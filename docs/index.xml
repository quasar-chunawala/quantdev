<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>quantdev.blog</title>
<link>http://quantdev.blog/index.html</link>
<atom:link href="http://quantdev.blog/index.xml" rel="self" type="application/rss+xml"/>
<description></description>
<generator>quarto-1.3.450</generator>
<lastBuildDate>Mon, 24 Nov 2025 00:00:00 GMT</lastBuildDate>
<item>
  <title>Generators, iterators and asynchronous programming</title>
  <dc:creator>Quasar </dc:creator>
  <link>http://quantdev.blog/posts/generators_iterators_and_asynchronous_programming/index.html</link>
  <description><![CDATA[ 




<section id="what-is-a-generator" class="level1">
<h1>What is a generator?</h1>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>load_ext itikz</span></code></pre></div>
</div>
<p>A generator is a function that uses the <code>yield</code> keyword to return an item. When a generator function is called, it returns a generator object, which is a type of iterator. Here is a simple generator, that produces a sequence of numbers:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> number_generator(n):</span>
<span id="cb2-2">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n):</span>
<span id="cb2-3">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">yield</span> i</span>
<span id="cb2-4"></span>
<span id="cb2-5">gen <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> number_generator(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1_000_000</span>)</span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">next</span>(gen))</span>
<span id="cb2-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">next</span>(gen))</span>
<span id="cb2-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">next</span>(gen))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0
1
2</code></pre>
</div>
</div>
<p>The state of the generator is saved between <code>yield</code> calls. The state of generator is the state of the local variables when the generator is suspended. This allows it to resume where it left off.</p>
<p>The main use of generators is to save memory - instead of having a very large list of elements in memory, holding everything at once, we have an object that knows how to produce each particular element, one at a time. This enables lazy computations of heavy objects in memory.</p>
</section>
<section id="example-flattening-a-list-of-lists" class="level1">
<h1>Example: Flattening a list of lists</h1>
<p>A common task is to flatten a list of lists into a single list.</p>
<p>Imagine you have a list of trades, where each trade has a list of associated cashflows. You want to process all cashflows from all trades.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ref: bwrob.github.io/posts/python-academy-iteration </span></span>
<span id="cb4-2">trades_cashflows <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb4-3">    [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>],   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cashflows for trade 1</span></span>
<span id="cb4-4">    [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>],       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cashflows for trade 2</span></span>
<span id="cb4-5">    [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>],  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cashflows for trade 3</span></span>
<span id="cb4-6">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">110</span>             <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simple payment doesn't need to be in a list</span></span>
<span id="cb4-7">]</span>
<span id="cb4-8"></span>
<span id="cb4-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> flatten(list_of_lists):</span>
<span id="cb4-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> item <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> list_of_lists:</span>
<span id="cb4-11">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">isinstance</span>(item, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>):</span>
<span id="cb4-12">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> subitem <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> item:</span>
<span id="cb4-13">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">yield</span> subitem</span>
<span id="cb4-14">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb4-15">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">yield</span> item</span>
<span id="cb4-16"></span>
<span id="cb4-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The generator does not hold all cashflows in memory</span></span>
<span id="cb4-18">all_cashflows_generator <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> flatten(trades_cashflows)</span>
<span id="cb4-19"></span>
<span id="cb4-20"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> cf <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_cashflows_generator:</span>
<span id="cb4-21">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(cf, end<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>10 20 30 15 25 100 -10 5 110 </code></pre>
</div>
</div>
<p>This <code>flatten</code> generator is memory-efficient. It only needs to store one cashflow at a time, regardless of the total number of cashflows.</p>
</section>
<section id="example-generating-the-fibonacci-sequence" class="level1">
<h1>Example: Generating the fibonacci sequence</h1>
<p>The Fibonacci sequence is defined by the recurrence relation: <img src="https://latex.codecogs.com/png.latex?F_n%20=%20F_%7Bn-1%7D%20+%20F_%7Bn-2%7D"> with seed values <img src="https://latex.codecogs.com/png.latex?F_0%20=%200"> and <img src="https://latex.codecogs.com/png.latex?F_1%20=%201">. A naive implementation of this in Python is a direct translation of the mathematical formula:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> fibonacci_recursive(n: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>):</span>
<span id="cb6-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Calculate the nth Fibonacci number using a recursive approach."""</span></span>
<span id="cb6-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb6-4">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fibonacci is not defined for negative numbers"</span>)</span>
<span id="cb6-5">    </span>
<span id="cb6-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>:</span>
<span id="cb6-7">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> n</span>
<span id="cb6-8"></span>
<span id="cb6-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> fibonacci_recursive(n) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> fibonacci_recursive(n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
</div>
<p>For <code>n=40</code>, this already takes a long amount of time. We are doing lot of rework. Another way to solve this problem is to use an iterative approach.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> fibonacci_iterative(n: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>):</span>
<span id="cb7-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Calculate the nth Fibonacci number using an iterative approach."""</span></span>
<span id="cb7-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb7-4">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fibonacci is not defined for negative numbers"</span>)</span>
<span id="cb7-5"></span>
<span id="cb7-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>:</span>
<span id="cb7-7">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> n</span>
<span id="cb7-8"></span>
<span id="cb7-9">    a, b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb7-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> _ <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb7-11">        a, b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> b, a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b</span>
<span id="cb7-12">    </span>
<span id="cb7-13">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> b</span></code></pre></div>
</div>
<p>We can also code up a generator to produce the fibonacci sequence.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> fibonacci_generator():</span>
<span id="cb8-2">    a, b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb8-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">while</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>:</span>
<span id="cb8-4">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">yield</span> a</span>
<span id="cb8-5">        a, b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> b, a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b</span>
<span id="cb8-6"></span>
<span id="cb8-7">gen <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> fibonacci_generator()</span>
<span id="cb8-8"></span>
<span id="cb8-9"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>):</span>
<span id="cb8-10">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"F_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>i<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> = </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">next</span>(gen)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>F_0 = 0
F_1 = 1
F_2 = 1
F_3 = 2
F_4 = 3
F_5 = 5
F_6 = 8
F_7 = 13
F_8 = 21
F_9 = 34</code></pre>
</div>
</div>
</section>
<section id="generator-expressions" class="level1">
<h1>Generator expressions</h1>
<p>List comprehensions are widely used in Python. However, many of the use-cases do not need to have the full list created in-memory. Instead, they only need to iterate over the elements one at a time.</p>
<p>For example, the following summation code will build a full list of squares in memory, iterate over those values, and when the reference is no longer needed, delete the list.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>([x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> x <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)])</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>285</code></pre>
</div>
</div>
<p>Memory is conserved by using a generator expression instead.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> x <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>285</code></pre>
</div>
</div>
<p>Consider taking the inner product of the vectors <code>x_vector</code> and <code>y_vector</code>:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1">x_vector <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>]</span>
<span id="cb14-2">y_vector <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]</span>
<span id="cb14-3"></span>
<span id="cb14-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> y <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> x, y <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(x_vector, y_vector))</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>130</code></pre>
</div>
</div>
</section>
<section id="iterators" class="level1">
<h1>Iterators</h1>
<p>An iterator is an object that represents a stream of data. It produces one item at a time, only when requested. This <em>lazy</em> evaluation is incredibly memory-efficient. The iterator protocol in Pythoon consists of two methods:</p>
<ul>
<li><code>__iter__()</code>: Returns the iterator object itself</li>
<li><code>__next__()</code>: Returns the next item from the stream. When there are no more items, it raise a <code>StopIteration</code> exception.</li>
</ul>
<p>Having these protocols in Python has an advantage: everyone know that Python will be familiar with this interface already, so there a sort of <em>standard contract</em>.</p>
</section>
<section id="example-finding-the-implied-volatility-of-european-vanilla-options-using-an-iterative-root-solver" class="level1">
<h1>Example : Finding the implied volatility of European vanilla options using an iterative root-solver</h1>
<p>For the purposes of this example, I will use the <a href="https://en.wikipedia.org/wiki/Bisection_method">bisection method</a> to solve for the implied volatility of a European call option.</p>
<p>The bisection method makes use of the <a href="https://en.wikipedia.org/wiki/Intermediate_value_theorem">intermediate value theorem</a>(IVT) from Real Analysis. The intermediate value theorem states that the image of a continuous function <img src="https://latex.codecogs.com/png.latex?f"> over an interval <img src="https://latex.codecogs.com/png.latex?(a,b)"> is an interval. If <img src="https://latex.codecogs.com/png.latex?f"> is a continuous function, it preserves intervals. If we take an interval and apply a continous function <img src="https://latex.codecogs.com/png.latex?f"> to it, the image is also an interval. It captures the intuitive notion, there are no gaps or jumps in a continuous curve. If <img src="https://latex.codecogs.com/png.latex?f"> is continuous and <img src="https://latex.codecogs.com/png.latex?f(a)%20%3C%20k%20%3Cf(b)">, then there exists an element <img src="https://latex.codecogs.com/png.latex?c%5Cin(a,b)">, such that <img src="https://latex.codecogs.com/png.latex?f(c)=k">.</p>
<section id="iteration-process" class="level2">
<h2 class="anchored" data-anchor-id="iteration-process">Iteration process</h2>
<p>We start with an initial interval <img src="https://latex.codecogs.com/png.latex?%5Ba,b%5D">, such that the function values <img src="https://latex.codecogs.com/png.latex?f(a)"> and <img src="https://latex.codecogs.com/png.latex?f(b)"> are of opposite sign.</p>
<p><strong>Step 1</strong>. We calculate the midpoint <img src="https://latex.codecogs.com/png.latex?m%20=%20(a%20+%20b)/2">.</p>
<p><strong>Step 2</strong>. Case I. If <img src="https://latex.codecogs.com/png.latex?f(a)"> and <img src="https://latex.codecogs.com/png.latex?f(m)"> have the same signs, the root must be in the right half <img src="https://latex.codecogs.com/png.latex?%5Bm,b%5D">. So, we set <img src="https://latex.codecogs.com/png.latex?a=m">.</p>
<p>Case II. If <img src="https://latex.codecogs.com/png.latex?f(m)"> and <img src="https://latex.codecogs.com/png.latex?f(b)"> have the same signs, the root must be in the left half <img src="https://latex.codecogs.com/png.latex?%5Ba,m%5D">. So, we set <img src="https://latex.codecogs.com/png.latex?b=m">.</p>
<p>We iteratively perform steps (1) and (2) until the absolute or relative error is within a certain tolerance <img src="https://latex.codecogs.com/png.latex?%5Cepsilon">.</p>
<div class="text-center">
<div class="cell" data-execution_count="10">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span>itikz <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span>temp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dir</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span>tex<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>packages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tikz <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span>tikz<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>libraries<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>backgrounds <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span>implicit<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>standalone</span>
<span id="cb16-2"></span>
<span id="cb16-3"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Scenario <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>: Root <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> left half</span>
<span id="cb16-4">\begin{tikzpicture}[scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>, background rectangle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>white}, show background rectangle]</span>
<span id="cb16-5">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Axes</span>
<span id="cb16-6">    \draw[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>] (<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) node[right] {$x$}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb16-7">    \draw[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>] (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>) node[above] {$y$}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb16-8">    </span>
<span id="cb16-9">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Points</span>
<span id="cb16-10">    \coordinate (a) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb16-11">    \coordinate (b) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb16-12">    \coordinate (m) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb16-13">    </span>
<span id="cb16-14">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Function curve (convex)</span>
<span id="cb16-15">    \draw[thick, blue, domain<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>:<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span>, samples<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>] </span>
<span id="cb16-16">        plot (\x, {<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(\x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(\x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>})<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb16-17">    </span>
<span id="cb16-18">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Vertical lines <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> points</span>
<span id="cb16-19">    \draw[dashed] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,{<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>})<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb16-20">    \draw[dashed] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>,{<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>})<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb16-21">    \draw[dashed] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span>,{<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>})<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb16-22">    </span>
<span id="cb16-23">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Function values</span>
<span id="cb16-24">    \fill[red] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,{<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>}) circle (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>) </span>
<span id="cb16-25">        node[below left] {$f(a) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>$}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb16-26">    \fill[red] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>,{<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>}) circle (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>) </span>
<span id="cb16-27">        node[below right] {$f(m) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>$}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb16-28">    \fill[red] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span>,{<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>}) circle (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>) </span>
<span id="cb16-29">        node[above right] {$f(b) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>$}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb16-30">    </span>
<span id="cb16-31">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>axis labels</span>
<span id="cb16-32">    \fill (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) circle (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>) node[below] {$a$}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb16-33">    \fill (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) circle (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>) node[below] {$m$}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb16-34">    \fill (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) circle (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>) node[below] {$b$}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb16-35">    </span>
<span id="cb16-36">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Root indicator</span>
<span id="cb16-37">    \draw[thick, red] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb16-38">    \node[red] at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>) {Root <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> $[a, m]$}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb16-39">    </span>
<span id="cb16-40">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Title</span>
<span id="cb16-41">    \node[align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>center] at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) {\textbf{Scenario <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:} $f(m)$ <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> $f(b)$ have same sign}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb16-42">    \node[align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>center] at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>) {New interval: $[a, m]$}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb16-43">\end{tikzpicture}</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="10">
<p><img src="http://quantdev.blog/posts/generators_iterators_and_asynchronous_programming/index_files/figure-html/cell-11-output-1.svg" class="img-fluid"></p>
</div>
</div>
</div>
<div class="text-center">
<div class="cell" data-execution_count="11">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span>itikz <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span>temp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dir</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span>tex<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>packages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tikz <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span>tikz<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>libraries<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>backgrounds <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span>implicit<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>standalone</span>
<span id="cb17-2">\begin{tikzpicture}[scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>, background rectangle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>white}, show background rectangle]</span>
<span id="cb17-3">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Axes</span>
<span id="cb17-4">    \draw[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>] (<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) node[right] {$x$}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb17-5">    \draw[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>] (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>) node[above] {$y$}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb17-6">    </span>
<span id="cb17-7">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Points</span>
<span id="cb17-8">    \coordinate (a) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb17-9">    \coordinate (b) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb17-10">    \coordinate (m) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb17-11">    </span>
<span id="cb17-12">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Function curve (convex)</span>
<span id="cb17-13">    \draw[thick, blue, domain<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>:<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span>, samples<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>] </span>
<span id="cb17-14">        plot (\x, {<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(\x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(\x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>})<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb17-15">    </span>
<span id="cb17-16">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Vertical lines <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> points</span>
<span id="cb17-17">    \draw[dashed] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,{<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>})<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb17-18">    \draw[dashed] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>,{<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>})<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb17-19">    \draw[dashed] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span>,{<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>})<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb17-20">    </span>
<span id="cb17-21">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Function values</span>
<span id="cb17-22">    \fill[red] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,{<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>}) circle (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>) </span>
<span id="cb17-23">        node[above left] {$f(a) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>$}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb17-24">    \fill[red] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>,{<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>}) circle (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>) </span>
<span id="cb17-25">        node[above right] {$f(m) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>$}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb17-26">    \fill[red] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span>,{<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>}) circle (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>) </span>
<span id="cb17-27">        node[below right] {$f(b) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>$}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb17-28">    </span>
<span id="cb17-29">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>axis labels</span>
<span id="cb17-30">    \fill (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) circle (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>) node[below] {$a$}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb17-31">    \fill (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) circle (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>) node[below] {$m$}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb17-32">    \fill (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) circle (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>) node[below] {$b$}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb17-33">    </span>
<span id="cb17-34">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Root indicator</span>
<span id="cb17-35">    \draw[thick, red] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb17-36">    \node[red] at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>) {Root <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> $[m, b]$}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb17-37">    </span>
<span id="cb17-38">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Title</span>
<span id="cb17-39">    \node[align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>center] at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) {\textbf{Scenario <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>:} $f(a)$ <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> $f(m)$ have same sign}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb17-40">    \node[align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>center] at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>) {New interval: $[m, b]$}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb17-41">\end{tikzpicture}</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="11">
<p><img src="http://quantdev.blog/posts/generators_iterators_and_asynchronous_programming/index_files/figure-html/cell-12-output-1.svg" class="img-fluid"></p>
</div>
</div>
</div>
<p>A call option is the right to buy an asset at a future time <img src="https://latex.codecogs.com/png.latex?T">, at a pre-determined price <img src="https://latex.codecogs.com/png.latex?K">. A put option is the right to sell an asset at a future time <img src="https://latex.codecogs.com/png.latex?T">, at a pre-determined price <img src="https://latex.codecogs.com/png.latex?K">.</p>
<p>Vanilla options have two quote conventions - they can be quoted in terms of a price (in dollar terms) or in terms of the implied volatility. The Black-Scholes analytic formula used as a converter to convert an implied-vol quote to a price.</p>
<p>Let <img src="https://latex.codecogs.com/png.latex?%5Csigma"> be the market-implied volatility of the option. Then, the option price is given by:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AC_%7BBS%7D(%5Csigma)%20=%20S_t%20%5CPhi(d_%7B+%7D)%20-%20K%20e%5E%7B-r(T-t)%7D%5CPhi(d_%7B-%7D)%0A"></p>
<p>where</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ad_%7B%5Cpm%7D%20=%20%5Cfrac%7B%5Clog(S_t/K)%20+%20(r%20%5Cpm%20%5Csigma%5E2/2)(T-t)%7D%7B%5Csigma%20%5Csqrt%7BT-t%7D%7D%0A"></p>
<p>Conversely, if we have the option price <img src="https://latex.codecogs.com/png.latex?C_%7BBS%7D">, we can backout the implied volatility <img src="https://latex.codecogs.com/png.latex?%5Csigma">, by solving for the root of the above equation.</p>
<p>Thus, we can define</p>


</section>
</section>

 ]]></description>
  <category>Python</category>
  <guid>http://quantdev.blog/posts/generators_iterators_and_asynchronous_programming/index.html</guid>
  <pubDate>Mon, 24 Nov 2025 00:00:00 GMT</pubDate>
  <media:content url="http://quantdev.blog/posts/generators_iterators_and_asynchronous_programming/python.svg" medium="image" type="image/svg+xml"/>
</item>
<item>
  <title>Pythonic code</title>
  <dc:creator>Quasar </dc:creator>
  <link>http://quantdev.blog/posts/pythonic_code/index.html</link>
  <description><![CDATA[ 




<section id="pythonic-code" class="level1">
<h1>Pythonic code</h1>
<section id="context-managers" class="level2">
<h2 class="anchored" data-anchor-id="context-managers">Context Managers</h2>
<p>Context managers are a very useful feature in Python. Most of the time, we see contet managers around resource management. For example, in situations, when we open files, we want to make sure they are closed after processing (so we do not leak file descriptors). Or, if we open a connection to a service (or even a socket), we also want to be sure to close it accordingly. In all of these cases, you would normally have to remember to free all of the resources that were allocated and that is just thinking about the best case - there could be also be exceptions and error handling. Handling all possible combinations and execution paths of our program makes it harder. There is a elegant Pythonic way of handling this.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(filename) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> fd:</span>
<span id="cb1-2">    process_file(fd)</span></code></pre></div>
<p>The <code>with</code> statement (PEP-43) enters the context manager. In this case, the <code>open</code> function implements the context manager protocol, which means that the file will be automatically closed when the block is finished, even if an exception occurred.</p>
<p>Context managers consist of two magic methods <code>__enter__</code> and <code>__exit__</code>. On the first line of the context manager, the <code>with</code> statement will call the first method, <code>__enter__</code>, and whatever this method returns will be assigned to the variable after <code>as</code>. This is optional - we dont really need to return anything specific on the <code>__enter__</code> method, even if we do, there is still no strict reason to assign it to a variable if it is not needed.</p>
<p>After this line is executed, the code enters a new context, where any other Python code can be run. After the last statement on the block is finished, the context will be exited, meaning that Python will call the <code>__exit__</code> method of the original context manager object we first invoked.</p>
<p>If there is an exception or error inside the context manager block, the <code>__exit__</code> method will still be called, which makes it convenient for safely cleaning up the conditions. In fact, this method receives the exceptions that was triggered on the block in case we want to handle it in a custom fashion.</p>
<p>Context managers are a good way of seperating concerns and isolating parts of the code that should be kept independent, because if we mix them, then the logic will become harder to maintain.</p>
<p>As an example, consider a situation where we want to run a backup of our database with a script. The caveat is that the backup is offline, which means that we can only do it while the database is not running, and for this we have to stop it. After running the backup, we want to be sure that we start the process again, regardless of how the backup itself went.</p>
<p>Instead of creating a monolithic function to do this, we can tackle this issue with context managers:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> stop_database():</span>
<span id="cb2-2">    run(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"systemctl stop postgresql.service"</span>)</span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> start_database():</span>
<span id="cb2-5">    run(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"systemctl start postgresql.service"</span>)</span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> DBHandler:</span>
<span id="cb2-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__enter__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb2-9">        stop_database()</span>
<span id="cb2-10">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span></span>
<span id="cb2-11">    </span>
<span id="cb2-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__exit__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, exc_type, ex_value, ex_traceback):</span>
<span id="cb2-13">        start_database()</span>
<span id="cb2-14">    </span>
<span id="cb2-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> db_backup():</span>
<span id="cb2-16">    run(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pg_dump database"</span>)</span>
<span id="cb2-17"></span>
<span id="cb2-18"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> main():</span>
<span id="cb2-19">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> DBHandler():</span>
<span id="cb2-20">        db_backup()</span></code></pre></div>
<section id="implementing-context-managers" class="level3">
<h3 class="anchored" data-anchor-id="implementing-context-managers">Implementing context managers</h3>
<p>In general, we can implement context managers like the one in the previous example. All we need is just a class that implements the <code>__enter__</code> and <code>__exit__</code> magic methods, and then that object will be able to support the context manager protocol. While this is the most common way for context managers to be implemented, it is not the only one.</p>
<p>The <code>contextlib</code> module in the Python standard library contains a lot of helper functions and objects to implement context managers or use ones already provided that can help us write more compact code.</p>
<p>Lets start by looking at the <code>contextmanager</code> decorator.</p>
<p>When the <code>contextlib.contextmanager</code> decorator is applied to a function, it converts the code on that function into a context manager. The function in question has to be a particular kind of function called a <code>generator</code> function, which will separate statements into what is going to be on <code>__enter__</code> and <code>__exit__</code> magic methods respectively.</p>
<p>The equivalent code in the previous example can be written as:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> contextlib</span>
<span id="cb3-2"></span>
<span id="cb3-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@contextlib.contextmanager</span></span>
<span id="cb3-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> db_handler():</span>
<span id="cb3-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb3-6">        stop_database()</span>
<span id="cb3-7">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">yield</span></span>
<span id="cb3-8">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">finally</span>:</span>
<span id="cb3-9">        start_database()</span>
<span id="cb3-10"></span>
<span id="cb3-11"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> db_handler():</span>
<span id="cb3-12">    db_backup()</span></code></pre></div>
<p>Here, we define the <code>generator</code> function and apply the <code>@contextlib.contextmanager</code> decorator to it. The function contains a <code>yield</code> statement, which makes it a generator function. Details on generators are not important at this point. All we need to know, is when the decorator is applied, everything before the <code>yield</code> statement will be run as if it were part of the <code>__enter__</code> method. Then the yielded value is going to be the result of the context manager evaluation (what <code>__enter__</code> would return and what would be assigned to the variable if we chose to assign it like <code>as x:</code> - in this case nothing is yielded).</p>
<p>At the <code>yield</code> statement, the <code>generator</code> function is suspended, and the context manager is entered, where, again we run the backup code for our database. After this completes, the execution resumes, so we can consider every line that comes after the <code>yield</code> statement will be part of <code>__exit__</code> logic.</p>
<p>Writing context managers like this has the advantage that it is easier to refactor existing functions, reuse code and in general a good idea when we need a context manager that doesnt belong to a particular object.</p>
<p>Using context managers is considered idiomatic.</p>
</section>
</section>
<section id="comprehensions-and-assignment-expressions" class="level2">
<h2 class="anchored" data-anchor-id="comprehensions-and-assignment-expressions">Comprehensions and assignment expressions</h2>
<p>The use of comprehensions is recommended to create data-structures in a single instruction, instead of multiple operations. For example, if we wanted to create a list with calculations over some numbers in it, instead of:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1">numbers <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb4-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>):</span>
<span id="cb4-3">    numbers.append(run_calculation(i))</span></code></pre></div>
<p>we could do:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1">numbers <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [run_calculation(i) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)]</span></code></pre></div>
<p>The introduction of assignment expressions in <a href="https://www.python.org/dev/peps/pep-0572/">PEP-572</a> is also very useful.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute partial sums in a list comprehension</span></span>
<span id="cb6-2">total <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb6-3">partial_sums <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [total <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:=</span> total <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> v <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> v <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> values]</span>
<span id="cb6-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total:"</span>, total)</span></code></pre></div>
<p>The <code>:=</code> operator is informally known as the walrus operator.</p>
<p>Keep in mind however, that a more compact code does not always mean better better code. If to write a one-liner, we have to create a convoluted expression, then its not worth it, and we would be better off using a naive approach. This is related to the <em>Keep it simple, stupid</em>(KISS) principle.</p>
<p>Another good reason for using assignment expressions in general is the performance considerations. If we have to use a function as part of our transformation logic, we dont want to call that more than is necessary. Assigning the result of the function to a temporary identifier is a good optimization technique.</p>
</section>
<section id="properties-attributes-and-different-types-of-methods-for-objects" class="level2">
<h2 class="anchored" data-anchor-id="properties-attributes-and-different-types-of-methods-for-objects">Properties, attributes and different types of methods for objects</h2>
<p>All of the properties and functions of object are <code>public</code> in Python, which is different from other languages where properties can have the access specifier <code>public</code>, <code>private</code> and <code>protected</code>. That is, there is no point in preventing the caller from invoking any attributes an object has.</p>
<p>There is no strict enforcement, but there are some conventions. An attribute that starts with an underscore is meant to be <code>private</code> to that object, and we expect that no external agent calls it (but again nothing preventing this).</p>
<section id="underscores-in-python" class="level3">
<h3 class="anchored" data-anchor-id="underscores-in-python">Underscores in Python</h3>
<p>There are some conventions and implementation details that make use of underscores in Python, which is an interesting topic in itself thats worthy of analysis.</p>
<p>Like I mentioned, by default, all attributes of an object in python are <code>public</code>. Consider the following example :</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> Point:</span>
<span id="cb7-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, x_value, y_value):</span>
<span id="cb7-3">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._x_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x_value</span>
<span id="cb7-4">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._y_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> y_value</span>
<span id="cb7-5"></span>
<span id="cb7-6">p1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Point(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.0</span>)</span>
<span id="cb7-7">p1.__dict__</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>{'_x_value': 1.0, '_y_value': 2.0}</code></pre>
</div>
</div>
<p>Attributes that start with an underscore must be respected as <code>private</code> and not called externally. Using a single underscore prefix is the Pythonic way of clearly delimiting the interface of the object.</p>
<p>Note that, using too many internal methods and attributes could be a sign that a class has too many tasks and doesnt comply with the single responsibility princple.</p>
<p>There is however, a common misconception that some attributes and methods can actually be made <code>private</code>. This is again a misconception. Let us imagine that the <code>x_value</code> and <code>y_value</code> attributes are defined with a leading double underscore instead.</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> Point:</span>
<span id="cb9-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, x_value : <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>, y_value : <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">FloatingPointError</span>):</span>
<span id="cb9-3">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.__x_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x_value</span>
<span id="cb9-4">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._y_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> y_value</span>
<span id="cb9-5"></span>
<span id="cb9-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> scale(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, scale_factor : <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>):</span>
<span id="cb9-7">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.__x_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*=</span> scale_factor</span>
<span id="cb9-8">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._y_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*=</span> scale_factor</span>
<span id="cb9-9"></span>
<span id="cb9-10"></span>
<span id="cb9-11">p1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Point(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.0</span>)</span>
<span id="cb9-12">p1.scale(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.0</span>)</span>
<span id="cb9-13">p1.__x_value</span></code></pre></div>
<p>Output:</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb10-1">--------------------------------------------------------------------------</span>
<span id="cb10-2">AttributeError                            Traceback (most recent call last)</span>
<span id="cb10-3">Cell In[7], line 13</span>
<span id="cb10-4">     11 p1 = Point(1.0, 2.0)</span>
<span id="cb10-5">     12 p1.scale(2.0)</span>
<span id="cb10-6">---&gt; 13 p1.__x_value</span>
<span id="cb10-7"></span>
<span id="cb10-8">AttributeError: 'Point' object has no attribute '__x_value'</span></code></pre></div>
<p>Some developers use this method to hide some attributes, thinking that <code>x_value</code> is now <code>private</code> and that no other object can modify it. Now, take a look at the exception that it raised when trying to access <code>__x_value</code>. Its <code>AttributeError</code> saying that it doesnt exist. It doesnt say something like <em>this is private</em>,</p>
<p>Whats actually happening is that with the double underscores, Python creates a different name for the attribute (this is called as name mangling). What it does is create the attribute with the following name instead <code>&lt;class_name&gt;__&lt;attribute_name&gt;</code>. In this case the attribute named <code>Point__x_value</code> will be created.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1">p1.__dict__</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>{'_x_value': 1.0, '_y_value': 2.0}</code></pre>
</div>
</div>
<p>The idea of a double underscore in Python is completely different. It was created as a means to override different methods of a class that is going to be extended several times. Double underscores are a non-Pythonic approach. If you need to defined attributes as <code>private</code>, use a single underscore and respect the Pythonic convention that it is a <code>private</code> attribute.</p>
</section>
<section id="properties" class="level3">
<h3 class="anchored" data-anchor-id="properties">Properties</h3>
<p>Typically, in object-oriented design we create objects to represent an abstraction over an entity of the problem domain. In this sense, objects can encapsulate the behavior or data. And more often than not, the accuracy of the data determines if an object can be created or not. That is to say, entities can exist for certain values of the data only, and incorrect values should not be allowed.</p>
<p>That is, why we create validation methods, typically to be used in <code>setter</code> operations. However, in Python, we can encapsulate the <code>setter</code> and <code>getter</code> methods more compactly using <code>properties</code>.</p>
<p>Consider the example of a geographical system that needs to deal with coordinates. There is only a certain range of values for which the latitude and the longitude make sense. Outside of those values, a coordinate cannot exist.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> Coordinate:</span>
<span id="cb13-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, lat: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">long</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb13-3">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._latitude <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._longitude <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb13-4">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.latitude <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> lat</span>
<span id="cb13-5">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.longitude <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">long</span></span>
<span id="cb13-6"></span>
<span id="cb13-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@property</span></span>
<span id="cb13-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> latitude(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>:</span>
<span id="cb13-9">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._latitude</span>
<span id="cb13-10"></span>
<span id="cb13-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@latitude.setter</span></span>
<span id="cb13-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> latitude(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, lat_value: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb13-13">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> lat_value <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb13-14">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>lat_value<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> is an invalid value for latitude"</span>)</span>
<span id="cb13-15"></span>
<span id="cb13-16">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._latitude <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> lat_value</span>
<span id="cb13-17"></span>
<span id="cb13-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@property</span></span>
<span id="cb13-19">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> longitude(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>:</span>
<span id="cb13-20">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._longitude</span>
<span id="cb13-21"></span>
<span id="cb13-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@longitude.setter</span></span>
<span id="cb13-23">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> longitude(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, long_value:<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb13-24">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> long_value <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">180</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">180</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb13-25">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>lat_value<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> is an invalid value for longitude"</span>)</span>
<span id="cb13-26"></span>
<span id="cb13-27">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._longitude <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> long_value</span></code></pre></div>
</div>
</section>
</section>
<section id="using-dataclasses" class="level2">
<h2 class="anchored" data-anchor-id="using-dataclasses">Using <code>dataclasses</code></h2>
<p>A <code>dataclass</code> is a class that exists primarily to store values which are accessible by attribute lookup and not complex logic. There is a common boilerplate when it comes to initialization of such objects, which is to declare in the <code>__init__</code> method all attributes that the object will have, and then set that to internal variables.</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> Point:</span>
<span id="cb14-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, x:<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>, y:<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb14-3">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x</span>
<span id="cb14-4">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> y</span></code></pre></div>
<p>Since Python 3.7 we can simplify this by using the <code>dataclasses</code> module, which was introduced in <a href="https://peps.python.org/pep-0557/#rationale">PEP-557</a>. Well review this module briefly to understand how it helps us write compact code.</p>
<p>The module provides a <code>@dataclass</code> decorator objectr which when applied to a class, itll take all the class attributes with annotations and treat them as instance attributes, as if they were declared in the initialization method. When using this method, it will automatically generate the <code>__init__</code> method on the class.</p>
<p>Additionally, this module provides a <code>field</code> object that will help us define particular traits for some of the attributes.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dataclasses <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> dataclass, field</span>
<span id="cb15-2"></span>
<span id="cb15-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@dataclass</span></span>
<span id="cb15-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> VanillaOptionQuote:</span>
<span id="cb15-5">    strike : <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span></span>
<span id="cb15-6">    spot : <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span></span>
<span id="cb15-7">    implied_vol : <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span> </span>
<span id="cb15-8">    underlying : <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> </span>
<span id="cb15-9">    time_to_maturity : <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> field(default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>)</span></code></pre></div>
</div>
<p>The <code>Field</code> objects describe each field. These objects are created internally and are returned by the <code>fields()</code> module-level method. Users should never instantiate a <code>Field</code> object directly. Its documented attributes are:</p>
<ul>
<li><code>name</code>: Name of the field</li>
<li><code>type</code>: The type of the field</li>
<li><code>default</code>: If provided, this will be th default value for this field.</li>
<li><code>default_factory</code>: If provided, it must be a zero-argument callable that will be called when a default value is needed for this field.</li>
<li><code>init</code>: If <code>true</code>(default), this field is included as a parameter in the generated <code>__init__</code> method.</li>
<li><code>__repr__</code> : If <code>true</code>(default), this field is included in the string returned by <code>__repr__</code> method.</li>
</ul>
<p>A good use-case for dataclass would be all those places when we need to use objects as data-containers or wrappers.</p>
<section id="immutable-dataclass" class="level3">
<h3 class="anchored" data-anchor-id="immutable-dataclass">Immutable <code>dataclass</code></h3>
<p>It is not possible to create truly immutable Python objects. However, by passing <code>frozen=True</code> to the <code>@dataclass</code> decorator you can emulate immutability. In that case, Data Classes will add <code>__setattr__</code> and <code>__delattr__</code> methods to the class. These methods will raise a <code>FrozenInstanceError</code> when invoked.</p>
</section>
<section id="why-not-just-use-attrs" class="level3">
<h3 class="anchored" data-anchor-id="why-not-just-use-attrs">Why not just use <code>attrs</code>?</h3>
<ul>
<li><code>attrs</code> moves faster than could be accomodated if it were moved to the standard library.</li>
<li><code>attrs</code> supports additional features not being proposed here : validators, converters, metadata etc.</li>
</ul>
</section>
</section>
<section id="iterable-objects" class="level2">
<h2 class="anchored" data-anchor-id="iterable-objects">Iterable objects</h2>
<p>In python, we have objects that can be iterated by default. For example, lists, sets, tuples and dictionaries can not only hold data in the structure, but also be iterated over a <code>for</code> loop to get those values repeatedly.</p>
<p>However, the built-in <code>iterable</code> objects are not the only kind we can have in a <code>for</code> loop. We can also create our own iterable, with the logic we define for iteration.</p>
<p>In order to achieve this, we rely again on magic methods. Iteration works in Python by its own protocol(namely the <code>iterator</code> protocol). When you try to iterate an object in the form <code>for e in my_collection:...</code>, at a high-level, Python checks for:</p>
<ul>
<li>If the object contains one of the iterator methods - <code>__next__</code> or <code>__iter__</code>.</li>
<li>If the object is a sequence and has <code>__len__</code> and <code>__get_item__</code></li>
</ul>
<section id="creating-iterable-objects" class="level3">
<h3 class="anchored" data-anchor-id="creating-iterable-objects">Creating iterable objects</h3>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> datetime <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> timedelta</span>
<span id="cb16-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> dt</span>
<span id="cb16-3"></span>
<span id="cb16-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> DateRange:</span>
<span id="cb16-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""An iterable that contains its own iterator object."""</span></span>
<span id="cb16-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, start_date: dt.date, end_date: dt.date):</span>
<span id="cb16-7">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._start_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> start_date</span>
<span id="cb16-8">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._end_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> end_date</span>
<span id="cb16-9">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._present_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> start_date</span>
<span id="cb16-10"></span>
<span id="cb16-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__iter__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb16-12">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span></span>
<span id="cb16-13"></span>
<span id="cb16-14">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__next__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb16-15">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._present_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._end_date:</span>
<span id="cb16-16">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">StopIteration</span>()</span>
<span id="cb16-17"></span>
<span id="cb16-18">        today <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._present_date</span>
<span id="cb16-19">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._present_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> timedelta(days<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb16-20">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> today</span>
<span id="cb16-21"></span>
<span id="cb16-22"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> day <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> DateRange(dt.date(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2026</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), dt.date(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2026</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)):</span>
<span id="cb16-23">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>day<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)        </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2026-01-01
2026-01-02
2026-01-03
2026-01-04
2026-01-05
2026-01-06
2026-01-07</code></pre>
</div>
</div>
</section>
<section id="the-basic-mechanics" class="level3">
<h3 class="anchored" data-anchor-id="the-basic-mechanics">The basic mechanics</h3>
<p>Here, the <code>for</code> loop starts a new iteration over our object. At this point Python will call the <code>iter()</code> function on it, which in turn will call the <code>__iter__</code> magic method. On this method, it is decided to return <code>self</code>, indicating that the object is an <code>iterable</code> itself. Every step of the loop calls the <code>next()</code> function on this object, which delegates to <code>__next__</code> method. When there is nothing else to produce, we have to signal this to Python by raising <code>StopIteration</code> exception.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DateRange(dt.date(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2026</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), dt.date(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2026</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>))</span>
<span id="cb18-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">next</span>(r))</span>
<span id="cb18-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">next</span>(r))</span>
<span id="cb18-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">next</span>(r))</span>
<span id="cb18-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">next</span>(r))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2026-01-01
2026-01-02
2026-01-03
2026-01-04</code></pre>
</div>
</div>
<p>This example works, but it has a small problem - once exhausted, the <code>iterable</code> will continue to be empty, hence raising <code>StopIteration</code>.</p>
<p>If there are two or more consecutive <code>for</code> loops, only the first one will work, while the second one will remain empty. Because, there is only one shared iteration state. We should separate out the iterator from the iterable.</p>
</section>
</section>
<section id="creating-sequences" class="level2">
<h2 class="anchored" data-anchor-id="creating-sequences">Creating sequences</h2>
<p>Maybe our object does not define the <code>__iter__()</code> method, but we still want to be able to iterate over it. If <code>__iter__</code> is not defined on the object, the <code>iter()</code> function will look for the presence of <code>__getitem__</code>, and if this is not found, it will raise <code>TypeError</code>.</p>
<p>A sequence is an object that implements <code>__len__</code> and <code>__getitem__</code> magic methods and expects to be able to get the elements it contains, one at a time, in order, starting at <img src="https://latex.codecogs.com/png.latex?0"> as the first index. This means that you should be careful in the logic so that you correctly implement <code>__get_item__</code> to expect this type of index, or the iteration will not work.</p>
<p>The example from the previous section had the advantage that it uses less memory. This means that it is only holding one date at a time and knows how to produce the days one by one. However, it has the drawback that if we want to get to the <code>n</code>th element, we have no way to do so but iterate <img src="https://latex.codecogs.com/png.latex?n"> times. until we reach it. This is a typical trade-off in CS between memory and CPU usage.</p>
<p>The implementation with an <code>iterable</code> will use memory, but take <img src="https://latex.codecogs.com/png.latex?O(n)"> time, whereas implementing a sequence will use more(because we have to hold everything at once),but supports indexing in constant time.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> DateRangeSequence:</span>
<span id="cb20-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, start_date : dt.date, end_date:dt.date):</span>
<span id="cb20-3">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._start_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> start_date</span>
<span id="cb20-4">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._end_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> end_date</span>
<span id="cb20-5">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._range <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._create_range()</span>
<span id="cb20-6"></span>
<span id="cb20-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _create_range(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb20-8">        days <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb20-9">        current_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._start_date</span>
<span id="cb20-10">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">while</span> current_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._end_date:</span>
<span id="cb20-11">            days.append(current_date)</span>
<span id="cb20-12">            current_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> timedelta(days<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb20-13"></span>
<span id="cb20-14">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> days</span>
<span id="cb20-15">    </span>
<span id="cb20-16">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__getitem__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, day_idx):</span>
<span id="cb20-17">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._range[day_idx]</span>
<span id="cb20-18"></span>
<span id="cb20-19">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__len__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb20-20">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._range)</span>
<span id="cb20-21"></span>
<span id="cb20-22">s1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DateRangeSequence(dt.date(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2026</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), dt.date(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2026</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb20-23"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> day <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> s1:</span>
<span id="cb20-24">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(day)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2026-01-01
2026-01-02
2026-01-03
2026-01-04
2026-01-05</code></pre>
</div>
</div>
</section>
<section id="container-objects" class="level2">
<h2 class="anchored" data-anchor-id="container-objects">Container objects</h2>
<p>Containers are objects that implement a <code>__contains__</code> method(that usually returns a <code>boolean</code> value). This method is called in the presence of the python keyword <code>in</code>.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dataclasses <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> dataclass</span>
<span id="cb22-2"></span>
<span id="cb22-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@dataclass</span></span>
<span id="cb22-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> Interval:</span>
<span id="cb22-5">    left_end_point : <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span> </span>
<span id="cb22-6">    right_end_point : <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span></span>
<span id="cb22-7">    exclude_right_end : <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb22-8"></span>
<span id="cb22-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__contains__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, x_value : <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>):</span>
<span id="cb22-10">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.exclude_right_end:</span>
<span id="cb22-11">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.left_end_point <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> x_value <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> x_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.right_end_point </span>
<span id="cb22-12">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb22-13">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.left_end_point <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> x_value <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> x_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.right_end_point </span>
<span id="cb22-14"></span>
<span id="cb22-15">interval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Interval(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>)</span>
<span id="cb22-16"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Is 0.5 contained in the interval [0,1) : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> interval<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb22-17"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Is 1.0 contained in the interval [0,1) : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> interval<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Is 0.5 contained in the interval [0,1) : True
Is 1.0 contained in the interval [0,1) : False</code></pre>
</div>
</div>
</section>
<section id="dynamic-attributes" class="level2">
<h2 class="anchored" data-anchor-id="dynamic-attributes">Dynamic attributes</h2>
<p>It is possible to control the way attributes are obtained from objects by means of the <code>__getattr__</code> magic method. When we call something like <code>&lt;my_object&gt;.&lt;my_attribute&gt;</code>, Python will look at <code>&lt;my_attribute&gt;</code> in the dictionary of the object, calling <code>__get_attribute__</code>. If this is not found (that is, the object does not have the attribute we are looking for), then the extra method <code>__getattr__</code> is called, passing in the name of the attribute as a parameter.</p>
<p>By receiving this value, we can control the way things should be returned to our objects. We can even create new attributes on the fly.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> DynamicAttributes:</span>
<span id="cb24-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, attribute):</span>
<span id="cb24-3">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.attribute <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> attribute</span>
<span id="cb24-4">    </span>
<span id="cb24-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__getattr__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, attr):</span>
<span id="cb24-6">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> attr.startswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback_"</span>):</span>
<span id="cb24-7">            name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> attr.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback_"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb24-8">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"[fallback resolved] </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb24-9">    </span>
<span id="cb24-10">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">AttributeError</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>__class__<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> has no attribute </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>attr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</div>
</section>
<section id="callable-objects" class="level2">
<h2 class="anchored" data-anchor-id="callable-objects">Callable objects</h2>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> collections <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> defaultdict</span>
<span id="cb25-2"></span>
<span id="cb25-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> CallCount:</span>
<span id="cb25-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb25-5">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._counts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> defaultdict(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>)</span>
<span id="cb25-6"></span>
<span id="cb25-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__call__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, argument):</span>
<span id="cb25-8">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._counts[argument] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb25-9">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._counts[argument]</span>
<span id="cb25-10"></span>
<span id="cb25-11">call_count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> CallCount()</span>
<span id="cb25-12"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(call_count(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hello"</span>))</span>
<span id="cb25-13"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(call_count(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"World"</span>))</span>
<span id="cb25-14"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(call_count(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hello"</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1
1
2</code></pre>
</div>
</div>
</section>
<section id="python-collections.abc-module" class="level2">
<h2 class="anchored" data-anchor-id="python-collections.abc-module">Python <code>collections.abc</code> module</h2>
<p>The best way to implement these methods is to declare our class to inherit from the corresponding class defined in the <code>collections.abc</code> module.</p>
<p>These interfaces provide the methods that need to be implemented, so itll make it easier for you to define the class correctly.</p>
<p>With practice and experience, you become more fluent with these features of Python, until it becomes second nature for you wrap the logic youre writing behind abstractions with nice and small interfaces. Give it enough time, and youll naturally think of having small, clean interfaces in your programs.</p>
</section>
<section id="caveats" class="level2">
<h2 class="anchored" data-anchor-id="caveats">Caveats</h2>
<section id="mutable-default-arguments" class="level3">
<h3 class="anchored" data-anchor-id="mutable-default-arguments">Mutable default arguments</h3>
<p>Dont use mutable objects as the default arguments of functions.</p>


</section>
</section>
</section>

 ]]></description>
  <category>Python</category>
  <guid>http://quantdev.blog/posts/pythonic_code/index.html</guid>
  <pubDate>Fri, 21 Nov 2025 00:00:00 GMT</pubDate>
  <media:content url="http://quantdev.blog/posts/pythonic_code/python.svg" medium="image" type="image/svg+xml"/>
</item>
<item>
  <title>Creating a tiny C++ Task Library</title>
  <dc:creator>Quasar </dc:creator>
  <link>http://quantdev.blog/posts/exploring_futures_and_promises/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>A <strong>future</strong> is an object that represents some undetermined result of a task that will be completed sometime in the future. A <strong>promise</strong> is the provider of that result.</p>
<p>The <code>std::promise</code> and <code>std::future</code> pair implements a one-short producer-consumer channel with the promise as the producer and the future as the consumer. The consumer (<code>std::future</code>) can can block until the result of the producer (<code>std::promise</code>) is available.</p>
<p>Many modern programming languages provide similar asynchronous approaches, such as Python(with the <code>asyncio</code> library), Scala(in the <code>scala.concurrent</code> library), Rust(in its standard library <code>std</code> or crates such as <code>promising_future</code>).</p>
<p>The basic principle behind achieving asynchronous execution using promises and futures is that a function we want to run to generate a result is executed in the background, using a new thread or the current one, and a future object is used by the initial thread to retrieve the result computed by the function. This result value will be stored when the function finishes, so meanwhile, the future acts as a placeholder. The asynchronous function will use a promise object to store the result in the future with no need for explicit synchronization mechanisms between the initial thread and the background one. When the value is needed by the initial thread, it will be retrieved from the future object. If the value is still not ready, the initial thread of execution will be blocked until the future becomes ready.</p>
<p>Using promises and futures improves responsiveness by offloading computations and provides a structured approach to handling asynchronous operations compared to threads and callbacks.</p>
<section id="the-basic-mechanics" class="level2">
<h2 class="anchored" data-anchor-id="the-basic-mechanics">The Basic Mechanics</h2>
<section id="promises" class="level3">
<h3 class="anchored" data-anchor-id="promises">Promises</h3>
<p>A promise holds a shared state. The shared state is a memory area that stores the completion status, synchronization mechanisms, and a pointer to the result. It ensures proper communication and synchronization between a promise and a future by enabling the promise to store either a result or an exception, signal when its complete and allowing the future to access the result, blocking if the promise is not yet ready. The promise can update its shared state using the following operations:</p>
<ul>
<li><p><strong>Make ready</strong>. The promise stores the result in the shared state and makes the state of the promise to become ready unblocking any thread waiting on a future associated with the promise.</p></li>
<li><p><strong>Release</strong>. The promise releases its reference to the shared state, which will be destroyed if this is the last reference.</p></li>
<li><p><strong>Abandon</strong>. The promise stores an exception of type <code>std::future_error</code> with error code <code>std::future_errc::broken_promise</code> making the shared state ready and then releasing it.</p></li>
</ul>
<p>The value of a promise can be set using the <code>std::promise</code> function <code>set_value()</code> and an exception by using the <code>set_exception()</code> function. The result is stored atomically in the promises shared state, making its state ready. Lets see an example:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Ref: Asynchronous programming with C++</span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//Javier Reguara Salgado</span></span>
<span id="cb1-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> threadFunc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[](</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> prom<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb1-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb1-5">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb1-6">        prom<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>set_value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>result<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb1-7">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">catch</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>exception<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> ex<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb1-8">        prom<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>set_exception<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>ex<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb1-9">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb1-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb1-11"></span>
<span id="cb1-12"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> prom<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-13"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>jthread<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>thread_func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>move<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>prom<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">));</span></span></code></pre></div>
<p><code>set_value()</code> can throw a <code>std::future_error</code> exception if the promise has no shared state (error code set to <code>no_state</code>) or the shared state has already a storedd result.</p>
<p><code>set_value()</code> can also be used without specifying a value. In that case, it simply makes the state ready. That can be used as a barrier, as we will see later in this blog post.</p>
</section>
<section id="futures" class="level3">
<h3 class="anchored" data-anchor-id="futures">Futures</h3>
<p>Futures are defined in the <code>&lt;future&gt;</code> header file as <code>std::future</code>.</p>
<p>As we saw earlier, a future is the consumer side of the communication channel. It provides access to the result stored by the promise.</p>
<p>A <code>std::future</code> object must be created from <code>std::promise</code> object by calling <code>get_future()</code> or through a <code>std::packaged_task</code> object or a call to the <code>std::async</code> function.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb2-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> prom<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>future<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> fut <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> prom<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get_future<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span></code></pre></div>
<p>Like promises, futures can be moved but not copied for the smae reasons. To reference the same shared state from multiple futures, we need to use shared futures.</p>
<p>The <code>get()</code> method can be used to retrieve the result. If the shared state is still not ready, this call will block internally calling <code>wait()</code>. When the shared state becomes ready, the result value is returned. If an exceptionwas sttored in the shared state, that exception will be retrhrown:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb3-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-2">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> fut<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span></span>
<span id="cb3-3">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Result from thread:"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> result<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-4"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">catch</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>exception<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> ex<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb3-5">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cerr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exception : "</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> ex<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>what<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>After calling the <code>get()</code> method, <code>valid()</code> will return <code>false</code>. If for some reason <code>get()</code> is called when <code>valid()</code> is <code>false</code>, the behavior is undefined, but the C++ standard recommends that a <code>std::future_error</code> exception is thrown with the <code>std::future_errc::no_state</code> error code.</p>
<p>When a future is destroyed, it releases it shared state reference. If that were the last reference, the shared state would be destroyed.</p>
</section>
</section>
<section id="a-quick-working-example" class="level2">
<h2 class="anchored" data-anchor-id="a-quick-working-example">A quick working example</h2>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb4-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;algorithm&gt;</span></span>
<span id="cb4-2"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;chrono&gt;</span></span>
<span id="cb4-3"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;future&gt;</span></span>
<span id="cb4-4"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;thread&gt;</span></span>
<span id="cb4-5"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;vector&gt;</span></span>
<span id="cb4-6"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;print&gt;</span></span>
<span id="cb4-7"></span>
<span id="cb4-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">namespace</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>chrono_literals<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-9"></span>
<span id="cb4-10"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb4-11">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span> user_list_promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-12">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span> orders_promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-13"></span>
<span id="cb4-14">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> fetch_users_ready <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> user_list_promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get_future<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb4-15">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> fetch_orders_ready <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> orders_promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get_future<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb4-16"></span>
<span id="cb4-17">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>jthread<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>user_list_thread<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">([&amp;](){</span></span>
<span id="cb4-18">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> userList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb4-19">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span> i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++</span>i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb4-20">            userList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>push_back<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb4-21">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>this_thread<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">::</span>sleep_for<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>chrono<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">::</span>milliseconds<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">));</span></span>
<span id="cb4-22">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb4-23">        user_list_promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>set_value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>userList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb4-24">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">});</span></span>
<span id="cb4-25"></span>
<span id="cb4-26">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>jthread<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>orders_thread<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">([&amp;](){</span></span>
<span id="cb4-27">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> orders<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb4-28">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span> i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++</span>i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb4-29">            orders<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>push_back<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb4-30">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>this_thread<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">::</span>sleep_for<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>chrono<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">::</span>milliseconds<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">));</span></span>
<span id="cb4-31">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb4-32">        orders_promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>set_value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>orders<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb4-33">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">});</span></span>
<span id="cb4-34"></span>
<span id="cb4-35">    fetch_users_ready<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>wait<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb4-36">    fetch_orders_ready<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>wait<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb4-37"></span>
<span id="cb4-38">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> users <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> fetch_users_ready<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb4-39">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> orders <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> fetch_orders_ready<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb4-40"></span>
<span id="cb4-41">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Users = </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> users<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb4-42">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Orders = </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> orders<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb4-43">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-44"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><a href="https://compiler-explorer.com/z/EqYY6MxaT">Compiler Explorer</a></p>
</section>
<section id="shared-futures" class="level2">
<h2 class="anchored" data-anchor-id="shared-futures">Shared Futures</h2>
<p>As we saw earlier, <code>std::future</code> is only moveable, thus only one future object can refer to a particular asynchronous result. On the other hand, <code>std::shared_future</code> is copyable, so several shared future objects can refer to the same shared state.</p>
<p>There, <code>std::shared_future</code> allows thread-safe access from different threads to the same shared state. Shared futures can be useful for sharing the result of a computationally intensive task among multiple consumers or interested parties, reducing computation. Also, they can be used to notify events or as a synchronization mechanism where multiple threads must wait for the completion of a single task. The interface of <code>std::shared_object</code> is the same as the one for <code>std::future</code>. A <code>shared_future</code> object is created using the <code>.share()</code> function on the future.</p>
</section>
<section id="creating-a-tiny-c-task-library" class="level2">
<h2 class="anchored" data-anchor-id="creating-a-tiny-c-task-library">Creating a tiny C++ task library</h2>
<p>Promises and futures can be chained together to perform multiple asynchronous operations sequentially. We can have elaborate data-processing pipelines where one futures result becoimes the input for the next operations promise. This allows for composing complex asynchronous workflows where the output of one task feeds into the next.</p>
<p>Also, we can allow branching in the pipeline and keep some tasks switched off until needed. This can be done using futures with deferred execution.</p>
<p>Generally speaking tasks make up a DAG(Directed acyclic graph). Thus, a task library must consist of two parts : an API to specify the task DAG and a scheduler that actually executes the DAG.</p>
<p>Lets try to create the following task graph:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<div>
<pre class="mermaid mermaid-js">graph LR
  Task-1[Task-1] --&gt; Task-2[Task-2]
  Task-2 --&gt; Task-3[Task-3]
  Task-2 --&gt; Task-4[Task-4]
  Task-3 --&gt; Aggregate[Aggregate results]
  Task-4 --&gt; Aggregate
</pre>
</div>
</div>
</div>
</div>
<p>We start by defining a template class called <code>Task</code> that accepts a callable as a template argument, defining the function to execute. This class will also allow us to create tasks that share a future with dependent ones.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb5-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;vector&gt;</span></span>
<span id="cb5-2"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;cstdint&gt;</span></span>
<span id="cb5-3"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;print&gt;</span></span>
<span id="cb5-4"></span>
<span id="cb5-5"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#define sync_cout </span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>osyncstream<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb5-6"></span>
<span id="cb5-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> GraphWalker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-8"></span>
<span id="cb5-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb5-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> Task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-11"></span>
<span id="cb5-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">public</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb5-13">    Task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> id<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb5-14">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-15">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_func</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> func <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-16">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-17">        sync_cout <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb5-18">                  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Task "</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" constructed "</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-19">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-20"></span>
<span id="cb5-21">    Task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> Task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb5-22">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_id</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-23">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_func</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_func</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-24">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb5-25"></span>
<span id="cb5-26">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">uint64_t</span> get_id<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb5-27">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-28">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-29"></span>
<span id="cb5-30">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">private</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb5-31">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">u64_t</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-32">    Func <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_func</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-33">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_promise</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-34"></span>
<span id="cb5-35"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb5-36"></span>
<span id="cb5-37"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> Node<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-38">    Task task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-39">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Node<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*&gt;</span> child_nodes<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-40"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span></code></pre></div>


</section>
</section>

 ]]></description>
  <category>C++</category>
  <guid>http://quantdev.blog/posts/exploring_futures_and_promises/index.html</guid>
  <pubDate>Tue, 18 Nov 2025 00:00:00 GMT</pubDate>
  <media:content url="http://quantdev.blog/posts/exploring_futures_and_promises/cpp.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>A crash course in Rust - I</title>
  <dc:creator>Quasar </dc:creator>
  <link>http://quantdev.blog/posts/rust_crash_course_I/index.html</link>
  <description><![CDATA[ 




<section id="a-crash-course-in-rust---i" class="level1">
<h1>A crash course in Rust - I</h1>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>I have been working through the excellent <a href="https://rust-unofficial.github.io/too-many-lists/">Learn Rust With Entirely Too Many Linked Lists</a> and I summarize my learnings about Rust language features and code snippets I tried here.</p>
</section>
<section id="designing-a-basic-linked-list" class="level2">
<h2 class="anchored" data-anchor-id="designing-a-basic-linked-list">Designing a basic linked list</h2>
<p>A linked list is a data-structure consisting of a collection of nodes which together form a sequence. In its most basic form, each node contains data and a reference (pointer or link) to the next node in the sequence. Consider defining a <code>List</code> as follows:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource rust number-lines code-with-copy"><code class="sourceCode rust"><span id="cb1-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">pub</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">enum</span> List<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb1-2">    Empty<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-3">    Element(<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">i32</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> List)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb1-4"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">pub</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">fn</span> main()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span></code></pre></div>
<p>Lets go ahead and compile that.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb2-1">[quantdev@quasar-arch ownership]$ rustc first.rs -o first.out</span>
<span id="cb2-2">error[E0072]: recursive type `List` has infinite size</span>
<span id="cb2-3"> --&gt; first.rs:1:1</span>
<span id="cb2-4">  |</span>
<span id="cb2-5">1 | pub enum List{</span>
<span id="cb2-6">  | ^^^^^^^^^^^^^</span>
<span id="cb2-7">2 |     Empty,</span>
<span id="cb2-8">3 |     Element(i32, List),</span>
<span id="cb2-9">  |                  ---- recursive without indirection</span>
<span id="cb2-10">  |</span>
<span id="cb2-11">help: insert some indirection (e.g., a `Box`, `Rc`, or `&amp;`) to break the cycle                ---- recursive without indirection</span></code></pre></div>
<p>If we actually checkout the error message, we can see that <code>rustc</code> is actually telling us exactly how to solve this problem.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb3-1">help: insert some indirection (e.g., a `Box`, `Rc`, or `&amp;`) to break the cycle                ---- recursive without indirection</span></code></pre></div>
<p>Alright, <code>Box</code>. Whats that? Lets google <code>rust box</code>. <a href="https://doc.rust-lang.org/std/boxed/struct.Box.html"></a> module documentation states that <code>Box&lt;T&gt;</code> casually referred to as a box, provides the simplest form of heap allocation in Rust. Boxes provide ownership for this allocation, and drop their contents when they go out of scope.</p>
<section id="examples" class="level3">
<h3 class="anchored" data-anchor-id="examples">Examples</h3>
<p>Move a value from a stack to the heap by creating a <code>Box</code>:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource rust number-lines code-with-copy"><code class="sourceCode rust"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">let</span> val<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">u8</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">let</span> boxed<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">Box</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">u8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">Box</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">::</span>new(val)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<p>Moving a value from a <code>Box</code> back to the stack by dereferencing it:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource rust number-lines code-with-copy"><code class="sourceCode rust"><span id="cb5-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">let</span> boxed<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">Box</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">u8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">Box</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">::</span>new(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">let</span> val<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">u8</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>boxed<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<p>Creating a recursive data-structure</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource rust number-lines code-with-copy"><code class="sourceCode rust"><span id="cb6-1"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">#[</span>derive<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Debug</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">)]</span></span>
<span id="cb6-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">pub</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">enum</span> List<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-3">    Empty<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb6-4">    Element(<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">i32</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">Box</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>List<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb6-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-6"></span>
<span id="cb6-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">pub</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">fn</span> main()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">let</span> list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> List <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">List::</span>Element(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">Box</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">::</span>new(<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">List::</span>Element(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">Box</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">::</span>new(<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">List::</span>Empty))))<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-9">    <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">println!</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{list:?}"</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>If I compile and run this code, it gives me:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb7-1">[quantdev@quasar-arch ownership]$ rustc first.rs -o first.out</span>
<span id="cb7-2">[quantdev@quasar-arch ownership]$ ./first.out</span>
<span id="cb7-3">Element(1, Element(2, Empty))</span></code></pre></div>
<p>Recursive data-structures must be boxed, because if the definition of <code>List</code> looked like this:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb8-1">Element(T, List)</span></code></pre></div>
<p>it wouldnt work.</p>


</section>
</section>
</section>

 ]]></description>
  <category>Rust</category>
  <guid>http://quantdev.blog/posts/rust_crash_course_I/index.html</guid>
  <pubDate>Mon, 17 Nov 2025 00:00:00 GMT</pubDate>
  <media:content url="http://quantdev.blog/posts/rust_crash_course_I/Rust-4.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Memory Barriers</title>
  <dc:creator>Quasar </dc:creator>
  <link>http://quantdev.blog/posts/memory_barriers/index.html</link>
  <description><![CDATA[ 




<section id="c-atomics" class="level1">
<h1>C++ Atomics</h1>
<section id="introduction-to-atomic-operations" class="level2">
<h2 class="anchored" data-anchor-id="introduction-to-atomic-operations">Introduction to Atomic Operations</h2>
<p>Atomic operations are indivisible. An atomic operation is any operation that is <strong>guaranteed to execute as a single transaction</strong>. At a low-level, atomic operations are special hardware instructions.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>load_ext itikz</span></code></pre></div>
</div>
<p>Consider a shared variable <code>counter</code> initialized to <code>0</code>. The assembly instructions for incrementing this counter show that it requires multiple CPU instructions: load the value from memory into a register, add 1 to the register, and store the result back to memory. This multi-step process creates opportunities for race conditions in multi-threaded code.</p>
<p>Using atomic types and operations solves this problem by using special CPU instructions like <code>lock add</code> that guarantee the entire operation completes as a single, indivisible unit.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Incrementing a counter        </span></span>
<span id="cb2-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> counter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb2-5">    counter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++;</span></span>
<span id="cb2-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</section>
<section id="generated-assembly---non-atomic" class="level2">
<h2 class="anchored" data-anchor-id="generated-assembly---non-atomic">Generated Assembly - Non-Atomic</h2>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource asm number-lines code-with-copy"><code class="sourceCode fasm"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">counter:</span></span>
<span id="cb3-2">        .zero   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">main:</span></span>
<span id="cb3-4">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">push</span>    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">rbp</span></span>
<span id="cb3-5">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">mov</span>     <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">rbp</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">rsp</span></span>
<span id="cb3-6">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">mov</span>     <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">eax</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">DWORD</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">PTR</span> counter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span>rip<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb3-7">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">add</span>     <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">eax</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb3-8">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">mov</span>     <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">DWORD</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">PTR</span> counter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span>rip<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">],</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">eax</span></span>
<span id="cb3-9">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">mov</span>     <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">eax</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb3-10">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">pop</span>     <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">rbp</span></span>
<span id="cb3-11">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">ret</span></span></code></pre></div>
</section>
<section id="atomic-increment" class="level2">
<h2 class="anchored" data-anchor-id="atomic-increment">Atomic Increment</h2>
<p>Using atomic types and operations:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb4-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;atomic&gt;</span></span>
<span id="cb4-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>atomic<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> counter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb4-5">    counter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++;</span></span>
<span id="cb4-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>Generated Assembly:</strong></p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource asm number-lines code-with-copy"><code class="sourceCode fasm"><span id="cb5-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">lock</span> add <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">DWORD</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">PTR</span> counter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span>rip<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">],</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span></code></pre></div>
<p>Atomic operations allow threads to read, modify and write indivisibly and can also be used as synchronization primitives. Atomic operations must be provided by the CPU (as in the <code>lock add</code> instruction).</p>
</section>
<section id="operations-on-stdatomict" class="level2">
<h2 class="anchored" data-anchor-id="operations-on-stdatomict">Operations on <code>std::atomic&lt;T&gt;</code></h2>
<p><strong>Explicit reads and writes:</strong></p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb6-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>atomic<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-2">T y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>load<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span>     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Same as T y = x;</span></span>
<span id="cb6-3">x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>store<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span>         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Same as x = y;</span></span></code></pre></div>
<p><strong>Atomic exchange:</strong></p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb7-1">T z <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>exchange<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span>    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Atomically: z = x; x = y;</span></span></code></pre></div>
<p><code>exchange</code> is an atomic swap - a read-modify-write done atomically. It reads the old value, replaces it with the new value and guarantees that nobody can get in there in between.</p>
</section>
<section id="compare-and-swap-cas" class="level2">
<h2 class="anchored" data-anchor-id="compare-and-swap-cas">Compare-and-Swap (CAS)</h2>
<p><strong>Compare-and-swap (conditional exchange):</strong></p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb8-1"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bool</span> success <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>compare_exchange_strong<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>z<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// T&amp; y</span></span>
<span id="cb8-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// var.compare_exchange_strong(expected,desired);</span></span>
<span id="cb8-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// If x == y, x = z and return true</span></span>
<span id="cb8-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Otherwise, set y = x and return false</span></span></code></pre></div>
</section>
<section id="why-is-cas-so-special" class="level2">
<h2 class="anchored" data-anchor-id="why-is-cas-so-special">Why is CAS So Special?</h2>
<p>Compare-and-swap (CAS) is used in most lock-free algorithms. Consider this example of atomic increment with CAS. Pretty much every lock-free algorithm is centered around a loop like this. We want to increment <code>x</code>. First, we read the atomic value and store it in a local <code>x0</code>. We hope nobody got to <code>x</code> before us, that <code>x</code> hasnt changed. If thats <code>true</code>, we change it atomically to the desired value (which could be an increment, decrement, multiplication by 2, etc.). If nobody else changed <code>x</code>, we did our increment atomically. CAS returns <code>true</code> and the loop ends.</p>
<p>If somebody did change <code>x</code>, CAS fails and returns <code>false</code>. The changed value of <code>x</code> is updated in <code>x0</code>, so we dont have to read again. We continue to the next iteration and keep trying, until our compare-and-swap beats everyone elses and gets that increment in.</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb9-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>atomic<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb9-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> x0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>load<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span>     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// [1] </span></span>
<span id="cb9-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">while</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(!</span>x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>compare_exchange_swap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x0<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> x0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)){}</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// [2]</span></span></code></pre></div>
</section>
<section id="additional-atomic-operations" class="level2">
<h2 class="anchored" data-anchor-id="additional-atomic-operations">Additional Atomic Operations</h2>
<p><strong>For integer T:</strong></p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb10-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>atomic<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-2">x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>fetch_add<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span>     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Same as x += y;</span></span></code></pre></div>
<p><code>fetch_add()</code> doesnt just add atomically. It increments atomically, but also returns the old value (the fetch part). So it returns the old value and adds the increment, all atomically.</p>
<p>Also available: <code>fetch_sub</code>, <code>fetch_and()</code>, <code>fetch_or()</code> and <code>fetch_xor()</code>.</p>
<p><strong>Note:</strong> If you have multiple atomic operations, their composition is not atomic.</p>
</section>
<section id="do-atomic-operations-wait-on-each-other" class="level2">
<h2 class="anchored" data-anchor-id="do-atomic-operations-wait-on-each-other">Do Atomic Operations wait on Each Other?</h2>
<p>Atomic operations are lock-free, maybe even wait-free. It doesnt mean they dont wait on each other. Atomic operations do wait for cache-line access.</p>
<div class="text-center">
<div class="cell" data-execution_count="2">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span>itikz <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span>temp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dir</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span>tex<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>packages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tikz <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span>tikz<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>libraries<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>arrows.meta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span>implicit<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>standalone</span>
<span id="cb11-2"></span>
<span id="cb11-3">\tikzset{every picture<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{line width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>}} <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span> default line width to <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>        </span>
<span id="cb11-4"></span>
<span id="cb11-5">\begin{tikzpicture}[x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>,y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>,yscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,xscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,font<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>\Large]</span>
<span id="cb11-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>uncomment <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> require: \path (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">249</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span> diagram left start at <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> has height of <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">249</span></span>
<span id="cb11-7"></span>
<span id="cb11-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Rounded Rect [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:dp7226624209327404] </span>
<span id="cb11-9">\draw  [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">181</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">212</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">244</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ] (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">115</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">43.47</span>) .. controls (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">115</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">33.82</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">122.82</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">26</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">132.47</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">26</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">505.03</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">26</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">514.68</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">26</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">522.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">33.82</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">522.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">43.47</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">522.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">95.88</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">522.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">105.52</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">514.68</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">113.34</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">505.03</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">113.34</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">132.47</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">113.34</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">122.82</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">113.34</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">115</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">105.52</span>) .. (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">115</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">95.88</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Rounded Rect [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:dp404929071772297] </span>
<span id="cb11-11">\draw  [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">181</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">212</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">244</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ] (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">113</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">158.47</span>) .. controls (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">113</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">148.82</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">120.82</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">141</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">130.47</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">141</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">503.03</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">141</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">512.68</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">141</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">520.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">148.82</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">520.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">158.47</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">520.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">210.88</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">520.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">220.52</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">512.68</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">228.34</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">503.03</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">228.34</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">130.47</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">228.34</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">120.82</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">228.34</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">113</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">220.52</span>) .. (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">113</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">210.88</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Rounded Rect [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:dp8165659276958122] </span>
<span id="cb11-13">\draw  [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">251</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">247</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">204</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ] (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">151</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">62</span>) .. controls (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">151</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">57.58</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">154.58</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">54</span>) .. (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">159</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">54</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">300.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">54</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">304.92</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">54</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">308.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">57.58</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">308.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">62</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">308.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">86</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">308.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">90.42</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">304.92</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">94</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">300.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">94</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">159</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">94</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">154.58</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">94</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">151</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">90.42</span>) .. (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">151</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">86</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-14"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Rounded Rect [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:dp5545605907049965] </span>
<span id="cb11-15">\draw  [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">251</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">247</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">204</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ] (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">325</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">61</span>) .. controls (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">325</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">56.58</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">328.58</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">53</span>) .. (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">333</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">53</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">474.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">53</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">478.92</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">53</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">482.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">56.58</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">482.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">61</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">482.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">85</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">482.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">89.42</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">478.92</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">93</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">474.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">93</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">333</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">93</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">328.58</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">93</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">325</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">89.42</span>) .. (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">325</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">85</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-16"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Rounded Rect [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:dp9918614693760329] </span>
<span id="cb11-17">\draw  [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">251</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">247</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">204</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ] (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">144</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">176</span>) .. controls (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">144</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">171.58</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">147.58</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">168</span>) .. (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">152</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">168</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">293.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">168</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">297.92</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">168</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">301.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">171.58</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">301.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">176</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">301.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">301.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">204.42</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">297.92</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">208</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">293.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">208</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">152</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">208</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">147.58</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">208</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">144</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">204.42</span>) .. (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">144</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-18"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Rounded Rect [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:dp9032232500910276] </span>
<span id="cb11-19">\draw  [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">251</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">247</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">204</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ] (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">332</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">176</span>) .. controls (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">332</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">171.58</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">335.58</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">168</span>) .. (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">340</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">168</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">481.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">168</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">485.92</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">168</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">489.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">171.58</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">489.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">176</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">489.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">489.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">204.42</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">485.92</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">208</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">481.5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">208</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">340</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">208</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">335.58</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">208</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">332</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">204.42</span>) .. (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">332</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-20"></span>
<span id="cb11-21"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb11-22">\draw (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">263</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">31</span>) node [anchor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>north west][inner sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>]   [align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>left] {\texttt{std::atomic<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>}}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-23"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb11-24">\draw (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">257</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">146</span>) node [anchor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>north west][inner sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>]   [align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>left] {\texttt{std::atomic<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>}}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-25"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb11-26">\draw (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">231.33</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">63.33</span>) node {Thread<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-27"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb11-28">\draw (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">410</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span>) node {Thread<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-29"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb11-30">\draw (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">221.33</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">180</span>) node {Thread<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-31"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb11-32">\draw (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">414</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">180</span>) node {Thread<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-33"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb11-34">\draw (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">231.71</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">82</span>) node {<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++</span>x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-35"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb11-36">\draw (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">410.38</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">80.67</span>) node {<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++</span>x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-37"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb11-38">\draw (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">228.08</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">198</span>) node {<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++</span>x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-39"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb11-40">\draw (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">419.58</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">196.67</span>) node {<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++</span>x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-41"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb11-42">\draw (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">214.67</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">13.33</span>) node {Accessing shared variable}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-43"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb11-44">\draw (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">212.67</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">127.33</span>) node {Accessing Non<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>shared variable}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-45"></span>
<span id="cb11-46"></span>
<span id="cb11-47">\end{tikzpicture}</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="2">
<p><img src="http://quantdev.blog/posts/memory_barriers/index_files/figure-html/cell-3-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>Fig. Functions - control flow</p>
</div>
<p>Lets compare atomic increment of an atomic variable versus increment two atomic variables that are different. That is, the worker thread <img src="https://latex.codecogs.com/png.latex?t0"> works on an atomic variable <code>x[0]</code> and the worker thread <img src="https://latex.codecogs.com/png.latex?t1"> works on the atomic variable <code>x[1]</code>. That way, they dont have to wait on each other. Lets run a benchmark for different number of threads. Lets run the benchmark for different number of threads. Its basically the same thing - we see no difference between the two. Can we conclude that atomic operations dont wait on each other from this?</p>
<div class="text-center">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="http://quantdev.blog/posts/memory_barriers/memory_barriers_01.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Two threads incrementing a shared variable atomically vs two threads work on different atomic variables</figcaption>
</figure>
</div>
</div>
<pre><code>Benchmark                                        Time         CPU
------------------------------------------------------------------------
BM_SharedAtomicIncrement/1/real_time         0.558 ms    0.015 ms
BM_SharedAtomicIncrement/2/real_time          2.56 ms    0.044 ms
BM_SharedAtomicIncrement/4/real_time          5.40 ms    0.096 ms
BM_SharedAtomicIncrement/8/real_time          10.6 ms    0.218 ms
BM_SharedAtomicIncrement/16/real_time         22.9 ms    0.401 ms
BM_SharedAtomicIncrement/32/real_time         48.4 ms     1.14 ms
BM_SeparateAtomicIncrement/1/real_time       0.556 ms    0.016 ms
BM_SeparateAtomicIncrement/2/real_time        2.74 ms    0.033 ms
BM_SeparateAtomicIncrement/4/real_time        5.74 ms    0.081 ms
BM_SeparateAtomicIncrement/8/real_time        11.2 ms    0.244 ms
BM_SeparateAtomicIncrement/16/real_time       23.9 ms    0.403 ms
BM_SeparateAtomicIncrement/32/real_time       26.6 ms     1.23 ms</code></pre>
<section id="whats-really-going-on" class="level3">
<h3 class="anchored" data-anchor-id="whats-really-going-on">Whats really going on?</h3>
<p>Can we conclude that atomic operations dont wait on each other? Not necessarily!</p>
<p>It is highly likely, that data elements in relatively close memory locations are accessed over a short period of time. This is typical, for example, when traversing an array, or performing matrix multiplication. To optimize performance, a chunk of data called the cache line trickles up and down through the cache from the main memory to the CPU and back, instead of just the request data-item. On x86, the cache line size is <img src="https://latex.codecogs.com/png.latex?64">-bytes.</p>
<p>Whats actually happening is that the two atomic operations are in the same cache-line. On x86, the whole cache line trickles up and down from main memory to the on-board CPU cache and back. Even if you want one variable from the cache line, the entire 64-byte chunk will go up and down. If two different CPUs want two different variables within the same cache-line, they need to wait, as if it was the same variable. You dont get lower granularity than 64-bytes on x86.</p>
<div class="text-center">
<div class="cell" data-execution_count="3">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span>itikz <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span>temp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dir</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span>tex<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>packages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tikz <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span>tikz<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>libraries<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>arrows.meta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span>implicit<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>standalone</span>
<span id="cb13-2">\tikzset{every picture<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{line width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>}} <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span> default line width to <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>        </span>
<span id="cb13-3"></span>
<span id="cb13-4">\begin{tikzpicture}[x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>,y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>,yscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.1</span>,xscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.1</span>,font<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>\Large]</span>
<span id="cb13-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>uncomment <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> require: \path (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">379</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span> diagram left start at <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> has height of <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">379</span></span>
<span id="cb13-6"></span>
<span id="cb13-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Rounded Rect [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:dp27460933128570264] </span>
<span id="cb13-8">\draw  [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">181</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">212</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">244</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">38.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">45.45</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">38.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">39.13</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">43.63</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">49.95</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">296.05</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">302.37</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">307.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">39.13</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">307.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">45.45</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">307.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">79.8</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">307.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">86.12</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">302.37</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">91.25</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">296.05</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">91.25</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">49.95</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">91.25</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">43.63</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">91.25</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">38.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">86.12</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">38.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">79.8</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-9"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Rounded Rect [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:dp6820620708533545] </span>
<span id="cb13-10">\draw  [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">181</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">212</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">244</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ] (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">335</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">127.87</span>) .. controls (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">335</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">124.63</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">337.63</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">122</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">340.87</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">122</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">586.63</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">122</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">589.87</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">122</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">592.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">124.63</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">592.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">127.87</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">592.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">145.48</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">592.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">148.72</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">589.87</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">151.34</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">586.63</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">151.34</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">340.87</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">151.34</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">337.63</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">151.34</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">335</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">148.72</span>) .. (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">335</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">145.48</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-11"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Rounded Rect [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:dp9973874025957986] </span>
<span id="cb13-12">\draw  [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">181</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">212</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">244</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ] (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">127.87</span>) .. controls (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">124.63</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">46.63</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">122</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">49.87</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">122</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">295.63</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">122</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">298.87</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">122</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">301.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">124.63</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">301.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">127.87</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">301.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">145.48</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">301.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">148.72</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">298.87</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">151.34</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">295.63</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">151.34</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">49.87</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">151.34</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">46.63</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">151.34</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">148.72</span>) .. (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">145.48</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-13"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Rounded Rect [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:dp9732688461749553] </span>
<span id="cb13-14">\draw  [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">252</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">246</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">153</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">46.33</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">309.12</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">46.33</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">303.9</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">50.56</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">299.67</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">55.78</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">299.67</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">586.38</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">299.67</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">591.6</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">299.67</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">595.83</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">303.9</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">595.83</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">309.12</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">595.83</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">337.47</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">595.83</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">342.69</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">591.6</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">346.92</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">586.38</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">346.92</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">55.78</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">346.92</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">50.56</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">346.92</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">46.33</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">342.69</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">46.33</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">337.47</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-15"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Straight Lines [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:da9504358299662848] </span>
<span id="cb13-16">\draw    (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">276.08</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">339.92</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">383.58</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">339.92</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-17">\draw [shift<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">386.58</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">339.92</span>)}, rotate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">180</span>] [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> }  ][line width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>]  [draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-18">\draw [shift<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">273.08</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">339.92</span>)}, rotate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> }  ][line width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>]  [draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-19"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Rounded Rect [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:dp1128018396464796] </span>
<span id="cb13-20">\draw  [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">181</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">212</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">244</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">329.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">45.45</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">329.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">39.13</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">334.63</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">340.95</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">587.05</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">593.37</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">598.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">39.13</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">598.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">45.45</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">598.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">79.8</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">598.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">86.12</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">593.37</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">91.25</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">587.05</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">91.25</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">340.95</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">91.25</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">334.63</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">91.25</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">329.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">86.12</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">329.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">79.8</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-21"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Straight Lines [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:da8059041144370804] </span>
<span id="cb13-22">\draw [color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">74</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">83</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">226</span> }  ,draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ]   (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">378.92</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">154.25</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">378.92</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">182.25</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-23">\draw [shift<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">378.92</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">151.25</span>)}, rotate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>] [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">74</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">83</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">226</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ][line width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>]  [draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-24"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Rounded Rect [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:dp591399533303866] </span>
<span id="cb13-25">\draw  [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">181</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">212</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">244</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">335.67</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">189.2</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">335.67</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">185.96</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">338.29</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">183.33</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">341.54</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">183.33</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">587.3</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">183.33</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">590.54</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">183.33</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">593.17</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">185.96</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">593.17</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">189.2</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">593.17</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">206.81</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">593.17</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">210.05</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">590.54</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">212.68</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">587.3</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">212.68</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">341.54</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">212.68</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">338.29</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">212.68</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">335.67</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">210.05</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">335.67</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">206.81</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-26"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Rounded Rect [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:dp5591689579874568] </span>
<span id="cb13-27">\draw  [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">181</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">212</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">244</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">44.67</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">189.2</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">44.67</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">185.96</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">47.29</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">183.33</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">50.54</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">183.33</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">296.3</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">183.33</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">299.54</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">183.33</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">302.17</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">185.96</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">302.17</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">189.2</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">302.17</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">206.81</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">302.17</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">210.05</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">299.54</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">212.68</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">296.3</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">212.68</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">50.54</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">212.68</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">47.29</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">212.68</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">44.67</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">210.05</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">44.67</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">206.81</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-28"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Rounded Rect [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:dp4165838369572783] </span>
<span id="cb13-29">\draw  [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">181</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">212</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">244</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">44.67</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">245.87</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">44.67</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">242.63</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">47.29</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">240</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">50.54</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">240</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">586.46</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">240</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">589.71</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">240</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">592.33</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">242.63</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">592.33</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">245.87</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">592.33</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">263.48</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">592.33</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">266.72</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">589.71</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">269.34</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">586.46</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">269.34</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">50.54</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">269.34</span>) .. controls (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">47.29</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">269.34</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">44.67</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">266.72</span>) .. (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">44.67</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">263.48</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-30"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Straight Lines [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:da7083107764900278] </span>
<span id="cb13-31">\draw [color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">74</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">83</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">226</span> }  ,draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ]   (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">92.99</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">215.67</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">92.92</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">240.92</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-32">\draw [shift<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">93</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">212.67</span>)}, rotate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">90.17</span>] [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">74</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">83</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">226</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ][line width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>]  [draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-33"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Straight Lines [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:da028317245941649194] </span>
<span id="cb13-34">\draw [color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">74</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">83</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">226</span> }  ,draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ]   (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">93.66</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">153.67</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">93.58</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">182.25</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-35">\draw [shift<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">93.67</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">150.67</span>)}, rotate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">90.15</span>] [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">74</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">83</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">226</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ][line width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>]  [draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-36"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Straight Lines [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:da8360791510647615] </span>
<span id="cb13-37">\draw [color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">74</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">83</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">226</span> }  ,draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ]   (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">92.33</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">93.67</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">92.25</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">122.25</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-38">\draw [shift<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">92.33</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">90.67</span>)}, rotate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">90.15</span>] [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">74</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">83</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">226</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ][line width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>]  [draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-39"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Straight Lines [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:da620625708639835] </span>
<span id="cb13-40">\draw [color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">74</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">83</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">226</span> }  ,draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ]   (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">378.25</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">213.58</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">378.25</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">241.58</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-41">\draw [shift<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">378.25</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">210.58</span>)}, rotate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>] [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">74</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">83</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">226</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ][line width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>]  [draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-42"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Straight Lines [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:da911476849461266] </span>
<span id="cb13-43">\draw [color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">74</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">83</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">226</span> }  ,draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ]   (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">305.58</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">270.92</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">305.58</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">298.92</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-44">\draw [shift<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">305.58</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">267.92</span>)}, rotate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>] [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">74</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">83</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">226</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ][line width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>]  [draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-45"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Straight Lines [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:da6168210047920039] </span>
<span id="cb13-46">\draw [color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">74</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">83</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">226</span> }  ,draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ]   (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">377.58</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">94.25</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">377.58</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">122.25</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-47">\draw [shift<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">377.58</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">91.25</span>)}, rotate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>] [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">74</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">83</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">226</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ][line width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>]  [draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-48"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Straight Lines [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:da45709411556658486] </span>
<span id="cb13-49">\draw [color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">144</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">254</span> }  ,draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ]   (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">243.58</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">91.25</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">243.58</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">119.25</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-50">\draw [shift<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">243.58</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">122.25</span>)}, rotate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">270</span>] [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">144</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">254</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ][line width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>]  [draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-51"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Straight Lines [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:da1624871748247504] </span>
<span id="cb13-52">\draw [color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">144</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">254</span> }  ,draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ]   (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">244.25</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">152.58</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">244.25</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">180.58</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-53">\draw [shift<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">244.25</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">183.58</span>)}, rotate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">270</span>] [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">144</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">254</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ][line width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>]  [draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-54"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Straight Lines [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:da951312301312835] </span>
<span id="cb13-55">\draw [color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">144</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">254</span> }  ,draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ]   (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">245.67</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">211.33</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">244.99</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">237.25</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-56">\draw [shift<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">244.92</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">240.25</span>)}, rotate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">271.49</span>] [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">144</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">254</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ][line width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>]  [draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-57"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Straight Lines [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:da5598487398669117] </span>
<span id="cb13-58">\draw [color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">144</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">254</span> }  ,draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ]   (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">351</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">270.67</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">350.93</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">295.92</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-59">\draw [shift<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">350.92</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">298.92</span>)}, rotate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">270.17</span>] [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">144</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">254</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ][line width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>]  [draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-60"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Straight Lines [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:da18143538236339274] </span>
<span id="cb13-61">\draw [color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">144</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">254</span> }  ,draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ]   (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">547.58</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">91.25</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">547.58</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">119.25</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-62">\draw [shift<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">547.58</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">122.25</span>)}, rotate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">270</span>] [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">144</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">254</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ][line width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>]  [draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-63"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Straight Lines [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:da11843933303452991] </span>
<span id="cb13-64">\draw [color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">144</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">254</span> }  ,draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ]   (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">547.58</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">151.25</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">547.58</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">179.25</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-65">\draw [shift<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">547.58</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">182.25</span>)}, rotate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">270</span>] [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">144</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">254</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ][line width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>]  [draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-66"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>Straight Lines [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>:da21016027697626216] </span>
<span id="cb13-67">\draw [color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">144</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">254</span> }  ,draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ]   (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">546.92</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">211.25</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">546.92</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">239.25</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-68">\draw [shift<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">546.92</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">242.25</span>)}, rotate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">270</span>] [fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">144</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">254</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ][line width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>]  [draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.93</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.29</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-69"></span>
<span id="cb13-70"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb13-71">\draw (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">52</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>) node [anchor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>north west][inner sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>]  [xscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,yscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] [align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>left] {\textit{CPU Core<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>}}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-72"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb13-73">\draw (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">342</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>) node [anchor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>north west][inner sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>]  [xscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,yscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] [align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>left] {\textit{CPU Core<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>}}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-74"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb13-75">\draw  [color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">184</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">233</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">134</span> }  ,draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ][fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">233</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">229</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">229</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ][line width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.25</span>]   (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">58.13</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">124.25</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">169.13</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">124.25</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">169.13</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">149.25</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">58.13</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">149.25</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-76">\draw (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">113.63</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">136.75</span>) node  [xscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,yscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] [align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>left] {\begin{minipage}[lt]{<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">72.93</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>}\setlength\topsep{<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>}</span>
<span id="cb13-77">x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>],x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],...</span>
<span id="cb13-78">\end{minipage}}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-79"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb13-80">\draw (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">210</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>) node [anchor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>north west][inner sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>]  [xscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,yscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] [align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>left] {\textit{L1 Cache}}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-81"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb13-82">\draw (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">127.5</span>) node [anchor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>north west][inner sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>]  [xscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,yscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] [align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>left] {\textit{L1 Cache}}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-83"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb13-84">\draw (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">470.33</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">302.67</span>) node [anchor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>north west][inner sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>]  [xscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,yscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] [align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>left] {\textit{Main Memory}}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-85"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb13-86">\draw (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">298.33</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">344.17</span>) node [anchor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>north west][inner sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>]  [xscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,yscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] [align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>left] {\textit{<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bytes</span>}}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-87"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb13-88">\draw (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">170.83</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">312.17</span>) node [anchor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>north west][inner sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>]  [xscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,yscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] [align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>left] {\textit{Cache line}}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-89"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb13-90">\draw (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">179.83</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">68.63</span>) node  [xscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,yscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] [align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>left] {\begin{minipage}[lt]{<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">48.73</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>}\setlength\topsep{<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>}</span>
<span id="cb13-91"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++</span>x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-92">\end{minipage}}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-93"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb13-94">\draw (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">467.67</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">68.13</span>) node  [xscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,yscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] [align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>left] {\begin{minipage}[lt]{<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">41.71</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>}\setlength\topsep{<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>}</span>
<span id="cb13-95"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++</span>x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-96">\end{minipage}}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-97"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb13-98">\draw  [color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">184</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">233</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">134</span> }  ,draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ][fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">233</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">229</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">229</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ][line width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.25</span>]   (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">349.63</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">123.75</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">460.63</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">123.75</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">460.63</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">148.75</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">349.63</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">148.75</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-99">\draw (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">405.13</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">136.25</span>) node  [xscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,yscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] [align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>left] {\begin{minipage}[lt]{<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">72.93</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>}\setlength\topsep{<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>}</span>
<span id="cb13-100">x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>],x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],...</span>
<span id="cb13-101">\end{minipage}}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-102"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb13-103">\draw  [color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">184</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">233</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">134</span> }  ,draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ][fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">233</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">229</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">229</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ][line width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.25</span>]   (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">278.63</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">305.92</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">389.63</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">305.92</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">389.63</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">330.92</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">278.63</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">330.92</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-104">\draw (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">334.13</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">318.42</span>) node  [xscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,yscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] [align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>left] {\begin{minipage}[lt]{<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">72.93</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>}\setlength\topsep{<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>}</span>
<span id="cb13-105">x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>],x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],...</span>
<span id="cb13-106">\end{minipage}}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-107"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb13-108">\draw  [color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">184</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">233</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">134</span> }  ,draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ][fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">233</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">229</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">229</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ][line width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.25</span>]   (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">58.79</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">185.58</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">169.79</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">185.58</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">169.79</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">210.58</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">58.79</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">210.58</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-109">\draw (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">114.29</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">198.08</span>) node  [xscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,yscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] [align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>left] {\begin{minipage}[lt]{<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">72.93</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>}\setlength\topsep{<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>}</span>
<span id="cb13-110">x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>],x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],...</span>
<span id="cb13-111">\end{minipage}}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-112"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb13-113">\draw (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">210.67</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">189.33</span>) node [anchor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>north west][inner sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>]  [xscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,yscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] [align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>left] {\textit{L2 Cache}}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-114"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb13-115">\draw (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">500.83</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">189.5</span>) node [anchor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>north west][inner sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>]  [xscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,yscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] [align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>left] {\textit{L2 Cache}}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-116"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb13-117">\draw  [color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">184</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">233</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">134</span> }  ,draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ][fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">233</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">229</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">229</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ][line width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.25</span>]   (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">350.29</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">185.08</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">461.29</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">185.08</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">461.29</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">210.08</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">350.29</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">210.08</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-118">\draw (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">405.79</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">197.58</span>) node  [xscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,yscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] [align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>left] {\begin{minipage}[lt]{<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">72.93</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>}\setlength\topsep{<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>}</span>
<span id="cb13-119">x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>],x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],...</span>
<span id="cb13-120">\end{minipage}}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-121"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb13-122">\draw  [color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">184</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">233</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">134</span> }  ,draw opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ][fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{rgb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>:red, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">233</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> green, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">229</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> blue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">229</span> }  ,fill opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ][line width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.25</span>]   (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">276.13</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">241.58</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">387.13</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">241.58</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">387.13</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">266.58</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">276.13</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">266.58</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> cycle  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-123">\draw (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">331.63</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">254.08</span>) node  [xscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,yscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] [align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>left] {\begin{minipage}[lt]{<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">72.93</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>}\setlength\topsep{<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>}</span>
<span id="cb13-124">x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>],x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],...</span>
<span id="cb13-125">\end{minipage}}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-126"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> Text Node</span>
<span id="cb13-127">\draw (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">500.33</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">246.67</span>) node [anchor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>north west][inner sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">pt</span>]  [xscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,yscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] [align<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>left] {\textit{L3 Cache}}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-128"></span>
<span id="cb13-129"></span>
<span id="cb13-130">\end{tikzpicture}</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="3">
<p><img src="http://quantdev.blog/posts/memory_barriers/index_files/figure-html/cell-4-output-1.svg" class="img-fluid"></p>
</div>
</div>
</div>
<p>Atomic operations do wait on each other! In particular, write-operations do. Read operations scale near-perfectly.</p>
<p>If I put the variables on separate cache-lines, then there is no problem and the CPUs dont have to wait on anything. We can prove it with a benchmark.</p>
<pre><code>Benchmark                            Time         CPU
------------------------------------------------------------------------
BM_Shared/1/real_time            0.561 ms    0.015 ms
BM_Shared/2/real_time             3.25 ms    0.054 ms
BM_Shared/4/real_time             6.07 ms    0.061 ms
BM_Shared/8/real_time             10.6 ms    0.240 ms
BM_Shared/16/real_time            22.9 ms    0.384 ms
BM_Shared/32/real_time            51.4 ms    0.944 ms
BM_Shared/64/real_time             103 ms     2.67 ms
BM_FalseShared/1/real_time       0.578 ms    0.016 ms
BM_FalseShared/2/real_time        2.98 ms    0.037 ms
BM_FalseShared/4/real_time        6.18 ms    0.065 ms
BM_FalseShared/8/real_time        10.6 ms    0.234 ms
BM_FalseShared/16/real_time       13.5 ms    0.386 ms
BM_FalseShared/32/real_time       26.7 ms     1.21 ms
BM_FalseShared/64/real_time       37.0 ms     2.36 ms
BM_NonShared/1/real_time         0.576 ms    0.015 ms
BM_NonShared/2/real_time         0.591 ms    0.028 ms
BM_NonShared/4/real_time         0.632 ms    0.051 ms
BM_NonShared/8/real_time         0.598 ms    0.102 ms
BM_NonShared/16/real_time         1.05 ms    0.225 ms
BM_NonShared/32/real_time         1.81 ms    0.701 ms
BM_NonShared/64/real_time         3.21 ms     1.28 ms</code></pre>
<p>Atomic operations have to wait for cache line access. This is the <strong>price of data sharing</strong> without race conditions. Modifying different locations on the same cache line still incurs a run-time penalty, a phenomenon known as false sharing. To avoid false sharing, we should align per-thread data to separate cache lines. Atomic operations do wait on each other, particularly write operations. However, read-only operations can scale near-perfectly when properly designed.</p>
</section>
</section>
<section id="strong-vs-weak-compare-and-swap" class="level2">
<h2 class="anchored" data-anchor-id="strong-vs-weak-compare-and-swap">Strong vs Weak Compare-and-Swap</h2>
<p>C++ provides two versions of CAS - weak and strong.</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Strong CAS</span></span>
<span id="cb15-2">x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>compare_exchange_strong<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>old_x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> new_x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb15-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/* </span></span>
<span id="cb15-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">if (x == old_x)</span></span>
<span id="cb15-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb15-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    x = new_x;</span></span>
<span id="cb15-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    return true;</span></span>
<span id="cb15-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}else{</span></span>
<span id="cb15-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    old_x = x;</span></span>
<span id="cb15-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    return false;</span></span>
<span id="cb15-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb15-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*/</span></span></code></pre></div>
<p><code>x.compare_exchange_weak(old_x, new_x)</code> is essentially the same thing, but can <strong>spuriously fail</strong> and return <code>false</code>, even if <code>x == old_x</code>.</p>
</section>
</section>
<section id="memory-barriers" class="level1">
<h1>Memory Barriers</h1>
<section id="memory-barriers---introduction" class="level2">
<h2 class="anchored" data-anchor-id="memory-barriers---introduction">Memory Barriers - Introduction</h2>
<p>Its good to understand about atomic variables, but its not enough by a mile. Memory barriers go hand-in-hand with C++ atomics. Memory barriers control how changes to memory made by one CPU core become visible to other CPU cores. Without memory barriers, there is no guarantee of visibility whatsoever. Imagine you have two CPUs, both modifying a variable <code>x</code> in their on-chip caches. The main memory doesnt have to change at all! There is no guarantee that anybody can see anything.</p>
<p>For example, CPU-1 cache might have <code>x = 42</code>, CPU-2 cache might have <code>x = 17</code>, while Main Memory still shows <code>x = 0</code> (stale/unchanged). The problem is that each CPU sees its own value. Memory is unchanged, and there is no coherence between the cores.</p>
</section>
<section id="memory-barriers-in-c" class="level2">
<h2 class="anchored" data-anchor-id="memory-barriers-in-c">Memory Barriers in C++</h2>
<p>C++ memory barriers are modifiers on atomic operations.</p>
<p><strong>Example:</strong></p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb16-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>atomic<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb16-2">x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>store<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>memory_order_release<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span></code></pre></div>
<p>This implies that we have put a release memory barrier on that store.</p>
</section>
<section id="no-barriers---stdmemory_order_relaxed" class="level2">
<h2 class="anchored" data-anchor-id="no-barriers---stdmemory_order_relaxed">No Barriers - <code>std::memory_order_relaxed</code></h2>
<p>No memory barrier means that we can reorder reads and writes any way we want. We have an atomic <code>x</code> variable and <code>a</code>, <code>b</code> and <code>c</code> are non-atomic variables. No memory order means I can reorder reads and writes anywhere I want.</p>
<p>We have an atomic store to <code>x</code> in the middle. In the program order, I write to <code>a</code>, then I write to <code>b</code>, then I write to <code>c</code> and then I write to <code>x</code>. In the actual order, anything is possible. There are no restrictions whatsoever. This in C++ stamdard is called <code>std::memory_order_relaxed</code>. There are no guarantees here.</p>
<div class="text-center">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="http://quantdev.blog/posts/memory_barriers/memory_order_relaxed.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Reads and writes can be reordered arbitrarily. No guarantees.</figcaption>
</figure>
</div>
</div>
</section>
<section id="acquire-barrier" class="level2">
<h2 class="anchored" data-anchor-id="acquire-barrier">Acquire Barrier</h2>
<p>An acquire barrier is a half-barrier that acts as a one-way gate. Nothing that was after the <code>load</code> can move in front of it, but anything that was before can move after. Acquire barrier guarantees that all memory operations scheduled after the barrier in the program order become visible after the barrier. This applies to <strong>all operations</strong> - not just all reads or all writes, but both reads and writes. Furthermore, this applies to <strong>all operations</strong>, not just operations on the atomic variable, but literally all memory operations. Reads and writes cannot be reordered from after to before the barrier.</p>
<div class="text-center">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="http://quantdev.blog/posts/memory_barriers/memory_order_acquire.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Anything that was after cannot be moved to before the load.</figcaption>
</figure>
</div>
</div>
</section>
<section id="release-barrier" class="level2">
<h2 class="anchored" data-anchor-id="release-barrier">Release Barrier</h2>
<p>A release barrier is the reverse of an acquire barrier. Nothing that was before the barrier can move after, but anything that is after can move in front of the <code>store</code>.</p>
<div class="text-center">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="http://quantdev.blog/posts/memory_barriers/memory_order_release.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Anything that was before cannot be moved to after the store.</figcaption>
</figure>
</div>
</div>
</section>
<section id="acquire-release-protocol" class="level2">
<h2 class="anchored" data-anchor-id="acquire-release-protocol">Acquire-Release Protocol</h2>
<p>Acquire and release barriers are often used together. Thread t1 writes atomic variable <code>x</code> with a <code>release</code> barrier. Thread t2 reads atomic variable <code>x</code> with an <code>acquire</code> barrier. On the acquire side, all memory reads done after the <code>acquire</code> barrier in t2 in program order have to be done after the barrier in actual execution order. On the release side, all memory writes done before the <code>release</code> barrier in t1 in program order have to be done before the barrier in actual execution order.</p>
<p>The result is that all memory writes that happen in t1 before the barrier become visible in thread t2 after the barrier. Thread 1 prepares data (does some writes) then <strong>releases</strong> (publishes) it by updating atomic variable <code>x</code>. Thread 2 <strong>acquires</strong> atomic variable <code>x</code> and the data is guaranteed to be visible. Its important to note that it has to be the same atomic variable <code>x</code> for this synchronization to work.</p>
</section>
<section id="acquire-release-example" class="level2">
<h2 class="anchored" data-anchor-id="acquire-release-example">Acquire-Release Example</h2>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb17-1"></span>
<span id="cb17-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Thread-1</span></span>
<span id="cb17-3">x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>store<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>memory_order_relaxed<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb17-4">y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>store<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>memory_order_release<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb17-5">x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>store<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>memory_order_relaxed<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb17-6">z<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>store<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>memory_order_release<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb17-7">x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>store<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>memory_order_relaxed<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb17-8"></span>
<span id="cb17-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//Thread-2</span></span>
<span id="cb17-10"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">while</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>load<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>memory_order_acquire<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)!=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){}</span>   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// p</span></span>
<span id="cb17-11"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>load<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>memory_order_relaxed<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// q</span></span>
<span id="cb17-12"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">while</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>z<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>load<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>memory_order_acquire<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)!=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){}</span>   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// r</span></span>
<span id="cb17-13"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>load<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>memory_order_relaxed<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// s</span></span></code></pre></div>
<p>The output of this code snippet would be (1) <code>q</code> is either 1, 3 or 5 and (2) <code>s</code> is either 3 or 5.</p>
</section>

</section>

<div id="quarto-appendix" class="default"><section id="references" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">References</h2><div class="quarto-appendix-contents">

<ul>
<li><a href="https://www.youtube.com/watch?v=ZQFzMfHIxng">C++ atomics, from basic to advanced</a> by Fedor Pikus (CppCon 2017)</li>
<li>C++ Concurrency in Action by Anthony Williams</li>
<li>The Art of Multiprocessor Programming by Herlihy and Shavit</li>
</ul>


</div></section></div> ]]></description>
  <category>Concurrency</category>
  <guid>http://quantdev.blog/posts/memory_barriers/index.html</guid>
  <pubDate>Sun, 16 Nov 2025 00:00:00 GMT</pubDate>
  <media:content url="http://quantdev.blog/posts/memory_barriers/concurrency.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Coroutines</title>
  <dc:creator>Quasar </dc:creator>
  <link>http://quantdev.blog/posts/coroutines/index.html</link>
  <description><![CDATA[ 




<section id="coroutines" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="coroutines">Coroutines</h2>
<p>Youve likely heard about this new C++20 feature, <strong>coroutines</strong>. I think that this is a really important subject and there are several cool use-cases for coroutines. A <a href="https://en.wikipedia.org/wiki/Coroutine">coroutine</a> in the simplest terms is just a function that you can pause in the middle. Imagine that you are executing a function top-down and then just at some point in between, youd like to say, I am going to hit the pause button here; going to return the control back to the caller. At a later point the caller will decide to resume the execution of the function right where you left off. Unlike a function therefore, coroutines are always stateful - you atleast need to remember where you left off in the function body. Usually, you also need to remember more than this; you need to remember the values of all of the local variables were at the point where you paused. As a consequence, <em>you can think of the coroutine you are calling not as a function in the classical sense of the term, but more like a factory function that actually returns the coroutine object back to you. And this coroutine object is the one that holds all the state, and which you can resume to continue the computation at a future time</em>.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>load_ext itikz</span></code></pre></div>
</div>
<p>Coroutines can simplify our code! Coroutines are a great tool, when it comes to implementing parsers.</p>
<p>Compared to functions, the control flow of coroutines looks as follows:</p>
<div class="text-center">
<div class="cell" data-execution_count="2">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span>itikz <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span>temp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dir</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span>tex<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>packages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tikz <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span>tikz<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>libraries<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>arrows.meta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span>implicit<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>standalone</span>
<span id="cb2-2">\begin{tikzpicture}[scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>]</span>
<span id="cb2-3">\draw[blue, rounded corners] (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) rectangle (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-4">\node(A) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.75</span>) {Caller}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-5">\node(B) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.50</span>) {}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-6">\node(C) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.20</span>) {}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-7">\node(call) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.20</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.20</span>) {call}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-8">\node(D) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.20</span>) {}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-9">\node(F) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.75</span>) {Function}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-10">\node(Func) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.55</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.50</span>) {}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-11">\node(Return) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.55</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>) {}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-12">\node(return_back) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.2</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.50</span>) {\texttt{<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span>}}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-13">\draw[dashed, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>{Stealth[length<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">mm</span>]}] (A) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (B)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-14">\draw[dashed, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>{Stealth[length<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">mm</span>]}] (B) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (Func)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-15">\draw[dashed, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>{Stealth[length<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">mm</span>]}] (Func) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (Return)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-16">\draw[dashed, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>{Stealth[length<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">mm</span>]}] (Return) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (C)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-17">\draw[dashed, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>{Stealth[length<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">mm</span>]}] (C) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (D)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-18">\draw[blue, rounded corners] (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) rectangle (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-19">\end{tikzpicture}</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="2">
<p><img src="http://quantdev.blog/posts/coroutines/index_files/figure-html/cell-3-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>Fig. Functions - control flow</p>
</div>
<div class="text-center">
<div class="cell" data-execution_count="3">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%</span>itikz <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span>temp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dir</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span>tex<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>packages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tikz <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span>tikz<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>libraries<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>arrows.meta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span>implicit<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>standalone</span>
<span id="cb3-2">\begin{tikzpicture}[scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>]</span>
<span id="cb3-3">\draw[blue, rounded corners] (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) rectangle (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-4">\node(F) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.75</span>) {Coroutine}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-5">\node(A) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.75</span>) {Caller}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-6">\node(B) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.50</span>) {}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-7">\node(coro_A) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.55</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.50</span>) {}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-8">\node(coro_B) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.55</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.20</span>) {}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-9">\node(suspend_1) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.75</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.70</span>) {suspend}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-10">\node(coyield_1) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.50</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.25</span>) {\texttt{co\_yield}}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-11">\node(call_1) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.20</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.20</span>) {call}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-12">\node(C) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.20</span>) {}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-13">\node(D) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.70</span>) {}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-14">\node(coro_C) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.55</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.70</span>) {}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-15">\node(resume_1) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.75</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.10</span>) {resume}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-16">\node(coro_D) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.55</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.20</span>) {}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-17">\node(suspend_2) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.75</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.70</span>) {suspend}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-18">\node(coyield_2) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.50</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.25</span>) {\texttt{co\_yield}}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-19">\node(E) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.20</span>) {}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-20">\node(F) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.25</span>) {}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-21">\node(resume_2) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.75</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.55</span>) {resume}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-22">\node(coro_F) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.55</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.25</span>) {}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-23">\node(coro_G) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.55</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>) {}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-24">\node(return_back) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.2</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>) {\texttt{co\_return}}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-25">\node(H) at (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>) {}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-26">\draw[dashed, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>{Stealth[length<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">mm</span>]}] (A) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (B)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-27">\draw[dashed, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>{Stealth[length<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">mm</span>]}] (B) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (coro_A)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-28">\draw[dashed, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>{Stealth[length<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">mm</span>]}] (coro_A) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (coro_B)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-29">\draw[dashed, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>{Stealth[length<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">mm</span>]}] (coro_B) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (C)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-30">\draw[dashed, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>{Stealth[length<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">mm</span>]}] (C) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (D)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-31">\draw[dashed, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>{Stealth[length<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">mm</span>]}] (D) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (coro_C)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-32">\draw[dashed, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>{Stealth[length<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">mm</span>]}] (coro_C) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (coro_D)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-33">\draw[dashed, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>{Stealth[length<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">mm</span>]}] (coro_D) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (E)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-34">\draw[dashed, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>{Stealth[length<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">mm</span>]}] (E) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (F)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-35">\draw[dashed, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>{Stealth[length<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">mm</span>]}] (F) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (coro_F)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-36">\draw[dashed, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>{Stealth[length<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">mm</span>]}] (coro_F) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (coro_G)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-37">\draw[dashed, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>{Stealth[length<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">mm</span>]}] (coro_G) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> (H)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-38">\draw[blue, rounded corners] (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) rectangle (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-39">\end{tikzpicture}</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="3">
<p><img src="http://quantdev.blog/posts/coroutines/index_files/figure-html/cell-4-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>Fig. Coroutines - control flow</p>
</div>
<p>Coroutine frames (state of all the local variables at the point where you paused) may be stored on the stack or on the dynamic heap. C++ implements the latter approach - stackless coroutines.</p>
<p>When using coroutines, we are talking about cooperative multi-tasking. As a quick 101, in preemptive multitasking, a special hardware timer interrupt is sent to the CPU periodically, the register state of the currently running process is saved to the main memory (in a data-structure called the process context) and the OS kernel acquires control of the CPU. The OS scheduler uses a scheduling policy such as round-robin to schedule another process from the process queue, copies its context from main memory to the CPU registers and transfers control to it. This is called a context switch. In cooperative multitasking, each process/thread, once running decides for how long to keep the CPU, and (crucially) when it is time to give it up so that another thread can use it.</p>
<section id="a-simple-example" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="a-simple-example">A simple example</h3>
<p>Lets start with a simple example. Lets say, you want to compute the Fibonacci sequence. First thing, that youd do, is code up a function <code>fibo(int)</code> that returns a sequence in a vector.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Returns a vector containing the </span></span>
<span id="cb4-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// first n elements of the Fibonacci </span></span>
<span id="cb4-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// series: </span></span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// 1, 1, 2, 3, 5, 8, 13, 21, ...</span></span>
<span id="cb4-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> fibo<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb4-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb4-7">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> results<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb4-8">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> a_prev<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">},</span> a_curr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb4-9">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> a_next<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb4-10">    results<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>push_back<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>a_prev<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb4-11">    results<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>push_back<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>a_curr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb4-12">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span>n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;++</span>i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb4-13">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb4-14">        a_next <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> a_prev <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> a_curr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-15">        results<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>push_back<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>a_next<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb4-16">        a_prev <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> a_curr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-17">        a_curr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> a_next<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-18">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb4-19"></span>
<span id="cb4-20">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> results<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-21"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>This naive implementation has a number of disadvantages. For example, this function will always require <img src="https://latex.codecogs.com/png.latex?O(n)"> storage. Fibonacci has a simple recursive equation, but if I have a complex computation, and I am only ever processing the numbers sequentially one at a time, then it makes no sense to pay for the entire <img src="https://latex.codecogs.com/png.latex?O(n)"> storage. Another problem is that, if you are dealing with an infinite range, then it becomes a lot harder to handle.</p>
<p>A different way of implementing this would be as follows. Instead of our function returning a range in a <code>vector</code>, we are just going to return a <code>generator</code> object; this <code>generator</code> object has then a <code>next()</code> member function and then every call to the <code>next()</code> member function gives us back the next number in the sequence.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb5-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> FiboGenerator</span>
<span id="cb5-2"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-3">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Successive calls to next()  </span></span>
<span id="cb5-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// return the numbers from the </span></span>
<span id="cb5-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Fibonacci series</span></span>
<span id="cb5-6">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> next<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb5-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-8"></span>
<span id="cb5-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Returns a new FiboGenerator object</span></span>
<span id="cb5-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// that will start from the first </span></span>
<span id="cb5-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Fibonacci number</span></span>
<span id="cb5-12">FiboGenerator makeFiboGenerator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span></code></pre></div>
<p>The interesting question is: Is <code>makeFiboGenerator()</code> a coroutine? And we really cant tell - its an implementation detail. All we see is an interface. This is actually the most important thing about coroutines. From the outside, they just look and behave like functions. From the outside, there is no way to tell, whether theyve been implemented using a coroutine or not. The only thing that we need to know as the user of this function is the interface of the object <code>FiboGenerator</code>.</p>
</section>
<section id="the-coroutine-return-type" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="the-coroutine-return-type">The coroutine return type</h3>
<p>The initial call to the coroutine function will produce this return object of a certain <code>ReturnType</code> and hand it back to the caller. The interface of this type is what is going to determine what the coroutine is capable of. Since coroutines are super-flexible, we can do a whole lot with this return object. If you have some coroutine, and you want to understand what its doing, the first thing you should look at is the <code>ReturnType</code>, and what its interface is. The important thing here is, we design this <code>ReturnType</code>. If you are writing a coroutine, you can decide, what goes into this interface.</p>
</section>
<section id="how-to-turn-a-function-into-a-coroutine" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="how-to-turn-a-function-into-a-coroutine">How to turn a function into a coroutine?</h3>
<p>The compiler looks for one of the three keywords in the implementation: <code>co_yield</code>, <code>co_await</code> and <code>co_return</code>.</p>
<table class="table">
<caption>Coroutine keywords and their effects</caption>
<thead>
<tr class="header">
<th>Keyword</th>
<th>Action</th>
<th>State</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>co_yield</code></td>
<td>Output</td>
<td>Suspended</td>
</tr>
<tr class="even">
<td><code>co_return</code></td>
<td>Output</td>
<td>Ended</td>
</tr>
<tr class="odd">
<td><code>co_await</code></td>
<td>Input</td>
<td>Suspended</td>
</tr>
</tbody>
</table>
<p>In the preceding table, we see that after <code>co_yield</code> and <code>co_await</code>, the coroutine suspends itself and after <code>co_return</code>, it is terminated (<code>co_return</code> is the equivalent of the <code>return</code> statement in the C++ function).</p>
<p>A classical function starts executing when its called and normally terminates with a <code>return</code> statement or just when the functions end is reached. A function runs from the beginning to end. It may call another function (or even itself if it is recursive) and it may throw exceptions or have different return points. But it always runs from the beginning to the end.</p>
<p>A coroutine is different. A coroutine is a function that can suspend itself. The flow for a coroutine may be like the following pseudo-code:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb6-1">ReturnType coroutine<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb6-2">    do_something<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb6-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">co_yield</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-4">    do_something_else<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb6-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">co_yield</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-6">    do_more_work<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb6-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">co_return</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>You should think of the coroutine function not as a function in the classical sense, but rather as a factory function that returns a coroutine object and this coroutine object is the one that holds all the state, and one which you can resume to continue the computation later on.</p>
</section>
<section id="use-cases-for-coroutines" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="use-cases-for-coroutines">Use-cases for coroutines</h3>
<p><strong>Asynchronous computation.</strong> Suppose we are tasked with designing a simple echo server. We listen for incoming data from a client socket and we simply send it back to the client. At some point in our code for the echo server, we will have a piece of logic like below:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb7-1"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> session<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Socket sock<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb7-2">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">char</span> buffer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">];</span></span>
<span id="cb7-3">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> len <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sock<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>read<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">({</span>buffer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">});</span></span>
<span id="cb7-4">    sock<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>write<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">({</span>buffer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>len<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">});</span></span>
<span id="cb7-5">    log<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>buffer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb7-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>We create a <code>buffer</code>, then call the <code>read</code> that reads packets from the NIC and stores them in the buffer. The return value <code>len</code> will tell us how many bytes we read. Then, we shrink the <code>buffer</code> - we create a smaller one with <code>len</code> bytes and we write it back. Finally, we perform some logging. If we run it, it will probably work, but we certainly dont want to write a server like this. Say one of the clients requests communication and we are in a session. They say, they are ready to send the data, so we are blocking on the <code>read</code>, but maybe they send us this data in 2 minutes, or 5 minutes or even more. And other clients keep waiting.</p>
<p>What we could do is start this session and run it in a separate thread. And this would work, because if this thread is blocked, and if there are other threads in this server, they would run in exchange during the wait time. If we have a threadpool, well just grab a thread from the threadpool, tell whatever system manages the pool to run this <code>session(Socket)</code> function there.</p>
<p>This solution is still far from ideal. These are operating system emulated threads and the OS will have to manage which threads get CPU time. It will have to preempt one thread, run another. This preemption will occur at random moments, when we least expect it. We could have data-races and likely require protection of a critical section/resource using mutexes.</p>
<p>One alternative is to use an asynchronous framework and rewrite our code as follows:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb8-1"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> session<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Socket sock<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb8-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> State<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> Socket sock<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">char</span> buffer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">];</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb8-3">    </span>
<span id="cb8-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Heap allocate the state</span></span>
<span id="cb8-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> state <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>make_shared<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>State<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;(</span>sock<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> buffer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb8-6"></span>
<span id="cb8-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> on_read_finished_callback <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/* ... */</span></span>
<span id="cb8-8"></span>
<span id="cb8-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Perform an asynchronous read </span></span>
<span id="cb8-10">    state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>socket<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>async_read<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>buffer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb8-11">                             on_read_finished_callback <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb8-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>The <code>async_read()</code> call is a request to the framework, which says that we are interested in data being read to our buffer at some point convenient to the client. When this succeeds, call our <code>on_read_finished_callback</code>. So, we are just making this association at this point and the server can move on to doing other stuff.</p>
<p>The <code>read</code> operation may fail for a number of reasons, so a good approach would be supply two arguments to the <code>on_read_finished_callback</code>: (i) An error code (ii) The number of bytes received, if there were no errors. We can try to implement it, by checking the error-code.</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb9-1"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> session<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Socket sock<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb9-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> State<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> Socket sock<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">char</span> buffer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">];</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb9-3">    </span>
<span id="cb9-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Heap allocate the state</span></span>
<span id="cb9-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> state <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>make_shared<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>State<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;(</span>sock<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> buffer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb9-6"></span>
<span id="cb9-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> on_read_finished_callback <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[&amp;</span>state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">](</span></span>
<span id="cb9-8">        error_code ec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb9-9">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> len</span>
<span id="cb9-10">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb9-11">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb9-12">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> done <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/* ... */</span></span>
<span id="cb9-13">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(!</span>ec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb9-14">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb9-15">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Perform an asynchronous write</span></span>
<span id="cb9-16">            state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>socket<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>async_write<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> </span>
<span id="cb9-17">                state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>buffer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb9-18">                done </span>
<span id="cb9-19">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span>    </span>
<span id="cb9-20">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb9-21">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb9-22"></span>
<span id="cb9-23">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Perform an asynchronous read </span></span>
<span id="cb9-24">    state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>socket<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>async_read<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>buffer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb9-25">                             on_read_finished_callback <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb9-26"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>Now, we dont have exception handling, because we have spread our logic over a number of callbacks. We are only left with <code>if</code> statements. If the reading all went fine, we can write the data back by shrinking the buffer, requesting that the <code>write</code> is performed at some time, not necessarily now - maybe later. When this <code>write</code> is performed, we would like to call another callback <code>done</code>. We dont wait until this callback is called or <code>write</code> is performed. At this point, we just make an association. It is possible, that at a future time, the <code>write</code> succeeds and then the callback <code>done</code> is called. So, we have to define it.</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb10-1"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> session<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Socket sock<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb10-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> State<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> Socket sock<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">char</span> buffer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">];</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb10-3">    </span>
<span id="cb10-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Heap allocate the state</span></span>
<span id="cb10-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> state <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>make_shared<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>State<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;(</span>sock<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> buffer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb10-6"></span>
<span id="cb10-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> on_read_finished_callback <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span>state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">](</span></span>
<span id="cb10-8">        error_code ec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb10-9">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> len</span>
<span id="cb10-10">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb10-11">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-12">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> done <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span>state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">](</span>error_code ec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> len<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb10-13">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-14">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(!</span>ec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb10-15">                log<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb10-16">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-17">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(!</span>ec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb10-18">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-19">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Perform an asynchronous write</span></span>
<span id="cb10-20">            state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>socket<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>async_write<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> </span>
<span id="cb10-21">                state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>buffer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb10-22">                done </span>
<span id="cb10-23">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span>    </span>
<span id="cb10-24">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-25">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-26"></span>
<span id="cb10-27">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Perform an asynchronous read </span></span>
<span id="cb10-28">    state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>socket<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>async_read<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span> state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>buffer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb10-29">                             on_read_finished_callback <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb10-30"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><code>done</code> has a similar structure. It takes two arguments - the error code that tells if the <code>write</code> went fine and the number of bytes written <code>len</code>. If there were no errors on <code>write</code> and everything went fine, we can do the logging. Implicitly,</p>
<p>So, the <code>session</code> makes two associations:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Ctext%7BOn%20finishing%20read%7D%20&amp;%5Cmapsto%20%5Ctexttt%7Bon%5C_finished%5C_read%5C_callback%7D%20%5C%5C%0A%5Ctext%7BOn%20finishing%20write%7D%20&amp;%5Cmapsto%20%5Ctexttt%7Bdone%7D%20%5C%5C%0A%5Ctext%7BAccepting%20a%20new%20client%20connection%7D%20&amp;%5Cmapsto%20%5Ctexttt%7Bsession%7D%0A%5Cend%7Balign*%7D%0A"></p>
<p>And implicitly there is a third association even though we cannot see it here - this entire function <code>session</code> is most likely a callback, in response to an event like <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BOn%20client%20connection%20established%7D">. So, the server will be many different associations of events to callbacks at different levels.</p>
<p>Pay attention to the <code>state</code>. We said that, we wanted to allocate it on the heap and manage it through a <code>shared_ptr</code>. We pass this <code>shared_ptr&lt;State&gt;</code> by value to every single callback. This way, I make sure that the last one who touches this session turns off the lights and deallocates <code>state</code>.</p>
<p>While this is a toy-example, in real production code, there can be a long sequence of steps and calling lambdas inside lambdas can obfuscate the meaning of the code. We already see a weird inversion of control flow, when reading the code.</p>
<p>One thing to note before I go to coroutines is that, even though those things happen asynchronously, there is a sequence to it, that is not violated. We only perform a <code>write</code> when we know that the <code>read</code> has succeeded. We only perform the <code>log</code> after the <code>write</code> has succeeded.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctexttt%7Bread%7D%20%5Cto%20%5Ctexttt%7Bwrite%7D%20%5Cto%20%5Ctexttt%7Blog%7D%0A"></p>
<p>As an application programmer we determine, when we yield control to the system other sessions. Its not that the system pre-empts this task.</p>
<p>A coroutine implementation of the same echoing session would look like this:</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb11-1">Task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> session<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Socket sock<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb11-2">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">char</span> buffer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">];</span></span>
<span id="cb11-3">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> len <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">co_await</span> sock<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>async_read<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">({</span>buffer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">});</span></span>
<span id="cb11-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">co_await</span> sock<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>async_write<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">({</span>buffer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>len<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">});</span></span>
<span id="cb11-5">    log<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>buffer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb11-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>This looks very similar to the sequential code, except that we use this <code>co_await</code> keyword. You have clear indication of the points where the coroutine will be suspended. Also, note that previously the function <code>session</code> returned <code>void</code>. Now, we are returning something - a <code>Task&lt;void&gt;</code>. This will be a handle to the coroutine and its how the outside world will be communicating with the coroutine.</p>
<p><strong>Suspended computation</strong>. A second use-case is that coroutines support lazy evaluation. Just as in the fibonacci example, sometimes we want to avoid doing unecessary evaluation. Lazy evaluation doesnt do any work unless its absolutely necessary. This can also potentially make your code more efficient. Lazy evaluation also supports programming with infinite lists.</p>
</section>
</section>
<section id="the-simplest-coroutine" class="level2">
<h2 class="anchored" data-anchor-id="the-simplest-coroutine">The simplest coroutine</h2>
<p>The following code is the simplest implementation of a coroutine:</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb12-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;coroutine&gt;</span></span>
<span id="cb12-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> coro_func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb12-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">co_return</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb12-4"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb12-5"></span>
<span id="cb12-6"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb12-7">    coro_func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb12-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><a href="https://compiler-explorer.com/z/W3GoWPoEs">Compiler Explorer</a></p>
<p>Our first coroutine will just return nothing. It will not do anything else. Sadly, the preceding code is too simple for a functional coroutine and it will not compile. When compiling with <code>gcc 15.2</code>, we get the following error:</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb13-1">&lt;source&gt;: In function 'void coro_func()':</span>
<span id="cb13-2">&lt;source&gt;:4:5: error: unable to find the promise type for this coroutine</span>
<span id="cb13-3">    4 |     co_return;</span>
<span id="cb13-4">      |     ^~~~~~~~~</span></code></pre></div>
<p>Looking at C++ reference, we see that the return type of a coroutine must define a type named <code>promise_type</code>.</p>
<section id="the-promise_type" class="level3">
<h3 class="anchored" data-anchor-id="the-promise_type">The <code>promise_type</code></h3>
<p>Why do we need a promise? The <code>promise_type</code> is the second important piece in the coroutine mechanism. We can draw an analogy from futures and promises which are essential blocks for achieving asynchronous programming in C++. The future is the thing, that the function that does the asynchronous computation, hands out back to the caller, that the caller can use to retrieve the result by invoking the <code>get()</code> member function. The future has the role of the return object. But, you need something that remains on the producer-side. The asynchronous function holds on to the promise, and thats where it puts the results that will be given to the caller, when it calls <code>get()</code> on the future. The idea behind the <code>promise_type</code> for coroutines is similar. The promise is where the coroutines return value is stored, and it provides functions to control the coroutines behavior at startup and completion of t he coroutine. The promise is the interface through which the caller interacts with the coroutine.</p>
<p>Following the reference advice, we can write a new version of our coroutine.</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb14-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;coroutine&gt;</span></span>
<span id="cb14-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> Task</span>
<span id="cb14-3"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span></span>
<span id="cb14-5">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-6">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb14-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb14-8"></span>
<span id="cb14-9">Task coro_func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb14-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">co_return</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-11"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb14-12"></span>
<span id="cb14-13"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb14-14">    coro_func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb14-15"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><a href="https://compiler-explorer.com/z/G957defsr">Compiler Explorer</a></p>
<p>Note that the return type of a coroutine can have any name (I call it <code>Task</code>, so that it makes intuitive sense). Compiling the preceding code again gives us errors. All errors are about missing functions in the <code>promise_type</code>:</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb15-1">&lt;source&gt;: In function 'Task coro_func()':</span>
<span id="cb15-2">&lt;source&gt;:11:5: error: no member named 'return_void' in</span>
<span id="cb15-3">'std::__n4861::__coroutine_traits_impl&lt;Task, void&gt;::promise_type' {aka 'Task::promise_type'}</span>
<span id="cb15-4">   11 |     co_return;</span>
<span id="cb15-5">      |     ^~~~~~~~~</span>
<span id="cb15-6">&lt;source&gt;:10:6: error: no member named 'unhandled_exception' in</span>
<span id="cb15-7">'std::__n4861::__coroutine_traits_impl&lt;Task, void&gt;::promise_type' {aka 'Task::promise_type'}</span>
<span id="cb15-8">   10 | Task coro_func(){</span>
<span id="cb15-9">      |      ^~~~~~~~~</span>
<span id="cb15-10">&lt;source&gt;:10:6: error: no member named 'get_return_object' in</span>
<span id="cb15-11">'std::__n4861::__coroutine_traits_impl&lt;Task, void&gt;::promise_type' {aka 'Task::promise_type'}</span></code></pre></div>
<p>One of the important functions of the <code>promise_type</code> is that it determines what happens at certain key points in the coroutines life. It determines, what happens at the startup and completion of execution of the coroutine.</p>
</section>
<section id="implementing-the-promise_type" class="level3">
<h3 class="anchored" data-anchor-id="implementing-the-promise_type">Implementing the <code>promise_type</code></h3>
<p>The first thing that the compiler expects from us the <code>get_return_object()</code> function. The return type of this function is the same as the return type of the coroutine.</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb16-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;coroutine&gt;</span></span>
<span id="cb16-2"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;print&gt;</span></span>
<span id="cb16-3"></span>
<span id="cb16-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> Task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-6">        Task get_return_object<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb16-7">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"get_return_object()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb16-8">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> Task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb16-9">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb16-10"></span>
<span id="cb16-11">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> return_void<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-12">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"return_void()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb16-13">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb16-14"></span>
<span id="cb16-15">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> unhandled_exception<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-16">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"unhandled_exception()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb16-17">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb16-18"></span>
<span id="cb16-19">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>suspend_always<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>initial_suspend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-20">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"initial_suspend()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb16-21">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb16-22">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb16-23"></span>
<span id="cb16-24">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>suspend_always<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>final_suspend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-25">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"final_suspend()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb16-26">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb16-27">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb16-28">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb16-29"></span>
<span id="cb16-30">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">explicit</span> Task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;){</span></span>
<span id="cb16-31">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Task(promise_type&amp;)"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb16-32">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb16-33"></span>
<span id="cb16-34">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-35">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~Task()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb16-36">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb16-37"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb16-38"></span>
<span id="cb16-39">Task coro_func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb16-40">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">co_return</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb16-41"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb16-42"></span>
<span id="cb16-43"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb16-44">    coro_func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb16-45"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><a href="https://compiler-explorer.com/z/xoqanYjMT">Compiler Explorer</a></p>
<p>Output:</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb17-1">get_return_object()</span>
<span id="cb17-2">Task(promise_type&amp;)</span>
<span id="cb17-3">initial_suspend()</span>
<span id="cb17-4">~Task()</span></code></pre></div>
<p>The <code>get_return_object()</code> method is implicitly called when the coroutine starts executing. Its upto the <code>promise_type</code> to provide an implementation of this method that constructs the return object that will be handed back to the caller. The <code>Task</code> object is stored on the heap. You dont see this in the source code anywhere. When the coroutine reaches its first suspension point, and control flow is returned back to the caller, then the caller will receive this object.</p>
<p>The next thing we need to specify is the <code>return_void()</code> function. This is a customization point for handling what happens when we reach the <code>co_return</code> statement in the function body. There is also a corresponding <code>return_value()</code>, if you dont have an empty <code>co_return</code> statement, but well look at this at length later ahead.</p>
<p>The next one we need is <code>unhandled_exception()</code> and similar to the <code>return_void()</code>, this function is a customization point for handling, what happens when the coroutine throws an exception. We leave it empty for now.</p>
<p>We need to implement two more functions <code>initial_suspend()</code> and <code>final_suspend()</code>. These are basically the customization points that allow us to execute some code, both when the coroutine first starts executing and shortly before the coroutine ends execution. Here, we are returning <code>std::suspend_always</code> which basically means that at these points, I want to go into suspension. In a typical implementation, you either return <code>std::suspend_always</code>, which means you pause execution at this point and hand control back to the caller always, or you return <code>std::suspend_never</code>, which basically means you just go on and continue executing the coroutine.</p>
<p>Note that, <code>final_suspend()</code> is not printed in the output, because the coroutine is paused at <code>initial_suspend()</code> and since I never resumed it, I dont see the output on the console.</p>
</section>
</section>
<section id="a-yielding-coroutine" class="level2">
<h2 class="anchored" data-anchor-id="a-yielding-coroutine">A yielding coroutine</h2>
<p>The do-nothing coroutine was great to get a gut intuitive feel for the basic mechanics of writing low-level coroutines in C++. Lets implement another coroutine that can send data back to the caller.</p>
<p>In this second example, we implement a coroutine that produces a message. It will be the hello world of coroutines. The coroutine will say hello and the caller function will print the message received from the coroutine.</p>
<p>To implement this functionality, we need to establish a communication channel from the coroutine to the caller. This channel is the mechanism that allows the coroutine to pass values to the caller and receive information from it. This channel is established through the coroutines <code>promise_type</code> and the <em>coroutine handle</em>.</p>
<p>The <em>coroutine handle</em> is a type that gives access to the coroutine frame(the coroutines internal state) and allows the caller to resume or destroy the coroutine. The handle is what the caller can use to resume the coroutine after it has been suspended (for example after <code>co_await</code> or <code>co_yield</code>). The handle can also be used to check whether the coroutine is done or to clean up its resources.</p>
<p>The following code is the new version of both the caller function and the coroutine:</p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb18-1">Task coro_func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb18-2">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">co_yield</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hello world from the coroutine"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb18-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">co_return</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb18-4"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb18-5"></span>
<span id="cb18-6"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb18-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> task <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> coro_func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb18-8">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>print<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"task.get() = </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">());</span></span>
<span id="cb18-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb18-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>The coroutine <em>yields</em> and sends some data to the caller. The caller reads that data and prints it. When the compiler reads the <code>co_ yield</code> expression, it will generate a call to the <code>yield_value</code> function defined in the <code>promise_type</code>. Thus, we add the following code to the <code>promise_type</code> :</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb19-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> Task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb19-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb19-3">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>string<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>output_data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb19-4"></span>
<span id="cb19-5">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/* ... */</span></span>
<span id="cb19-6">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>suspend_always<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>yield_value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>string<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>msg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb19-7">            output_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>move<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>msg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb19-8">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb19-9">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb19-10"></span>
<span id="cb19-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">explicit</span> Task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;){</span></span>
<span id="cb19-12">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Task(promise_type&amp;)"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb19-13">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb19-14"></span>
<span id="cb19-15">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb19-16">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~Task()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb19-17">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb19-18"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span></code></pre></div>
<p>The function gets a <code>std::string</code> object and moves it to the <code>output_data</code> member variable of the promise type. But, this just keeps the data inside the <code>promise_type</code>. We still need a mechanism to get that data out of the coroutine.</p>
<section id="the-coroutine-handle" class="level3">
<h3 class="anchored" data-anchor-id="the-coroutine-handle">The coroutine handle</h3>
<p>Once we require a communication channel to and from a coroutine, we need a way to refer to a suspended or executing coroutine. The mechanism to refer to the coroutine object is through a pointer or handle called a <strong>coroutine handle</strong>. The C++ library header file <code>&lt;coroutine&gt;</code> defines a type <code>std::coroutine_handle</code> to work with coroutine handles.</p>
<p>Two functions are of interest to us in the <code>std::coroutine_handle</code> interface : <code>resume()</code> and <code>destroy()</code>.</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb20-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> coroutine_handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;{</span></span>
<span id="cb20-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/* ... */</span></span>
<span id="cb20-3">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> resume<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb20-4">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> destroy<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb20-5">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb20-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> coroutine_handle from_promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;);</span></span>
<span id="cb20-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>What <code>resume()</code> does is simply, it resumes the suspended coroutine. It continues execution.</p>
<p>If we think of this coroutine frame or object living somewhere on the heap, where all of the state of execution is stored, one way to destroy this state is to let the coroutine run to completion. But, far more commonly, we would like to manage the lifetime externally and we can then just call the <code>destroy()</code> function which will then get rid of the coroutine state.</p>
<p>Note that, the <code>coroutine_handle</code> is not a smart pointer type. So, you have to call the <code>destroy()</code> explicitly.</p>
<p>Theres two more functions <code>.promise()</code> and <code>.from_promise()</code>. These are used to convert from a coroutine to a promise object and vice versa.</p>
<p>We add the following functionality to our return type to manage the coroutine handle:</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb21-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> Task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb21-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb21-3">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>string<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>output_data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb21-4"></span>
<span id="cb21-5">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/* ... */</span></span>
<span id="cb21-6">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>suspend_always<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>yield_value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>string<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>msg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb21-7">            output_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>move<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>msg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb21-8">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb21-9">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb21-10"></span>
<span id="cb21-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Coroutine handle member-variable</span></span>
<span id="cb21-12">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>coroutine_handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb21-13"></span>
<span id="cb21-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// ReturnType(promise_type&amp;) ctor initializes </span></span>
<span id="cb21-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// the coroutine handle member variable</span></span>
<span id="cb21-16">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">explicit</span> Task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb21-17">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> handle <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>coroutine_handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>from_promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb21-18">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb21-19">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Task(promise_type&amp;)"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb21-20">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb21-21"></span>
<span id="cb21-22">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Destructor</span></span>
<span id="cb21-23">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb21-24">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~Task()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb21-25">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb21-26">            handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>destroy<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb21-27">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb21-28"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span></code></pre></div>
<p>The preceding code declares a coroutine handle of type <code>std::coroutine_handle&lt;promise_type&gt;</code> and creates the handle in the return type constructor. The handle is destroyed in the return type destructor.</p>
<p>Now, back to our yielding coroutine. The only missing bit is a <code>get()</code> function for the caller to be able to extract the resultant string out of the promise.</p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb22-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>string<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb22-2">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(!</span>handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>done<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()){</span></span>
<span id="cb22-3">        handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>resume<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb22-4">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb22-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>move<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">().</span>output_data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb22-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>The <code>get()</code> function resumes the coroutine if it has not terminated and return the result stored in the <code>output_data</code> member variable of the promise. The full source code listing is shown below:</p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb23-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;coroutine&gt;</span></span>
<span id="cb23-2"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;print&gt;</span></span>
<span id="cb23-3"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb23-4"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;string&gt;</span></span>
<span id="cb23-5"></span>
<span id="cb23-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">namespace</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>string_literals<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb23-7"></span>
<span id="cb23-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> Task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb23-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb23-10">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>string<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>output_data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb23-11"></span>
<span id="cb23-12">        Task get_return_object<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb23-13">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"get_return_object()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb23-14">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> Task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb23-15">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb23-16"></span>
<span id="cb23-17">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> return_void<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb23-18">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"return_void()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb23-19">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb23-20"></span>
<span id="cb23-21">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> unhandled_exception<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb23-22">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"unhandled_exception()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb23-23">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb23-24"></span>
<span id="cb23-25">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>suspend_always<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>initial_suspend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb23-26">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"initial_suspend()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb23-27">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb23-28">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb23-29"></span>
<span id="cb23-30">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>suspend_always<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>final_suspend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb23-31">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"final_suspend()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb23-32">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb23-33">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb23-34"></span>
<span id="cb23-35">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>suspend_always<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>yield_value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>string<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>msg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb23-36">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yield_value(std::string)"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb23-37">            output_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>move<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>msg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb23-38">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb23-39">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb23-40">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb23-41"></span>
<span id="cb23-42">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Coroutine handle member-variable</span></span>
<span id="cb23-43">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>coroutine_handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb23-44"></span>
<span id="cb23-45">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// ReturnType(promise_type&amp;) ctor initializes </span></span>
<span id="cb23-46">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// the coroutine handle member variable</span></span>
<span id="cb23-47">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">explicit</span> Task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb23-48">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> handle <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>coroutine_handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>from_promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb23-49">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb23-50">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Task(promise_type&amp;)"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb23-51">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb23-52"></span>
<span id="cb23-53">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb23-54">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~Task()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb23-55">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb23-56">            handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>destroy<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb23-57">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb23-58"></span>
<span id="cb23-59">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>string<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb23-60">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"get()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb23-61">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(!</span>handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>done<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">())</span></span>
<span id="cb23-62">            handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>resume<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb23-63"></span>
<span id="cb23-64">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>move<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">().</span>output_data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb23-65">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb23-66"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb23-67"></span>
<span id="cb23-68">Task coro_func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb23-69">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">co_yield</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hello world from the coroutine"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb23-70">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">co_return</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb23-71"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb23-72"></span>
<span id="cb23-73"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb23-74">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> task <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> coro_func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb23-75">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>endl<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb23-76"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><a href="https://compiler-explorer.com/z/EjdWEnb5a">Compiler Explorer</a></p>
<p>Output:</p>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb24-1">get_return_object()</span>
<span id="cb24-2">Task(promise_type&amp;)</span>
<span id="cb24-3">initial_suspend()</span>
<span id="cb24-4">get()</span>
<span id="cb24-5">yield_value(std::string)</span>
<span id="cb24-6">Hello world from the coroutine</span>
<span id="cb24-7">~Task()</span></code></pre></div>
<p>The output shows what is happening during the coroutine execution. The <code>Task</code> object is created after a call to <code>get_return_object</code>. The coroutine is initially suspended. The caller wants to get the message from the coroutine so <code>get()</code> is called, which resumes the coroutine. When the compiler sees <code>co_yield</code> statement in the coroutine, it generates an implicit called to <code>yield_value(std::string)</code>. <code>yield_value</code> is called and the message is copied to the resultant member variable <code>output_data</code> in the promise. Finally, the message is printed by the caller function, and the coroutine returns.</p>
</section>
</section>
<section id="a-waiting-coroutine" class="level2">
<h2 class="anchored" data-anchor-id="a-waiting-coroutine">A waiting coroutine</h2>
<p>We are now going to implement a coroutine that can wait for the input data sent by the caller. In our example, the coroutine will wait until it gets a <code>std::string</code> object and then print it. We say that the coroutine waits, we mean it is suspended (that is, not executed) until the data is received.</p>
<p>We start with changes to both the coroutine and the caller function:</p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb25-1">Task coro_func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb25-2">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">co_await</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>string<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb25-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">co_return</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb25-4"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb25-5"></span>
<span id="cb25-6"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb25-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> task <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> coro_func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb25-8">    task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>put<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"To boldly go where no man has gone before"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb25-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb25-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>In the preceding code, the caller function calls the <code>put()</code> function(a method in the return type structure) and the coroutine calls <code>co_await</code> to wait for a <code>std::string</code> object from the caller.</p>
<p>The changes to the return type are simple, that is, just adding the <code>put()</code> function.</p>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb26-1"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> put<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>string<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>msg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb26-2">    handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">().</span>input_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>move<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>msg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb26-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(!</span>handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>done<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()){</span></span>
<span id="cb26-4">        handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>resume<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb26-5">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb26-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>We need to add the <code>input_data</code> variable to the promise structure. But, just with those changes to our first example and the coroutine handle from the previous example, the code cannot be compiled.</p>
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb27-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;print&gt;</span></span>
<span id="cb27-2"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;string&gt;</span></span>
<span id="cb27-3"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;coroutine&gt;</span></span>
<span id="cb27-4"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb27-5"></span>
<span id="cb27-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> Task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb27-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb27-8">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>string<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>input_data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb27-9"></span>
<span id="cb27-10">        Task get_return_object<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb27-11">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"get_return_object"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb27-12">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> Task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb27-13">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span> </span>
<span id="cb27-14"></span>
<span id="cb27-15">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> return_void<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb27-16">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"return_void"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb27-17">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb27-18"></span>
<span id="cb27-19">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>suspend_always<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>initial_suspend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb27-20">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"initial_suspend"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb27-21">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb27-22">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb27-23"></span>
<span id="cb27-24">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>suspend_always<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>final_suspend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb27-25">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"final_suspend"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb27-26">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb27-27">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb27-28">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> unhandled_exception<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb27-29">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"unhandled_exception"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb27-30">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb27-31"></span>
<span id="cb27-32">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>suspend_always<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>yield_value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>string<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>msg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb27-33">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yield_value"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb27-34">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//output_data = std::move(msg);</span></span>
<span id="cb27-35">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb27-36">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb27-37">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb27-38"></span>
<span id="cb27-39">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>coroutine_handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb27-40"></span>
<span id="cb27-41">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">explicit</span> Task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb27-42">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>coroutine_handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>from_promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)}</span></span>
<span id="cb27-43">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb27-44">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Task(promise_type&amp;) ctor"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb27-45">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb27-46"></span>
<span id="cb27-47">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb27-48">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb27-49">            handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>destroy<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb27-50"></span>
<span id="cb27-51">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~Task()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb27-52">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb27-53"></span>
<span id="cb27-54">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> put<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>string<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>msg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb27-55">        handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">().</span>input_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>move<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>msg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb27-56">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(!</span>handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>done<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">())</span></span>
<span id="cb27-57">            handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>resume<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb27-58">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb27-59"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb27-60"></span>
<span id="cb27-61">Task coro_func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb27-62">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">co_await</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>string<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb27-63">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">co_return</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb27-64"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb27-65"></span>
<span id="cb27-66"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb27-67">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> task <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> coro_func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb27-68">    task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>put<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"To boldly go where no man has gone before"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb27-69">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb27-70"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><a href="https://compiler-explorer.com/z/1qafsj83e">Compiler Explorer</a></p>
<p>The compiler gives us the following error:</p>
<div class="sourceCode" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb28-1">&lt;source&gt;: In function 'Task coro_func()':</span>
<span id="cb28-2">&lt;source&gt;:62:18: error: no member named 'await_ready' in 'std::string' {aka 'std::__cxx11::basic_string&lt;char&gt;'}</span>
<span id="cb28-3">   62 |     std::cout &lt;&lt; co_await std::string{};</span>
<span id="cb28-4">      |                  ^~~~~~~~</span></code></pre></div>
<p>Lets explore more about what this error message means.</p>
</section>
<section id="what-is-an-awaitable" class="level2">
<h2 class="anchored" data-anchor-id="what-is-an-awaitable">What is an awaitable?</h2>
<p>An <em>awaitable</em> is any object, I can call <code>co_await</code> on. You can think of <code>co_await</code> like an operator, and its argument as an <em>awaitable</em>. The way to think about the operator <code>co_await</code> is that these are opportunities for suspension. These are the points where the coroutine can be paused, and the control-flow can be handed back to the caller. The awaitable controls what happens at these points. Similar to, how the <code>promise_type</code> provides hooks to control what happens at startup or when you return from the coroutine, the awaitable provides these hooks for what happens when we go into suspension. They may decide not to suspend at all, and let the execution just continue. Not every <code>co_await</code> call necessary suspends. Its totally upto the coroutine-writer. Lets try to implement such an awaitable.</p>
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb29-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> Awaitable<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb29-2">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bool</span> await_ready<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb29-3">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> await_suspend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>coroutine_handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;);</span></span>
<span id="cb29-4">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> await_resume<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>coroutine_handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;);</span></span>
<span id="cb29-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span></code></pre></div>
<p>The first function is <code>.await_ready()</code> which returns a <code>bool</code>. This determines whether we do actually go into suspension or we just say, <em>yeah, we are ready, and we dont want to go into suspension</em>, we want to continue execution and in that case we just return <code>true</code>.</p>
<p>The next function is <code>.await_suspend()</code> and that is the customization point that will get executed shortly before the coroutine function goes to sleep.</p>
<p>The next function is <code>.await_resume()</code> and that is the customization point that will get execute just after the coroutine is resumed.</p>
<p>The following code shows our implementation of the <code>await_transform</code> function and the <code>Awaitable</code> struct:</p>
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb30-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> await_transform<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>string<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb30-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> Awaitable<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb30-3">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb30-4"></span>
<span id="cb30-5">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bool</span> await_ready<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb30-6">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Says, yeah we are ready</span></span>
<span id="cb30-7">                            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// we don't need to sleep. Just go on.</span></span>
<span id="cb30-8">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb30-9"></span>
<span id="cb30-10">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>string<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>await_resume<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb30-11">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>move<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>input_data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb30-12">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb30-13"></span>
<span id="cb30-14">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> await_suspend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>coroutine_handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;)</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb30-15"></span>
<span id="cb30-16">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb30-17"></span>
<span id="cb30-18">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> Awaitable<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb30-19"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>This is the code for the full example of the waiting coroutine:</p>
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb31-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;print&gt;</span></span>
<span id="cb31-2"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;string&gt;</span></span>
<span id="cb31-3"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;coroutine&gt;</span></span>
<span id="cb31-4"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb31-5"></span>
<span id="cb31-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> Task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb31-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb31-8">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>string<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>input_data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb31-9"></span>
<span id="cb31-10">        Task get_return_object<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb31-11">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"get_return_object"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb31-12">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> Task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb31-13">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span> </span>
<span id="cb31-14"></span>
<span id="cb31-15">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> return_void<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb31-16">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"return_void"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb31-17">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb31-18"></span>
<span id="cb31-19">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>suspend_always<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>initial_suspend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb31-20">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"initial_suspend"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb31-21">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb31-22">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb31-23"></span>
<span id="cb31-24">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>suspend_always<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>final_suspend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb31-25">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"final_suspend"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb31-26">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb31-27">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb31-28">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> unhandled_exception<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb31-29">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"unhandled_exception"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb31-30">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb31-31"></span>
<span id="cb31-32">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>suspend_always<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>yield_value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>string<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>msg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb31-33">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yield_value"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb31-34">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//output_data = std::move(msg);</span></span>
<span id="cb31-35">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb31-36">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb31-37"></span>
<span id="cb31-38">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> await_transform<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>string<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb31-39">            <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> Awaitable<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb31-40">                <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb31-41"></span>
<span id="cb31-42">                <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bool</span> await_ready<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb31-43">                    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Says, yeah we are ready</span></span>
<span id="cb31-44">                                    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// we don't need to sleep. Just go on.</span></span>
<span id="cb31-45">                <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb31-46"></span>
<span id="cb31-47">                <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>string<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>await_resume<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb31-48">                    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>move<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>input_data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb31-49">                <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb31-50"></span>
<span id="cb31-51">                <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> await_suspend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>coroutine_handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;)</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb31-52"></span>
<span id="cb31-53">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb31-54"></span>
<span id="cb31-55">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> Awaitable<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb31-56">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb31-57">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb31-58"></span>
<span id="cb31-59">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>coroutine_handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb31-60"></span>
<span id="cb31-61">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">explicit</span> Task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb31-62">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>coroutine_handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>from_promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)}</span></span>
<span id="cb31-63">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb31-64">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Task(promise_type&amp;) ctor"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb31-65">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb31-66"></span>
<span id="cb31-67">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb31-68">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb31-69">            handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>destroy<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb31-70"></span>
<span id="cb31-71">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~Task()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb31-72">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb31-73"></span>
<span id="cb31-74">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> put<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>string<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>msg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb31-75">        handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">().</span>input_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>move<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>msg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb31-76">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(!</span>handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>done<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">())</span></span>
<span id="cb31-77">            handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>resume<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb31-78">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb31-79"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb31-80"></span>
<span id="cb31-81">Task coro_func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb31-82">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">co_await</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>string<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb31-83">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">co_return</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb31-84"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb31-85"></span>
<span id="cb31-86"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb31-87">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> task <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> coro_func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb31-88">    task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>put<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"To boldly go where no man has gone before"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb31-89">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb31-90"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><a href="https://compiler-explorer.com/z/fTvvYcsjn">Compiler Explorer</a></p>
<p>Output:</p>
<div class="sourceCode" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb32-1">get_return_object</span>
<span id="cb32-2">Task(promise_type&amp;) ctor</span>
<span id="cb32-3">initial_suspend</span>
<span id="cb32-4">To boldly go where no man has gone beforereturn_void</span>
<span id="cb32-5">final_suspend</span>
<span id="cb32-6">~Task()</span></code></pre></div>
</section>
<section id="coroutine-generators" class="level2">
<h2 class="anchored" data-anchor-id="coroutine-generators">Coroutine Generators</h2>
<p>A <strong>generator</strong> is a coroutine that generates a sequence of elements by repeatedly resuming itself from the point that it was suspended.</p>
<p>A generator can be seen as an infinite list, because it can generate an arbitrary number of elements.</p>
<p>I present below the source code for a simple <code>FibonacciGenerator</code>.</p>
<div class="sourceCode" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb33-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;print&gt;</span></span>
<span id="cb33-2"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;string&gt;</span></span>
<span id="cb33-3"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;coroutine&gt;</span></span>
<span id="cb33-4"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb33-5"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;utility&gt;</span></span>
<span id="cb33-6"></span>
<span id="cb33-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> Generator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb33-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb33-9">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> fibo_n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb33-10"></span>
<span id="cb33-11">        Generator get_return_object<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb33-12">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> Generator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb33-13">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span> </span>
<span id="cb33-14"></span>
<span id="cb33-15">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> return_void<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb33-16"></span>
<span id="cb33-17">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>suspend_always<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>initial_suspend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb33-18">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb33-19">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb33-20"></span>
<span id="cb33-21">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>suspend_always<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>final_suspend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb33-22">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb33-23">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb33-24">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> unhandled_exception<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb33-25"></span>
<span id="cb33-26">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>suspend_always<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>yield_value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb33-27">            fibo_n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb33-28">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb33-29">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb33-30">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb33-31"></span>
<span id="cb33-32">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>coroutine_handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb33-33"></span>
<span id="cb33-34">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">explicit</span> Generator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb33-35">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>coroutine_handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">promise_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>from_promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)}</span></span>
<span id="cb33-36">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb33-37"></span>
<span id="cb33-38">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Generator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb33-39">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb33-40">            handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>destroy<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb33-41">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb33-42"></span>
<span id="cb33-43">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> next<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb33-44">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(!</span>handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>done<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">())</span></span>
<span id="cb33-45">            handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>resume<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb33-46">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> handle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>promise<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">().</span>fibo_n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb33-47">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb33-48"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb33-49"></span>
<span id="cb33-50">Generator makeFibonacciGenerator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb33-51">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> i1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb33-52">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> i2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb33-53">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">while</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb33-54">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">co_yield</span> i1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb33-55">        i1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>exchange<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>i2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> i1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> i2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb33-56">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb33-57">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">co_return</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb33-58"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb33-59"></span>
<span id="cb33-60"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb33-61">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> fibo_gen <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> makeFibonacciGenerator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb33-62">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"The first 10 numbers the Fibonacci sequence are : "</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb33-63">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span> i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++</span>i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb33-64">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>println<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F[</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">] = </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> fibo_gen<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>next<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">());</span></span>
<span id="cb33-65">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb33-66">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb33-67"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><a href="https://compiler-explorer.com/z/5vv9eh7r5">Compiler Explorer</a></p>


</section>

 ]]></description>
  <category>C++</category>
  <guid>http://quantdev.blog/posts/coroutines/index.html</guid>
  <pubDate>Wed, 12 Nov 2025 00:00:00 GMT</pubDate>
  <media:content url="http://quantdev.blog/posts/coroutines/cpp.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>AAD(Adjoint Algorithmic Differentiation)</title>
  <dc:creator>Quasar </dc:creator>
  <link>http://quantdev.blog/posts/aad/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>I was skimming through <a href="http://luca-capriotti.net/">Luca Capriotti</a> and Mike Giles paper <a href="https://people.maths.ox.ac.uk/~gilesm/files/AAD_Review.pdf">15 Years of Adjoint Algorithmic Differentiation in Finance</a> and wanted to write a toy implementation in Julia. Algorithmic differentiation (AD) is a set of techniques to accurately and efficiently compute derivatives of a function in the form of a computer program. Many of my toy examples are borrowed from the excellent <a href="https://www.amazon.co.uk/Algorithmic-Differentiation-Explained-Financial-Engineering/dp/3319539787/ref=sr_1_1?crid=3ICBI9FQDER6B&amp;dib=eyJ2IjoiMSJ9.OBdGni8_VOEiK_wWQ1g2PA.ChQjNVwVvAHPnbWhiXJDTSw2G9dyuIX9-hsH6BP_ZT4&amp;dib_tag=se&amp;keywords=Algorithmic+Differentiation+in+Finance+Explained&amp;qid=1761218601&amp;sprefix=algorithmic+differentiation+in+finance+explained%2Caps%2C91&amp;sr=8-1">Algorithmic Differentiation in Finance Explained</a>, by Marc Henrard.</p>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>As a quick example, suppose we have the scalar-valued function <img src="https://latex.codecogs.com/png.latex?f:%5Cmathbb%7BR%7D%5E%7Bp_a%7D%20%5Cto%20%5Cmathbb%7BR%7D">:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ay%20=%20%5Ccos(x_1%20+%20e%5E%7Bx_2%7D)(%5Csin%20x_3%20+%20%5Ccos%20x_4)%20+%20x_2%5E%7B3/2%7D%20+%20x_4%0A"></p>
<p>The function inputs are a vector <code>a[1...p_a]</code> of dimension <img src="https://latex.codecogs.com/png.latex?p_a">. All intermediate values in the program will be denoted by <code>b</code>s. The output of the function is denoted by the variable <code>z</code> of dimension <img src="https://latex.codecogs.com/png.latex?1">. So, the algorithm starts with the inputs <code>a</code>, goes to <code>z</code> through a lot of <code>b</code>s. The new variables are denoted by <code>b[j]</code> with <code>j</code> starting with <code>1</code> and going upto <img src="https://latex.codecogs.com/png.latex?p_b">. There are <img src="https://latex.codecogs.com/png.latex?p_b"> intermediate variables <img src="https://latex.codecogs.com/png.latex?b"> in the program.</p>
</section>
<section id="forward-mode-ad" class="level2">
<h2 class="anchored" data-anchor-id="forward-mode-ad">Forward-mode AD</h2>
<p>Standard algorithmic differentiation also called forward algorithmic differentiation or tangent algorithmic differentiation. Our goal is to compute <img src="https://latex.codecogs.com/png.latex?%5Cpartial%20z/%5Cpartial%20a_i">. We achieve this by computing for each <img src="https://latex.codecogs.com/png.latex?j">(<img src="https://latex.codecogs.com/png.latex?p_a%20+%201%20%5Cleq%20j%20%5Cleq%20p_b">) the value:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cdot%7Bb%7D%5Bj,i%5D%20=%20%5Cfrac%7B%5Cpartial%20b%5Bj%5D%7D%7B%5Cpartial%20a%5Bi%5D%7D%0A"></p>
<p>We first initialize the variables <img src="https://latex.codecogs.com/png.latex?b%5Bj%5D"> from <img src="https://latex.codecogs.com/png.latex?1%20%5Cleq%20j%20%5Cleq%20p_a"> with the inputs values <img src="https://latex.codecogs.com/png.latex?a%5Bj%5D">. Note that the derivative is denoted by dot on the variable and <img src="https://latex.codecogs.com/png.latex?%5Cdot%7Bb%7D%5Bj,i%5D"> is the derivative of <img src="https://latex.codecogs.com/png.latex?b%5Bj%5D"> with respect to some other variable <img src="https://latex.codecogs.com/png.latex?a%5Bi%5D">. For <img src="https://latex.codecogs.com/png.latex?j=1:p_a">, then, the derivative of <img src="https://latex.codecogs.com/png.latex?b%5Bj%5D"> with respect to <img src="https://latex.codecogs.com/png.latex?a%5Bi%5D"> is simply <img src="https://latex.codecogs.com/png.latex?1">, if <img src="https://latex.codecogs.com/png.latex?j=i"> and <img src="https://latex.codecogs.com/png.latex?0"> if <img src="https://latex.codecogs.com/png.latex?j%20%5Cneq%20i">. This is the starting point of a recursive algorithm. The starting part is the identity matrix :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cdot%7Bb%7D%5Bj,i%5D%20=%20%5Cdelta_%7Bi,j%7D%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?%5Cdelta_%7Bi,j%7D"> represents Kroneckers delta.</p>
<p>The successive derivatives <img src="https://latex.codecogs.com/png.latex?%5Cdot%7Bb%7D%5Bj,i%5D"> are given by the chain rule:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cdot%7Bb%7D%5Bj,i%5D%20=%20%5Cfrac%7B%5Cpartial%20b%5Bj%5D%7D%7B%5Cpartial%20a%5Bi%5D%7D%20&amp;=%20%5Csum_%7Bk=p_a%20+%201%7D%5E%7Bk=j-1%7D%5Cfrac%7B%5Cpartial%20b%5Bj%5D%7D%7B%5Cpartial%20b%5Bk%5D%7D%20%5Ccdot%20%5Cfrac%7B%5Cpartial%20b%5Bk%5D%7D%7B%5Cpartial%20a%5Bi%5D%7D%5C%5C%0A&amp;=%20%5Csum_%7Bk=p_a%20+%201%7D%5E%7Bj-1%7D%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20b%5Bk%5D%7D%20(b%5Bj%5D)%20%5Ccdot%20%5Cdot%7Bb%7D%5Bk,i%5D%5C%5C%0A&amp;=%20%5Csum_%7Bk=p_a%20+%201%7D%5E%7Bj-1%7D%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20b%5Bk%5D%7D%20g_j(b%5Bp_a%20+%201%20:%20j%20-%201%5D)%20%5Ccdot%20%5Cdot%7Bb%7D%5Bk,i%5D%5C%5C%0A%5Cend%7Balign*%7D%0A"></p>
<p>The numbers <img src="https://latex.codecogs.com/png.latex?%5Cdot%7Bb%7D%5Bp_b,i%5D"> are equal to the derivatives of <img src="https://latex.codecogs.com/png.latex?z=b%5Bp_b%5D"> with respect to <img src="https://latex.codecogs.com/png.latex?a_i">, <img src="https://latex.codecogs.com/png.latex?1%20%5Cleq%20i%20%5Cleq%20p_a">. This concludes the algorithm for the computation of <img src="https://latex.codecogs.com/png.latex?%5Cpartial%20z/%5Cpartial%20a_i">.</p>
<p>The requirements for such an implementation is that all the intermediary functions <img src="https://latex.codecogs.com/png.latex?g_j"> have a derivative version. The algorithmic differentiation approach is a bottom-up approach : it can be implemented for an algorithm only if all the components below it, all the components entering into the composition have already been implemented.</p>
<div id="fig:forward_ad" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="http://quantdev.blog/posts/aad/forward_ad.jpg" class="img-fluid figure-img" data-scale="70%"></p>
<figcaption class="figure-caption">Forward AD</figcaption>
</figure>
</div>
</section>
<section id="naive-implementation-of-forward-ad" class="level2">
<h2 class="anchored" data-anchor-id="naive-implementation-of-forward-ad">Naive implementation of forward-AD</h2>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">f</span>(a<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">Array{Real}</span>)</span>
<span id="cb1-2">    b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">zeros</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb1-3">    b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> a[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(a[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb1-4">    b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sin</span>(a[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cos</span>(a[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>])</span>
<span id="cb1-5">    b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> a[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> a[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]</span>
<span id="cb1-6">    b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cos</span>(b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]</span>
<span id="cb1-7">    b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]</span>
<span id="cb1-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">end</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>f (generic function with 1 method)</code></pre>
</div>
</div>
<p>We create an AD version of the starter function as follows:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">f_AD</span>(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">Array{Real}</span>)</span>
<span id="cb3-2">    b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">zeros</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb3-3">    b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> a[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(a[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb3-4">    b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sin</span>(a[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cos</span>(a[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>])</span>
<span id="cb3-5">    b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> a[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> a[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]</span>
<span id="cb3-6">    b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cos</span>(b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]</span>
<span id="cb3-7">    </span>
<span id="cb3-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Forward sweep - derivatives</span></span>
<span id="cb3-9">    n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(x)</span>
<span id="cb3-10"></span>
<span id="cb3-11">    b1dot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">zeros</span>(n)</span>
<span id="cb3-12">    b1dot[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb3-13">    b1dot[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb3-14"></span>
<span id="cb3-15">    b2dot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">zeros</span>(n)</span>
<span id="cb3-16">    b2dot[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cos</span>(b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>])</span>
<span id="cb3-17">    b2dot[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">-sin</span>(b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>])</span>
<span id="cb3-18"></span>
<span id="cb3-19">    b3dot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">zeros</span>(n)</span>
<span id="cb3-20">    b3dot[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">*</span>(b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb3-21">    b3dot[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb3-22"></span>
<span id="cb3-23">    b4dot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">-sin</span>(b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b1dot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cos</span>(b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b2dot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b3dot</span>
<span id="cb3-24">    (b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>],b4dot)</span>
<span id="cb3-25"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">end</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>f_AD (generic function with 1 method)</code></pre>
</div>
</div>
<p>Note that, the output of the original function <code>f</code> is the function value - a <code>double</code>, whilst the output <code>f_ad</code> is a 2-tuple : the function value and the value of the jacobian(gradient).</p>
</section>
<section id="adjoint-algorithmic-differentiation" class="level2">
<h2 class="anchored" data-anchor-id="adjoint-algorithmic-differentiation">Adjoint Algorithmic Differentiation</h2>
<p>Our goal is to compute <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%20z%7D%7B%5Cpartial%20a_i%7D">. We achieve this by computing for each intermediate variable <img src="https://latex.codecogs.com/png.latex?j"> (<img src="https://latex.codecogs.com/png.latex?p_a%20+%201%20%5Cleq%20j%20%5Cleq%20p_b">) the value:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Coverline%7Bb%7D%5Bj%5D%20=%20%5Cfrac%7B%5Cpartial%20z%7D%7B%5Cpartial%20b%5Bj%5D%7D%0A"></p>
<p>Note that, <img src="https://latex.codecogs.com/png.latex?%5Coverline%7Bb%7D%5Bj%5D"> is the derivative of the output with respect to <code>b[j]</code>. It is important to switch the perception between the forward mode and the reverse mode. What is fixed in the reverse approach is the output, we always compute the derivative of the same variable, the output.</p>
<p>The starting point of the algorithm is easy. For <img src="https://latex.codecogs.com/png.latex?j%20=%20p_b">, the derivative of <img src="https://latex.codecogs.com/png.latex?z"> with respect to <img src="https://latex.codecogs.com/png.latex?b%5Bj%5D"> is simply the derivative of <img src="https://latex.codecogs.com/png.latex?z"> with respect to itself, which is <img src="https://latex.codecogs.com/png.latex?1">. This is the starting point of a recursive algorithm.</p>
<p>From there, we read the code in reverse order and just apply the chain rule. Each intermediary variable <img src="https://latex.codecogs.com/png.latex?b%5Bj%5D"> is used only in the lines of code that follow in the computation. The derivative <img src="https://latex.codecogs.com/png.latex?%5Coverline%7Bb%7D%5Bj%5D"> is given by:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Coverline%7Bb%7D%5Bj%5D%20=%20%5Cfrac%7B%5Cpartial%20z%7D%7B%5Cpartial%20b_j%7D%20=%20%5Csum_%7Bk=j+1%7D%5E%7Bp_b%7D%20%5Cfrac%7B%5Cpartial%20z%7D%7B%5Cpartial%20b_k%7D%20%5Ccdot%20%5Cfrac%7B%5Cpartial%20b_k%7D%7B%5Cpartial%20b_j%7D%20=%20%5Csum_%7Bk=j+1%7D%5E%7Bp_b%7D%20%5Coverline%7Bb%7D%5Bk%5D%20%5Ccdot%20%5Cfrac%7B%5Cpartial%20g_k%7D%7B%5Cpartial%20b_j%7D%0A"></p>
<p>I think its easy to visualize this in a computational graph:</p>
<div id="fig:reverse_ad" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="http://quantdev.blog/posts/aad/reverse_ad.jpg" class="img-fluid figure-img" data-scale="70%"></p>
<figcaption class="figure-caption">Reverse AD</figcaption>
</figure>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">f_AAD</span>(a<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">Array{Real}</span>)</span>
<span id="cb5-2">    b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">zeros</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb5-3">    b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> a[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(a[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb5-4">    b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sin</span>(a[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cos</span>(a[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>])</span>
<span id="cb5-5">    b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> a[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> a[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]</span>
<span id="cb5-6">    b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cos</span>(b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]</span>
<span id="cb5-7"></span>
<span id="cb5-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Backward sweep - derivatives</span></span>
<span id="cb5-9">    n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(a)</span>
<span id="cb5-10">    abar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">zeros</span>(n)</span>
<span id="cb5-11">    b4bar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span></span>
<span id="cb5-12">    b3bar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b4bar</span>
<span id="cb5-13">    b2bar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cos</span>(b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b4bar</span>
<span id="cb5-14">    b1bar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">-sin</span>(b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b4bar</span>
<span id="cb5-15"></span>
<span id="cb5-16">    abar[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">-sin</span>(a[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b2bar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b3bar</span>
<span id="cb5-17">    abar[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cos</span>(a[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b2bar</span>
<span id="cb5-18">    abar[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(a[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b1bar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (a[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span> (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b3bar</span>
<span id="cb5-19">    abar[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b1bar</span>
<span id="cb5-20"></span>
<span id="cb5-21">    (b[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>], abar)</span>
<span id="cb5-22"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">end</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>f_AAD (generic function with 1 method)</code></pre>
</div>
</div>
</section>
</section>
<section id="algorithmic-differentiation-tools" class="level1">
<h1>Algorithmic Differentiation Tools</h1>
<p>Given any computer function <code>f(x)</code>, we can build code implementing the tangent or adjoint mode for the calculation of its derivatives. This involves representing the function as a computational graph, calculating the derivatives on each of the edges, and computing the tangents or adjoints in the appropriate direction. This process is mechanical in nature and can be easily automated.</p>
<p>Most AD tools fall into 2 categories : <em>source code transformation</em> and <em>operator overloading</em>.</p>


</section>

 ]]></description>
  <category>Fin Math</category>
  <guid>http://quantdev.blog/posts/aad/index.html</guid>
  <pubDate>Wed, 22 Oct 2025 23:00:00 GMT</pubDate>
  <media:content url="http://quantdev.blog/posts/aad/image.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Continuous probability puzzles</title>
  <dc:creator>Quasar </dc:creator>
  <link>http://quantdev.blog/posts/continuous_probability_puzzles/index.html</link>
  <description><![CDATA[ 




<section id="puzzles-on-continuous-probability" class="level2">
<h2 class="anchored" data-anchor-id="puzzles-on-continuous-probability">Puzzles on continuous probability</h2>
<div id="exm-puzzle-1" class="theorem example">
<p><span class="theorem-title"><strong>Example 1 </strong></span>What is the maximum possible variance of a random variable that takes the values in the set <img src="https://latex.codecogs.com/png.latex?%5B-1,1%5D">?</p>
</div>
<p><em>Solution</em>.</p>
<p>Intuitively speaking, the variance of a mass distribution is the probability weighted average of the sum of the squared distances from the mean. It is maximized if the masses are placed far away from the center of gravity. So, if we place two point masses with probability weights <img src="https://latex.codecogs.com/png.latex?1/2"> at <img src="https://latex.codecogs.com/png.latex?(-1,0)"> and <img src="https://latex.codecogs.com/png.latex?(1,0)">, the variance would be maximal. Hence, the maximum variance equals <img src="https://latex.codecogs.com/png.latex?1">.</p>
<div id="exm-puzzle-2" class="theorem example">
<p><span class="theorem-title"><strong>Example 2 </strong></span>What is the maximum possible variance of a random variable that takes the values in the set <img src="https://latex.codecogs.com/png.latex?%5B0,1%5D">?</p>
</div>
<p><em>Solution</em>.</p>
<p>Again, we can have point masses with probability weights <img src="https://latex.codecogs.com/png.latex?1/2"> at <img src="https://latex.codecogs.com/png.latex?X=0"> and <img src="https://latex.codecogs.com/png.latex?X=1">. The center of mass or expectation of this distribution <img src="https://latex.codecogs.com/png.latex?EX%20=%201/2">. So, the maximal variance would be <img src="https://latex.codecogs.com/png.latex?(1/2)(1/2)%5E2%20+%20(1/2)(1/2)%5E2=1/4">.</p>
<div id="exm-puzzle-3" class="theorem example">
<p><span class="theorem-title"><strong>Example 3 </strong></span>Let <img src="https://latex.codecogs.com/png.latex?X"> be a random variable such that <img src="https://latex.codecogs.com/png.latex?P(X%20%5Cne%200)%20%3E%200">. Suppose that for some real numbers <img src="https://latex.codecogs.com/png.latex?a"> and <img src="https://latex.codecogs.com/png.latex?b">, the random variables <img src="https://latex.codecogs.com/png.latex?aX"> and <img src="https://latex.codecogs.com/png.latex?bX"> have the same distribution. Is it true that <img src="https://latex.codecogs.com/png.latex?a%20=%20b">? What if we also assume that <img src="https://latex.codecogs.com/png.latex?a"> and <img src="https://latex.codecogs.com/png.latex?b"> are both positive.</p>
</div>
<p><em>Solution</em>.</p>
<p>If <img src="https://latex.codecogs.com/png.latex?aX"> and <img src="https://latex.codecogs.com/png.latex?bX"> have the same mass distribution, they have the same expectation and variance.</p>
<p>Hence, <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%5BaX%5D%20=%20%5Cmathbb%7BE%7D%5BbX%5D">. So, <img src="https://latex.codecogs.com/png.latex?a%5Cmathbb%7BE%7D%5BX%5D%20=%20b%20%5Cmathbb%7BE%7D%5BX%5D">. Consequently, <img src="https://latex.codecogs.com/png.latex?(a-b)%5Cmathbb%7BE%7D%5BX%5D%20=%200">. If <img src="https://latex.codecogs.com/png.latex?a%20%5Cneq%20b">, then <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%5BX%5D%20=%200">. For example, consider the <img src="https://latex.codecogs.com/png.latex?U%20%5Csim%20U%5B-1,1%5D"> random variable. Both <img src="https://latex.codecogs.com/png.latex?U"> and <img src="https://latex.codecogs.com/png.latex?-U"> have the same distribution. Also, their second moments must match. So, <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%5BaX"></p>


</section>

 ]]></description>
  <category>Quant Puzzles</category>
  <guid>http://quantdev.blog/posts/continuous_probability_puzzles/index.html</guid>
  <pubDate>Tue, 21 Oct 2025 23:00:00 GMT</pubDate>
  <media:content url="http://quantdev.blog/posts/continuous_probability_puzzles/image.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Discrete probability and counting puzzles</title>
  <dc:creator>Quasar </dc:creator>
  <link>http://quantdev.blog/posts/discrete-probability-and-counting-puzzles/index.html</link>
  <description><![CDATA[ 




<section id="puzzles-on-discrete-probability" class="level2">
<h2 class="anchored" data-anchor-id="puzzles-on-discrete-probability">Puzzles on discrete probability</h2>
<div id="exm-puzzle-1" class="theorem example">
<p><span class="theorem-title"><strong>Example 1 </strong></span>We flip a fair coin until we obtain our first heads. If the first heads occurs on the <img src="https://latex.codecogs.com/png.latex?k">-th flip, we are given <img src="https://latex.codecogs.com/png.latex?k"> balls. We put them into 3 bins labeled 1, 2, and 3 at random. Find the probability that none of the three bins are empty.</p>
</div>
<p><em>Solution</em>.</p>
<p>Let <img src="https://latex.codecogs.com/png.latex?A_k"> be the event that the first head occurs on the <img src="https://latex.codecogs.com/png.latex?k">th flip. So, we are interested in the sequence <img src="https://latex.codecogs.com/png.latex?%5Cunderbrace%7BT%20%5Cldots%20T%7D_%7B(k-1)%5Ctext%7B-tails%7D%7DH">. We have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cmathbb%7BP%7D(A_k)%20=%20%5Cleft(%5Cfrac%7B1%7D%7B2%7D%5Cright)%5E%7Bk-1%7D%20%5Ccdot%20%5Cfrac%7B1%7D%7B2%7D%20=%20%5Cfrac%7B1%7D%7B2%5Ek%7D%0A"></p>
<div id="exm-puzzle-2" class="theorem example">
<p><span class="theorem-title"><strong>Example 2 </strong></span>Imagine you have <img src="https://latex.codecogs.com/png.latex?4"> <img src="https://latex.codecogs.com/png.latex?6">-sided dice. What is the probability that you roll a different number on each die?</p>
</div>
<p><em>Solution</em>.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ap%20=%20%5Cfrac%7B6%5Ccdot%205%20%5Ccdot%204%20%5Ccdot%203%7D%7B6%5E4%7D%0A"></p>
<div id="exm-puzzle-3" class="theorem example">
<p><span class="theorem-title"><strong>Example 3 </strong></span>What is the probability of flipping exactly <img src="https://latex.codecogs.com/png.latex?5"> heads when flipping <img src="https://latex.codecogs.com/png.latex?10"> fair coins?</p>
</div>
<p><em>Solution</em>.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AP(k%20=%205)%20=%20%7B10%20%5Cchoose%205%7D%20%5Cfrac%7B1%7D%7B2%5E%7B10%7D%7D%0A"></p>
<div id="exm-puzzle-4" class="theorem example">
<p><span class="theorem-title"><strong>Example 4 </strong></span>Two players are at deuce in a tennis match  player <img src="https://latex.codecogs.com/png.latex?1"> has <img src="https://latex.codecogs.com/png.latex?60"> percent of winning the point and player <img src="https://latex.codecogs.com/png.latex?2"> has <img src="https://latex.codecogs.com/png.latex?40"> percent chance. What are the odds of player 1 winning?</p>
</div>
<p><em>Solution</em></p>
<p>When a game is at the 40-40 mark, a player still needs two clear points to win the game. We can quickly draw the following state diagram to represent the game (it is a discrete-time markov chain).</p>
<div id="fig:markov_chain_01" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="http://quantdev.blog/posts/discrete-probability-and-counting-puzzles/markov_chain_01.jpg" class="img-fluid figure-img" data-scale="50%"></p>
<figcaption class="figure-caption">Winning the game</figcaption>
</figure>
</div>
<p>Let the state <img src="https://latex.codecogs.com/png.latex?s_1%20%5Cstackrel%7Bdef%7D%7B=%7D"> the two players are 40-40. And the state <img src="https://latex.codecogs.com/png.latex?s_3%20%5Cstackrel%7Bdef%7D%7B=%7D"> player <img src="https://latex.codecogs.com/png.latex?1"> wins. The states <img src="https://latex.codecogs.com/png.latex?3"> and <img src="https://latex.codecogs.com/png.latex?5"> are absorbing states. Let <img src="https://latex.codecogs.com/png.latex?p_%7B13%7D"> be the hitting probability of state <img src="https://latex.codecogs.com/png.latex?3"> from state <img src="https://latex.codecogs.com/png.latex?1">. We have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0Ap_%7B13%7D%20&amp;=%200.6%20p_%7B23%7D%20+%200.4%20p_%7B43%7D%5C%5C%0Ap_%7B23%7D%20&amp;=%200.6%20(1)%20+%200.4p_%7B13%7D%5C%5C%0Ap_%7B43%7D%20&amp;=%200.6p_%7B13%7D%20+%200.4(0)%0A%5Cend%7Balign*%7D%0A"></p>
<p>It turns out that <img src="https://latex.codecogs.com/png.latex?p_%7B13%7D%20=%20%5Cfrac%7B9%7D%7B13%7D">.</p>
<div id="exm-puzzle-5" class="theorem example">
<p><span class="theorem-title"><strong>Example 5 </strong></span>You have a plate of spaghetti in front of you (no sauce!). You pick two ends and tie them together. Then you pick two more ends and tie them together. Continue until there are no free ends left. If there were <img src="https://latex.codecogs.com/png.latex?n"> spaghettis originally, what is the probability that you now have a single giant loop consisting of all the spaghettis?</p>
</div>
<p>Let <img src="https://latex.codecogs.com/png.latex?p_n"> be the probability of a single giant loop. <img src="https://latex.codecogs.com/png.latex?n"> spaghettis have <img src="https://latex.codecogs.com/png.latex?2n"> free ends. In each of the <img src="https://latex.codecogs.com/png.latex?n"> trials, you pick <img src="https://latex.codecogs.com/png.latex?2"> ends. At the start, the probability that you dont tie a sphagetti to itself is</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7B2n%7D%7B2n%7D%20%5Ccdot%20%5Cfrac%7B2n%20-%202%7D%7B2n%20-%201%7D%20=%20%5Cfrac%7B2n%20-%202%7D%7B2n%20-%201%7D%0A"></p>
<p>After the first draw, we have reduced the problem to <img src="https://latex.codecogs.com/png.latex?(n-1)"> spaghetti strands and <img src="https://latex.codecogs.com/png.latex?2n-2"> free ends. So, the probability of no-loops is:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ap_n%20=%20%20%5Cfrac%7B2n%20-%202%7D%7B2n%20-%201%7D%20%5Ccdot%20p_%7Bn-1%7D%0A"></p>
<p>Extending this to <img src="https://latex.codecogs.com/png.latex?k=(n-1)"> trials: <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0Ap_n%20&amp;=%20%5Cfrac%7B2n%20-%202%7D%7B2n%20-%201%7D%20%5Ccdot%20%5Cfrac%7B2n-4%7D%7B2n-3%7D%20%5Ccdots%20%5Cfrac%7B2%7D%7B1%7D%5C%5C%0A&amp;=%202%5E%7Bn-1%7D%20%5Cfrac%7B(n-1)!%7D%7B(2n-1)(2n-3)%5Ccdots%201%7D%5C%5C%0A&amp;=%202%5E%7Bn-1%7D%20%5Cfrac%7B2%5En%20n!%20(n-1)!%7D%7B(2n)(2n-1)(2n-2)(2n-3)%20%5Ccdots%201%7D%5C%5C%0A&amp;=%202%5E%7B2n-1%7D%20%5Cfrac%7Bn!%20(n-1)!%7D%7B(2n)!%7D%5C%5C%0A%5Cend%7Balign*%7D%0A"></p>
<div id="exm-puzzle-7" class="theorem example">
<p><span class="theorem-title"><strong>Example 6 </strong></span>An electronic safe has a three digit passcode. You are given three constraints regarding the code. Firstly, the code is not an odd number. Secondly, the code does not contain the number six. Lastly, one of the digits appears more than once. How many possible three digit entries satisfy these three requirements?</p>
</div>
<p><em>Solution</em>.</p>
<p>Since its a <img src="https://latex.codecogs.com/png.latex?3">-digit electronic passcode to a safe, <img src="https://latex.codecogs.com/png.latex?0"> is a valid first digit. The last digit must be one of <img src="https://latex.codecogs.com/png.latex?0,2,4,8">. The first digit must be one of <img src="https://latex.codecogs.com/png.latex?%5C%7B0,1,2,%5Cldots,5,7,8,9%5C%7D">. The middle digit must be must be one of <img src="https://latex.codecogs.com/png.latex?%5C%7B0,1,2,%5Cldots,5,7,8,9%5C%7D"></p>
<p>Case I. The first two digits are identical.</p>
<p>There are <img src="https://latex.codecogs.com/png.latex?9%20%5Ctimes%201%20%5Ctimes%204%20=%2036"> such distinguishable codes.</p>
<p>Case II. The last two digits are identical.</p>
<p>There are <img src="https://latex.codecogs.com/png.latex?9%20%5Ctimes%201%20%5Ctimes%204%20=%2036"> such distinguishable codes.</p>
<p>Case III. The first and the third digits are identical.</p>
<p>There are <img src="https://latex.codecogs.com/png.latex?1%20%5Ctimes%209%20%5Ctimes%204%20=%2036"> such distinguishable codes.</p>
<p>Also, <img src="https://latex.codecogs.com/png.latex?000">, <img src="https://latex.codecogs.com/png.latex?222">, <img src="https://latex.codecogs.com/png.latex?444"> and <img src="https://latex.codecogs.com/png.latex?888"> have been overcounted <img src="https://latex.codecogs.com/png.latex?3"> times. They should be accounted for only once. Hence, the number of possible three digit entries satisfying the above requirements are <img src="https://latex.codecogs.com/png.latex?108%20-%208%20=%20100">.</p>
<div id="exm-puzzle-8" class="theorem example">
<p><span class="theorem-title"><strong>Example 7 </strong></span>Suppose we roll <img src="https://latex.codecogs.com/png.latex?5"> standard fair dice and sum the faces of the largest <img src="https://latex.codecogs.com/png.latex?3"> values showing. Find the probability that the sum is <img src="https://latex.codecogs.com/png.latex?18">.</p>
</div>
<p><em>Solution</em>.</p>
<p>To reach a sum of <img src="https://latex.codecogs.com/png.latex?18"> on the largest three die faces, we must get atleast <img src="https://latex.codecogs.com/png.latex?3"> sixes in <img src="https://latex.codecogs.com/png.latex?5"> dice rolls.</p>
<p>Define success as getting a <img src="https://latex.codecogs.com/png.latex?6"> on a die, <img src="https://latex.codecogs.com/png.latex?p%20=%20%5Cfrac%7B1%7D%7B6%7D">, <img src="https://latex.codecogs.com/png.latex?q=%5Cfrac%7B5%7D%7B6%7D"> and let <img src="https://latex.codecogs.com/png.latex?X"> be the number of sixes in <img src="https://latex.codecogs.com/png.latex?5"> die rolls.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0AP(X%20%5Cge%203)%20&amp;=%201%20-%20(P(X=0)%20+%20P(X=1)%20+%20P(X=2))%5C%5C%0A&amp;=%201%20-%20%5Cleft(%5Cfrac%7B5%7D%7B6%7D%5Cright)%5E5%20-%20%7B5%20%5Cchoose%201%7D%20%5Cleft(%5Cfrac%7B1%7D%7B6%7D%5Cright)%5Cleft(%5Cfrac%7B5%7D%7B6%7D%5Cright)%5E4%20-%20%7B5%20%5Cchoose%202%7D%20%5Cleft(%5Cfrac%7B1%7D%7B6%7D%5Cright)%5E2%5Cleft(%5Cfrac%7B5%7D%7B6%7D%5Cright)%5E3%5C%5C%0A&amp;=%20%5Cfrac%7B23%7D%7B648%7D%0A%5Cend%7Balign*%7D%0A"></p>
<div id="exm-puzzle-9" class="theorem example">
<p><span class="theorem-title"><strong>Example 8 </strong></span>Consider a <img src="https://latex.codecogs.com/png.latex?2023%20%5Ctimes%202023"> grid. The grid squares from the middle row are shaded in. What is the probability that a randomly selected rectangle contains at least one shaded square?</p>
</div>
<p><em>Solution</em>.</p>
<p>Lets solve this puzzle for a smaller <img src="https://latex.codecogs.com/png.latex?5%20%5Ctimes%205"> grid. A rectangle is always determined by a choice of a pair of vertical grid lines and a pair of horizonal grid lines.</p>
<div id="fig:quant_puzzles_01" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="http://quantdev.blog/posts/discrete-probability-and-counting-puzzles/quant_puzzles_01.jpg" class="img-fluid figure-img" data-scale="25%"></p>
<figcaption class="figure-caption">Rectangles</figcaption>
</figure>
</div>
<p>The number of horizontal and vertical grid lines are <img src="https://latex.codecogs.com/png.latex?6">. So, the total number of rectangles are <img src="https://latex.codecogs.com/png.latex?%7B6%20%5Cchoose%202%7D%20%5Ctimes%20%7B6%20%5Cchoose%202%7D">.</p>
<p>In order to pick rectangle that includes atleast one shaded square, one of the grid lines must chosen from the top <img src="https://latex.codecogs.com/png.latex?3"> horizontal grid lines and the second grid line must be chosen from the bottom <img src="https://latex.codecogs.com/png.latex?3"> horizontal grid lines. That yields <img src="https://latex.codecogs.com/png.latex?%7B3%20%5Cchoose%201%7D%5E2"> pairs of horizontal grid lines. There are no restrictions on the vertical grid lines so there are <img src="https://latex.codecogs.com/png.latex?%7B6%20%5Cchoose%202%7D"> pairs of vertical grid lines. Hence, the number of favorable rectangles are <img src="https://latex.codecogs.com/png.latex?3%5E2%20%5Ctimes%20%7B6%20%5Cchoose%202%7D">.</p>
<p>Generalizing, the desired probability for a <img src="https://latex.codecogs.com/png.latex?(2n-1)%20%5Ctimes%20(2n-1)"> grid is:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0Ap_%7B2n-1%7D%20&amp;=%20%5Cfrac%7Bn%5E2%20%5Ccdot%20%7B2n%20%5Cchoose%202%7D%7D%7B%7B2n%20%5Cchoose%202%7D%5E2%7D%20%5C%5C%0A&amp;=%20%5Cfrac%7Bn%5E2%20%7D%7B%7B2n%20%5Cchoose%202%7D%7D%20%5C%5C%0A&amp;=%20%5Cfrac%7B2n%5E2%7D%7B(2n)(2n-1)%7D%5C%5C%0A&amp;=%20%5Cfrac%7Bn%7D%7B2n-1%7D%0A%5Cend%7Balign*%7D%0A"></p>
<p>So, <img src="https://latex.codecogs.com/png.latex?p_%7B2023%7D%20=%20%5Cfrac%7B1012%7D%7B2023%7D%20%5Capprox%200.5">.</p>
<div id="exm-puzzle-10" class="theorem example">
<p><span class="theorem-title"><strong>Example 9 </strong></span>How many paths are there where you can only move up or right one unit at each step that go from <img src="https://latex.codecogs.com/png.latex?(0,%200)"> to <img src="https://latex.codecogs.com/png.latex?(5,%203)"> without crossing the line <img src="https://latex.codecogs.com/png.latex?y%20=%20x">? You are allowed to touch it.</p>
</div>
<p>We are interested in those paths where each vertice on the trajectory has <img src="https://latex.codecogs.com/png.latex?x"> coordinate greater than or equal to the <img src="https://latex.codecogs.com/png.latex?y">- coordinate.</p>
<div id="exm-puzzle-11" class="theorem example">
<p><span class="theorem-title"><strong>Example 10 </strong></span>How many paths are there where you can only move up or right one unit at each step that go from <img src="https://latex.codecogs.com/png.latex?(0,%200)"> to <img src="https://latex.codecogs.com/png.latex?(5,%203)"> without crossing the line <img src="https://latex.codecogs.com/png.latex?y%20=%20x">? You are allowed to touch it.</p>
</div>
<div id="exm-puzzle-12" class="theorem example">
<p><span class="theorem-title"><strong>Example 11 </strong></span>Imagine 3 pairs of socks (6 total) labeled <img src="https://latex.codecogs.com/png.latex?%5C%7B1,1,2,2,3,3%5C%7D">. Define a satisfactory pair as any pair of individual socks such that their numbers differ by a maximum of 1 (i.e.&nbsp;2 3 is a satisfactory pair). In this game, drawing without replacement, what is the probability that a player will draw three satisfactory pairs of socks?</p>
</div>
<p><em>Solution</em>.</p>
<p>Label the socks as</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5C%7Ba_1,%20a_2,%20b_1,%20b_2,%20c_1,%20c_2%5C%7D%0A"></p>
<p>Arrangements with <img src="https://latex.codecogs.com/png.latex?3"> satisfactory pairs are only obtained, if there are no pairs where a 1-sock is paired with a 3-sock. Let us find the number of arrangements, where there is atleast <img src="https://latex.codecogs.com/png.latex?1"> pair containing a 1-sock paired with a 3-sock.</p>
<p>The number of distinguishable arrangements where the first pair has a 1-sock paired with a 3-sock are given as follows. There are <img src="https://latex.codecogs.com/png.latex?2"> possible choices for the 1-sock, <img src="https://latex.codecogs.com/png.latex?2"> possible choices for the <img src="https://latex.codecogs.com/png.latex?3">-sock, <img src="https://latex.codecogs.com/png.latex?2"> possible arrangements within this pair. For each such choice, there are <img src="https://latex.codecogs.com/png.latex?4!"> choices for second and third pairs of socks. So, the result is <img src="https://latex.codecogs.com/png.latex?2%20%5Ctimes%202%20%5Ctimes%202%20%5Ctimes%204!%20=%20192">. By similar arguments, the number of arrangements with the second pair/third pair containing a 1-sock and 3-sock are <img src="https://latex.codecogs.com/png.latex?192"> each. So, the total number of distinct arrangements are <img src="https://latex.codecogs.com/png.latex?192%20%5Ctimes%203%20=%20576">.</p>
<p>However, we overcounted the arrangements that have two (<img src="https://latex.codecogs.com/png.latex?1">-sock,<img src="https://latex.codecogs.com/png.latex?3">-sock) pairs. The number of arrangements where the first and second pair are (<img src="https://latex.codecogs.com/png.latex?1">-sock,<img src="https://latex.codecogs.com/png.latex?3">-sock) pairs is <img src="https://latex.codecogs.com/png.latex?2%20%5Ctimes%202%20%5Ctimes%202%20%5Ctimes%201%20%5Ctimes%202%20=%2016">. The three pairs can be arrangement amongst themselves in <img src="https://latex.codecogs.com/png.latex?3!%20=%206"> ways. So, the total number of distinct arrangements are <img src="https://latex.codecogs.com/png.latex?96">.</p>
<p>By inclusion-exclusion, the number of arrangments with atleast one (<img src="https://latex.codecogs.com/png.latex?1">-sock, <img src="https://latex.codecogs.com/png.latex?3">-sock) pair = <img src="https://latex.codecogs.com/png.latex?576%20-%2096%20=%20480">. Thus, the number of satisfactory arrangments is <img src="https://latex.codecogs.com/png.latex?720%20-%20480%20=%20240">.</p>
<p>The probability of <img src="https://latex.codecogs.com/png.latex?3"> satisfactory pairs = <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B240%7D%7B720%7D=%5Cfrac%7B1%7D%7B3%7D"></p>
<div id="exm-puzzle-13" class="theorem example">
<p><span class="theorem-title"><strong>Example 12 </strong></span>Player M has <img src="https://latex.codecogs.com/png.latex?1"> dollar and player N has <img src="https://latex.codecogs.com/png.latex?2"> dollars. Each game gives the winner $1 from the other. As a better player, M wins <img src="https://latex.codecogs.com/png.latex?2/3"> of the games. They play until one of them is bankrupt. What Is the probability that M wins?</p>
</div>
<p><em>Solution.</em></p>
<div id="fig:markov_chain_02" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="http://quantdev.blog/posts/discrete-probability-and-counting-puzzles/markov_chain_02.jpg" class="img-fluid figure-img" data-scale="50%"></p>
<figcaption class="figure-caption">Winning the game</figcaption>
</figure>
</div>
<p>Let <img src="https://latex.codecogs.com/png.latex?p_%7B1W%7D"> be the hitting probability of state <img src="https://latex.codecogs.com/png.latex?W"> given we are in state <img src="https://latex.codecogs.com/png.latex?1">. We can quickly setup:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0Ap_%7B1W%7D%20&amp;=%20%5Cfrac%7B2%7D%7B3%7Dp_%7B2W%7D%20%20+%20%5Cfrac%7B1%7D%7B3%7D%20%5Ctimes%200%0Ap_%7B2W%7D%20&amp;=%20%5Cfrac%7B1%7D%7B3%7Dp_%7B1W%7D%20+%20%5Cfrac%7B2%7D%7B3%7D%20%5Ctimes%201%0A%5Cend%7Balign*%7D%0A"></p>
<p>So, we get:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0Ap_%7B1W%7D%20&amp;=%20%5Cfrac%7B2%7D%7B3%7D%5Cleft(%5Cfrac%7B1%7D%7B3%7Dp_%7B1W%7D%20+%20%5Cfrac%7B2%7D%7B3%7D%5Cright)%5C%5C%0A&amp;=%20%5Cfrac%7B2%7D%7B9%7D%20p_%7B1W%7D%20+%20%5Cfrac%7B4%7D%7B9%7D%5C%5C%0A%5Cfrac%7B7%7D%7B9%7Dp_%7B1W%7D%20&amp;=%20%5Cfrac%7B4%7D%7B9%7D%5C%5C%0Ap_%7B1W%7D%20&amp;=%20%5Cfrac%7B4%7D%7B7%7D%0A%5Cend%7Balign*%7D%0A"></p>
<div id="exm-puzzle-13" class="theorem example">
<p><span class="theorem-title"><strong>Example 13 </strong></span>We throw <img src="https://latex.codecogs.com/png.latex?3"> dice one by one. What is the probability that we obtain 3 points in strictly increasing order?</p>
</div>
<p><em>Solution.</em></p>
<p>We can choose a sub-population of <img src="https://latex.codecogs.com/png.latex?3"> numbers without ordering from a population of <img src="https://latex.codecogs.com/png.latex?n=6"> in <img src="https://latex.codecogs.com/png.latex?%7B6%20%5Cchoose%203%7D"> ways. For each selection, there is only one unique way to order them in strictly increasing order. Hence, the number of dice rolls where the points are in strictly increasing order are:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7B%7B6%20%5Cchoose%203%7D%7D%7B6%5E3%7D%20=%20%5Cfrac%7B20%7D%7B216%7D%0A"></p>
<div id="exm-puzzle-14" class="theorem example">
<p><span class="theorem-title"><strong>Example 14 </strong></span>Five boys and five girls are seated in a row at the movie theater. To ensure that the children are engaged during the movie, the teacher mandates that no two children of the same gender can sit next to each other. How many arrangements are possible?</p>
</div>
<p><em>Solution</em>.</p>
<p>We label the set of boys and girls as</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5C%7BB_1,%20B_2,%20B_3,%20B_4,%20B_5,%20G_1,%20G_2,%20G_3,%20G_4,%20G_5%20%5C%7D%0A"></p>
<p>There are <img src="https://latex.codecogs.com/png.latex?5%20%5Ctimes%204%20%5Ctimes%203%20%5Ctimes%202%20%5Ctimes%20=%205!"> ways to pick a girl for each boy. A boy and girl <img src="https://latex.codecogs.com/png.latex?(B_i,%20G_j)"> within a pair can be further be permuted. Additionally, the person in the first seat can be boy or a girl.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ap%20=%20%5Cfrac%7B5!%205!%202%7D%7B10!%7D%0A"></p>
<div id="exm-puzzle-15" class="theorem example">
<p><span class="theorem-title"><strong>Example 15 </strong></span>A company is hosting a dinner for working mothers who have at least one son. Ms.&nbsp;Jackson, a mother with two children, has been invited to the event. What are the chances that both of her children are boys? In the second part, a new colleague, Ms.&nbsp;Parker, has two children. If you happen to see her walking with one of her children, and the child happens to be a boy, what is the probability that both of her children are boys?</p>
</div>
<p><em>Solution</em></p>
<p>The sample space <img src="https://latex.codecogs.com/png.latex?%5COmega%20=%20%5C%7B%20GG,%20GB,%20BG,%20BB%20%5C%7D">. The probability that both children are boys given that atleast one is a boy is <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B1%7D%7B3%7D">.</p>
<p>The probability that both children are boys given that a specific child is a boy is given by</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cmathbb%7BP%7D(%5Ctext%7BBoth%20are%20boys%7D%20%7C%20%5Ctext%7BSpecific%20child%20is%20a%20boy%7D)%20&amp;=%20P(%5Ctext%7BBoth%20are%20boys%7D%7C%5Ctext%7BFirst%20is%20a%20boy%7D)%20%5Ctimes%20P(%5Ctext%7BFirst%20is%20a%20boy%7D)%20+%20P(%5Ctext%7BBoth%20are%20boys%7D%7C%5Ctext%7BSecond%20is%20a%20boy%7D)%20%5Ctimes%20P(%5Ctext%7BSecond%20is%20a%20boy%7D)%5C%5C%0A&amp;=%20%5Cfrac%7B1%7D%7B2%7D%20%5Ctimes%20%5Cfrac%7B1%7D%7B2%7D%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Ctimes%20%5Cfrac%7B1%7D%7B2%7D%5C%5C%0A&amp;=%20%5Cfrac%7B1%7D%7B2%7D%0A%5Cend%7Balign*%7D%0A"></p>
<div id="exm-puzzle-16" class="theorem example">
<p><span class="theorem-title"><strong>Example 16 </strong></span>You have been given a thousand coins to study. One of these coins has heads on both sides, while the remaining 999 are fair coins. You pick a coin at random and flip it ten times. To your surprise, the coin turns up heads every time. What is the likelihood that the coin you picked is the one with two heads?</p>
</div>
<p><em>Solution.</em></p>
<p>By Bayes,</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0AP(%5Ctext%7BDouble%20head%20coin%7D%7C%5Ctext%7B10%20heads%7D)%20&amp;=%20%5Cfrac%7BP(%5Ctext%7B10%20heads%7D%20%5Ccap%20%5Ctext%7BDouble%20head%20coin%7D)%7D%7BP(%5Ctext%7B10%20heads%7D)%7D%5C%5C%0A&amp;=%20%5Cfrac%7B%5Cfrac%7B1%7D%7B1000%7D%7D%7BP(%5Ctext%7B10%20heads%7D%20%7C%20%5Ctext%7BDouble%20head%20coin%7D)%20P(%5Ctext%7BDouble%20head%20coin%7D)%20+%20P(%5Ctext%7B10%20heads%7D%20%7C%20%5Ctext%7BFair%20coin%7D)%20P(%5Ctext%7BFair%20coin%7D)%7D%20%5C%5C%0A&amp;=%20%5Cfrac%7B%5Cfrac%7B1%7D%7B1000%7D%5Ccdot%201%7D%7B%5Cfrac%7B1%7D%7B1000%7D%20%5Ccdot%201%20+%20%5Cfrac%7B1%7D%7B2%5E%7B10%7D%7D%20%5Ccdot%20%5Cfrac%7B999%7D%7B1000%7D%20%7D%5C%5C%0A%5Capprox%200.5061%0A%5Cend%7Balign*%7D%0A"></p>
<div id="exm-puzzle-17" class="theorem example">
<p><span class="theorem-title"><strong>Example 17 </strong></span>You have ten coins. <img src="https://latex.codecogs.com/png.latex?9"> of them are fair coins and <img src="https://latex.codecogs.com/png.latex?1"> of them is a coin with two heads. You pick a random coin from the set of coins and flip it five times. All five flips happen to be heads. Given this, what is the probability that the next flip will also be heads?</p>
</div>
<p><em>Solution.</em></p>
<p>Let <img src="https://latex.codecogs.com/png.latex?D"> be the event that a double coin is picked and <img src="https://latex.codecogs.com/png.latex?F"> be the event that a fair coin was picked. Let <img src="https://latex.codecogs.com/png.latex?E"> be the event that the next flip is heads. Let <img src="https://latex.codecogs.com/png.latex?S"> be the event that we get a sequence of <img src="https://latex.codecogs.com/png.latex?5">-heads.</p>
<p>By Bayes:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0AP(E%7CS)%20&amp;=%20%5Cfrac%7BP(SE)%7D%7BP(S)%7D%5C%5C%0A&amp;=%20%5Cfrac%7BP(SE%7CF)%20P(F)%20+%20P(SE%7CD)%20P(D)%7D%7BP(S%7CF)P(F)%20+%20P(S%7CD)%20P(D)%7D%5C%5C%0A&amp;=%20%5Cfrac%7B%5Cfrac%7B1%7D%7B2%5E6%7D%20%5Ccdot%20%5Cfrac%7B9%7D%7B10%7D%20+%201%5Ccdot%20%5Cfrac%7B1%7D%7B10%7D%7D%7B%5Cfrac%7B1%7D%7B2%5E5%7D%5Cfrac%7B9%7D%7B10%7D%20+%201%20%5Ccdot%20%5Cfrac%7B1%7D%7B10%7D%7D%5C%5C%0A&amp;=%20%5Cfrac%7B73%7D%7B82%7D%0A%5Capprox%200.890243%0A%5Cend%7Balign*%7D%0A"></p>
<div id="exm-puzzle-18" class="theorem example">
<p><span class="theorem-title"><strong>Example 18 </strong></span>You are given n random variables, <img src="https://latex.codecogs.com/png.latex?X_1,%20X_2%20%5Cldots,%20X_N">. Each of these variables has a uniform distribution that ranges from <img src="https://latex.codecogs.com/png.latex?0"> to <img src="https://latex.codecogs.com/png.latex?1">. Your task is to determine the probability that the sum of these variables, denoted as <img src="https://latex.codecogs.com/png.latex?S">, is less than equal to <img src="https://latex.codecogs.com/png.latex?1">. Can you solve this problem?</p>
</div>
<p><em>Solution</em>.</p>
<p>For <img src="https://latex.codecogs.com/png.latex?N=2">, <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BP%7D%5BX_1%20+%20X_2%20%5Cleq%201%5D"> can be visualized as follows:</p>
<div id="fig:quant_puzzles_02" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="http://quantdev.blog/posts/discrete-probability-and-counting-puzzles/quant_puzzles_02.jpg" class="img-fluid figure-img" data-scale="25%"></p>
<figcaption class="figure-caption">Sum of Uniforms</figcaption>
</figure>
</div>
<p>The two uniform random variables can be plotted along two orthogonal axes. Since <img src="https://latex.codecogs.com/png.latex?X_1%20%5Cgeq%200">, <img src="https://latex.codecogs.com/png.latex?X_2%20%5Cgeq%200"> and <img src="https://latex.codecogs.com/png.latex?X_1%20+%20X_2%20%5Cleq%201">, we are interested in the area of the yellow shaded portion. This should be <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B1%7D%7B2%7D">.</p>
<p>Similarly, for <img src="https://latex.codecogs.com/png.latex?N=3"> random variables, we will be interested in the volume of the tetrahedron, having vertices <img src="https://latex.codecogs.com/png.latex?(1,0,0)">, <img src="https://latex.codecogs.com/png.latex?(0,1,0)">, <img src="https://latex.codecogs.com/png.latex?(0,0,1)"> and <img src="https://latex.codecogs.com/png.latex?(0,0,0)"> which equals <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B1%7D%7B2%5Ccdot%203%7D">.</p>
<p>In general, we posit that the probability that the sum of <img src="https://latex.codecogs.com/png.latex?N"> uniforms is less than unity is <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B1%7D%7BN!%7D">.</p>
<p>More rigorously, the MGF of a uniform random variable is: <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0AP(X_1%20+%20X_2%20%5Cleq%20t)%20&amp;=%20%5Cint_0%5Et%20P(X_2%20%5Cleq%20t%20-%20x_1%20%7C%20X_1%20=%20x_1%20)%20f_%7BX_1%7D(x_1)%20dx_1%20%5C%5C%0A&amp;=%20%5Cint_0%5Et%20%5Cint_0%5E%7Bt-x_1%7D%20dx_2%20dx_1%20%5C%5C%0A&amp;=%20%5Cint_0%5Et%20(t-x_1)%20dx_1%5C%5C%0A&amp;=%20%5Cleft%5B%5Cfrac%7B(t-x_1)%5E2%7D%7B2%7D%5Cright%5D_0%5Et%20%5C%5C%0A&amp;=%20%5Cfrac%7Bt%5E2%7D%7B2%7D%0A%5Cend%7Balign*%7D%0A"></p>
<p>Assume that <img src="https://latex.codecogs.com/png.latex?P(X_1%20+%20%5Cldots%20+%20X_k%20%5Cleq%20t)%20=%20%5Cfrac%7Bt%5Ek%7D%7Bk!%7D">. We are interested to show that <img src="https://latex.codecogs.com/png.latex?P(X_1+%20%5Cldots%20+%20X_%7Bk%7D%20+%20X_%7Bk+1%7D%20%5Cleq%20t)%20=%20%5Cfrac%7Bt%5E%7Bk+1%7D%7D%7B(k+1)!%7D">.</p>
<p>Define <img src="https://latex.codecogs.com/png.latex?S_k%20%5Cstackrel%7Bdef%7D%7B=%7D%20%5Csum_%7Bi=1%7D%5E%7Bk%7D%20X_k">. We have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0AP(S_k%20+%20X_%7Bk+1%7D%20%5Cleq%20t)%20&amp;=%20%5Cint_0%5Et%20P(S_k%20%5Cleq%20t%20-%20x_%7Bk+1%7D%20%7C%20X_%7Bk+1%7D%20=%20x_%7Bk+1%7D)%20f_%7BX_%7Bk+1%7D%7D(x_%7Bk+1%7D)%20dx_%7Bk+1%7D%5C%5C%0A&amp;=%20%5Cint_0%5Et%20%5Cfrac%7B(t%20-%20x_%7Bk+1%7D)%5Ek%7D%7Bk!%7D%20dx_%7Bk+1%7D%5C%5C%0A&amp;=%20%5Cleft%5B%5Cfrac%7B(t-x_%7Bk+1%7D)%5E%7Bk+1%7D%7D%7B(k+1)k!%7D%5Cright%5D_0%5Et%5C%5C%0A&amp;=%20%5Cfrac%7Bt%5E%7Bk+1%7D%7D%7B(k+1)!%7D%0A%5Cend%7Balign*%7D%0A"></p>
<div id="exm-puzzle-19" class="theorem example">
<p><span class="theorem-title"><strong>Example 19 </strong></span>Person A has a <img src="https://latex.codecogs.com/png.latex?20">-sided dice and person B has three <img src="https://latex.codecogs.com/png.latex?6">-sided dice. They both roll their dice and whoever gets a bigger number/sum of numbers wins the game. Is it a fair game? Now, what if there is one more player <img src="https://latex.codecogs.com/png.latex?C"> who has a <img src="https://latex.codecogs.com/png.latex?20">-sided dice. Is this new game fair? (all dice are fair; a <img src="https://latex.codecogs.com/png.latex?20">-sided dice has number <img src="https://latex.codecogs.com/png.latex?1,2,%5Cldots,20"> on each of its <img src="https://latex.codecogs.com/png.latex?20"> sides)</p>
</div>
<p><em>Solution</em></p>
<p>The game between is <img src="https://latex.codecogs.com/png.latex?A"> and <img src="https://latex.codecogs.com/png.latex?B"> is not fair.</p>
<p>Define <img src="https://latex.codecogs.com/png.latex?X_1"> as the face value on the <img src="https://latex.codecogs.com/png.latex?20">-sided die rolled by person A.</p>
<p>Define <img src="https://latex.codecogs.com/png.latex?Y_1,%20Y_2,%20Y_3"> as the face values on the three <img src="https://latex.codecogs.com/png.latex?6">-sided die rolled by person B.</p>
<p>Define <img src="https://latex.codecogs.com/png.latex?S_1%20%5Cstackrel%7Bdef%7D%7B=%7D%20X_1">, <img src="https://latex.codecogs.com/png.latex?S_2%20%5Cstackrel%7Bdef%7D%7B=%7D%20Y_1%20+%20Y_2%20+%20Y_3">.</p>
<p>Its a fair game, if the expected cost of playing a game equals the expected winnings. The expected cost for <img src="https://latex.codecogs.com/png.latex?A"> is expectetaion of <img src="https://latex.codecogs.com/png.latex?B"> winnings.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cmathbb%7BE%7D%5BS_1%5D%20-%20%5Cmathbb%7BE%7D%5BS_2%5D%20%20=%2010.5%20-%203%20%5Ctimes%203.5%20=%200%0A"></p>
<div id="exm-puzzle-20" class="theorem example">
<p><span class="theorem-title"><strong>Example 20 </strong></span>I keep rolling a die until a <img src="https://latex.codecogs.com/png.latex?6"> appears. What is the probability the sum of all rolls is even?</p>
</div>
<p><em>Solution.</em></p>
<div id="fig:quant_puzzles_03" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="http://quantdev.blog/posts/discrete-probability-and-counting-puzzles/quant_puzzles_03.jpg" class="img-fluid figure-img" data-scale="25%"></p>
<figcaption class="figure-caption">Even Sum</figcaption>
</figure>
</div>
<p>We have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0Ap_%7B13%7D%20&amp;=%20%5Cfrac%7B1%7D%7B6%7D%20%5Ccdot%201%20+%20%5Cfrac%7B1%7D%7B3%7D%20%5Ccdot%20p_%7B13%7D%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Ccdot%20p_%7B23%7D%5C%5C%0Ap_%7B23%7D%20&amp;=%20%5Cfrac%7B1%7D%7B2%7D%20%5Ccdot%20p_%7B13%7D%20+%20%5Cfrac%7B1%7D%7B3%7D%20%5Ccdot%20p_%7B23%7D%20+%20%5Cfrac%7B1%7D%7B6%7D%20%5Ccdot%200%0A%5Cend%7Balign*%7D%0A"></p>
<p>So, <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B2%7D%7B3%7Dp_%7B23%7D%20=%20%5Cfrac%7B1%7D%7B2%7Dp_%7B13%7D"> which implies <img src="https://latex.codecogs.com/png.latex?p_%7B23%7D%20=%20%5Cfrac%7B3%7D%7B4%7Dp_%7B13%7D">. Substituting in the first equation, we have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cfrac%7B2%7D%7B3%7Dp_%7B13%7D%20&amp;=%20%5Cfrac%7B1%7D%7B6%7D%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Ccdot%20%5Cfrac%7B3%7D%7B4%7D%20p_%7B13%7D%20%5C%5C%0A%5Cfrac%7B7%7D%7B24%7D%20p_%7B13%7D%20&amp;=%20%5Cfrac%7B1%7D%7B6%7D%5C%5C%0Ap_%7B13%7D%20&amp;=%20%5Cfrac%7B4%7D%7B7%7D%0A%5Cend%7Balign*%7D%0A"></p>
<div id="exm-puzzle-21" class="theorem example">
<p><span class="theorem-title"><strong>Example 21 </strong></span>You have two dice, how do you simulate one seventh odds with the two dice? Same way as one third odds with coins.</p>
</div>
<p><em>Solution.</em></p>


</section>

 ]]></description>
  <category>Quant Puzzles</category>
  <guid>http://quantdev.blog/posts/discrete-probability-and-counting-puzzles/index.html</guid>
  <pubDate>Tue, 21 Oct 2025 23:00:00 GMT</pubDate>
  <media:content url="http://quantdev.blog/posts/discrete-probability-and-counting-puzzles/image.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Uniformly sampling from the unit disk</title>
  <dc:creator>Quasar </dc:creator>
  <link>http://quantdev.blog/posts/sampling-uniformly-on-the-unit-disk/index.html</link>
  <description><![CDATA[ 




<section id="uniformly-sampling-from-the-unit-disk" class="level1">
<h1>Uniformly sampling from the unit disk</h1>
<p>I was asked this puzzle in a recent quant interview and thought it would be interesting to solve this. We are asked to generate points that are uniformly distributed on the unit circle. This is a really elegant question.</p>
<p>A first approach would be to generate points from the unit square distribution - that is pick <img src="https://latex.codecogs.com/png.latex?U_1%20%5Csim%20U%5B0,1%5D"> and <img src="https://latex.codecogs.com/png.latex?U_2%20%5Csim%20U%5B0,1%5D">, and apply the transform <img src="https://latex.codecogs.com/png.latex?U_1'%20=%20-1%20+%202U_1">, <img src="https://latex.codecogs.com/png.latex?U_2'%20=%20-1%20+%202U_2">, so that the transformed random variables are <img src="https://latex.codecogs.com/png.latex?U%5B-1,1%5D">. We then accept all points that satisfy <img src="https://latex.codecogs.com/png.latex?u_1'%5E2%20+%20u_2'%5E2%20%5Cleq%201"> and reject all points that violate this condition. However, this is not computationally efficient as we are wasting <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B4%20-%20%5Cpi%7D%7B4%7D%20%5Capprox%2020%5C%25"> of the points.</p>
<p>One thing is, if you divide circle in concentric rings of size <img src="https://latex.codecogs.com/png.latex?%5CDelta%20R">, note that the further you are away from the origin, the more area the ring contains. However, we would like a distant ring to have the same density as a ring closer to the origin. So, we need to pick more points in the outer ring then in the inner ring. If we pick points with a probability proportional to the square of the distance from the origin, we should end up with a uniform scattering.</p>
<p>Let <img src="https://latex.codecogs.com/png.latex?u%20=%20F(r)%20=%20r%5E2">. So, <img src="https://latex.codecogs.com/png.latex?r%20=%20%5Csqrt%7Bu%7D">. Thus, <img src="https://latex.codecogs.com/png.latex?R%20%5Cstackrel%7Bdef%7D%7B=%7D%20F%5E%7B-1%7D(U)%20=%20%5Csqrt%7BU%7D"> must have the CDF <img src="https://latex.codecogs.com/png.latex?F_R(r)%20=%20r%5E2"> and density <img src="https://latex.codecogs.com/png.latex?f_R(r)%20=%202r">. We also pick <img src="https://latex.codecogs.com/png.latex?%5CTheta%20%5Csim%20U%5B0,2%5Cpi%5D">. If we project the point <img src="https://latex.codecogs.com/png.latex?%5Cleft(r,%20%5Ctheta%20%5Cright)"> onto the <img src="https://latex.codecogs.com/png.latex?x">- and <img src="https://latex.codecogs.com/png.latex?y">-axis, then we have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0AX%20&amp;=%20%5Csqrt%7BU%7D%20%5Ccos%20%5CTheta%5C%5C%0AY%20&amp;=%20%5Csqrt%7BU%7D%20%5Csin%20%5CTheta%5C%5C%0A%5Cend%7Balign*%7D%0A"></p>
<p>Then, we have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0Af_%7BX,Y%7D(x,y)%20&amp;=%20f_%7BR,%5CTheta%7D(r(x,y),%5Ctheta(x,y))%20%5Cfrac%7B%5Cpartial(r,%5Ctheta)%7D%7B%5Cpartial(x,y)%7D%5C%5C%0A&amp;=%202r%20%5Ccdot%20%5Cfrac%7B1%7D%7B2%5Cpi%7D%20%5Cleft%7C%5Cbegin%7Bmatrix%7D%0A%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20x%7D%20%5Cfrac%7B1%7D%7B%5Csqrt%7Bx%5E2%20+%20y%5E2%7D%7D%20&amp;%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20y%7D%20%5Cfrac%7B1%7D%7B%5Csqrt%7Bx%5E2%20+%20y%5E2%7D%7D%20%5C%5C%0A%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20x%7D%20%5Carctan%20(y/x)%20&amp;%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20y%7D%20%5Carctan%20(y/x)%0A%5Cend%7Bmatrix%7D%5Cright%7C%5C%5C%0A&amp;=%202%5Csqrt%7Bx%5E2%20+%20y%5E2%7D%20%5Ccdot%20%5Cfrac%7B1%7D%7B2%5Cpi%7D%20%5Cleft%7C%5Cbegin%7Bmatrix%7D%0A%5Cfrac%7Bx%7D%7B%5Csqrt%7Bx%5E2%20+%20y%5E2%7D%7D%20&amp;%20%5Cfrac%7By%7D%7B%5Csqrt%7Bx%5E2%20+%20y%5E2%7D%7D%20%5C%5C%0A-%5Cfrac%7By%7D%7Bx%5E2%20+%20y%5E2%7D%20&amp;%20%5Cfrac%7Bx%7D%7Bx%5E2%20+%20y%5E2%7D%0A%5Cend%7Bmatrix%7D%5Cright%7C.%5C%5C%0A&amp;%20=%20%5Cfrac%7B1%7D%7B%5Cpi%7D%0A%5Cend%7Balign*%7D%0A"></p>
<section id="numerical-simulation" class="level2">
<h2 class="anchored" data-anchor-id="numerical-simulation">Numerical simulation</h2>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.patches <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> patches</span>
<span id="cb1-4"></span>
<span id="cb1-5">u <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.uniform(low<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, high<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>, size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>)</span>
<span id="cb1-6">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.sqrt(u)</span>
<span id="cb1-7">theta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>np.pi<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>np.random.uniform(low<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, high<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>, size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>)</span>
<span id="cb1-8">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.cos(theta)</span>
<span id="cb1-9">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sin(theta)</span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create fig and axes</span></span>
<span id="cb1-12">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots()</span>
<span id="cb1-13"></span>
<span id="cb1-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Use patches.Circle() to create the circle. The xy argument is a tuple for the center (x,y) and radius is a float</span></span>
<span id="cb1-15">circle <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> patches.Circle((<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>), radius <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>, fill<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb1-16"></span>
<span id="cb1-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add the circle to the axes</span></span>
<span id="cb1-18">ax.add_patch(circle)</span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add the (x,y) samples to the axes using the 'scatter' method</span></span>
<span id="cb1-21">ax.scatter(x, y, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>)</span>
<span id="cb1-22"></span>
<span id="cb1-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure the aspect ratio is equal so the circle isn't distorted</span></span>
<span id="cb1-24">ax.set_aspect(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'equal'</span>, adjustable<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'box'</span>)</span>
<span id="cb1-25"></span>
<span id="cb1-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set the plot limits</span></span>
<span id="cb1-27">ax.set_xlim(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-28">ax.set_ylim(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-29"></span>
<span id="cb1-30">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Uniform sampling from the unit circle'</span>)</span>
<span id="cb1-31">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="http://quantdev.blog/posts/sampling-uniformly-on-the-unit-disk/index_files/figure-html/cell-2-output-1.png" class="img-fluid"></p>
</div>
</div>


</section>
</section>

 ]]></description>
  <category>Quant Puzzles</category>
  <guid>http://quantdev.blog/posts/sampling-uniformly-on-the-unit-disk/index.html</guid>
  <pubDate>Mon, 20 Oct 2025 23:00:00 GMT</pubDate>
  <media:content url="http://quantdev.blog/posts/sampling-uniformly-on-the-unit-disk/image.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Gaussian Processes</title>
  <dc:creator>Quasar </dc:creator>
  <link>http://quantdev.blog/posts/gaussian-processes/index.html</link>
  <description><![CDATA[ 




<section id="gaussian-processes." class="level1">
<h1>Gaussian Processes.</h1>
<section id="random-vectors." class="level2">
<h2 class="anchored" data-anchor-id="random-vectors.">Random Vectors.</h2>
<p>Consider a probability space <img src="https://latex.codecogs.com/png.latex?(%5COmega,%5Cmathcal%7BF%7D,%5Cmathbb%7BP%7D)">. We can define several random variables on <img src="https://latex.codecogs.com/png.latex?%5COmega">. A <img src="https://latex.codecogs.com/png.latex?n">-tuple of random variables on this space is called a random vector. For example, if <img src="https://latex.codecogs.com/png.latex?X_%7B1%7D,X_%7B2%7D,%5Cldots,X_%7Bn%7D"> are random variables on <img src="https://latex.codecogs.com/png.latex?(%5COmega,%5Cmathcal%7BF%7D,%5Cmathbb%7BP%7D)">, then the <img src="https://latex.codecogs.com/png.latex?n">-tuple <img src="https://latex.codecogs.com/png.latex?(X_%7B1%7D,X_%7B2%7D,%5Cldots,X_%7Bn%7D)"> is a random vector on <img src="https://latex.codecogs.com/png.latex?(%5COmega,%5Cmathcal%7BF%7D,%5Cmathbb%7BP%7D)">. The vector is said to be <img src="https://latex.codecogs.com/png.latex?n">-dimensional because it contains <img src="https://latex.codecogs.com/png.latex?n">-variables. We will sometimes denote a random vector by <img src="https://latex.codecogs.com/png.latex?X">.</p>
<p>A good point of view is to think of a random vector <img src="https://latex.codecogs.com/png.latex?X=(X_%7B1%7D,%5Cldots,X_%7Bn%7D)"> as a random variable (point) in <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BR%7D%5E%7Bn%7D">. In other words, for an outcome <img src="https://latex.codecogs.com/png.latex?%5Comega%5Cin%5COmega">, <img src="https://latex.codecogs.com/png.latex?X(%5Comega)"> is a point sampled in <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BR%7D%5E%7Bn%7D">, where <img src="https://latex.codecogs.com/png.latex?X_%7Bj%7D(%5Comega)"> represents the <img src="https://latex.codecogs.com/png.latex?j">-th coordinate of the point. The distribution of <img src="https://latex.codecogs.com/png.latex?X">, denoted <img src="https://latex.codecogs.com/png.latex?%5Cmu_%7BX%7D"> is the probability on <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BR%7D%5E%7Bn%7D">defined by the events related to the values of <img src="https://latex.codecogs.com/png.latex?X">:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BP%7D%5C%7BX%5Cin%20A%5C%7D=%5Cmu_%7BX%7D(A)%5Cquad%5Ctext%7Bfor%20a%20subset%20%7DA%5Ctext%7B%20in%20%7D%5Cmathbf%7BR%7D%5E%7Bn%7D"></p>
<p>In other words, <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BP%7D(X%5Cin%20A)=%5Cmu_%7BX%7D(A)"> is the probability that the random point <img src="https://latex.codecogs.com/png.latex?X"> falls in <img src="https://latex.codecogs.com/png.latex?A">. The distribution of the vector <img src="https://latex.codecogs.com/png.latex?X"> is also called the joint distribution of <img src="https://latex.codecogs.com/png.latex?(X_%7B1%7D,%5Cldots,X_%7Bn%7D)">.</p>
<div id="def-joint-distribution" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 1 (Joint Distribution) </strong></span>The <strong>joint distribution function</strong> of <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BX%7D=(X,Y)"> is the function <img src="https://latex.codecogs.com/png.latex?F:%5Cmathbf%7BR%7D%5E%7B2%7D%5Cto%5B0,1%5D"> given by:</p>
<p><img src="https://latex.codecogs.com/png.latex?F_%7B%5Cmathbf%7BX%7D%7D(x,y)=%5Cmathbb%7BP%7D(X%5Cleq%20x,Y%5Cleq%20y)"></p>
</div>
<div id="def-joint-density-function" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 2 (Joint density) </strong></span>The joint <strong>PDF</strong> <img src="https://latex.codecogs.com/png.latex?f_%7B%5Cmathbf%7BX%7D%7D(x_%7B1%7D,%5Cldots,x_%7Bn%7D)"> of a random vector <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BX%7D"> is a function <img src="https://latex.codecogs.com/png.latex?f_%7B%5Cmathbf%7BX%7D%7D:%5Cmathbf%7BR%7D%5E%7Bn%7D%5Cto%5Cmathbf%7BR%7D"> such that the probability that <img src="https://latex.codecogs.com/png.latex?X"> falls in a subset <img src="https://latex.codecogs.com/png.latex?A"> of <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BR%7D%5E%7Bn%7D"> and is expressed as the multiple integral of <img src="https://latex.codecogs.com/png.latex?f(x_%7B1%7D,x_%7B2,%7D%5Cldots,x_%7Bn%7D)"> over <img src="https://latex.codecogs.com/png.latex?A">.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BP%7D(X%5Cin%20A)=%5Cint_%7BA%7Df(x_%7B1%7D,x_%7B2%7D,%5Cldots,x_%7Bn%7D)dx_%7B1%7Ddx_%7B2%7D%5Cldots%20dx_%7Bn%7D"></p>
</div>
<p>Note that: we must have that the integral of <img src="https://latex.codecogs.com/png.latex?f"> over the whole of <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BR%7D%5E%7Bn%7D"> is <img src="https://latex.codecogs.com/png.latex?1">.</p>
<p>If <img src="https://latex.codecogs.com/png.latex?F"> is differentiable at the point <img src="https://latex.codecogs.com/png.latex?(x,y)">, then we usually specify:</p>
<p><img src="https://latex.codecogs.com/png.latex?f(x,y)=%5Cfrac%7B%5Cpartial%5E%7B2%7D%7D%7B%5Cpartial%20x%5Cpartial%20y%7DF(x,y)"></p>
<div id="thm-law-of-total-probability" class="theorem">
<p><span class="theorem-title"><strong>Theorem 1 (Law of total probability) </strong></span>Let <img src="https://latex.codecogs.com/png.latex?(X,Y)"> be the random variables with joint density function <img src="https://latex.codecogs.com/png.latex?f_%7BX,Y%7D(x,y)">. The marginal density function <img src="https://latex.codecogs.com/png.latex?f_%7BX%7D(x)"> and <img src="https://latex.codecogs.com/png.latex?f_%7BY%7D(y)"> of the random variables <img src="https://latex.codecogs.com/png.latex?X"> and <img src="https://latex.codecogs.com/png.latex?Y"> respectively is given by:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0Af_%7BX%7D(x)%20&amp;%20=%5Cint_%7B-%5Cinfty%7D%5E%7B+%5Cinfty%7Df_%7B(X,Y)%7D(x,y)dy%5C%5C%20f_%7BY%7D(y)%20&amp;%20=%5Cint_%7B-%5Cinfty%7D%5E%7B+%5Cinfty%7Df_%7B(X,Y)%7D(x,y)dx%5Cend%7Baligned%7D"></p>
</div>
<p><em>Proof.</em></p>
<p>We have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0AF_%7BX%7D(x)%20&amp;%20=P(X%5Cleq%20x)%5C%5C%20&amp;%20=%5Cint_%7B-%5Cinfty%7D%5E%7Bx%7D%5Cint_%7By=-%5Cinfty%7D%5E%7By=+%5Cinfty%7Df(x,y)dydx%5Cend%7Baligned%7D"></p>
<p>Differentiating both sides with respect to <img src="https://latex.codecogs.com/png.latex?x">,</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0Af_%7BX%7D(x)%20&amp;%20=%5Cint_%7By=-%5Cinfty%7D%5E%7By=+%5Cinfty%7Df(x,y)dydx%5Cend%7Baligned%7D">&nbsp;</p>
<p>This closes the proof. <img src="https://latex.codecogs.com/png.latex?%5Cblacksquare"></p>
<div id="def-conditional-density-function" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3 (Conditional density function) </strong></span>For continuous random variables <img src="https://latex.codecogs.com/png.latex?X"> and <img src="https://latex.codecogs.com/png.latex?Y"> with the joint density function <img src="https://latex.codecogs.com/png.latex?f_%7B(X,Y)%7D">, the conditional density of <img src="https://latex.codecogs.com/png.latex?Y"> given <img src="https://latex.codecogs.com/png.latex?X=x"> is:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0Af_%7BY%7CX%7D(y%7Cx)%20&amp;%20=%5Cfrac%7Bf_%7B(X,Y)%7D(x,y)%7D%7Bf_%7BX%7D(x)%7D%5Cend%7Baligned%7D"></p>
<p>for all <img src="https://latex.codecogs.com/png.latex?x"> with <img src="https://latex.codecogs.com/png.latex?f_%7BX%7D(x)%3E0">. This is considered as a function of <img src="https://latex.codecogs.com/png.latex?y"> for a fixed <img src="https://latex.codecogs.com/png.latex?x">. As a convention, in order to make <img src="https://latex.codecogs.com/png.latex?f_%7BY%7CX%7D(y%7Cx)"> well-defined for all real <img src="https://latex.codecogs.com/png.latex?x">, let <img src="https://latex.codecogs.com/png.latex?f_%7BY%7CX%7D(y%7Cx)=0"> for all <img src="https://latex.codecogs.com/png.latex?x"> with <img src="https://latex.codecogs.com/png.latex?f_%7BX%7D(x)=0">.</p>
</div>
<p>We are essentially slicing the the joint density function of <img src="https://latex.codecogs.com/png.latex?f_%7B(X,Y)%7D(x,y)"> by a thin plane <img src="https://latex.codecogs.com/png.latex?X=x">. How can we speak of conditioning on <img src="https://latex.codecogs.com/png.latex?X=x"> for <img src="https://latex.codecogs.com/png.latex?X"> being a continuous random variable, considering that this event has probability zero. Rigorously speaking, we are actually conditioning on the event that <img src="https://latex.codecogs.com/png.latex?X"> falls within a small interval containing <img src="https://latex.codecogs.com/png.latex?x">, say <img src="https://latex.codecogs.com/png.latex?X%5Cin(x-%5Cepsilon,x+%5Cepsilon)"> and then taking the limit as <img src="https://latex.codecogs.com/png.latex?%5Cepsilon"> approaches zero from the right.</p>
<p>We can recover the joint PDF <img src="https://latex.codecogs.com/png.latex?f_%7B(X,Y)%7D"> if we have the conditional PDF <img src="https://latex.codecogs.com/png.latex?f_%7BY%7CX%7D"> and the corresponding marginal <img src="https://latex.codecogs.com/png.latex?f_%7BX%7D">:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0Af_%7B(X,Y)%7D(x,y)%20&amp;%20=f_%7BY%7CX%7D(y%7Cx)%5Ccdot%20f_%7BX%7D(x)%0A%5Cend%7Baligned%7D%0A"></p>
<div id="thm-bayes-rule-and-lotp" class="theorem">
<p><span class="theorem-title"><strong>Theorem 2 (Bayes rule and LOTP) </strong></span>Let <img src="https://latex.codecogs.com/png.latex?(X,Y)"> be continuous random variables. We have the following continuous form of the Bayes rule:</p>
<p><img src="https://latex.codecogs.com/png.latex?f_%7BY%7CX%7D(y%7Cx)=%5Cfrac%7Bf_%7BX%7CY%7D(x%7Cy)%5Ccdot%20f_%7BY%7D(y)%7D%7Bf_%7BX%7D(x)%7D"></p>
<p>And we have the following continuous form of the law of total probability:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0Af_%7BX%7D(x)%20&amp;%20=%5Cint_%7By=-%5Cinfty%7D%5E%7By=+%5Cinfty%7Df_%7BX%7CY%7D(x%7Cy)%5Ccdot%20f_%7BY%7D(y)dy%5Cend%7Baligned%7D"></p>
</div>
<p><em>Proof.</em></p>
<p>By the definition of conditional PDFs, we have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0Af_%7BX%7CY%7D(x%7Cy)%5Ccdot%20f_%7BY%7D(y)%20&amp;%20=f_%7B(X,Y)%7D(x,y)=f_%7BY%7CX%7D(y%7Cx)%5Ccdot%20f_%7BX%7D(x)%5Cend%7Baligned%7D%0A"></p>
<p>Dividing throughout by <img src="https://latex.codecogs.com/png.latex?f_%7BX%7D(x)">, we have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0Af_%7BY%7CX%7D(x)%20&amp;%20=%5Cfrac%7Bf_%7BX%7CY%7D(x%7Cy)%5Ccdot%20f_%7BY%7D(y)%7D%7Bf_%7BX%7D(x)%7D=%5Cfrac%7Bf_%7B(X,Y)%7D(x,y)%7D%7Bf_%7BX%7D(x)%7D%5Cend%7Baligned%7D%0A">&nbsp;</p>
<p>This closes the proof. <img src="https://latex.codecogs.com/png.latex?%5Cblacksquare"></p>
<div id="exm-sampling-uniformly" class="theorem example">
<p><span class="theorem-title"><strong>Example 1 </strong></span>(Sampling uniformly in the unit disc). Consider the random vector <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BX%7D=(X,Y)"> corresponding to a random point chosen uniformly in the unit disc <img src="https://latex.codecogs.com/png.latex?%5C%7B(x,y):x%5E%7B2%7D+y%5E%7B2%7D%5Cleq1%5C%7D">. <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BX%7D"> is said to have uniform on the unit circle distribution. In this case the PDF is <img src="https://latex.codecogs.com/png.latex?0"> outside the disc and <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B1%7D%7B%5Cpi%7D"> inside the disc:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0Af(x,y)%20&amp;%20=%5Cfrac%7B1%7D%7B%5Cpi%7D%5Cquad%5Ctext%7B%20if%20%7Dx%5E%7B2%7D+y%5E%7B2%7D%5Cleq1%5Cend%7Baligned%7D"></p>
<p>The random point <img src="https://latex.codecogs.com/png.latex?(X,Y)"> has <img src="https://latex.codecogs.com/png.latex?x">-coordinate <img src="https://latex.codecogs.com/png.latex?X"> and <img src="https://latex.codecogs.com/png.latex?Y"> coordinate <img src="https://latex.codecogs.com/png.latex?Y">. Each of these are random variables and their PDFs and CDFs can be computed. This is a valid PDF, because:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0A%5Cint%5Cint_%7BD%7Df(x,y)dydx%20&amp;%20=%5Cint_%7B-1%7D%5E%7B1%7D%5Cint_%7B-%5Csqrt%7B1-x%5E%7B2%7D%7D%7D%5E%7B%5Csqrt%7B1-x%5E%7B2%7D%7D%7D%5Cfrac%7B1%7D%7B%5Cpi%7Ddydx%5C%5C%20&amp;%20=%5Cfrac%7B1%7D%7B%5Cpi%7D%5Cint_%7B-1%7D%5E%7B1%7D%5Cleft%5By%5Cright%5D_%7B-%5Csqrt%7B1-x%5E%7B2%7D%7D%7D%5E%7B+%5Csqrt%7B1-x%5E%7B2%7D%7D%7Ddx%5C%5C%20&amp;%20=%5Cfrac%7B2%7D%7B%5Cpi%7D%5Cint_%7B-1%7D%5E%7B1%7D%5Csqrt%7B1-x%5E%7B2%7D%7Ddx%5Cend%7Baligned%7D"></p>
<p>Substituting <img src="https://latex.codecogs.com/png.latex?x=%5Csin%5Ctheta">, we have: <img src="https://latex.codecogs.com/png.latex?dx=%5Ccos%5Ctheta%20d%5Ctheta"> and <img src="https://latex.codecogs.com/png.latex?%5Csqrt%7B1-x%5E%7B2%7D%7D=%5Ccos%5Ctheta">. The limits of integration are <img src="https://latex.codecogs.com/png.latex?%5Ctheta=-%5Cpi/2"> to <img src="https://latex.codecogs.com/png.latex?%5Ctheta=%5Cpi/2">. Thus,</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0A%5Cint%5Cint_%7BD%7Df(x,y)dydx%20&amp;%20=%5Cfrac%7B2%7D%7B%5Cpi%7D%5Cint_%7B-%5Cpi/2%7D%5E%7B%5Cpi/2%7D%5Ccos%5E%7B2%7D%5Ctheta%20d%5Ctheta%5C%5C%20&amp;%20=%5Cfrac%7B1%7D%7B%5Cpi%7D%5Cint_%7B-%5Cpi/2%7D%5E%7B%5Cpi/2%7D(1+%5Ccos2%5Ctheta)d%5Ctheta%5C%5C%20&amp;%20=%5Cfrac%7B1%7D%7B%5Cpi%7D%5Cleft%5B%5Ctheta+%5Cfrac%7B1%7D%7B2%7D%5Csin2%5Ctheta%5Cright%5D_%7B-%5Cpi/2%7D%5E%7B%5Cpi/2%7D%5C%5C%20&amp;%20=%5Cfrac%7B1%7D%7B%5Cpi%7D%5Ccdot%5Cpi%5C%5C%20&amp;%20=1%5Cend%7Baligned%7D"></p>
<p>The CDF of <img src="https://latex.codecogs.com/png.latex?X"> is given by:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0AF_%7BX%7D(a)%20&amp;%20=%5Cint_%7B-1%7D%5E%7Ba%7D%5Cint_%7B-%5Csqrt%7B1-x%5E%7B2%7D%7D%7D%5E%7B%5Csqrt%7B1-x%5E%7B2%7D%7D%7D%5Cfrac%7B1%7D%7B%5Cpi%7Ddydx%5C%5C%20&amp;%20=%5Cfrac%7B2%7D%7B%5Cpi%7D%5Cint_%7B-1%7D%5E%7Ba%7D%5Csqrt%7B1-x%5E%7B2%7D%7Ddx%5Cend%7Baligned%7D"></p>
<p>I leave it in this integral form. The PDF of <img src="https://latex.codecogs.com/png.latex?X"> is obtained by differentiating the CDF, so it is:</p>
<p><img src="https://latex.codecogs.com/png.latex?f_%7BX%7D(x)=%5Cfrac%7B2%7D%7B%5Cpi%7D%5Csqrt%7B1-x%5E%7B2%7D%7D%5Clabel%7Beq:marginal-pdf-of-X%7D"></p>
</div>
<p>Lets quickly plot the density of <img src="https://latex.codecogs.com/png.latex?X"> over the domain of the definition <img src="https://latex.codecogs.com/png.latex?-1%5Cleq%20x%5Cleq1">.</p>
<p>::: center Figure. The PDF of the random variable <img src="https://latex.codecogs.com/png.latex?X">. :::</p>
<p>Not suprisingly the distribution of the <img src="https://latex.codecogs.com/png.latex?x">-coordinate is no longer uniform!</p>
<p>If <img src="https://latex.codecogs.com/png.latex?(X_%7B1%7D,X_%7B2%7D,%5Cldots,X_%7Bn%7D)"> is a random vector, the distribution of a single coordinate, say <img src="https://latex.codecogs.com/png.latex?X_%7B1%7D"> is called the <em>marginal distribution</em>. In the example [Uniform-on-the-unit-circle-distribution], the marginal distribution of <img src="https://latex.codecogs.com/png.latex?X"> is determined by the PDF [eq:marginal-pdf-of-X].</p>
<p>Random variables <img src="https://latex.codecogs.com/png.latex?X_%7B1%7D,X_%7B2%7D,%5Cldots,X_%7Bn%7D"> defined on the same probability space are said to be independent if for any intervals <img src="https://latex.codecogs.com/png.latex?A_%7B1%7D,A_%7B2%7D,%5Cldots,A_%7Bn%7D"> in <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BR%7D">, the probability factors:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BP%7D(X_%7B1%7D%5Cin%20A_%7B1%7D,X_%7B2%7D%5Cin%20A_%7B2%7D,%5Cldots,X_%7Bn%7D%5Cin%20A_%7Bn%7D)=%5Cmathbb%7BP%7D(X_%7B1%7D%5Cin%20A_%7B1%7D)%5Ctimes%5Cmathbb%7BP%7D(X_%7B2%7D%5Cin%20A_%7B2%7D)%5Ctimes%5Cldots%5Ctimes%5Cmathbb%7BP%7D(X_%7Bn%7D%5Cin%20A_%7Bn%7D)"> We say that the random variables are independent and identically distributed (IID) if they are independent and their marginal distributions are the same.</p>
<p>When the random vector <img src="https://latex.codecogs.com/png.latex?(X_%7B1%7D,X_%7B2%7D,%5Cldots,X_%7Bn%7D)"> has a joint PDF <img src="https://latex.codecogs.com/png.latex?f(x_%7B1%7D,x_%7B2%7D,%5Cldots,x_%7Bn%7D)">, the independence of random variables is equivalent to saying that the joint PDF is given by the product of the marginal PDFs:</p>
<p><img src="https://latex.codecogs.com/png.latex?f(x_%7B1%7D,x_%7B2%7D,%5Cldots,x_%7Bn%7D)=f_%7B1%7D(x_%7B1%7D)%5Ctimes%20f_%7B2%7D(x_%7B2%7D)%5Ctimes%5Cldots%5Ctimes%20f_%7Bn%7D(x_%7Bn%7D)"></p>
</section>
<section id="basic-probabilistic-inequalities." class="level2">
<h2 class="anchored" data-anchor-id="basic-probabilistic-inequalities.">Basic Probabilistic Inequalities.</h2>
<p>Inequalities are extremely useful tools in the theoretical development of probability theory.</p>
<section id="jensens-inequality." class="level3">
<h3 class="anchored" data-anchor-id="jensens-inequality.">Jensens inequality.</h3>
<div id="thm-jensens-inequality" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3 </strong></span>If <img src="https://latex.codecogs.com/png.latex?g"> is a convex function, and <img src="https://latex.codecogs.com/png.latex?a%3E0">, <img src="https://latex.codecogs.com/png.latex?b%3E0">, with <img src="https://latex.codecogs.com/png.latex?p%5Cin%5B0,1%5D">, it follows that:</p>
<p><img src="https://latex.codecogs.com/png.latex?g(pa+(1-p)b)%5Cleq%20pg(a)+(1-p)g(b)"></p>
</div>
<p><em>Proof.</em> This directly follows from the definition of convex functions.&nbsp;<img src="https://latex.codecogs.com/png.latex?%5Cblacksquare"></p>
</section>
<section id="jensens-inequality-for-random-variables." class="level3">
<h3 class="anchored" data-anchor-id="jensens-inequality-for-random-variables.">Jensens inequality for Random variables.</h3>
<div id="thm-jensens-inequality-for-random-variables" class="theorem">
<p><span class="theorem-title"><strong>Theorem 4 </strong></span>If <img src="https://latex.codecogs.com/png.latex?g"> is a convex function, then it follows that:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D(g(X))%5Cgeq%20g(%5Cmathbb%7BE%7DX)"></p>
</div>
<p><em>Proof.</em></p>
<p>Another way to express the idea, that a function is convex is to observe that the tangent line at an arbitrary point <img src="https://latex.codecogs.com/png.latex?(t,g(t))"> always lies below the curve. Let <img src="https://latex.codecogs.com/png.latex?y=a+bx"> be the tangent to <img src="https://latex.codecogs.com/png.latex?g"> at the point <img src="https://latex.codecogs.com/png.latex?t">. Then, it follows that:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0Aa+bt%20&amp;%20=g(t)%5C%5C%20a+bx%20&amp;%20%5Cleq%20g(x)%5Cend%7Baligned%7D"></p>
<p>for all <img src="https://latex.codecogs.com/png.latex?x">.</p>
<p>Thus, it follows that, for any point <img src="https://latex.codecogs.com/png.latex?t">, there exists <img src="https://latex.codecogs.com/png.latex?b"> such that:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0Ag(x)-g(t)%20&amp;%20%5Cgeq%20b(x-t)%5Cend%7Baligned%7D"></p>
<p>for all <img src="https://latex.codecogs.com/png.latex?x">. Set <img src="https://latex.codecogs.com/png.latex?t=%5Cmathbb%7BE%7DX"> and <img src="https://latex.codecogs.com/png.latex?x=X">. Then,</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0Ag(X)-g(%5Cmathbb%7BE%7DX)%20&amp;%20%5Cgeq%20b(X-%5Cmathbb%7BE%7DX)%5Cend%7Baligned%7D"></p>
<p>Taking expectations on both sides and simplifying:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0A%5Cmathbb%7BE%7D%5Cleft(g(X)%5Cright)-g(%5Cmathbb%7BE%7DX)%20&amp;%20%5Cgeq%20b(%5Cmathbb%7BE%7DX-%5Cmathbb%7BE%7DX)=0%5C%5C%20%5Cmathbb%7BE%7Dg(X)%20&amp;%20%5Cgeq%20g(%5Cmathbb%7BE%7DX)%5Cend%7Baligned%7D">&nbsp;</p>
<p>This closes the proof. <img src="https://latex.codecogs.com/png.latex?%5Cblacksquare"></p>
</section>
<section id="youngs-inequality." class="level3">
<h3 class="anchored" data-anchor-id="youngs-inequality.">Youngs Inequality.</h3>
<div id="thm-youngs-inequality" class="theorem">
<p><span class="theorem-title"><strong>Theorem 5 </strong></span>If <img src="https://latex.codecogs.com/png.latex?a%5Cgeq0"> and <strong><img src="https://latex.codecogs.com/png.latex?b%5Cgeq0"></strong> are non-negative real numbers and if <img src="https://latex.codecogs.com/png.latex?p%3E1"> and <img src="https://latex.codecogs.com/png.latex?q%3E1"> are real numbers such that <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B1%7D%7Bp%7D+%5Cfrac%7B1%7D%7Bq%7D=1">, then:</p>
<p><img src="https://latex.codecogs.com/png.latex?ab%5Cleq%5Cfrac%7Ba%5E%7Bp%7D%7D%7Bp%7D+%5Cfrac%7Bb%5E%7Bq%7D%7D%7Bq%7D"></p>
</div>
<p><em>Proof.</em></p>
<p>Consider <img src="https://latex.codecogs.com/png.latex?g(x)=%5Clog%20x">. Being a concave function, Jensens inequality can be reversed. We have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0Ag%5Cleft(%5Cfrac%7B1%7D%7Bp%7Da%5E%7Bp%7D+%5Cfrac%7B1%7D%7Bq%7Db%5E%7Bq%7D%5Cright)%20&amp;%20%5Cgeq%5Cfrac%7B1%7D%7Bp%7Dg(a%5E%7Bp%7D)+%5Cfrac%7B1%7D%7Bq%7Dg(b%5E%7Bq%7D)%5C%5C%20%5Clog%5Cleft(%5Cfrac%7B1%7D%7Bp%7Da%5E%7Bp%7D+%5Cfrac%7B1%7D%7Bq%7Db%5E%7Bq%7D%5Cright)%20&amp;%20%5Cgeq%5Cfrac%7B1%7D%7Bp%7D%5Clog(a%5E%7Bp%7D)+%5Cfrac%7B1%7D%7Bq%7D%5Clog(b%5E%7Bq%7D)%5C%5C%20%5Clog%5Cleft(%5Cfrac%7B1%7D%7Bp%7Da%5E%7Bp%7D+%5Cfrac%7B1%7D%7Bq%7Db%5E%7Bq%7D%5Cright)%20&amp;%20%5Cgeq%5Cfrac%7B1%7D%7Bp%7D%5Ccdot%20p%5Clog(a)+%5Cfrac%7B1%7D%7Bq%7D%5Ccdot%20q%5Clog(b)%5C%5C%20%5Clog%5Cleft(%5Cfrac%7B1%7D%7Bp%7Da%5E%7Bp%7D+%5Cfrac%7B1%7D%7Bq%7Db%5E%7Bq%7D%5Cright)%20&amp;%20%5Cgeq%5Clog%20ab%5Cend%7Baligned%7D"></p>
<p>By the Monotonicity of the <img src="https://latex.codecogs.com/png.latex?%5Clog%20x"> function, it follows that :</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0Aab%20&amp;%20%5Cleq%5Cfrac%7Ba%5E%7Bp%7D%7D%7Bp%7D+%5Cfrac%7Bb%5E%7Bq%7D%7D%7Bq%7D%5Cend%7Baligned%7D">&nbsp;</p>
<p>This closes the proof. <img src="https://latex.codecogs.com/png.latex?%5Cblacksquare"></p>
</section>
<section id="chebyshevs-inequality." class="level3">
<h3 class="anchored" data-anchor-id="chebyshevs-inequality.">Chebyshevs inequality.</h3>
<p>One of the simplest and very useful probabilistic inequalities is a tail bound by expectation: the so called Chebyshevs inequality.</p>
<div id="thm-chebyshevs-inequality" class="theorem">
<p><span class="theorem-title"><strong>Theorem 6 (Chebyshevs inequality) </strong></span>If <img src="https://latex.codecogs.com/png.latex?X"> is a non-negative random variable, then for every <img src="https://latex.codecogs.com/png.latex?t%5Cgeq0">:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BP%7D(X%5Cgeq%20t)%5Cleq%5Cfrac%7B1%7D%7Bt%7D%5Cmathbb%7BE%7DX"></p>
</div>
<p><em>Proof.</em></p>
<p>We have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0At%5Ccdot%5Cmathbf%7B1%7D_%7B%5C%7BX%5Cgeq%20t%5C%7D%7D%20&amp;%20%5Cleq%20X%5Ccdot%5Cmathbf%7B1%7D_%7B%5C%7BX%5Cgeq%20t%5C%7D%7D%5Cend%7Baligned%7D"></p>
<p>By the monotonicity of expectations, we have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0A%5Cmathbb%7BE%7D%5Cmathbf%7B1%7D_%7B%5C%7BX%5Cgeq%20t%5C%7D%7D%20&amp;%20%5Cleq%5Cfrac%7B1%7D%7Bt%7D%5Cmathbb%7BE%7DX%5C%5C%20%5Cimplies%5Cmathbb%7BP%7D%5C%7BX%5Cgeq%20t%5C%7D%20&amp;%20%5Cleq%5Cfrac%7B1%7D%7Bt%7D%5Cmathbb%7BE%7DX%5Cend%7Baligned%7D"></p>
<p>This closes the proof.&nbsp;<img src="https://latex.codecogs.com/png.latex?%5Cblacksquare"></p>
<p>There are several variants, easily deduced from Chebyshevs inequality using monotonicity of several functions. For a non-negative random variable <img src="https://latex.codecogs.com/png.latex?X"> and <img src="https://latex.codecogs.com/png.latex?t%3E0">, using the power function <img src="https://latex.codecogs.com/png.latex?x%5E%7Bp%7D">, <img src="https://latex.codecogs.com/png.latex?p%3E0">, we get:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BP%7D(X%5Cgeq%20t)=%5Cmathbb%7BP%7D(X%5E%7Bp%7D%5Cgeq%20t%5E%7Bp%7D)%5Cleq%5Cfrac%7B1%7D%7Bt%5E%7Bp%7D%7D%5Cmathbb%7BE%7DX%5E%7Bp%7D"></p>
<p>For a real valued random variable <img src="https://latex.codecogs.com/png.latex?X">, every <img src="https://latex.codecogs.com/png.latex?t%5Cin%5Cmathbf%7BR%7D">, using the square function <img src="https://latex.codecogs.com/png.latex?x%5E%7B2%7D"> and variance, we have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BP%7D(%7CX-%5Cmathbb%7BE%7DX%7C%5Cgeq%20t)%5Cleq%5Cfrac%7B1%7D%7Bt%5E%7B2%7D%7D%5Cmathbb%7BE%7D%7CX-%5Cmathbb%7BE%7DX%7C%5E%7B2%7D=%5Cfrac%7B1%7D%7Bt%5E%7B2%7D%7DVar(X)"></p>
<p>For a real-valued random variable <img src="https://latex.codecogs.com/png.latex?X">, every <img src="https://latex.codecogs.com/png.latex?t%5Cin%5Cmathbf%7BR%7D"> and <img src="https://latex.codecogs.com/png.latex?%5Clambda%3E0">, using the exponential function <img src="https://latex.codecogs.com/png.latex?e%5E%7B%5Clambda%20x%7D">(which is monotonic), we have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BP%7D(X%5Cgeq%20t)=%5Cmathbb%7BP%7D(%5Clambda%20X%5Cgeq%5Clambda%20t)=%5Cmathbb%7BP%7D(e%5E%7B%5Clambda%20X%7D%5Cgeq%20e%5E%7B%5Clambda%20t%7D)%5Cleq%5Cfrac%7B1%7D%7Be%5E%7B%5Clambda%20t%7D%7D%5Cmathbb%7BE%7De%5E%7B%5Clambda%20X%7D"></p>
<p>Our next inequality, the so-called Holders inequality is a very effective inequality to factor out the expectation of a product.</p>
</section>
<section id="holders-inequality." class="level3">
<h3 class="anchored" data-anchor-id="holders-inequality.">Holders inequality.</h3>
<div id="thm-holders-inequality" class="theorem">
<p><span class="theorem-title"><strong>Theorem 7 </strong></span>Let <img src="https://latex.codecogs.com/png.latex?p,q%5Cgeq1"> be such that <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B1%7D%7Bp%7D+%5Cfrac%7B1%7D%7Bq%7D=1">, For random variables <img src="https://latex.codecogs.com/png.latex?X"> and <img src="https://latex.codecogs.com/png.latex?Y">, we have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0A%5Cmathbb%7BE%7D%7CXY%7C%20&amp;%20%5Cleq%5Cleft(%5Cmathbb%7BE%7D%7CX%5E%7Bp%7D%7C%5Cright)%5E%7B1/p%7D%5Cleft(%5Cmathbb%7BE%7D%7CY%5E%7Bq%7D%7C%5Cright)%5E%7B1/q%7D%5Cend%7Baligned%7D"></p>
</div>
<p><em>Proof.</em> From the Youngs inequality, for any <img src="https://latex.codecogs.com/png.latex?a,b%5Cin%5Cmathbf%7BR%7D">, <img src="https://latex.codecogs.com/png.latex?p,q%5Cgeq1">, we have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0Aab%20&amp;%20%5Cleq%5Cfrac%7Ba%5E%7Bp%7D%7D%7Bp%7D+%5Cfrac%7Bb%5E%7Bq%7D%7D%7Bq%7D%5Cend%7Baligned%7D"></p>
<p>Setting <img src="https://latex.codecogs.com/png.latex?a=%5Cfrac%7B%7CX%7C%7D%7B%5Cleft(%5Cmathbb%7BE%7D%7CX%5E%7Bp%7D%7C%5Cright)%5E%7B1/p%7D%7D"> and <img src="https://latex.codecogs.com/png.latex?b=%5Cfrac%7B%7CY%7C%7D%7B%5Cleft(%5Cmathbb%7BE%7D%7CY%5E%7Bq%7D%7C%5Cright)%5E%7B1/q%7D%7D">, we get:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0A%5Cfrac%7B%7CXY%7C%7D%7B%5Cleft(%5Cmathbb%7BE%7D%7CX%5E%7Bp%7D%7C%5Cright)%5E%7B1/p%7D%5Cleft(%5Cmathbb%7BE%7D%7CY%5E%7Bq%7D%7C%5Cright)%5E%7B1/q%7D%7D%20&amp;%20%5Cleq%5Cfrac%7B1%7D%7Bp%7D%5Ccdot%5Cfrac%7B%7CX%7C%5E%7Bp%7D%7D%7B%5Cmathbb%7BE%7D%7CX%5E%7Bp%7D%7C%7D+%5Cfrac%7B1%7D%7Bq%7D%5Ccdot%5Cfrac%7B%7CY%7C%5E%7Bq%7D%7D%7B%5Cmathbb%7BE%7D%7CY%5E%7Bq%7D%7C%7D%5Cend%7Baligned%7D"></p>
<p>Taking expectations on both sides, and using the monotonicity of expectation property, we get:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0A%5Cfrac%7B%5Cmathbb%7BE%7D%7CXY%7C%7D%7B%5Cleft(%5Cmathbb%7BE%7D%7CX%5E%7Bp%7D%7C%5Cright)%5E%7B1/p%7D%5Cleft(%5Cmathbb%7BE%7D%7CY%5E%7Bq%7D%7C%5Cright)%5E%7B1/q%7D%7D%20&amp;%20%5Cleq%5Cfrac%7B1%7D%7Bp%7D%5Ccdot%5Cfrac%7B%5Cmathbb%7BE%7D%7CX%7C%5E%7Bp%7D%7D%7B%5Cmathbb%7BE%7D%7CX%5E%7Bp%7D%7C%7D+%5Cfrac%7B1%7D%7Bq%7D%5Ccdot%5Cfrac%7B%5Cmathbb%7BE%7D%7CY%7C%5E%7Bq%7D%7D%7B%5Cmathbb%7BE%7D%7CY%5E%7Bq%7D%7C%7D=%5Cfrac%7B1%7D%7Bp%7D+%5Cfrac%7B1%7D%7Bq%7D=1%5Cend%7Baligned%7D"></p>
<p>Consequently,</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0A%5Cmathbb%7BE%7D%7CXY%7C%20&amp;%20%5Cleq%5Cleft(%5Cmathbb%7BE%7D%7CX%5E%7Bp%7D%7C%5Cright)%5E%7B1/p%7D%5Cleft(%5Cmathbb%7BE%7D%7CY%5E%7Bq%7D%7C%5Cright)%5E%7B1/q%7D%5Cend%7Baligned%7D"></p>
<p>Let <img src="https://latex.codecogs.com/png.latex?p=2"> and <img src="https://latex.codecogs.com/png.latex?q=2">. Then, we get the Cauchy-Schwarz inequality:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0A%5Cmathbb%7BE%7D%7CXY%7C%20&amp;%20%5Cleq%5Cleft%5B%5Cmathbb%7BE%7D(X%5E%7B2%7D)%5Cright%5D%5E%7B1/2%7D%5Cleft%5B%5Cmathbb%7BE%7D(Y%5E%7B2%7D)%5Cright%5D%5E%7B1/2%7D%5Cend%7Baligned%7D"></p>
<p>In some ways, the <img src="https://latex.codecogs.com/png.latex?p">-th moment of a random variable can be thought of as its length or <img src="https://latex.codecogs.com/png.latex?p">-norm.</p>
<p>Define:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cleft%5CVert%20X%5Cright%5CVert%20_%7Bp%7D=%5Cleft(%5Cmathbb%7BE%7D%7CX%7C%5E%7Bp%7D%5Cright)%5E%7B1/p%7D">&nbsp;</p>
<p>This closes the proof. <img src="https://latex.codecogs.com/png.latex?%5Cblacksquare"></p>
</section>
<section id="minkowskis-inequality." class="level3">
<h3 class="anchored" data-anchor-id="minkowskis-inequality.">Minkowskis Inequality.</h3>
<div id="thm-minkowskis-inequality" class="theorem">
<p><span class="theorem-title"><strong>Theorem 8 </strong></span>For random variables <img src="https://latex.codecogs.com/png.latex?X"> and <img src="https://latex.codecogs.com/png.latex?Y">, and for all <img src="https://latex.codecogs.com/png.latex?p%5Cgeq1"> we have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cleft%5CVert%20X+Y%5Cright%5CVert%20_%7Bp%7D%5Cleq%5Cleft%5CVert%20X%5Cright%5CVert%20_%7Bp%7D+%5Cleft%5CVert%20Y%5Cright%5CVert%20_%7Bp%7D"></p>
</div>
<p><em>Proof.</em></p>
<p>The basic idea of the proof is to use Holders inequality. Let <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B1%7D%7Bq%7D=1-%5Cfrac%7B1%7D%7Bp%7D"> or in other words, <img src="https://latex.codecogs.com/png.latex?q=%5Cfrac%7Bp%7D%7Bp-1%7D">. We have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0A%5Cmathbb%7BE%7D%7CX%7C%7CX+Y%7C%5E%7Bp-1%7D%20&amp;%20%5Cleq%5Cleft(%5Cmathbb%7BE%7D%7CX%7C%5E%7Bp%7D%5Cright)%5E%7B1/p%7D%5Cleft(%5Cmathbb%7BE%7D%7CX+Y%7C%5E%7B(p-1)q%7D%5Cright)%5E%7B1/q%7D%20&amp;%20(a)%5C%5C%20%5Cmathbb%7BE%7D%7CY%7C%7CX+Y%7C%5E%7Bp-1%7D%20&amp;%20%5Cleq%5Cleft(%5Cmathbb%7BE%7D%7CY%7C%5E%7Bp%7D%5Cright)%5E%7B1/p%7D%5Cleft(%5Cmathbb%7BE%7D%7CX+Y%7C%5E%7B(p-1)q%7D%5Cright)%5E%7B1/q%7D%20&amp;%20(b)%5Cend%7Baligned%7D"></p>
<p>Adding the above two equations, we get:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0A%5Cmathbb%7BE%7D(%7CX+Y%7C%7CX+Y%7C%5E%7Bp-1%7D)%5Cleq%5Cmathbb%7BE%7D(%7CX%7C+%7CY%7C)(%7CX+Y%7C%5E%7Bp-1%7D)%20&amp;%20%5Cleq%5Cleft%5C%7B%20%5Cleft(%5Cmathbb%7BE%7D%7CX%7C%5E%7Bp%7D%5Cright)%5E%7B1/p%7D+%5Cleft(%5Cmathbb%7BE%7D%7CY%7C%5E%7Bp%7D%5Cright)%5E%7B1/p%7D%5Cright%5C%7D%20%5Cleft(%5Cmathbb%7BE%7D%7CX+Y%7C%5E%7B(p-1)q%7D%5Cright)%5E%7B1/q%7D%5C%5C%20%5Cmathbb%7BE%7D%7CX+Y%7C%5E%7Bp%7D%20&amp;%20%5Cleq%5Cleft%5C%7B%20%5Cleft%5CVert%20X%5Cright%5CVert%20_%7Bp%7D+%5Cleft%5CVert%20Y%5Cright%5CVert%20_%7Bp%7D%5Cright%5C%7D%20%5Cleft(%5Cmathbb%7BE%7D%7CX+Y%7C%5E%7Bp%7D%5Cright)%5E%7B1/q%7D%5C%5C%20%5Cleft(%5Cmathbb%7BE%7D%7CX+Y%7C%5E%7Bp%7D%5Cright)%5E%7B1/p%7D%20&amp;%20%5Cleq%5Cleft%5CVert%20X%5Cright%5CVert%20_%7Bp%7D+%5Cleft%5CVert%20Y%5Cright%5CVert%20_%7Bp%7D%5C%5C%20%5Cleft%5CVert%20X+Y%5Cright%5CVert%20_%7Bp%7D%20&amp;%20%5Cleq%5Cleft%5CVert%20X%5Cright%5CVert%20_%7Bp%7D+%5Cleft%5CVert%20Y%5Cright%5CVert%20_%7Bp%7D%5Cend%7Baligned%7D">&nbsp;</p>
<p>This closes the proof. <img src="https://latex.codecogs.com/png.latex?%5Cblacksquare"></p>
</section>
</section>
<section id="a-quick-refresher-of-linear-algebra." class="level2">
<h2 class="anchored" data-anchor-id="a-quick-refresher-of-linear-algebra.">A quick refresher of linear algebra.</h2>
<p>Many of the concepts in this chapter have very elegant interpretations, if we think of real-valued random variables on a probability space as vectors in a vector space. In particular, variance is related to the concept of norm and distance, while covariance is related to inner-products. These concepts can help unify some of the ideas in this chapter from a geometric point of view. Of course, real-valued random variables are simply measurable, real-valued functions on the abstract space <img src="https://latex.codecogs.com/png.latex?%5COmega."></p>
<div id="def-vector-space" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 4 (Vector Space.) </strong></span>By a vector space, we mean a non-empty set <img src="https://latex.codecogs.com/png.latex?V"> with two operations: :::</p>
<ul>
<li><p>Vector addition: <img src="https://latex.codecogs.com/png.latex?+:(%5Cmathbf%7Bx%7D,%5Cmathbf%7By%7D)%5Cto%5Cmathbf%7Bx%7D+%5Cmathbf%7By%7D"></p></li>
<li><p>Scalar multiplication: <img src="https://latex.codecogs.com/png.latex?%5Ccdot:(%5Calpha,%5Cmathbf%7Bx%7D)%5Cto%5Calpha%5Cmathbf%7Bx%7D"></p></li>
</ul>
<p>such that the following conditions are satisfied:</p>
<p>(A1) Commutativity. <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bx%7D+%5Cmathbf%7By%7D=%5Cmathbf%7By%7D+%5Cmathbf%7Bx%7D"> for all <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bx%7D,%5Cmathbf%7By%7D%5Cin%20V"></p>
<p>(A2) Associativity: <img src="https://latex.codecogs.com/png.latex?(%5Cmathbf%7Bx%7D+%5Cmathbf%7By%7D)+%5Cmathbf%7Bz%7D=%5Cmathbf%7Bx%7D+(%5Cmathbf%7By%7D+%5Cmathbf%7Bz%7D)"> for all <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bx%7D,%5Cmathbf%7By%7D,%5Cmathbf%7Bz%7D%5Cin%20V"></p>
<p>(A3) Zero Element: There exists a zero element, denoted <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7B0%7D"> in <img src="https://latex.codecogs.com/png.latex?V">, for all <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bx%7D%5Cin%20V">, such that <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bx%7D+%5Cmathbf%7B0%7D=%5Cmathbf%7Bx%7D">.</p>
<p>(A4) Additive Inverse: For all <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bx%7D%5Cin%20V">, there exists an additive inverse(negative element) denoted <img src="https://latex.codecogs.com/png.latex?-%5Cmathbf%7Bx%7D"> in <img src="https://latex.codecogs.com/png.latex?V">, such that <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bx%7D+(-%5Cmathbf%7Bx%7D)=%5Cmathbf%7B0%7D">.</p>
<p>(M1) Scalar multiplication by identity element in <img src="https://latex.codecogs.com/png.latex?F">: For all <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bx%7D%5Cin%20V">, <img src="https://latex.codecogs.com/png.latex?1%5Ccdot%5Cmathbf%7Bx%7D=%5Cmathbf%7Bx%7D">, where <img src="https://latex.codecogs.com/png.latex?1"> denotes the multiplicative identity in <img src="https://latex.codecogs.com/png.latex?F">.</p>
<p>(M2) Scalar multiplication and field multiplication mix well: For all <img src="https://latex.codecogs.com/png.latex?%5Calpha,%5Cbeta%5Cin%20F"> and <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bv%7D%5Cin%20V">, <img src="https://latex.codecogs.com/png.latex?(%5Calpha%5Cbeta)%5Cmathbf%7Bv%7D=%5Calpha(%5Cbeta%5Cmathbf%7Bv%7D)">.</p>
<p>(D1) Distribution of scalar multiplication over vector addition: For all <img src="https://latex.codecogs.com/png.latex?%5Calpha%5Cin%20F">, and <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bu%7D,%5Cmathbf%7Bv%7D%5Cin%20V">, <img src="https://latex.codecogs.com/png.latex?%5Calpha(%5Cmathbf%7Bu%7D+%5Cmathbf%7Bv%7D)=%5Calpha%5Cmathbf%7Bu%7D+%5Calpha%5Cmathbf%7Bv%7D">.</p>
<p>(D2) Distribution of field addition over scalar multiplication: For all <img src="https://latex.codecogs.com/png.latex?%5Calpha,%5Cbeta%5Cin%20F">, and <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bv%7D%5Cin%20V">, <img src="https://latex.codecogs.com/png.latex?(%5Calpha+%5Cbeta)%5Cmathbf%7Bv%7D=%5Calpha%5Cmathbf%7Bv%7D+%5Cbeta%5Cmathbf%7Bv%7D">.</p>
</div>
<p>As usual, our starting point is a random experiment modeled by a probability space <img src="https://latex.codecogs.com/png.latex?(%5COmega,%5Cmathcal%7BF%7D,%5Cmathbb%7BP%7D)">, so that <img src="https://latex.codecogs.com/png.latex?%5COmega"> is the set of outcomes, <img src="https://latex.codecogs.com/png.latex?%5Cmathscr%7B%5Cmathcal%7BF%7D%7D"> is the <img src="https://latex.codecogs.com/png.latex?%5Csigma">-algebra of events and <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BP%7D"> is the probability measure on the measurable space <img src="https://latex.codecogs.com/png.latex?(%5COmega,%5Cmathcal%7BF%7D)">. Our basic vector space <img src="https://latex.codecogs.com/png.latex?V"> consists of all real-valued random variables defined on <img src="https://latex.codecogs.com/png.latex?(%5COmega,%5Cmathcal%7BF%7D,%5Cmathbb%7BP%7D)">. We define vector addition and scalar multiplication in the usual way point-wise.</p>
<ul>
<li><p>Vector addition: <img src="https://latex.codecogs.com/png.latex?(X+Y)(%5Comega)=X(%5Comega)+Y(%5Comega)">.</p></li>
<li><p>Scalar multiplication: <img src="https://latex.codecogs.com/png.latex?(%5Calpha%20X)(%5Comega)=%5Calpha%20X(%5Comega)"></p></li>
</ul>
<p>Clearly, any function <img src="https://latex.codecogs.com/png.latex?g"> of a random variable <img src="https://latex.codecogs.com/png.latex?X(%5Comega)"> is also a random variable on the same probability space and any linear combination of random variables on <img src="https://latex.codecogs.com/png.latex?(%5COmega,%5Cmathcal%7BF%7D,%5Cmathbb%7BP%7D)"> also define a new random variable on the same probability space. Thus, <img src="https://latex.codecogs.com/png.latex?V"> is closed under vector addition and scalar-multiplication. Since vector-addition and scalar multiplication is defined point-wise, it is easy to see that - all the axioms of a vector space (A1)-(A4), (M1-M2), (D1), (D2) are satisfied. The constantly zero random variable <img src="https://latex.codecogs.com/png.latex?0(%5Comega)=0"> and the indicator random variable <img src="https://latex.codecogs.com/png.latex?I_%7B%5COmega%7D(%5Comega)"> can be thought of as the zero and identity vectors in this vector space.</p>
<p>Clearly, any function <img src="https://latex.codecogs.com/png.latex?g"> of a random variable <img src="https://latex.codecogs.com/png.latex?X(%5Comega)"> is also a random variable on the same probability space and any linear combination of random variables on <img src="https://latex.codecogs.com/png.latex?(%5COmega,%5Cmathcal%7BF%7D,%5Cmathbb%7BP%7D)"> also define a new random variable on the same probability space. Thus, <img src="https://latex.codecogs.com/png.latex?V"> is closed under vector addition and scalar-multiplication. Since vector-addition and scalar multiplication is defined point-wise, it is easy to see that - all the axioms of a vector space (A1)-(A4), (M1-M2), (D1), (D2) are satisfied. The constantly zero random variable <img src="https://latex.codecogs.com/png.latex?0(%5Comega)=0"> and the indicator random variable <img src="https://latex.codecogs.com/png.latex?I_%7B%5COmega%7D(%5Comega)"> can be thought of as the zero and identity vectors in this vector space.</p>
<section id="inner-products." class="level3">
<h3 class="anchored" data-anchor-id="inner-products.">Inner Products.</h3>
<p>In Euclidean geometry, the angle between two vectors is specified by their dot product, which is itself formalized by the abstract concept of inner products.</p>
<div id="def-inner-product" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 5 (Inner Product.) </strong></span>An inner product on the real vector space <img src="https://latex.codecogs.com/png.latex?V"> is a pairing that takes two vectors <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bv%7D,%5Cmathbf%7Bw%7D%5Cin%20V"> and produces a real number <img src="https://latex.codecogs.com/png.latex?%5Cleft%5Clangle%20%5Cmathbf%7Bv%7D,%5Cmathbf%7Bw%7D%5Cright%5Crangle%20%5Cin%5Cmathbf%7BR%7D">. The inner product is required to satisfy the following three axioms for all <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bu%7D,%5Cmathbf%7Bv%7D,%5Cmathbf%7Bw%7D%5Cin%20V"> and scalars <img src="https://latex.codecogs.com/png.latex?c,d%5Cin%5Cmathbf%7BR%7D">.</p>
<ol type="1">
<li>Bilinearity: <img src="https://latex.codecogs.com/png.latex?%0A%5Cleft%5Clangle%20c%5Cmathbf%7Bu%7D+d%5Cmathbf%7Bv%7D,%5Cmathbf%7Bw%7D%5Cright%5Crangle%20=c%5Cleft%5Clangle%20%5Cmathbf%7Bu%7D,%5Cmathbf%7Bw%7D%5Cright%5Crangle%20+d%5Cleft%5Clangle%20%5Cmathbf%7Bv%7D,%5Cmathbf%7Bw%7D%5Cright%5Crangle%0A"></li>
</ol>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cleft%5Clangle%20%5Cmathbf%7Bu%7D,c%5Cmathbf%7Bv%7D+d%5Cmathbf%7Bw%7D%5Cright%5Crangle%20=c%5Cleft%5Clangle%20%5Cmathbf%7Bu%7D,%5Cmathbf%7Bv%7D%5Cright%5Crangle%20+d%5Cleft%5Clangle%20%5Cmathbf%7Bu%7D,%5Cmathbf%7Bw%7D%5Cright%5Crangle%0A"></p>
<ol start="2" type="1">
<li>Symmetry:</li>
</ol>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cleft%5Clangle%20%5Cmathbf%7Bv%7D,%5Cmathbf%7Bw%7D%5Cright%5Crangle%20=%5Cleft%5Clangle%20%5Cmathbf%7Bw%7D,%5Cmathbf%7Bv%7D%5Cright%5Crangle%0A"></p>
<ol start="3" type="1">
<li>Positive Definiteness:</li>
</ol>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cleft%5Clangle%20%5Cmathbf%7Bv%7D,%5Cmathbf%7Bv%7D%5Cright%5Crangle%20%3E0%5Cquad%5Ctext%7B%20whenever%20%7D%5Cmathbf%7Bv%5Cneq%5Cmathbf%7B0%7D%7D%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cleft%5Clangle%20%5Cmathbf%7Bv%7D,%5Cmathbf%7Bv%7D%5Cright%5Crangle%20=0%5Cquad%5Ctext%7B%20whenever%20%7D%5Cmathbf%7Bv=0%7D%0A"></p>
</div>
<div id="def-norm" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 6 </strong></span>(Norm). A norm on a real vector space <img src="https://latex.codecogs.com/png.latex?V"> is a function <img src="https://latex.codecogs.com/png.latex?%5Cleft%5CVert%20%5Ccdot%5Cright%5CVert%20:V%5Cto%5Cmathbf%7BR%7D"> satisfying :</p>
<p>(i) Positive Definiteness.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cleft%5CVert%20%5Cmathbf%7Bv%7D%5Cright%5CVert%20%5Cgeq0"></p>
<p>and <img src="https://latex.codecogs.com/png.latex?%5Cleft%5CVert%20%5Cmathbf%7Bv%7D%5Cright%5CVert%20=0%5Cquad%5Ctext%7Bif%20and%20only%20if%20%7D%5Cmathbf%7Bv%7D=%5Cmathbf%7B0%7D"></p>
<p>(ii) Scalar multiplication.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cleft%5CVert%20%5Calpha%5Cmathbf%7Bv%7D%5Cright%5CVert%20=%7C%5Calpha%7C%5Cleft%5CVert%20%5Cmathbf%7Bv%7D%5Cright%5CVert"></p>
<p>(iii) Triangle Inequality.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cleft%5CVert%20%5Cmathbf%7Bx+y%7D%5Cright%5CVert%20%5Cleq%5Cleft%5CVert%20%5Cmathbf%7Bx%7D%5Cright%5CVert%20+%5Cleft%5CVert%20%5Cmathbf%7By%7D%5Cright%5CVert"></p>
</div>
<p>As mentioned earlier, we can define the <img src="https://latex.codecogs.com/png.latex?p">-norm of a random variable as:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0A%5Cleft%5CVert%20X%5Cright%5CVert%20_%7Bp%7D%20&amp;%20=%5Cleft(%5Cmathbb%7BE%7D%7CX%7C%5E%7Bp%7D%5Cright)%5E%7B1/p%7D%0A%5Cend%7Baligned%7D%0A"></p>
<p>(i) Positive semi-definiteness: Since <img src="https://latex.codecogs.com/png.latex?%7CX%7C"> is a non-negative random variable, <img src="https://latex.codecogs.com/png.latex?%7CX%7C%5E%7Bp%7D%5Cgeq0"> and the expectation of a non-negative random variable is also non-negative. Hence, <img src="https://latex.codecogs.com/png.latex?(%5Cmathbb%7BE%7D%7CX%7C%5E%7Bp%7D)%5E%7B1/p%7D%5Cgeq0">. Moreover, <img src="https://latex.codecogs.com/png.latex?%5Cleft%5CVert%20X%5Cright%5CVert%20_%7Bp%7D=0"> implies that <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%7CX%7C%5E%7Bp%7D=0">. From property (iv) of expectations, <img src="https://latex.codecogs.com/png.latex?X=0">.</p>
<p>(ii) Scalar-multiplication: We have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0A%5Cleft%5CVert%20cX%5Cright%5CVert%20_%7Bp%7D%20&amp;%20=%5Cleft(%5Cmathbb%7BE%7D%7CcX%7C%5E%7Bp%7D%5Cright)%5E%7B1/p%7D%5C%5C%0A&amp;%20=%5Cleft(%7Cc%7C%5E%7Bp%7D%5Cright)%5E%7B1/p%7D%5Cleft(%5Cmathbb%7BE%7D%7CX%7C%5E%7Bp%7D%5Cright)%5E%7B1/p%7D%5C%5C%0A&amp;%20=%7Cc%7C%5Ccdot%5Cleft%5CVert%20X%5Cright%5CVert%20_%7Bp%7D%0A%5Cend%7Baligned%7D%0A"></p>
<p>(iii) Triangle Inequality. This followed from the Minkowskis inequality.</p>
<p>The space of all random variables defined on <img src="https://latex.codecogs.com/png.latex?(%5COmega,%5Cmathcal%7B%5Cmathcal%7BF%7D%7D,%5Cmathbb%7BP%7D)"> such that <img src="https://latex.codecogs.com/png.latex?%7C%7CX%7C%7C_%7Bp%7D%3C%5Cinfty"> is finite is called the <img src="https://latex.codecogs.com/png.latex?L%5E%7Bp%7D"> space.</p>
</section>
<section id="orthogonal-matrices." class="level3">
<h3 class="anchored" data-anchor-id="orthogonal-matrices.">Orthogonal Matrices.</h3>
<div id="def-orthogonal-matrices" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 7 (Orthogonal Matrix.) </strong></span>Let <img src="https://latex.codecogs.com/png.latex?A"> be an <img src="https://latex.codecogs.com/png.latex?n%5Ctimes%20n"> square matrix. We say that the matrix <img src="https://latex.codecogs.com/png.latex?A"> is orthogonal, if its transpose is equal toits inverse.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0AA'%20&amp;%20=A%5E%7B-1%7D%0A%5Cend%7Baligned%7D%0A"></p>
</div>
<p>This may seem like an odd property to study, but the following theorem explains why it is so useful. Essentially, an orthogonal matrix rotates (or reflects) vectors without distorting angles or distances.</p>
<div id="prp-properties-of-orthogonal-matrix" class="theorem proposition">
<p><span class="theorem-title"><strong>Proposition 1 (Properties of an orthogonal matrix) </strong></span>Faor an <img src="https://latex.codecogs.com/png.latex?n%5Ctimes%20n"> square matrix <img src="https://latex.codecogs.com/png.latex?A">, the following are equivalent:</p>
<p>(1) <img src="https://latex.codecogs.com/png.latex?A"> is orthogonal. That is, <img src="https://latex.codecogs.com/png.latex?A'A=I">.</p>
<p>(2) <img src="https://latex.codecogs.com/png.latex?A"> preserves norms. That is, for all <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bx%7D">,</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0A%5Cleft%5CVert%20A%5Cmathbf%7Bx%7D%5Cright%5CVert%20&amp;=%5Cleft%5CVert%20%5Cmathbf%7Bx%7D%5Cright%5CVert%20%5Cend%7Baligned%7D"></p>
<p>(3) <img src="https://latex.codecogs.com/png.latex?A"> preserves inner products, that is, for every <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bx%7D">, <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7By%7D"><img src="https://latex.codecogs.com/png.latex?%5Cin%5Cmathbf%7BR%7D%5E%7Bn%7D">:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0A(A%5Cmathbf%7Bx%7D)%5Ccdot(A%5Cmathbf%7By%7D)%20&amp;=%5Cmathbf%7Bx%7D%5Ccdot%5Cmathbf%7By%7D%5Cend%7Baligned%7D"></p>
</div>
<p><em>Proof.</em></p>
<p>We have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0A%5Cleft%5CVert%20A%5Cmathbf%7Bx%7D%5Cright%5CVert%20%5E%7B2%7D%20&amp;%20=%5Cleft(A%5Cmathbf%7Bx%7D%5Cright)'(A%5Cmathbf%7Bx%7D)%5C%5C%0A&amp;%20=%5Cmathbf%7Bx%7D'(A'A)%5Cmathbf%7Bx%7D%5C%5C%0A&amp;%20=%5Cmathbf%7Bx%7D'I%5Cmathbf%7Bx%7D%5C%5C%0A&amp;%20=%5Cmathbf%7Bx%7D'%5Cmathbf%7Bx%7D%5C%5C%0A&amp;%20=%7C%7C%5Cmathbf%7Bx%7D%7C%7C%5E%7B2%7D%5Cend%7Baligned%7D"></p>
<p>Consequently, <img src="https://latex.codecogs.com/png.latex?%7C%7CA%5Cmathbf%7Bx%7D%7C%7C=%7C%7C%5Cmathbf%7Bx%7D%7C%7C">. The matrix <img src="https://latex.codecogs.com/png.latex?A"> preserves norms. Thus, (1) implies (2).</p>
<p>Moreover, consider</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0A%7C%7CA(%5Cmathbf%7Bx%7D+%5Cmathbf%7By%7D)%7C%7C%5E%7B2%7D%20&amp;%20=%5Cleft(A%5Cmathbf%7Bx%7D+A%5Cmathbf%7By%7D%5Cright)%5Ccdot%5Cleft(A%5Cmathbf%7Bx%7D+A%5Cmathbf%7By%7D%5Cright)%5C%5C%0A&amp;%20=(A%5Cmathbf%7Bx%7D)%5Ccdot(A%5Cmathbf%7Bx%7D)+(A%5Cmathbf%7Bx%7D)%5Ccdot(A%5Cmathbf%7By%7D)+(A%5Cmathbf%7By%7D)%5Ccdot(A%5Cmathbf%7Bx%7D)+(A%5Cmathbf%7By%7D)%5Ccdot(A%5Cmathbf%7By%7D)%5C%5C%0A&amp;%20=%7C%7CA%5Cmathbf%7Bx%7D%7C%7C%5E%7B2%7D+2(A%5Cmathbf%7Bx%7D)%5Ccdot(A%5Cmathbf%7By%7D)+%7C%7CA%5Cmathbf%7By%7D%7C%7C%5E%7B2%7D%20&amp;%20%5C%7B%5Cmathbf%7Bx%7D%5Ccdot%5Cmathbf%7By%7D=%5Cmathbf%7By%7D%5Ccdot%5Cmathbf%7Bx%7D%5C%7D%5C%5C%0A&amp;%20=%7C%7C%5Cmathbf%7Bx%7D%7C%7C%5E%7B2%7D+2(A%5Cmathbf%7Bx%7D)%5Ccdot(A%5Cmathbf%7By%7D)+%7C%7C%5Cmathbf%7By%7D%7C%7C%5E%7B2%7D%20&amp;%20%5C%7BA%5Ctext%7B%20preserves%20norms%7D%5C%7D%5Cend%7Baligned%7D"></p>
<p>But, <img src="https://latex.codecogs.com/png.latex?%7C%7CA(%5Cmathbf%7Bx%7D+%5Cmathbf%7By%7D)%7C%7C%5E%7B2%7D=%7C%7C%5Cmathbf%7Bx%7D+%5Cmathbf%7By%7D%7C%7C%5E%7B2%7D=%7C%7C%5Cmathbf%7Bx%7D%7C%7C%5E%7B2%7D+2%5Cmathbf%7Bx%7D%5Ccdot%5Cmathbf%7By%7D+%7C%7C%5Cmathbf%7By%7D%7C%7C%5E%7B2%7D">.</p>
<p>Equating the two expressions, we have the desired result. Hence, (2) implies (3).</p>
<p>Lastly, if <img src="https://latex.codecogs.com/png.latex?A"> preserves inner products, we may write:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0A%5Cleft%5Clangle%20A%5Cmathbf%7Bx%7D,A%5Cmathbf%7Bx%7D%5Cright%5Crangle%20%20&amp;%20=%5Cleft%5Clangle%20%5Cmathbf%7Bx%7D,%5Cmathbf%7Bx%7D%5Cright%5Crangle%20%5C%5C%0A%5Cleft(A%5Cmathbf%7Bx%7D%5Cright)'(A%5Cmathbf%7Bx%7D)%20&amp;%20=%5Cmathbf%7Bx%7D'%5Cmathbf%7Bx%7D%5C%5C%0A%5Cmathbf%7Bx%7D'A'A%5Cmathbf%7Bx%7D%20&amp;%20=0%5Cend%7Baligned%7D"></p>
<p>Since <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bx%7D%5Cneq%5Cmathbf%7B0%7D">, it must be true that <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bx%7D'A'A-%5Cmathbf%7Bx%7D'=0">. Again, since <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bx%7D'%5Cneq%5Cmathbf%7B0%7D">, it follows that <img src="https://latex.codecogs.com/png.latex?A'A-I=0">.</p>
<div id="thm-linear-independence-of-orthogonal-vectors" class="theorem">
<p><span class="theorem-title"><strong>Theorem 9 (Linear Independence of orthogonal vectors) </strong></span>If <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bq%7D_%7B1%7D,%5Cmathbf%7Bq%7D_%7B2%7D,%5Cldots,%5Cmathbf%7Bq%7D_%7Bk%7D%5Cin%20V"> be mutually orthogonal elements, such that <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bq%7D_%7Bi%7D%5Cneq%5Cmathbf%7B0%7D"> for all <img src="https://latex.codecogs.com/png.latex?i">, then <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bq%7D_%7B1%7D,%5Cmathbf%7Bq%7D_%7B2%7D,%5Cldots,%5Cmathbf%7Bq%7D_%7Bk%7D"> are linearly independent.</p>
</div>
<p><em>Proof.</em></p>
<p>Let</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0Ac_%7B1%7D%5Cmathbf%7Bq%7D_%7B1%7D+c_%7B2%7D%5Cmathbf%7Bq%7D_%7B2%7D+%5Cldots+c_%7Bk%7D%5Cmathbf%7Bq%7D_%7Bk%7D%20&amp;%20=%5Cmathbf%7B0%7D%5Cend%7Baligned%7D"></p>
<p>Since <img src="https://latex.codecogs.com/png.latex?%5Cleft%5Clangle%20%5Cmathbf%7Bq%7D_%7Bi%7D,%5Cmathbf%7Bq%7D_%7Bi%7D%5Cright%5Crangle%20=1"> and <img src="https://latex.codecogs.com/png.latex?%5Cleft%5Clangle%20%5Cmathbf%7Bq%7D_%7Bi%7D,%5Cmathbf%7Bq%7D_%7Bj%7D%5Cright%5Crangle%20=0"> where <img src="https://latex.codecogs.com/png.latex?i%5Cneq%20j">, we can take the inner product of the vector <img src="https://latex.codecogs.com/png.latex?c_1%20%5Cmathbf%7Bq%7D_%7B1%7D%20+%20c_2%20%5Cmathbf%7Bq%7D_%7B2%7D%20+%20%5Cldots%20+%20c_i%20%5Cmathbf%7Bq%7D_%7Bi%7D+%5Cldots%20+%20c_%7Bk%7D%5Cmathbf%7Bq%7D_%7Bk%7D"> with <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bq%7D_%7Bi%7D"> for each <img src="https://latex.codecogs.com/png.latex?i=1,2,3,%5Cldots,k">. It results in <img src="https://latex.codecogs.com/png.latex?c_%7Bi%7D%7C%7C%5Cmathbf%7Bq%7D_%7Bi%7D%7C%7C%5E%7B2%7D=0">. Since <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bq%7D_%7Bi%7D%5Cneq%5Cmathbf%7B0%7D">, <img src="https://latex.codecogs.com/png.latex?%7C%7C%5Cmathbf%7Bq%7D_%7Bi%7D%7C%7C%5E%7B2%7D%3E0">. So, <img src="https://latex.codecogs.com/png.latex?c_%7Bi%7D=0">. We conclude that <img src="https://latex.codecogs.com/png.latex?c_%7B1%7D=c_%7B2%7D=%5Cldots=c_%7Bk%7D%20=0">. Consequently, <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bq%7D_%7B1%7D,%5Cmathbf%7Bq%7D_%7B2%7D,%5Cldots,%5Cmathbf%7Bq%7D_%7Bk%7D"> are linearly independent.&nbsp;<img src="https://latex.codecogs.com/png.latex?%5Cblacksquare"></p>
<div id="thm-orthogonal-vectors-form-a-basis" class="theorem">
<p><span class="theorem-title"><strong>Theorem 10 (Orthogonal vectors form a basis) </strong></span>Let <img src="https://latex.codecogs.com/png.latex?Q=%5Cleft%5B%5Cbegin%7Barray%7D%7Bcccc%7D%20%5Cmathbf%7Bq%7D_%7B1%7D%20&amp;%20%5Cmathbf%7Bq%7D_%7B2%7D%20&amp;%20%5Cldots%20&amp;%20%5Cmathbf%7Bq%7D_%7Bn%7D%5Cend%7Barray%7D%5Cright%5D"> be an <img src="https://latex.codecogs.com/png.latex?n%5Ctimes%20n"> orthogonal matrix. Then, <img src="https://latex.codecogs.com/png.latex?%5C%7B%5Cmathbf%7Bq%7D_%7B1%7D,%5Cldots,%5Cmathbf%7Bq%7D_%7Bn%7D%5C%7D"> form an orthonormal basis for <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BR%7D%5E%7Bn%7D">.</p>
</div>
<p><em>Proof.</em></p>
<p>We have <img src="https://latex.codecogs.com/png.latex?Q%5Cmathbf%7Be%7D_%7Bi%7D=%5Cmathbf%7Bq%7D_%7Bi%7D">. Consequently,</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0A%5Cleft%5Clangle%20%5Cmathbf%7Bq%7D_%7Bi%7D,%5Cmathbf%7Bq%7D_%7Bi%7D%5Cright%5Crangle%20%20&amp;%20=%5Cmathbf%7Bq%7D_%7Bi%7D'%5Cmathbf%7Bq%7D_%7Bi%7D%5C%5C%0A&amp;%20=(Q%5Cmathbf%7Be%7D_%7Bi%7D)'(Q%5Cmathbf%7Be%7D_%7Bi%7D)%5C%5C%0A&amp;%20=%5Cmathbf%7Be%7D_%7Bi%7D'Q'Q%5Cmathbf%7Be%7D_%7Bi%7D%5C%5C%0A&amp;%20=%5Cmathbf%7Be%7D_%7Bi%7D'I%5Cmathbf%7Be%7D_%7Bi%7D%5C%5C%0A&amp;%20=%5Cmathbf%7Be%7D_%7Bi%7D'%5Cmathbf%7Be%7D_%7Bi%7D%5C%5C%0A&amp;%20=1%5Cend%7Baligned%7D"></p>
<p>Assume that <img src="https://latex.codecogs.com/png.latex?i%5Cneq%20j">. We have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0A%5Cleft%5Clangle%20%5Cmathbf%7Bq%7D_%7Bi%7D,%5Cmathbf%7Bq%7D_%7Bj%7D%5Cright%5Crangle%20%20&amp;%20=%5Cmathbf%7Bq%7D_%7Bi%7D'%5Cmathbf%7Bq%7D_%7Bj%7D%5C%5C%0A&amp;%20=%5Cmathbf%7Be%7D_%7Bi%7D'Q'Q%5Cmathbf%7Be%7D_%7Bj%7D%5C%5C%0A&amp;%20=%5Cmathbf%7Be%7D_%7Bi%7D'%5Cmathbf%7Be%7D_%7Bj%7D%5C%5C%0A&amp;%20=0%5Cend%7Baligned%7D"></p>
<p>From Theorem&nbsp;9, <img src="https://latex.codecogs.com/png.latex?%5C%7B%5Cmathbf%7Bq%7D_%7B1%7D,%5Cldots,%5Cmathbf%7Bq%7D_%7Bn%7D%5C%7D"> are linearly independent and hence form an orthonormal basis for <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BR%7D%5E%7Bn%7D">.</p>
</section>
<section id="quadratic-forms." class="level3">
<h3 class="anchored" data-anchor-id="quadratic-forms.">Quadratic Forms.</h3>
<p>An expression of the form:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bx%7D'A%5Cmathbf%7Bx%7D"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bx%7D"> is a <img src="https://latex.codecogs.com/png.latex?n%5Ctimes1"> column vector and <img src="https://latex.codecogs.com/png.latex?A"> is an <img src="https://latex.codecogs.com/png.latex?n%5Ctimes%20n"> matrix is called a quadratic form in <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bx%7D"> and</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0A%5Cmathbf%7Bx%7D'A%5Cmathbf%7Bx%7D%20&amp;%20=%5Csum_%7Bi=1%7D%5E%7Bn%7D%5Csum_%7Bj=1%7D%5E%7Bn%7Da_%7Bij%7Dx_%7Bi%7Dx_%7Bj%7D%5Cend%7Baligned%7D"></p>
<p>If <img src="https://latex.codecogs.com/png.latex?A"> and <img src="https://latex.codecogs.com/png.latex?B"> are <img src="https://latex.codecogs.com/png.latex?n%5Ctimes%20n"> and <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bx%7D,%5Cmathbf%7By%7D"> are <img src="https://latex.codecogs.com/png.latex?n">-vectors, then</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0A%5Cmathbf%7Bx%7D'(A+B)%5Cmathbf%7By%7D%20&amp;%20=%5Cmathbf%7Bx%7D'A%5Cmathbf%7By%7D+%5Cmathbf%7Bx%7D'B%5Cmathbf%7By%7D%5Cend%7Baligned%7D"></p>
<p>The quadratic form of the matrix <img src="https://latex.codecogs.com/png.latex?A"> is called positive definite if:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0A%5Cmathbf%7Bx%7D'A%5Cmathbf%7Bx%7D%20&amp;%20%3E0%5Cquad%5Ctext%7Bwhenever%20%7D%5Cmathbf%7Bx%7D%5Cneq%5Cmathbf%7B0%7D%5Cend%7Baligned%7D"></p>
<p>and positive semidefinite if:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0A%5Cmathbf%7Bx%7D'A%5Cmathbf%7Bx%7D%20&amp;%20%5Cgeq0%5Cquad%5Ctext%7Bwhenever%20%7D%5Cmathbf%7Bx%7D%5Cneq%5Cmathbf%7B0%7D%5Cend%7Baligned%7D"></p>
<p>Letting <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Be%7D_%7Bi%7D"> be the unit vector with its <img src="https://latex.codecogs.com/png.latex?i">th coordinate vector <img src="https://latex.codecogs.com/png.latex?1">, we have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0A%5Cmathbf%7Be%7D_%7Bi%7D'A%5Cmathbf%7Be%7D_%7Bi%7D%20&amp;%20=%5Cleft%5Ba_%7Bi1%7Da_%7Bi2%7D%5Cldots%20a_%7Bii%7D%5Cldots%20a_%7Bin%7D%5Cright%5D%5Cleft%5B%5Cbegin%7Barray%7D%7Bc%7D%0A0%5C%5C%0A0%5C%5C%0A%5Cvdots%5C%5C%0A1%5C%5C%0A%5Cvdots%5C%5C%0A0%0A%5Cend%7Barray%7D%5Cright%5D=a_%7Bii%7D%0A%5Cend%7Baligned%7D%0A"></p>
</section>
<section id="eigenthingies-and-diagonalizability." class="level3">
<h3 class="anchored" data-anchor-id="eigenthingies-and-diagonalizability.">Eigenthingies and diagonalizability.</h3>
<p>Let <img src="https://latex.codecogs.com/png.latex?V"> and <img src="https://latex.codecogs.com/png.latex?W"> be finite dimensional vector spaces with <img src="https://latex.codecogs.com/png.latex?dim(V)=n"> and <img src="https://latex.codecogs.com/png.latex?dim(W)=m">. A linear transformation <img src="https://latex.codecogs.com/png.latex?T:V%5Cto%20W">, is defined by its action on the basis vectors. Suppose:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0AT(%5Cmathbf%7Bv%7D_%7Bj%7D)%20&amp;%20=%5Csum_%7Bi=1%7D%5E%7Bn%7Da_%7Bij%7D%5Cmathbf%7Bw%7D_%7Bi%7D%0A%5Cend%7Baligned%7D%0A"></p>
<p>for all <img src="https://latex.codecogs.com/png.latex?1%5Cleq%20i%5Cleq%20m">.</p>
<p>Then, the matrix <img src="https://latex.codecogs.com/png.latex?A=%5BT%5D_%7B%5Cmathcal%7BB%7D_%7BV%7D%7D%5E%7B%5Cmathcal%7BB%7D_%7BW%7D%7D"> of the linear transformation is defined as:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0AA%20&amp;%20=%5Cleft%5B%5Cbegin%7Barray%7D%7Bcccc%7D%0Aa_%7B11%7D%20&amp;%20a_%7B12%7D%20&amp;%20%5Cldots%20&amp;%20a_%7B1n%7D%5C%5C%0Aa_%7B21%7D%20&amp;%20a_%7B22%7D%20&amp;%20%5Cldots%20&amp;%20a_%7B2n%7D%5C%5C%0A%5Cvdots%20&amp;%20%5Cvdots%20&amp;%20%5Cddots%20&amp;%20%5Cvdots%5C%5C%0Aa_%7Bm1%7D%20&amp;%20a_%7Bm2%7D%20&amp;%20%5Cldots%20&amp;%20a_%7Bmn%7D%0A%5Cend%7Barray%7D%5Cright%5D%5Cend%7Baligned%7D"></p>
<div id="def-diagonalizable" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 8 </strong></span>A linear transformation <img src="https://latex.codecogs.com/png.latex?T:V%5Cto%20V"> is said to be <strong>diagonalizable</strong> if there exists an ordered basis <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BB%7D=%5C%7B%5Cmathbf%7Bv%7D_%7B1%7D,%5Cldots,%5Cmathbf%7Bv%7D_%7Bn%7D%5C%7D"> for <img src="https://latex.codecogs.com/png.latex?V"> so that the matrix for <img src="https://latex.codecogs.com/png.latex?T"> with respect to <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BB%7D"> is diagonal. This means precisely that, for some scalars <img src="https://latex.codecogs.com/png.latex?%5Clambda_%7B1%7D,%5Clambda_%7B2%7D,%5Cldots,%5Clambda_%7Bn%7D">, we have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0AT(%5Cmathbf%7Bv%7D_%7B1%7D)%20&amp;%20=%5Clambda_%7B1%7D%5Cmathbf%7Bv%7D_%7B1%7D%5C%5C%0AT(%5Cmathbf%7Bv%7D_%7B2%7D)%20&amp;%20=%5Clambda_%7B2%7D%5Cmathbf%7Bv%7D_%7B2%7D%5C%5C%0A%5Cvdots%5C%5C%0AT(%5Cmathbf%7Bv%7D_%7Bn%7D)%20&amp;%20=%5Clambda_%7Bn%7D%5Cmathbf%7Bv%7D_%7Bn%7D%0A%5Cend%7Baligned%7D%0A"></p>
</div>
<p>In other words, if <img src="https://latex.codecogs.com/png.latex?A=%5BT%5D_%7B%5Cmathcal%7BB%7D%7D">, then we have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0AA%5Cmathbf%7Bv%7D_%7Bi%7D%20&amp;%20=%5Clambda_%7Bi%7D%5Cmathbf%7Bv%7D_%7Bi%7D%5Cend%7Baligned%7D"></p>
<p>Thus, if we let <img src="https://latex.codecogs.com/png.latex?P"> be the <img src="https://latex.codecogs.com/png.latex?n%5Ctimes%20n"> matrix whose columns are the vectors <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bv%7D_%7B1%7D,%5Cmathbf%7Bv%7D_%7B2%7D,%5Cldots,%5Cmathbf%7Bv%7D_%7Bn%7D"> and <img src="https://latex.codecogs.com/png.latex?%5CLambda"> be the <img src="https://latex.codecogs.com/png.latex?n%5Ctimes%20n"> diagonal matrix with diagonal entries <img src="https://latex.codecogs.com/png.latex?%5Clambda_%7B1%7D,%5Clambda_%7B2%7D,%5Cldots,%5Clambda_%7Bn%7D">, then we have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0AA%5Cleft%5B%5Cbegin%7Barray%7D%7Bcccc%7D%0A%5Cmathbf%7Bv%7D_%7B1%7D%20&amp;%20%5Cmathbf%7Bv%7D_%7B2%7D%20&amp;%20%5Cldots%20&amp;%20%5Cmathbf%7Bv%7D_%7Bn%7D%5Cend%7Barray%7D%5Cright%5D%20&amp;%20=%5Cleft%5B%5Cbegin%7Barray%7D%7Bcccc%7D%0A%5Cmathbf%7Bv%7D_%7B1%7D%20&amp;%20%5Cmathbf%7Bv%7D_%7B2%7D%20&amp;%20%5Cldots%20&amp;%20%5Cmathbf%7Bv%7D_%7Bn%7D%5Cend%7Barray%7D%5Cright%5D%5Cleft%5B%5Cbegin%7Barray%7D%7Bcccc%7D%0A%5Clambda_%7B1%7D%5C%5C%0A&amp;%20%5Clambda_%7B2%7D%5C%5C%0A&amp;%20%20&amp;%20%5Cddots%5C%5C%0A&amp;%20%20&amp;%20%20&amp;%20%5Clambda_%7Bn%7D%0A%5Cend%7Barray%7D%5Cright%5D%5C%5C%0AAP%20&amp;%20=P%5CLambda%5C%5C%0AA%20&amp;%20=P%5CLambda%20P%5E%7B-1%7D%5Cend%7Baligned%7D"></p>
<p>There exists a large class of diagonalizable matrices - the symmetric matrices. A square matrix <img src="https://latex.codecogs.com/png.latex?A"> is symmetric, if <img src="https://latex.codecogs.com/png.latex?A=A'">.</p>
<div id="def-eigenvector" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 9 (Eigenvectors) </strong></span>Let <img src="https://latex.codecogs.com/png.latex?T:V%5Cto%20V"> be a linear transformation. A <strong>non-zero</strong> vector <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bv%7D%5Cin%20V"> is called the eigenvector of <img src="https://latex.codecogs.com/png.latex?T">, if there is a scalar <img src="https://latex.codecogs.com/png.latex?%5Clambda"> so that <img src="https://latex.codecogs.com/png.latex?T(%5Cmathbf%7Bv%7D)=%5Clambda%5Cmathbf%7Bv%7D">. The scalar <img src="https://latex.codecogs.com/png.latex?%5Clambda"> is called the eigenvalue of <img src="https://latex.codecogs.com/png.latex?T">.</p>
</div>


</section>
</section>
</section>

 ]]></description>
  <category>Fin Math</category>
  <guid>http://quantdev.blog/posts/gaussian-processes/index.html</guid>
  <pubDate>Sat, 18 Oct 2025 23:00:00 GMT</pubDate>
  <media:content url="http://quantdev.blog/posts/gaussian-processes/image.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>A short note on the Dupire PDE</title>
  <dc:creator>Quasar </dc:creator>
  <link>http://quantdev.blog/posts/dupire-pde/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>If the Black-Scholes model were good, the implied volatility <img src="https://latex.codecogs.com/png.latex?%5Chat%7B%5Csigma%7D"> parameter would be the same for all call option market prices. However, in reality, Black-Scholes implied volatility depends strongly on strike <img src="https://latex.codecogs.com/png.latex?K">, and maturity <img src="https://latex.codecogs.com/png.latex?T">.</p>
<p>In Dupires 1993 paper, he proposes the following dynamics for the spot process:</p>
<p><span id="eq-local-volatility-model"><img src="https://latex.codecogs.com/png.latex?%0AdS_t%20=%20r(t)S_t%20dt%20+%20%5Csigma_%7BLV%7D(t,%20S_t)%20S_t%20dW_t%5E%7BQ%7D%0A%5Ctag%7B1%7D"></span></p>
<p>where <img src="https://latex.codecogs.com/png.latex?%5Csigma_%7BLV%7D(t,S_t)"> is a deterministic function of the variables <img src="https://latex.codecogs.com/png.latex?(S_t,t)">.</p>
<p>The function <img src="https://latex.codecogs.com/png.latex?%5Csigma_%7BLV%7D(t,s)"> such that the call option prices are given by the model in Equation&nbsp;1 coinicide with the market option prices <img src="https://latex.codecogs.com/png.latex?%5Chat%7BC%7D(K,T)"> is called <strong>local volatility</strong>.</p>
</section>
<section id="derivation-of-the-dupire-pde" class="level1">
<h1>Derivation of the Dupire PDE</h1>
<p>Recall, that the Fokker-Planck PDE describes the dynamics of the transition probability density forward in time. We represent the transition probability density function by <img src="https://latex.codecogs.com/png.latex?p(x,t)">. Were we to be more rigorous, we should write <img src="https://latex.codecogs.com/png.latex?p(x,t%7Cx_0,%20t_0)">. The call option price has a similar representation. It is a function of strike <img src="https://latex.codecogs.com/png.latex?K"> and expiration <img src="https://latex.codecogs.com/png.latex?T">, given the current spot value <img src="https://latex.codecogs.com/png.latex?S_t"> and current time <img src="https://latex.codecogs.com/png.latex?t">. So, its a function <img src="https://latex.codecogs.com/png.latex?C(K,T%20%7C%20S_t,%20t)">; we can suppress the variables <img src="https://latex.codecogs.com/png.latex?(S_t,%20t)"> and write <img src="https://latex.codecogs.com/png.latex?C(K,T)">. This is standard terminology in the industry.</p>
<p>The call option payoff at maturity <img src="https://latex.codecogs.com/png.latex?T"> is given by:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0AC(K,T%7CS_T,T)%20=%20(S_T%20-%20K)%5E%7B+%7D%0A%5Cend%7Baligned%7D%0A"></p>
<p>We cant exactly apply Itos formula, but there is the Tanaka-Meyer formula - an implication of which is that we can use Itos lemma for the absolute value function and the maximum function.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0Ad(S_T%20-%20K)%5E%7B+%7D%20&amp;=%20%5Cfrac%7B%5Cpartial%20%7D%7B%5Cpartial%20S_T%7D(S_T%20-%20K)%5E%7B+%7DdS_T%20+%20%5Cfrac%7B1%7D%7B2%7D%5Cfrac%7B%5Cpartial%5E2%7D%7B%5Cpartial%20S_T%5E2%7D%20(S_T%20-%20K)%5E%7B+%7D%20dS_T%5E2%0A%5Cend%7Baligned%7D%0A"></p>
<p>We can write:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20S_T%7D(S_T%20-%20K)%5E%7B+%7D%20=%201_%7BS_T%20%3E%20K%7D%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20S_T%7D%20(S_T%20-%20K)%20=%201_%7BS_T%20%3E%20K%7D%0A%5Cend%7Balign*%7D%0A"></p>
<p>Now, we calculate the second derivative:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%5E2%20S_T%7D(S_T%20-%20K)%5E%7B+%7D%20=%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20S_T%7D%201_%7BS_T%20%3E%20K%7D%20=%20%5Cdelta(S_T%20-%20K)%0A%5Cend%7Balign*%7D%0A"></p>
<p>The indicator function goes from <img src="https://latex.codecogs.com/png.latex?0"> to <img src="https://latex.codecogs.com/png.latex?1"> at <img src="https://latex.codecogs.com/png.latex?K">, so the derivative at <img src="https://latex.codecogs.com/png.latex?K"> is <img src="https://latex.codecogs.com/png.latex?%5Cinfty"> and <img src="https://latex.codecogs.com/png.latex?0"> otherwise, and this is basically the definition of the Dirac-Delta function. Now, we can substitute these derivatives into the Tanaka formula and get:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0Ad(S_T%20-%20K)%5E%7B+%7D%20&amp;=%201_%7BS_T%20%3E%20K%7D%20dS_T%20+%20%5Cfrac%7B1%7D%7B2%7D%5Cdelta(S_T%20-%20K)dS_T%5E2%0A%5Cend%7Balign*%7D%0A"></p>
<p>Next, lets calculate the partial derivatives of the payoff with respect to <img src="https://latex.codecogs.com/png.latex?K">. We have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20K%7D(S_T%20-%20K)%5E%7B+%7D%20=%201_%7BS_T%20%3E%20K%7D%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20K%7D%20(S_T%20-%20K)%20=%20-1_%7BS_T%20%3E%20K%7D%0A%5Cend%7Balign*%7D%0A"></p>
<p>Differentiating this result again with respect to <img src="https://latex.codecogs.com/png.latex?K">:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cfrac%7B%5Cpartial%5E2%7D%7B%5Cpartial%20K%5E2%7D%20(S_T%20-%20K)%5E%7B+%7D%20&amp;=%20-%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20K%7D%201_%7BS_T%20%3E%20K%7D%20%5C%5C%0A&amp;=%20-%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20K%7D1_%7BS_T%20-%20K%20%3E%200%7D%20%5C%5C%0A&amp;=%20-%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20K%7DH(S_T%20-%20K)%0A%5Cend%7Balign*%7D%0A"></p>
<p>Define <img src="https://latex.codecogs.com/png.latex?y%20=%20(S_T%20-%20K)">. We have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cfrac%7B%5Cpartial%5E2%7D%7B%5Cpartial%20K%5E2%7D%20(S_T%20-%20K)%5E%7B+%7D%20&amp;=%20%20-%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20K%7DH(S_T%20-%20K)%20%5C%5C%0A&amp;=-%5Cfrac%7B%5Cpartial%20H(y)%7D%7B%5Cpartial%20y%7D%5Ccdot%20%5Cfrac%7B%5Cpartial%20y%7D%7B%5Cpartial%20K%7D%5C%5C%0A&amp;=-%5Cdelta(y)%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20K%7D(S_T%20-%20K)%5C%5C%0A&amp;=%5Cdelta(S_T%20-%20K)%0A%5Cend%7Balign*%7D%0A"></p>
<p>Now, substituting for <img src="https://latex.codecogs.com/png.latex?dS_T"> and <img src="https://latex.codecogs.com/png.latex?dS_T%5E2"> in Itos lemma, we have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0Ad(S_T%20-%20K)%5E%7B+%7D%20&amp;=%201_%7BS_T%20%3E%20K%7D(rS_T%20dT%20+%20%5Csigma(S_T,%20T)S_TdW_T)%20+%20%5Cfrac%7B1%7D%7B2%7D%5Cdelta(S_T%20-%20K)%20%5Csigma(S_T,T)%5E2%20S_T%5E2%20dT%5C%5C%0A&amp;=%20%5Cleft(rS_T%201_%7BS_T%20%3E%20K%7D%20+%20%5Cfrac%7B1%7D%7B2%7D%5Cdelta(S_T%20-%20K)%5Csigma(S_T,T)%5E2%20S_T%5E2%20%5Cright)dT%20+%201_%7BS_T%20%3E%20K%7D%20%5Csigma(S_T,%20T)%20S_T%20dW_T%0A%5Cend%7Balign*%7D%0A"></p>
<p>Taking expectations on both sides, the <img src="https://latex.codecogs.com/png.latex?dB_T"> becomes zero. So, we have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cmathbb%7BE%7D%5E%7B%5Cmathbb%7BQ%7D%7D%5Cleft%5Bd(S_T%20-%20K)%5E%7B+%7D%5Cright%5D%20=%5Cmathbb%7BE%7D%5E%7BQ%7D%5Cleft%5BrS_T1_%7BS_T%20%3E%20K%7D%20+%20%5Cfrac%7B1%7D%7B2%7D%5Csigma(S_T,T)%5E2%20S_T%5E2%5Cright%5DdT%0A%5Cend%7Balign*%7D%0A"></p>
<p>We are left with just the <img src="https://latex.codecogs.com/png.latex?dT"> term. Now, we can shift <img src="https://latex.codecogs.com/png.latex?dT"> to the LHS (interchange expectation and the derivative) to get:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20T%7D%5Cmathbb%7BE%7D%5E%7BQ%7D%5Cleft%5Bd(S_T%20-%20K)%5E%7B+%7D%5Cright%5D%20&amp;=%5Cmathbb%7BE%7D%5E%7BQ%7D%5Cleft%5BrS_T1_%7BS_T%20%3E%20K%7D%20+%20%5Cfrac%7B1%7D%7B2%7D%5Csigma(S_T,T)%5E2%20S_T%5E2%5Cright%5D%5C%5C%0A&amp;=%20rS_T%20%5Cmathbb%7BE%7D%5E%7BQ%7D%5Cleft%5B1_%7BS_T%20%3E%20K%7D%5Cright%5D%20+%20%5Cfrac%7B1%7D%7B2%7D%5Cmathbb%7BE%7D%5E%7BQ%7D%5Cleft%5B%5Csigma(S_T,T)%5E2%20S_T%5E2%5Cright%5D%0A%5Cend%7Balign*%7D%0A"></p>
<p>Lets try to express the first term on the RHS by the call option price. We can write the payoff as:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A(S_T%20-%20K)1_%7BS_T%20%3E%20K%7D%20%20=%20S_T%201_%7BS_T%20%3E%20K%7D%20-%20K%201_%7BS_T%20%3E%20K%7D%0A%5Cend%7Balign*%7D%0A"></p>
<p>Now, we can rearrange the terms to get what we want:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0AS_T1_%7BS_T%20%3E%20K%7D%20=%20(S_T%20-%20K)%201_%7BS_T%20%3E%20K%7D%20+%20K1_%7BS_T%20%3E%20K%7D%0A%5Cend%7Balign*%7D%0A"></p>
<p>We now take expectation on both sides, so we get:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cmathbb%7BE%7D%5EQ%5BS_T%201_%7BS_T%20%3E%20K%7D%5D%20&amp;=%20%5Cmathbb%7BE%7D%5E%7BQ%7D%5B(S_T%20-%20K)1_%7BS_T%20%3E%20K%7D%5D%20+%20K%5Cmathbb%7BE%7D%5E%7BQ%7D%5B1_%7BS_T%20%3E%20K%7D%5D%0A%5Cend%7Balign*%7D%0A"></p>
<p>Recall that:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0AC_%7BK,T%7D%20&amp;=%20e%5E%7B-rT%7D%20%5Cmathbb%7BE%7D%5E%7BQ%7D%5B(S_T%20-%20K)1_%7BS_T%20%3E%20K%7D%5D%20%5C%5C%0A%5Cimplies%20e%5E%7BrT%7D%20C(K,T)%20&amp;=%20%5Cmathbb%7BE%7D%5E%7BQ%7D%5B(S_T%20-%20K)1_%7BS_T%20%3E%20K%7D%5D%0A%5Cend%7Balign*%7D%0A"></p>
<p>So, our first expression is then the undiscounted value of the call option. Now, the second expression has got the indicator or the heavyside function, which we know is the derivative of the payoff. Lets reproduce the risk-neutral valuation formula.</p>
<p><span id="eq-first-derivative-wrt-strike"><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20K%7D%20C_%7BK,T%7D%20&amp;=%20e%5E%7B-rT%7D%20%5Cmathbb%7BE%7D%5E%7BQ%7D%5Cleft%5B%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20K%7D%20(S_T%20-%20K)%5E%7B+%7D%5Cright%5D%5C%5C%0A&amp;=%20-%20e%5E%7B-rT%7D%20%5Cmathbb%7BE%7D%5E%7BQ%7D%5B1_%7BS_T%20%3E%20K%7D%5D%0A%5Cend%7Balign*%7D%0A%5Ctag%7B2%7D"></span></p>
<p>So, we can replace the second expectation term <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%5E%7BQ%7D%5B1_%7BS_T%20%3E%20K%7D%5D"> by <img src="https://latex.codecogs.com/png.latex?-e%5E%7BrT%7D%5Cfrac%7B%5Cpartial%20C_%7BK,T%7D%7D%7B%5Cpartial%20K%7D">. So, we have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cmathbb%7BE%7D%5EQ%5BS_T%201_%7BS_T%20%3E%20K%7D%5D%20&amp;=%20e%5E%7BrT%7DC(K,T)%20-%20Ke%5E%7BrT%7D%5Cfrac%7B%5Cpartial%20C%7D%7B%5Cpartial%20K%7D%0A%5Cend%7Balign*%7D%0A"></p>
<p>Lets move to the second expectation term:</p>
<p><span id="eq-primary-expression-2"><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20T%7D%5Cmathbb%7BE%7D%5E%7BQ%7D%5Cleft%5Bd(S_T%20-%20K)%5E%7B+%7D%5Cright%5D%20&amp;=%20re%5E%7BrT%7DC(K,T)%20-%20rKe%5E%7BrT%7D%5Cfrac%7B%5Cpartial%20C%7D%7B%5Cpartial%20K%7D%20+%20%5Cfrac%7B1%7D%7B2%7D%5Cmathbb%7BE%7D%5EQ%5Cleft%5B%5Csigma(T,S_T)%5E2%20S_T%5E2%20%5Cdelta(S_T%20-%20K)%5Cright%5D%0A%5Cend%7Balign*%7D%0A%5Ctag%7B3%7D"></span></p>
<p>We know that:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cmathbb%7BE%7D%5BX%20%7C%20Y=y_0%5D%20&amp;=%20%5Cint_%7B-%5Cinfty%7D%5E%7B%5Cinfty%7D%20x%20f_%7BX%7CY=y_0%7D(x)%20dx%5C%5C%0A&amp;=%5Cint_%7B%5Cmathbb%7BR%7D%7D%20x%20%5Cfrac%7Bf_%7BX,Y%7D(x,y_0)%7D%7Bf_Y(y_0)%7D%20dx%5C%5C%0A&amp;=%20%5Cint_%7B%5Cmathbb%7BR%7D%7D%20x%20%5Cfrac%7B%5Cint_%7B%5Cmathbb%7BR%7D%7D1_%7BY=y_0%7Df_%7BX,Y%7D(x,y)dy%7D%7Bf_Y(y_0)%7D%20dx%5C%5C%0A&amp;=%20%5Cfrac%7B%5Cint%5Cint_%7B%5Cmathbb%7BR%7D%5E2%7Dxf_%7BX,Y%7D(x,y)%5Ccdot%201_%7BY=y_0%7Ddx%20dy%7D%7B%5Cint_%7BR%7Df_%7BX,Y%7D(x,y_0)%20dx%7D%5C%5C%0A&amp;=%20%5Cfrac%7B%5Cint%5Cint_%7B%5Cmathbb%7BR%7D%5E2%7Dxf_%7BX,Y%7D(x,y)%5Ccdot%201_%7BY=y_0%7Ddx%20%5Ccdot%20dy%7D%7B%5Cint%20%5Cint_%7B%5Cmathbb%7BR%7D%5E2%7D1_%7BY=y_0%7D%20%5Ccdot%20f_%7BX,Y%7D(x,y)%20dx%20%5Ccdot%20dy%7D%5C%5C%0A&amp;=%20%5Cfrac%7B%5Cmathbb%7BE%7D%5BX%5Ccdot%201_%7BY=y_0%7D%5D%7D%7B%5Cmathbb%7BE%7D%5B1_%7BY=y_0%7D%5D%7D%0A%5Cend%7Balign*%7D%0A"></p>
<p>So,</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cmathbb%7BE%7D%5BX%20%7C%20Y=y_0%5D%20%5Ccdot%20%5Cmathbb%7BE%7D%5B1_%7BY=y_0%7D%5D%20=%20%5Cmathbb%7BE%7D%5BX%5Ccdot%201_%7BY=y_0%7D%5D%0A"></p>
<p>Using this result, we may write:</p>
<p><span id="eq-intermediate-result-1"><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cmathbb%7BE%7D%5EQ%20%5B%5Csigma(T,S_T)%5E2%20S_T%5E2%20%5Cdelta(S_T%20-%20K)%5D%20&amp;=%20%5Cmathbb%7BE%7D%5EQ%5B%5Csigma(T,S_T)%5E2%20S_T%5E2%20%7C%20S_T%20=%20K%5D%20%5Ccdot%20%5Cmathbb%7BE%7D%5EQ%5B%5Cdelta(S_T%20-%20K)%5D%5C%5C%0A&amp;=%20K%5E2%20%5Cmathbb%7BE%7D%5EQ%5B%5Csigma(T,S_T)%5E2%20%7C%20S_T%20=%20K%5D%20%20%5Ccdot%20%5Cmathbb%7BE%7D%5EQ%5B%5Cdelta(S_T%20-%20K)%5D%0A%5Cend%7Balign*%7D%0A%5Ctag%7B4%7D"></span></p>
<p>Now, taking the second derivative of the call option price with respect to the strike <img src="https://latex.codecogs.com/png.latex?K">, we have:</p>
<p><span id="eq-second-derivative-wrt-strike"><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0AC_%7BK,T%7D%20&amp;=%20e%5E%7B-rT%7D%5Cmathbb%7BE%7D%5EQ%5B(S_T%20-%20K)%5E%7B+%7D%5D%5C%5C%0A%5Cfrac%7B%5Cpartial%5E2%20C%7D%7B%5Cpartial%20K%5E2%7D%20%20&amp;=%20e%5E%7B-rT%7D%5Cmathbb%7BE%7D%5EQ%5Cleft%5B%5Cfrac%7B%5Cpartial%5E2%7D%7B%5Cpartial%20K%5E2%7D%20(S_T%20-%20K)%5E%7B+%7D%5Cright%5D%5C%5C%0A&amp;=%20e%5E%7B-rT%7D%20%5Cmathbb%7BE%7D%5EQ%5B%5Cdelta(S_T%20-%20K)%5D%5C%5C%0Ae%5E%7BrT%7D%5Cfrac%7B%5Cpartial%5E2%20C_%7BK,T%7D%7D%7B%5Cpartial%20K%5E2%7D%20&amp;=%20%5Cmathbb%7BE%7D%5EQ%5B%5Cdelta(S_T%20-%20K)%5D%0A%5Cend%7Balign*%7D%0A%5Ctag%7B5%7D"></span></p>
<p>So, the second expression in the RHS of Equation&nbsp;4 becomes:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cmathbb%7BE%7D%5EQ%20%5B%5Csigma(T,S_T)%5E2%20S_T%5E2%20%5Cdelta(S_T%20-%20K)%5D%20%20&amp;=%20K%5E2%20%5Cmathbb%7BE%7D%5EQ%5B%5Csigma(T,S_T)%5E2%20%7C%20S_T%20=%20K%5D%20%20%5Ccdot%20%5Cmathbb%7BE%7D%5EQ%5B%5Cdelta(S_T%20-%20K)%5D%20%5C%5C%0A&amp;=%20K%5E2%20%5Cmathbb%7BE%7D%5EQ%5B%5Csigma(T,S_T)%5E2%20%7C%20S_T%20=%20K%5D%20%20%5Ccdot%20e%5E%7BrT%7D%20%5Cfrac%7B%5Cpartial%5E2%20C%7D%7B%5Cpartial%20K%5E2%7D%0A%5Cend%7Balign*%7D%0A"></p>
<p>So, our primary expression in Equation&nbsp;3 becomes:</p>
<p><span id="eq-time-derivative"><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20T%7D%5Cmathbb%7BE%7D%5EQ%5B(S_T%20-%20K)%5E+%5D%20&amp;=%20re%5E%7BrT%7D%20C(K,T)%20-%20rKe%5E%7BrT%7D%20%5Cfrac%7B%5Cpartial%20C%7D%7B%5Cpartial%20K%7D%20%5C%5C&amp;+%20%5Cfrac%7B1%7D%7B2%7DK%5E2%20%5Cmathbb%7BE%7D%5EQ%5B%5Csigma(T,S_T)%5E2%20%7C%20S_T%20=%20K%5D%20%20%5Ccdot%20e%5E%7BrT%7D%20%5Cfrac%7B%5Cpartial%5E2%20C%7D%7B%5Cpartial%20K%5E2%7D%0A%5Cend%7Balign*%7D%0A%5Ctag%7B6%7D"></span></p>
<p>Let <img src="https://latex.codecogs.com/png.latex?C%5Eu(K,T%7CS,t)"> denote the undiscounted call option price. Since <img src="https://latex.codecogs.com/png.latex?C%5Eu(K,T%7CS,t)%20=%20%5Cmathbb%7BE%7D%5EQ%5B(S_T%20-%20K)%5E%7B+%7D%5D">, we can write the above PDE as:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cfrac%7B%5Cpartial%20C%5Eu_%7BK,T%7D%7D%7B%5Cpartial%20T%7D&amp;=%20rC%5Eu_%7BK,T%7D%20-%20rK%20%5Cfrac%7B%5Cpartial%20C%5Eu_%7BK,T%7D%7D%7B%5Cpartial%20K%7D%20%5C%5C&amp;+%20%5Cfrac%7B1%7D%7B2%7DK%5E2%20%5Cmathbb%7BE%7D%5EQ%5B%5Csigma(T,S_T)%5E2%20%7C%20S_T%20=%20K%5D%20%20%5Ccdot%20%5Cfrac%7B%5Cpartial%5E2%20C%5Eu_%7BK,T%7D%7D%7B%5Cpartial%20K%5E2%7D%0A%5Cend%7Balign*%7D%0A"></p>
<p>Rearranging we have:</p>
<p><span id="eq-dupire-formula-in-terms-of-undiscounted-call-option-price-1"><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cmathbb%7BE%7D%5EQ%5B%5Csigma(T,%20S_T)%5E2%20%7C%20S_T%20=%20K%5D%0A=%20%5Cfrac%7B%5Cfrac%7B%5Cpartial%20C%5Eu_%7BK,T%7D%7D%7B%5Cpartial%20T%7D%20+%20rK%5Cfrac%7B%5Cpartial%20C%5Eu_%7BK,T%7D%7D%7B%5Cpartial%20K%7D%20-%20rC%5Eu_%7BK,T%7D%7D%7B%5Cfrac%7B1%7D%7B2%7DK%5E2%20%5Cfrac%7B%5Cpartial%5E2%20C%5Eu_%7BK,T%7D%7D%7B%5Cpartial%20K%5E2%7D%7D%0A%5Cend%7Balign*%7D%0A%5Ctag%7B7%7D"></span></p>
<p><img src="https://latex.codecogs.com/png.latex?%5Csigma%5E2(S_T,%20T)"> is the instantaneous variance at <img src="https://latex.codecogs.com/png.latex?(S_T,T)">. We can write its conditional expectation as a function of the variables <img src="https://latex.codecogs.com/png.latex?(K,T)">, since it is an integral over the state space of <img src="https://latex.codecogs.com/png.latex?S_T">, so <img src="https://latex.codecogs.com/png.latex?S_T"> is integrated out and we will have a function of <img src="https://latex.codecogs.com/png.latex?K"> for each <img src="https://latex.codecogs.com/png.latex?T">.</p>
<section id="the-theory-of-local-volatility" class="level3">
<h3 class="anchored" data-anchor-id="the-theory-of-local-volatility">The theory of local volatility</h3>
<div id="def-local-volatility" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 1 (Local Volatility) </strong></span>The local variance <img src="https://latex.codecogs.com/png.latex?%5Csigma_%7BK,T%7D%5E2(S_t,t)"> is defined as the reisk-neutral expectation of the squared instantaneous volatility at <img src="https://latex.codecogs.com/png.latex?(S_T,T)"> conditional on <img src="https://latex.codecogs.com/png.latex?S_T%20=%20K"> and time <img src="https://latex.codecogs.com/png.latex?t"> information <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BF%7D_t">:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cboxed%7B%5Csigma_%7BK,T%7D%5E2(S_t,t)%20%5Cstackrel%7Bdef%7D%7B=%7D%20%5Cmathbf%7BE%7D%5E%7BQ%7D%5B%5Csigma%5E2(S_T,T,%5Ccdot)%7CS_T%20=%20K,%20%5Cmathcal%7BF%7D_t%5D=%20%5Cint_%7B-%5Cinfty%7D%5E%7B%5Cinfty%7D%20%5Csigma(s,T)%5E2%20f_%7BS_T%7CS_T%20=%20K%7D(s)%20ds%7D%0A"></p>
<p>Then local volatility is given by:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Csigma_%7BK,T%7D%20%5Cstackrel%7Bdef%7D%7B=%7D%20%5Csqrt%7B%5Csigma_%7BK,T%7D%5E2(S_t,t)%7D%0A"></p>
</div>
<p>Thus, intuitively, we can think of the local volatility <img src="https://latex.codecogs.com/png.latex?%5Csigma_%7BK,T%7D(S_t,t)"> is the markets consensus for instantaneous volatility for a market level <img src="https://latex.codecogs.com/png.latex?K"> at some future date <img src="https://latex.codecogs.com/png.latex?T">. Since, it is implied from the observed option prices, the LVS gives the fair value of the asset price volatility for future market levels and times.</p>
<p>This definition of local volatility has two implications: first, the use markets view on future volatility expressed by the expectation operator clarifies that all sources of risk from stochastic volatility are integrated out. Instead, the evolution of volatility is compressed into a single funtion that is deterministic in <img src="https://latex.codecogs.com/png.latex?S_t,t">.</p>
<p>To put it differently, the concept of local volatility assumes</p>
<p>So, we have:</p>
<p><span id="eq-dupire-formula-in-terms-of-undiscounted-call-option-price"><img src="https://latex.codecogs.com/png.latex?%0A%5Cboxed%7B%0A%20%20%20%20%5Csigma_%7BLV%7D%5E2(K,T)%20=%20%5Cfrac%7B%5Cfrac%7B%5Cpartial%20C%5Eu_%7BK,T%7D%7D%7B%5Cpartial%20T%7D%20+%20rK%5Cfrac%7B%5Cpartial%20C%5Eu_%7BK,T%7D%7D%7B%5Cpartial%20K%7D%20-%20rC%5Eu_%7BK,T%7D%7D%7B%5Cfrac%7B1%7D%7B2%7DK%5E2%20%5Cfrac%7B%5Cpartial%5E2%20C%5Eu_%7BK,T%7D%7D%7B%5Cpartial%20K%5E2%7D%7D%0A%7D%0A%5Ctag%7B8%7D"></span></p>
<p>We can also relabel the parameters to define the function in terms of time <img src="https://latex.codecogs.com/png.latex?t"> and stock price <img src="https://latex.codecogs.com/png.latex?S">:</p>
<p><span id="eq-dupire-formula-in-time-and-stock-price-terms"><img src="https://latex.codecogs.com/png.latex?%0A%5Cboxed%7B%0A%20%20%20%20%5Cmathbb%7BE%7D%5EQ%5B%5Csigma(t,%20S)%5E2%20%7C%20S_t%20=%20S%5D%20=%20%5Csigma_%7BLV%7D%5E2(K,T)%20%7C_%7BK=S,%20T=t%7D%20=%5Cleft.%5Cfrac%7B%5Cfrac%7B%5Cpartial%20C%5Eu_%7BK,T%7D%7D%7B%5Cpartial%20T%7D%20+%20rK%5Cfrac%7B%5Cpartial%20C%5Eu_%7BK,T%7D%7D%7B%5Cpartial%20K%7D%20-%20rC%5Eu_%7BK,T%7D%7D%7B%5Cfrac%7B1%7D%7B2%7DK%5E2%20%5Cfrac%7B%5Cpartial%5E2%20C%5Eu_%7BK,T%7D%7D%7B%5Cpartial%20K%5E2%7D%7D%5Cright%5Cvert_%7BK=S,T=t%7D%0A%7D%0A%5Ctag%7B9%7D"></span></p>
</section>
<section id="digression---breeden-litzenberger-formula" class="level2">
<h2 class="anchored" data-anchor-id="digression---breeden-litzenberger-formula">Digression - Breeden-Litzenberger Formula</h2>
<p>Assume that <img src="https://latex.codecogs.com/png.latex?(S_t,t%5Cgeq%200)"> is a markov process with the density <img src="https://latex.codecogs.com/png.latex?p(t,s,T,S_T)"> conditioned on <img src="https://latex.codecogs.com/png.latex?S_t%20=%20s">. Then:</p>
<p><span id="eq-first-derivative-of-call-option-price"><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0AC(s,t,T,K)%20&amp;=%20e%5E%7B-r(T-t)%7D%5Cint_0%5E%5Cinfty%20p(t,s,T,S_T)%20(S_T%20-%20K)%5E%7B+%7D%20dS_T%20%5C%5C%0A&amp;=%20%20e%5E%7B-r(T-t)%7D%5Cint_K%5E%5Cinfty%20p(t,s,T,y)%20(y%20-%20K)%20dy%20%5C%5C%0A%5Cend%7Balign*%7D%0A%5Ctag%7B10%7D"></span></p>
<p>Differentiating with respect to <img src="https://latex.codecogs.com/png.latex?K">, we have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cfrac%7B%5Cpartial%20C%7D%7B%5Cpartial%20K%7D%20&amp;=%20e%5E%7B-r(T-t)%7D%5Cleft%5B%5Cleft.p(t,s,T,y)%20(y%20-%20K)%5Cright%5Cvert_%7By=%5Cinfty%7D%20-%20%5Cleft.p(t,s,T,y)%20(y%20-%20K)%5Cright%5Cvert_%7By=K%7D%20+%20%5Cint_%7BK%7D%5E%5Cinfty%20p(t,s,T,y)%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20K%7D(y-k)dy%5Cright%5D%20%5C%5C%0A&amp;=%20-e%5E%7B-r(T-t)%7D%20%5Cint_%7BK%7D%5E%5Cinfty%20p(t,s,T,y)%20dy%0A%5Cend%7Balign*%7D%0A"></p>
<p>Differentiating again with respect to <img src="https://latex.codecogs.com/png.latex?K"> and applying the Leibnitz rule:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cfrac%7B%5Cpartial%5E2%20C%7D%7B%5Cpartial%20K%5E2%7D%20&amp;=%20-%20e%5E%7B-r(T-t)%7D%20%5B%20p(t,s,T,y)%7C_%7By=%5Cinfty%7D%20-%20%20p(t,s,T,y)%7C_%7By=K%7D%5D%5C%5C%0A&amp;=%20e%5E%7B-r(T-t)%7Dp(t,s,T,K)%0A%5Cend%7Balign*%7D%0A"></p>
<p>Finally, we have:</p>
<p><span id="eq-breeden-litzenberger-formula"><img src="https://latex.codecogs.com/png.latex?%0A%5Cboxed%7B%5Cfrac%7B%5Cpartial%5E2%20C%7D%7B%5Cpartial%20K%5E2%7D%20=%20e%5E%7B-r(T-t)%7Dp(t,s,T,K)%7D%0A%5Ctag%7B11%7D"></span></p>
<p><a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2642349">Breeden &amp; Litzenberger(1978)</a>, showed that this second-order partial derivative can be used to approximate the option-implied risk-neutral probability that the underlying asset price <img src="https://latex.codecogs.com/png.latex?S"> will be equal to the strike <img src="https://latex.codecogs.com/png.latex?K"> at maturity.</p>
</section>
<section id="no-arbitrage-conditions" class="level2">
<h2 class="anchored" data-anchor-id="no-arbitrage-conditions">No-arbitrage conditions</h2>
<p>The volatility surface, or equivalently the Call prices surface cannot have any arbitrary shape. Peter Carr has shown that static arbitrage is avoided in a set of option prices, if the calendar spread and butterfly spread arbitrages are avoided.</p>
<section id="calendar-spread-condition" class="level3">
<h3 class="anchored" data-anchor-id="calendar-spread-condition">Calendar spread condition</h3>
<p>Calendar spread arbitrage is usually expressed as the monotonicity of the European call option prices <img src="https://latex.codecogs.com/png.latex?C"> with respect to the maturity <img src="https://latex.codecogs.com/png.latex?T">. I closely follow the derivation in <a href="https://core.ac.uk/reader/6978470">Fengler(2005)</a>.</p>
<div id="prp-calendar-spread" class="theorem proposition">
<p><span class="theorem-title"><strong>Proposition 1 (Calendar Arbitrage) </strong></span>Define forward-moneyness <img src="https://latex.codecogs.com/png.latex?k%20%5Cstackrel%7Bdef%7D%7B=%7D%20K/F(t,T)">, where the forward price is given by <img src="https://latex.codecogs.com/png.latex?F(t,T)%20=%20S_t%20e%5E%7B%5Cint_t%5ET%20r(u)du%7D"> and total variance as <img src="https://latex.codecogs.com/png.latex?%5Cnu%5E2(k,%5Ctau)%20=%20%5Chat%7B%5Csigma%7D%5E2(k,%5Ctau)%5Ctau">.</p>
<p>If <img src="https://latex.codecogs.com/png.latex?%5Cnu%5E2(k,%5Ctau_i)"> is a strictly increasing function of <img src="https://latex.codecogs.com/png.latex?%5Ctau_i%20=%20T_i%20-%20t">, <img src="https://latex.codecogs.com/png.latex?i=1,2">, there is no calendar arbitrage.</p>
</div>
<p><em>Proof.</em></p>
<p>Given two expiry dates <img src="https://latex.codecogs.com/png.latex?t%20%3C%20T_1%20%3C%20T_2">, construct in <img src="https://latex.codecogs.com/png.latex?t">, the following calendar spread in two calls with the same forward-moneyness: a long position in a call <img src="https://latex.codecogs.com/png.latex?C_t(K_2,%20T_2)"> and a short position in <img src="https://latex.codecogs.com/png.latex?C_t(K_1,T_1)"> call. The forward-moneyness requirement implies that:</p>
<p><span id="eq-forward-moneyness-condition"><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cfrac%7BK_1%7D%7BF(t,T_1)%7D%20&amp;=%20%5Cfrac%7BK_2%7D%7BF(t,T_2)%7D%5C%5C%0AK_1%20&amp;=%20e%5E%7B-%5Cint_%7BT_1%7D%5E%7BT_2%7Dr(u)du%7D%20K_2%0A%5Cend%7Balign*%7D%0A%5Ctag%7B12%7D"></span></p>
<p>In <img src="https://latex.codecogs.com/png.latex?T_1">, if <img src="https://latex.codecogs.com/png.latex?S_%7BT_1%7D%20%5Cleq%20K_1"> the short option position struck at <img src="https://latex.codecogs.com/png.latex?K_1"> expires worthless while <img src="https://latex.codecogs.com/png.latex?C_%7BT_1%7D(K_2,T_2)%5Cgeq%200">, because it still has some time-value of money. Otherwise, the entire portfolio is worth <img src="https://latex.codecogs.com/png.latex?C_%7BT_1%7D(K_2,T_2)%20-%20(S_%7BT_1%7D%20-%20K_1)">. But, Equation&nbsp;12 implies that the portfolio is worth <img src="https://latex.codecogs.com/png.latex?C_%7BT_1%7D(K_2,T_2)%20-%20(S_%7BT_1%7D%20-%20K_2%20e%5E%7B-%5Cint_%7BT_1%7D%5E%7BT_2%7D%20r(u)%20du%7D)"> which equals <img src="https://latex.codecogs.com/png.latex?P_%7BT_1%7D(K_2,T_2)"> by put-call parity. Thus, the payoff of this portfolio is always non-negative.</p>
<p>In order to preclude arbitrage, at time <img src="https://latex.codecogs.com/png.latex?t%20%5Cleq%20T_1%20%3C%20T_2"> we must have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0AC_t(K_2,T_2)%20-%20C_t(K_1,T_1)%20&amp;%3E%200%5C%5C%0AC_t(K_2,T_2)%20&amp;%3E%20C_t(K_1,T_1)%0A%5Cend%7Balign*%7D%0A"></p>
<p>Multiplying by <img src="https://latex.codecogs.com/png.latex?e%5E%7B%5Cint_0%5E%7BT_2%7D%20r_u%20du%7D"> and dividing by <img src="https://latex.codecogs.com/png.latex?K_2"> yields:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cfrac%7Be%5E%7B%5Cint_0%5E%7BT_2%7D%20r_u%20du%7DC_t(K_2,T_2)%7D%7BK_2%7D%20&amp;%3E%20%5Cfrac%7Be%5E%7B%5Cint_0%5E%7BT_2%7D%20r_u%20du%7DC_t(K_1,T_1)%7D%7BK_2%7D%5C%5C%0A&amp;=%20%5Cfrac%7Be%5E%7B%5Cint_0%5E%7BT_2%7D%20r_u%20du%7DC_t(K_1,T_1)%7D%7BK_1%20e%5E%7B%5Cint_%7BT_1%7D%5E%7BT_2%7Dr_u%20du%7D%7D%5C%5C%0A%5Cend%7Balign*%7D%0A"></p>
<p>So, we have the condition:</p>
<p><span id="eq-undiscounted-call-option-price-scaled-by-strike"><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cboxed%7B%5Cfrac%7Be%5E%7B%5Cint_0%5E%7BT_2%7D%20r_u%20du%7DC_t(K_2,T_2)%7D%7BK_2%7D%20%3E%20%20%5Cfrac%7Be%5E%7B%5Cint_0%5E%7BT_1%7D%20r_u%20du%7DC_t(K_1,T_1)%7D%7BK_1%7D%7D%0A%5Cend%7Balign*%7D%0A%5Ctag%7B13%7D"></span></p>
<p>Finally, we observe that the function:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0Af(k,%5Cnu%5E2)%20&amp;%5Cstackrel%7Bdef%7D%7B=%7D%20%5Cfrac%7Be%5E%7B%5Cint_%7B0%7D%5ET%20r_u%20du%7DC_t%5E%7BBS%7D(K,T)%7D%7BK%7D%5C%5C%0A&amp;=%20%5Cfrac%7BF(0,T)%5CPhi(d_%7B+%7D)%7D%7BK%7D%20-%20%5CPhi(d_%7B-%7D)%5C%5C%0A&amp;=%20k%5E%7B-1%7D%5CPhi(d_%7B+%7D)%20-%20%5CPhi(d_%7B-%7D)%0A%5Cend%7Balign*%7D%0A"></p>
<p>is a function in <img src="https://latex.codecogs.com/png.latex?k"> and <img src="https://latex.codecogs.com/png.latex?%5Cnu%5E2"> only, and, for a fixed <img src="https://latex.codecogs.com/png.latex?k">, is a strictly monotone increasing function in <img src="https://latex.codecogs.com/png.latex?%5Cnu%5E2">, since</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0Ad_%7B%5Cpm%7D%20&amp;=%20%5Cfrac%7B%5Cln(%5Cfrac%7B1%7D%7Bk%7D)%5Cpm%20%5Cfrac%7B%5Cnu%5E2%7D%7B2%7D%7D%7B%5Csqrt%7B%5Cnu%5E2%7D%7D%5C%5C%0A%5Cfrac%7B%5Cpartial%20d_%7B+%7D%7D%7B%5Cpartial%20%5Cnu%5E2%7D%20&amp;=%5Cfrac%7B%5Csqrt%7B%5Cnu%5E2%7D%20%5Ccdot%20%5Cfrac%7B1%7D%7B2%7D%20-%20%5Cleft(-%5Cln%20k%20+%20%5Cfrac%7B%5Cnu%5E2%7D%7B2%7D%5Cright)%5Ccdot%20%5Cfrac%7B1%7D%7B2%5Csqrt%7B%5Cnu%5E2%7D%7D%7D%7B%5Cnu%5E2%7D%5C%5C%0A&amp;=%20%5Cfrac%7B%5Cfrac%7B%5Csqrt%7B%5Cnu%5E2%7D%7D%7B2%7D%20-%20%5Cfrac%7Bd_%7B+%7D%7D%7B2%7D%7D%7B%5Cnu%5E2%7D%5C%5C%0A%5Cfrac%7B%5Cpartial%20d_%7B-%7D%7D%7B%5Cpartial%20%5Cnu%5E2%7D%20&amp;=%20%5Cfrac%7B-%5Cfrac%7B%5Csqrt%7B%5Cnu%5E2%7D%7D%7B2%7D%20-%20%5Cfrac%7Bd_%7B-%7D%7D%7B2%7D%7D%7B%5Cnu%5E2%7D%5C%5C%0A%5Cfrac%7B%5Cpartial%20d_%7B+%7D%7D%7B%5Cpartial%20%5Cnu%5E2%7D%20-%20%5Cfrac%7B%5Cpartial%20d_%7B-%7D%7D%7B%5Cpartial%20%5Cnu%5E2%7D%20&amp;=%20%5Cfrac%7B1%7D%7B2%5Csqrt%7B%5Cnu%5E2%7D%7D%0A%5Cend%7Balign*%7D%0A"></p>
<p>Also observe that:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cfrac%7B%5Cphi(d_%7B+%7D)%7D%7B%5Cphi(d_%7B-%7D)%7D%20&amp;=%20%5Cexp%5Cleft%5B-%5Cfrac%7B1%7D%7B2%7D(d_%7B+%7D%5E2%20-%20d_%7B-%7D%5E2)%5Cright%5D%5C%5C%0A&amp;=%20%5Cexp%5Cleft%5B-%5Cfrac%7B1%7D%7B2%7D(d_%7B+%7D%20+%20d_%7B-%7D)(d_%7B+%7D%20-%20d_%7B-%7D)%5Cright%5D%5C%5C%0A&amp;=%20%5Cexp%5Cleft%5B-%5Cfrac%7B1%7D%7B2%7D%5Cleft(%5Cfrac%7B-%5Cln%20k%20+%20%5Cnu%5E2/2%7D%7B%5Csqrt%7B%5Cnu%5E2%7D%7D%20+%20%5Cfrac%7B-%5Cln%20k%20-%20%5Cnu%5E2/2%7D%7B%5Csqrt%7B%5Cnu%5E2%7D%7D%5Cright)%5Cleft(%5Cfrac%7B-%5Cln%20k%20+%20%5Cnu%5E2/2%7D%7B%5Csqrt%7B%5Cnu%5E2%7D%7D%20-%20%5Cfrac%7B-%5Cln%20k%20-%20%5Cnu%5E2/2%7D%7B%5Csqrt%7B%5Cnu%5E2%7D%7D%5Cright)%5Cright%5D%5C%5C%0A&amp;=%20%5Cexp%5Cleft%5B%5Cleft(%5Cfrac%7B%5Cln%20k%7D%7B%5Csqrt%7B%5Cnu%5E2%7D%7D%5Cright)%5Csqrt%7B%5Cnu%5E2%7D%5Cright%5D%5C%5C%0A&amp;=%20k%0A%5Cend%7Balign*%7D%0A"></p>
<p>So, <img src="https://latex.codecogs.com/png.latex?%5Cphi(d_%7B+%7D)%20=%20k%20%5Cphi(d_%7B-%7D)">. Also, recall that <img src="https://latex.codecogs.com/png.latex?d_%7B+%7D%20=%20d_%7B-%7D%20+%20%5Csqrt%7B%5Cnu%5E2%7D">. Putting it all together, we have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cfrac%7B%5Cpartial%20f%7D%7B%5Cpartial%20%5Cnu%5E2%7D%20&amp;=%20k%5E%7B-1%7D%5Cphi(d_%7B+%7D)%20(%5Cpartial%20d_%7B+%7D/%5Cpartial%20%5Cnu%5E2)%20-%20%5Cphi(d_%7B-%7D)(%5Cpartial%20d_%7B-%7D/%5Cpartial%20%5Cnu%5E2)%20%5C%5C%0A&amp;=%20%5Cphi(d_%7B-%7D)%20%5Ccdot%20%5Cleft(%5Cfrac%7B%5Cpartial%20d_%7B+%7D%7D%7B%5Cpartial%20%5Cnu%5E2%7D%20-%20%5Cfrac%7B%5Cpartial%20d_%7B-%7D%7D%7B%5Cpartial%20%5Cnu%5E2%7D%5Cright)%5C%5C%0A&amp;=%20%5Cphi(d_%7B-%7D)%5Cfrac%7B1%7D%7B2%5Csqrt%7B%5Cnu%5E2%7D%7D%20%3E%200,%20%5Cquad%20%5Cforall%20%5Cnu%5E2%20%5Cin%20(0,%5Cinfty)%0A%5Cend%7Balign*%7D%0A"></p>
<p>We conclude that <img src="https://latex.codecogs.com/png.latex?f"> is strictly monotonically increasing in <img src="https://latex.codecogs.com/png.latex?%5Cnu%5E2">. So, if total variance <img src="https://latex.codecogs.com/png.latex?%5Cnu%5E2%20=%20%5Csigma%5E2(k,%5Ctau)"> is increasing, <img src="https://latex.codecogs.com/png.latex?f(k,%5Cnu%5E2)">, that is the undiscounted call option price scaled by the strike price <img src="https://latex.codecogs.com/png.latex?K"> is increasing and from Equation&nbsp;13, it follows that there is no calendar arbitrage.</p>
<p>The equation Equation&nbsp;13 is the discrete version of the calendar spread no-arbitrage condition. We can also <img src="https://latex.codecogs.com/png.latex?%5Cblacksquare"></p>
</section>
<section id="butterfly-spread-arbitrage" class="level3">
<h3 class="anchored" data-anchor-id="butterfly-spread-arbitrage">Butterfly spread arbitrage</h3>
<p>We can write:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cfrac%7B%5Cpartial%5E2%20C%7D%7B%5Cpartial%20K%5E2%7D%20=%20%5Clim_%7B%5Cepsilon%20%5Cto%200%7D%20%5Cfrac%7BC(K-%5Cepsilon,T)%20-%202C(K,T)%20+%20C(K+%5Cepsilon,%20T)%7D%7B%5Cepsilon%5E2%7D%0A%5Cend%7Balign*%7D%0A"></p>
<p>Consider the European payoff consisting of <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B1%7D%7B%5Cepsilon%5E2%7D"> calls of strike <img src="https://latex.codecogs.com/png.latex?K%20-%20%5Cepsilon">, <img src="https://latex.codecogs.com/png.latex?1/%5Cepsilon%5E2"> calls of strike <img src="https://latex.codecogs.com/png.latex?K+%5Cepsilon"> and <img src="https://latex.codecogs.com/png.latex?-2/%5Cepsilon%5E2"> calls of strike <img src="https://latex.codecogs.com/png.latex?K"> - this is known as the butterfly spread.</p>
<p>The payout at maturity as a function of <img src="https://latex.codecogs.com/png.latex?S_T"> has a triangular shape whose surface area is unity : it vanishes for <img src="https://latex.codecogs.com/png.latex?S_T%20%5Cleq%20K%20-%20%5Cepsilon"> and <img src="https://latex.codecogs.com/png.latex?S_T%20%5Cgeq%20K%20+%20%5Cepsilon"> and is equal to <img src="https://latex.codecogs.com/png.latex?1/%5Cepsilon"> for <img src="https://latex.codecogs.com/png.latex?S_T%20=%20K">. For <img src="https://latex.codecogs.com/png.latex?%5Cepsilon%20%5Cto%200">, it becomes a Dirac-Delta function. It either vanishes or is strictly positive dependending on <img src="https://latex.codecogs.com/png.latex?S_T">. Hence, its price at inception must be positive.</p>
<p>Options prices are arbitraged well-enough that butterfly spreads do not have negative prices : the denominator in the Dupire formula is positive.</p>
<p>By the Breeden-Litzenberger formula Equation&nbsp;11, <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7Bd%5E2%20C(K,T)%7D%7BdK%5E2%7D"> is related to the probability density of <img src="https://latex.codecogs.com/png.latex?S_T">, which must be positive. Hence, the condition <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7Bd%5E2%20C(K,T)%7D%7BdK%5E2%7D%20%3E%200"> is equivalent to requiring that the market implied risk-beutral probabilities are not negative. Violation of the positivity of <img src="https://latex.codecogs.com/png.latex?d%5E2%20C/dK%5E2"> is called butterfly-spread arbitrage.</p>
</section>
<section id="call-option-price-bounds" class="level3">
<h3 class="anchored" data-anchor-id="call-option-price-bounds">Call option price bounds</h3>
<p>From Equation&nbsp;10, we have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7B%5Cpartial%20C%7D%7B%5Cpartial%20K%7D%20=%20-e%5E%7B-r%5Ctau%7D%20%5Cint_%7BK%7D%5E%7B%5Cinfty%7Dp(s,t,y,T)dy%0A"></p>
<p>From the positivity of the integral <img src="https://latex.codecogs.com/png.latex?%5Cint_%7BK%7D%5E%7B%5Cinfty%7Dp(s,t,y,T)dy%20%3E%200">, we must have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7B%5Cpartial%20C%7D%7B%5Cpartial%20K%7D%20%5Cleq%200%0A"></p>
<p>Further, using the fact <img src="https://latex.codecogs.com/png.latex?%5Cint_%7B-%5Cinfty%7D%5E%7B%5Cinfty%7Dp(s,t,y,T)dy%20=%201">, we have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0Ae%5E%7B-r%5Ctau%7D%5Cint_%7BK%7D%5E%7B%5Cinfty%7Dp(s,t,y,T)dy%20&amp;%5Cleq%20e%5E%7B-r%5Ctau%7D%20%5Cint_%7BK%7D%5E%7B%5Cinfty%7Dp(s,t,y,T)dy%20=%20e%5E%7B-r%5Ctau%7D%20%5C%5C%0A-e%5E%7B-r%5Ctau%7D%5Cint_%7BK%7D%5E%7B%5Cinfty%7Dp(s,t,y,T)dy%20%5Cfrac%7B%5Cpartial%20C%7D%7B%5Cpartial%20K%7D%5Cgeq%20-e%5E%7B-r%5Ctau%7D%0A%5Cend%7Balign*%7D%0A"></p>
<p>Putting it together, we have:</p>
<p><span id="eq-no-arbitrage-bounds-on-first-derivative-wrt-strike"><img src="https://latex.codecogs.com/png.latex?%0A%5Cboxed%7B-e%5E%7B-r%5Ctau%7D%20%5Cleq%20%5Cfrac%7B%5Cpartial%20C%7D%7B%5Cpartial%20K%7D%20%5Cleq%200%7D%0A%5Ctag%7B14%7D"></span></p>
<p>The option price is a decreasing and convex function of the strike <img src="https://latex.codecogs.com/png.latex?K">.</p>
</section>
</section>
<section id="dupire-pde-in-terms-of-forward-moneyness" class="level2">
<h2 class="anchored" data-anchor-id="dupire-pde-in-terms-of-forward-moneyness">Dupire PDE in terms of forward moneyness</h2>
<p>Let the log forward-moneyness be defined as <img src="https://latex.codecogs.com/png.latex?y%20=%20%5Cln(K/F)">. We need to transform the derivatives of the Dupire formula in terms of forward-moneyness.</p>
<p>The deterministic local volatility function is given by:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Csigma_%7BK,T%7D%5E2(S_t,t)%20=%20%5Cfrac%7B%5Cfrac%7B%5Cpartial%20C%5Eu_%7BK,T%7D%7D%7B%5Cpartial%20T%7D%20+%20rK%5Cfrac%7B%5Cpartial%20C%5Eu_%7BK,T%7D%7D%7B%5Cpartial%20K%7D%20-%20rC%5Eu_%7BK,T%7D%7D%7B%5Cfrac%7B1%7D%7B2%7DK%5E2%20%5Cfrac%7B%5Cpartial%5E2%20C%5Eu_%7BK,T%7D%7D%7B%5Cpartial%20K%5E2%7D%7D%0A"></p>
<p>The first derivative with respect to time <img src="https://latex.codecogs.com/png.latex?T"> is obtained using the total derivative rule. Imagine that the undiscounted call option price is a function of two intermediate variables <img src="https://latex.codecogs.com/png.latex?a,b"> which are in turn a function of <img src="https://latex.codecogs.com/png.latex?T">. That is, <img src="https://latex.codecogs.com/png.latex?C%5Eu%20=%20C%5Eu(a(T),b(T))">. Then:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cfrac%7B%5Cpartial%20C%5Eu%7D%7B%5Cpartial%20T%7D(%7Ba(T),b(T)%7D)%20&amp;=%20%5Cleft.%5Cfrac%7B%5Cpartial%20C%5Eu%7D%7B%5Cpartial%20a%7D%5Cright%5Cvert_%7Bb%7D%20%5Ccdot%20%5Cfrac%7B%5Cpartial%20a%7D%7B%5Cpartial%20T%7D%20+%20%5Cleft.%5Cfrac%7B%5Cpartial%20C%5Eu%7D%7B%5Cpartial%20b%7D%5Cright%5Cvert_%7Ba%7D%20%20%5Ccdot%20%5Cfrac%7B%5Cpartial%20b%7D%7B%5Cpartial%20T%7D%20%20%0A%5Cend%7Balign*%7D%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?%5Cvert_%7Ba%7D"> indicates that <img src="https://latex.codecogs.com/png.latex?a"> is treated as a constant. For the undiscounted call option price <img src="https://latex.codecogs.com/png.latex?C%5Eu%20=%20C%5Eu(y(K,T),T)">, so <img src="https://latex.codecogs.com/png.latex?a(T)%20=%20y(K,T)"> and <img src="https://latex.codecogs.com/png.latex?b(T)%20=%20T">. So, we have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cfrac%7B%5Cpartial%20C%5Eu%7D%7B%5Cpartial%20T%7D(%7By(K,T),T%7D)%20&amp;=%20%5Cleft.%5Cfrac%7B%5Cpartial%20C%5Eu%7D%7B%5Cpartial%20y%7D%5Cright%5Cvert_%7BT%7D%20%5Ccdot%20%5Cfrac%7B%5Cpartial%20y%7D%7B%5Cpartial%20T%7D%20+%20%5Cleft.%5Cfrac%7B%5Cpartial%20C%5Eu%7D%7B%5Cpartial%20T%7D%5Cright%5Cvert_%7By%7D%20%20%5Ccdot%20%5Cfrac%7B%5Cpartial%20T%7D%7B%5Cpartial%20T%7D%20%5C%5C%0A&amp;=%20%5Cleft.%5Cfrac%7B%5Cpartial%20C%5Eu%7D%7B%5Cpartial%20y%7D%5Cright%5Cvert_%7BT%7D%20%5Ccdot%20%5Cfrac%7B%5Cpartial%20y%7D%7B%5Cpartial%20T%7D%20+%20%5Cleft.%5Cfrac%7B%5Cpartial%20C%5Eu%7D%7B%5Cpartial%20T%7D%5Cright%5Cvert_%7By%7D%20%20%5C%5C%0A%5Cend%7Balign*%7D%0A"></p>
<p>Now,</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0Ay(K,T)%20&amp;=%20(-rT)+%5Cln%5Cleft(%5Cfrac%7BK%7D%7BS_0%7D%5Cright)%5C%5C%0A%5Cfrac%7B%5Cpartial%20y%7D%7B%5Cpartial%20T%7D%20&amp;=%20(-r)%0A%5Cend%7Balign*%7D%0A"></p>
<p>Thus,</p>
<p><span id="eq-dupire-formula-in-forward-moneyness-terms-1"><img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7B%5Cpartial%20C%5Eu%7D%7B%5Cpartial%20T%7D%20=%20-r%5Cleft.%5Cfrac%7B%5Cpartial%20C%5Eu%7D%7B%5Cpartial%20y%7D%5Cright%5Cvert_%7BT%7D%20%20+%20%5Cleft.%5Cfrac%7B%5Cpartial%20C%5Eu%7D%7B%5Cpartial%20T%7D%5Cright%5Cvert_%7By%7D%20%20%5C%5C%0A%5Ctag%7B15%7D"></span></p>
<p>Using the chain rule, the first derivative with respect to <img src="https://latex.codecogs.com/png.latex?K"> is:</p>
<p><span id="eq-dupire-formula-in-forward-moneyness-terms-2"><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cfrac%7B%5Cpartial%20C%5Eu%7D%7B%5Cpartial%20K%7D%20&amp;=%20%5Cfrac%7B%5Cpartial%20C%5Eu%7D%7B%5Cpartial%20y%7D%20%5Ccdot%20%5Cfrac%7B%5Cpartial%20y%7D%7B%5Cpartial%20K%7D%20%5C%5C%0A&amp;=%20%5Cfrac%7B%5Cpartial%20C%5Eu%7D%7B%5Cpartial%20y%7D%20%5Ccdot%20%5Cfrac%7B%5Cpartial%20%7D%7B%5Cpartial%20K%7D%20%5Cln%5Cleft(%5Cfrac%7BK%7D%7BF_t%7D%5Cright)%5C%5C%0A&amp;=%20%5Cfrac%7B%5Cpartial%20C%5Eu%7D%7B%5Cpartial%20y%7D%20%5Ccdot%20%5Cfrac%7BF%7D%7BK%7D%20%5Ccdot%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20K%7D%20%5Cleft(%5Cfrac%7BK%7D%7BF_t%7D%5Cright)%5C%5C%0A&amp;=%20%5Cfrac%7B1%7D%7BK%7D%20%5Cfrac%7B%5Cpartial%20C%5Eu%7D%7B%5Cpartial%20y%7D%0A%5Cend%7Balign*%7D%0A%5Ctag%7B16%7D"></span></p>
<p>Differentiating again with respect to <img src="https://latex.codecogs.com/png.latex?K">, we have:</p>
<p><span id="eq-dupire-formula-in-forward-moneyness-terms-3"><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cfrac%7B%5Cpartial%5E2%20C%5Eu%7D%7B%5Cpartial%20K%5E2%7D%20&amp;=%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20K%7D%20%5Cleft(%5Cfrac%7B1%7D%7BK%7D%20%5Cfrac%7B%5Cpartial%20C%5Eu%7D%7B%5Cpartial%20y%7D%5Cright)%20%5C%5C%0A&amp;=%20-%5Cfrac%7B1%7D%7BK%5E2%7D%20%5Cfrac%7B%5Cpartial%20C%5Eu%7D%7B%5Cpartial%20y%7D%20+%20%5Cfrac%7B1%7D%7BK%7D%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20K%7D%20%5Cleft(%5Cfrac%7B%5Cpartial%20C%5Eu%7D%7B%5Cpartial%20y%7D%5Cright)%5C%5C%0A&amp;=%20-%5Cfrac%7B1%7D%7BK%5E2%7D%20%5Cfrac%7B%5Cpartial%20C%5Eu%7D%7B%5Cpartial%20y%7D%20+%20%5Cfrac%7B1%7D%7BK%7D%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20y%7D%20%5Cleft(%5Cfrac%7B%5Cpartial%20C%5Eu%7D%7B%5Cpartial%20y%7D%5Cright)%5Cfrac%7B%5Cpartial%20y%7D%7B%5Cpartial%20K%7D%5C%5C%0A&amp;=%20-%5Cfrac%7B1%7D%7BK%5E2%7D%20%5Cfrac%7B%5Cpartial%20C%5Eu%7D%7B%5Cpartial%20y%7D%20+%20%5Cfrac%7B1%7D%7BK%5E2%7D%5Cfrac%7B%5Cpartial%5E2%20C%5Eu%7D%7B%5Cpartial%20y%5E2%7D%5C%5C%0A&amp;=%5Cfrac%7B1%7D%7BK%5E2%7D%5Cleft(%5Cfrac%7B%5Cpartial%5E2%20C%5Eu%7D%7B%5Cpartial%20y%5E2%7D%20-%20%5Cfrac%7B%5Cpartial%20C%5Eu%7D%7B%5Cpartial%20y%7D%5Cright)%0A%5Cend%7Balign*%7D%0A%5Ctag%7B17%7D"></span></p>
<p>Substituting Equation&nbsp;15, Equation&nbsp;16 and Equation&nbsp;17 in the expression for local volatility, we have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Csigma_%7BK,T%7D%5E2(S_t,t)%20&amp;=%20%5Cfrac%7B-r%20%5Cleft.%5Cfrac%7B%5Cpartial%20C%5Eu_%7By,T%7D%7D%7B%5Cpartial%20y%7D%5Cright%5Cvert_%7BT%7D%20+%20%5Cleft.%5Cfrac%7B%5Cpartial%20C%5Eu_%7By,T%7D%7D%7B%5Cpartial%20T%7D%5Cright%5Cvert_%7By%7D%20+%20rK%5Cfrac%7B%5Cpartial%20C%5Eu_%7By,T%7D%7D%7B%5Cpartial%20y%7D%20%5Ccdot%20%5Cfrac%7B1%7D%7BK%7D%20-%20rC%5Eu_%7By,T%7D%7D%7B%5Cfrac%7B1%7D%7B2%7DK%5E2%20%5Cfrac%7B1%7D%7BK%5E2%7D%5Ccdot%20%5Cleft(%5Cfrac%7B%5Cpartial%5E2%20C%5Eu%7D%7B%5Cpartial%20y%5E2%7D%20-%20%5Cfrac%7B%5Cpartial%20C%5Eu%7D%7B%5Cpartial%20y%7D%5Cright)%7D%5C%5C%0A&amp;=%20%5Cfrac%7B%20%5Cleft.%5Cfrac%7B%5Cpartial%20C%5Eu_%7By,T%7D%7D%7B%5Cpartial%20T%7D%5Cright%5Cvert_%7By%7D%20+%20%20-%20rC%5Eu_%7By,T%7D%7D%7B%5Cfrac%7B1%7D%7B2%7D%20%5Cleft(%5Cfrac%7B%5Cpartial%5E2%20C%5Eu%7D%7B%5Cpartial%20y%5E2%7D%20-%20%5Cfrac%7B%5Cpartial%20C%5Eu%7D%7B%5Cpartial%20y%7D%5Cright)%7D%5C%5C%0A%5Cfrac%7B%5Cpartial%20C%5Eu_%7By,T%7D%7D%7B%5Cpartial%20T%7D%20&amp;=%20rC%5Eu_%7By,T%7D%20+%20%5Cfrac%7B%5Csigma_%7By,T%7D%5E2%7D%7B2%7D%5Cleft(%5Cfrac%7B%5Cpartial%5E2%20C%5Eu_%7By,T%7D%7D%7B%5Cpartial%20y%5E2%7D%20-%20%5Cfrac%7B%5Cpartial%20C%5Eu_%7By,T%7D%7D%7B%5Cpartial%20y%7D%5Cright)%0A%5Cend%7Balign*%7D%0A"></p>
</section>
<section id="local-volatility-in-terms-of-implied-volatility" class="level2">
<h2 class="anchored" data-anchor-id="local-volatility-in-terms-of-implied-volatility">Local volatility in terms of implied volatility</h2>
<p>Since options can also be quoted in terms of implied volatility, the local volatility may also be expressed in terms of the total variance <img src="https://latex.codecogs.com/png.latex?w(y,T)">. Define:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Aw(y,T)%20=%20%5CSigma%5E2(y,T)%20T%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?%5CSigma(y,T)"> is the Black-Scholes implied volatility as a function of forward-moneyness and time-to-maturity <img src="https://latex.codecogs.com/png.latex?T">.</p>
<p>We know that the Black-Scholes formula for the future value of the call-option price is:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AC_%7BBS%7D(y,w)%20=%20F%5Cleft(%5CPhi%5Cleft(-%5Cfrac%7By%7D%7B%5Csqrt%7Bw%7D%7D+%5Cfrac%7B%5Csqrt%7Bw%7D%7D%7B2%7D%5Cright)%20-%20e%5Ey%5CPhi%5Cleft(-%5Cfrac%7By%7D%7B%5Csqrt%7Bw%7D%7D-%5Cfrac%7B%5Csqrt%7Bw%7D%7D%7B2%7D%5Cright)%5Cright)%0A"></p>
<p>Differentiating with respect to <img src="https://latex.codecogs.com/png.latex?w">, we have:</p>
<p><span id="eq-BS-derivative-wrt-w"><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0A%5Cfrac%7B%5Cpartial%20C_%7BBS%7D%7D%7B%5Cpartial%20w%7D%20&amp;%20=F_%7BT%7D%5Cleft%5C%7B%5Cphi%20%5Cleft(%20-%5Cfrac%7By%7D%7B%5Csqrt%7Bw%7D%7D%20+%5Cfrac%7B%5Csqrt%7Bw%7D%7D%7B2%7D%5Cright)%5Cfrac%7B%5Cpartial%20%7D%7B%5Cpartial%20w%7D%5Cleft(%20-%5Cfrac%7By%7D%7B%5Csqrt%7Bw%7D%7D%20+%5Cfrac%7B%5Csqrt%7Bw%7D%7D%7B2%7D%5Cright)%20-e%5E%7By%7D%20%5Cphi%20%5Cleft(%20-%5Cfrac%7By%7D%7B%5Csqrt%7Bw%7D%7D%20-%5Cfrac%7B%5Csqrt%7Bw%7D%7D%7B2%7D%5Cright)%5Cfrac%7B%5Cpartial%20%7D%7B%5Cpartial%20w%7D%5Cleft(%20-%5Cfrac%7By%7D%7B%5Csqrt%7Bw%7D%7D%20-%5Cfrac%7B%5Csqrt%7Bw%7D%7D%7B2%7D%5Cright)%5Cright%5C%7D%5C%5C%0A&amp;%20=F_%7BT%7D%5Cleft%5C%7B%5Cphi%20%5Cleft(%20-%5Cfrac%7By%7D%7B%5Csqrt%7Bw%7D%7D%20+%5Cfrac%7B%5Csqrt%7Bw%7D%7D%7B2%7D%5Cright)%5Cleft(%5Cfrac%7By%7D%7B2w%5E%7B3/2%7D%7D%20+%5Cfrac%7B1%7D%7B4w%5E%7B1/2%7D%7D%5Cright)%20-e%5E%7By%7D%20%5Cphi%20%5Cleft(%20-%5Cfrac%7By%7D%7B%5Csqrt%7Bw%7D%7D%20-%5Cfrac%7B%5Csqrt%7Bw%7D%7D%7B2%7D%5Cright)%5Cleft(%5Cfrac%7By%7D%7B2w%5E%7B3/2%7D%7D%20-%5Cfrac%7B1%7D%7B4w%5E%7B1/2%7D%7D%5Cright)%5Cright%5C%7D%5C%5C%0A&amp;%20=F_%7BT%7D%5Cleft%5C%7B%5Cphi%20%5Cleft(%20-%5Cfrac%7By%7D%7B%5Csqrt%7Bw%7D%7D%20+%5Cfrac%7B%5Csqrt%7Bw%7D%7D%7B2%7D%5Cright)%5Cleft(%5Cfrac%7By%7D%7B2w%5E%7B3/2%7D%7D%20+%5Cfrac%7B1%7D%7B4w%5E%7B1/2%7D%7D%5Cright)%20-%5Cleft(%5Cfrac%7By%7D%7B2w%5E%7B3/2%7D%7D%20-%5Cfrac%7B1%7D%7B4w%5E%7B1/2%7D%7D%5Cright)%5Cright%5C%7D%5C%5C%0A&amp;%20=F_%7BT%7D%20%5Cphi%20%5Cleft(%20-%5Cfrac%7By%7D%7B%5Csqrt%7Bw%7D%7D%20+%5Cfrac%7B%5Csqrt%7Bw%7D%7D%7B2%7D%5Cright)%20%5Ccdotp%20%5Cfrac%7B1%7D%7B2w%5E%7B1/2%7D%7D%0A%5Cend%7Baligned%7D%0A%5Ctag%7B18%7D"></span></p>
<p>Differentiating again with respect to <img src="https://latex.codecogs.com/png.latex?w">:</p>
<p><span id="eq-BS-second-derivative-wrt-w"><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0A%5Cfrac%7B%5Cpartial%20%5E%7B2%7D%20C_%7BBS%7D%7D%7B%5Cpartial%20w%5E%7B2%7D%7D%20&amp;%20=F_%7BT%7D%5Cfrac%7B%5Cpartial%20%7D%7B%5Cpartial%20w%7D%5Cleft(%20%5Cphi%20(%20d_%7B+%7D)%20%5Ccdotp%20%5Cfrac%7B1%7D%7B2w%5E%7B1/2%7D%7D%5Cright)%5C%5C%0A&amp;%20=F_%7BT%7D%5Cleft%5B%5Cfrac%7B1%7D%7B2w%5E%7B1/2%7D%7D%5Cfrac%7B%5Cpartial%20%7D%7B%5Cpartial%20w%7D(%20%5Cphi%20(%20d_%7B+%7D))%20+%5Cphi%20(%20d_%7B+%7D)%5Cfrac%7B%5Cpartial%20%7D%7B%5Cpartial%20w%7D%5Cleft(%5Cfrac%7B1%7D%7B2w%5E%7B1/2%7D%7D%5Cright)%5Cright%5D%5C%5C%0A&amp;%20=F_%7BT%7D%5Cleft%5B%5Cfrac%7B1%7D%7B2w%5E%7B1/2%7D%7D%20%5Cphi%20(%20d_%7B+%7D)%5Cfrac%7B%5Cpartial%20%7D%7B%5Cpartial%20w%7D%5Cleft(%20-%5Cfrac%7Bd_%7B+%7D%5E%7B2%7D%7D%7B2%7D%5Cright)%20-%5Cphi%20(%20d_%7B+%7D)%5Cfrac%7B1%7D%7B4w%5E%7B3/2%7D%7D%5Cright%5D%5C%5C%0A&amp;%20=F_%7BT%7D%5Cfrac%7B%5Cphi%20(%20d_%7B+%7D)%7D%7B2w%5E%7B1/2%7D%7D%5Cleft%5B%5Cfrac%7B%5Cpartial%20%7D%7B%5Cpartial%20w%7D%5Cleft(%20-%5Cfrac%7Bd_%7B+%7D%5E%7B2%7D%7D%7B2%7D%5Cright)%20-%5Cfrac%7B1%7D%7B2w%7D%5Cright%5D%5C%5C%0A&amp;%20=%5Cfrac%7B%5Cpartial%20C_%7BBS%7D%7D%7B%5Cpartial%20w%7D%5Cleft%5B%20-d_%7B+%7D%5Cfrac%7B%5Cpartial%20d_%7B+%7D%7D%7B%5Cpartial%20w%7D%20-%5Cfrac%7B1%7D%7B2w%7D%5Cright%5D%5C%5C%0A&amp;%20=%5Cfrac%7B%5Cpartial%20C_%7BBS%7D%7D%7B%5Cpartial%20w%7D%5Cleft%5B%20-%5Cleft(%20-%5Cfrac%7By%7D%7Bw%5E%7B1/2%7D%7D%20+%5Cfrac%7Bw%5E%7B1/2%7D%7D%7B2%7D%5Cright)%5Cleft(%5Cfrac%7By%7D%7B2w%5E%7B3/2%7D%7D%20+%5Cfrac%7B1%7D%7B4w%5E%7B1/2%7D%7D%5Cright)%20-%5Cfrac%7B1%7D%7B2w%7D%5Cright%5D%5C%5C%0A&amp;%20=%5Cfrac%7B%5Cpartial%20C_%7BBS%7D%7D%7B%5Cpartial%20w%7D%5Cleft%5B%5Cfrac%7By%5E%7B2%7D%7D%7B2w%5E%7B2%7D%7D%20+%5Cfrac%7By%7D%7B4w%7D%20-%5Cfrac%7By%7D%7B4w%7D%20-%5Cfrac%7B1%7D%7B8%7D%20-%5Cfrac%7B1%7D%7B2w%7D%5Cright%5D%5C%5C%0A&amp;%20=%5Cfrac%7B%5Cpartial%20C_%7BBS%7D%7D%7B%5Cpartial%20w%7D%5Cleft(%5Cfrac%7By%5E%7B2%7D%7D%7B2w%5E%7B2%7D%7D%20-%5Cfrac%7B1%7D%7B2w%7D%20-%5Cfrac%7B1%7D%7B8%7D%5Cright)%0A%5Cend%7Baligned%7D%0A%5Ctag%7B19%7D"></span></p>
<p>Also, the mixed partial <img src="https://latex.codecogs.com/png.latex?%5Cpartial_%7Bwy%7D%20C_%7BBS%7D"> is given by:</p>
<p><span id="eq-BS-mixed-partial-derivative-wrt-wy"><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0A%5Cfrac%7B%5Cpartial%20%5E%7B2%7D%20C_%7BBS%7D%7D%7B%5Cpartial%20w%5Cpartial%20y%7D%20&amp;%20=%5Cfrac%7BF_%7BT%7D%7D%7B2w%5E%7B1/2%7D%7D%5Cfrac%7B%5Cpartial%20%7D%7B%5Cpartial%20y%7D%5Cleft%5C%7B%5Cphi%20%5Cleft(%20-%5Cfrac%7By%7D%7B%5Csqrt%7Bw%7D%7D%20+%5Cfrac%7B%5Csqrt%7Bw%7D%7D%7B2%7D%5Cright)%5Cright%5C%7D%5C%5C%0A&amp;%20=%5Cfrac%7BF_%7BT%7D%7D%7B2w%5E%7B1/2%7D%7D%20%5Cphi%20%5Cleft(%20-%5Cfrac%7By%7D%7B%5Csqrt%7Bw%7D%7D%20+%5Cfrac%7B%5Csqrt%7Bw%7D%7D%7B2%7D%5Cright)%5Cfrac%7B%5Cpartial%20%7D%7B%5Cpartial%20y%7D%5Cleft(%20-%5Cfrac%7Bd_%7B+%7D%5E%7B2%7D%7D%7B2%7D%5Cright)%5C%5C%0A&amp;%20=%5Cfrac%7B%5Cpartial%20C_%7BBS%7D%7D%7B%5Cpartial%20w%7D%5Cfrac%7B%5Cpartial%20%7D%7B%5Cpartial%20d_%7B+%7D%7D%5Cleft(%20-%5Cfrac%7Bd_%7B+%7D%5E%7B2%7D%7D%7B2%7D%5Cright)%5Cfrac%7B%5Cpartial%20d_%7B+%7D%7D%7B%5Cpartial%20y%7D%5C%5C%0A&amp;%20=-%5Cfrac%7B%5Cpartial%20C_%7BBS%7D%7D%7B%5Cpartial%20w%7D%5Cleft(%20-%5Cfrac%7By%7D%7Bw%5E%7B1/2%7D%7D%20+%5Cfrac%7Bw%5E%7B1/2%7D%7D%7B2%7D%5Cright)%5Cleft(%20-%5Cfrac%7B1%7D%7B%5Csqrt%7Bw%7D%7D%5Cright)%5C%5C%0A&amp;%20=%5Cfrac%7B%5Cpartial%20C_%7BBS%7D%7D%7B%5Cpartial%20w%7D%5Cleft(%5Cfrac%7B1%7D%7B2%7D%20-%5Cfrac%7By%7D%7Bw%7D%5Cright)%0A%5Cend%7Baligned%7D%0A%5Ctag%7B20%7D"></span></p>
<p>Additionally, the partial derivatives of the Black-Scholes formula with respect to <img src="https://latex.codecogs.com/png.latex?y"> are:</p>
<p><span id="eq-BS-partial-derivative-wrt-y"><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0A%5Cfrac%7B%5Cpartial%20C_%7BBS%7D%7D%7B%5Cpartial%20y%7D%20&amp;%20=F_%7BT%7D%5Cfrac%7B%5Cpartial%20%7D%7B%5Cpartial%20y%7D%5Cleft%5C%7B%5CPhi%20%5Cleft(%20-%5Cfrac%7By%7D%7B%5Csqrt%7Bw%7D%7D%20+%5Cfrac%7B%5Csqrt%7Bw%7D%7D%7B2%7D%5Cright)%20-e%5E%7By%7D%20%5CPhi%20%5Cleft(%20-%5Cfrac%7By%7D%7B%5Csqrt%7Bw%7D%7D%20-%5Cfrac%7B%5Csqrt%7Bw%7D%7D%7B2%7D%5Cright)%5Cright%5C%7D%5C%5C%0A&amp;%20=F_%7BT%7D%20%5Ccdot%20%5Cleft%5B%20%5Cphi%20%5Cleft(%20-%5Cfrac%7By%7D%7B%5Csqrt%7Bw%7D%7D%20+%5Cfrac%7B%5Csqrt%7Bw%7D%7D%7B2%7D%5Cright)%5Cfrac%7B%5Cpartial%20d_%7B+%7D%7D%7B%5Cpartial%20y%7D%20-e%5E%7By%7D%20%5CPhi%20%5Cleft(%20-%5Cfrac%7By%7D%7B%5Csqrt%7Bw%7D%7D%20-%5Cfrac%7B%5Csqrt%7Bw%7D%7D%7B2%7D%5Cright)%5Cright%5D%5C%5C%0A&amp;%20-F_%7BT%7D%5Cleft%5B%20e%5E%7By%7D%20%5Cphi%20%5Cleft(%20-%5Cfrac%7By%7D%7B%5Csqrt%7Bw%7D%7D%20-%5Cfrac%7B%5Csqrt%7Bw%7D%7D%7B2%7D%5Cright)%5Cfrac%7B%5Cpartial%20d_%7B-%7D%7D%7B%5Cpartial%20y%7D%5Cright%5D%5C%5C%0A&amp;%20=F_%7BT%7D%20%5Ccdot%20%5Cleft%5B%20%5Cphi%20%5Cleft(%20-%5Cfrac%7By%7D%7B%5Csqrt%7Bw%7D%7D%20+%5Cfrac%7B%5Csqrt%7Bw%7D%7D%7B2%7D%5Cright)%5Cleft(%20-%5Cfrac%7B1%7D%7B%5Csqrt%7Bw%7D%7D%5Cright)%20-e%5E%7By%7D%20%5CPhi%20%5Cleft(%20-%5Cfrac%7By%7D%7B%5Csqrt%7Bw%7D%7D%20-%5Cfrac%7B%5Csqrt%7Bw%7D%7D%7B2%7D%5Cright)%5Cright%5D%5C%5C%0A&amp;%20-F_%7BT%7D%5Cleft%5B%20e%5E%7By%7D%20%5Cphi%20%5Cleft(%20-%5Cfrac%7By%7D%7B%5Csqrt%7Bw%7D%7D%20-%5Cfrac%7B%5Csqrt%7Bw%7D%7D%7B2%7D%5Cright)%5Cleft(%20-%5Cfrac%7B1%7D%7B%5Csqrt%7Bw%7D%7D%5Cright)%5Cright%5D%5C%5C%0A&amp;%20=-%5Cfrac%7BF_%7BT%7D%7D%7B%5Csqrt%7Bw%7D%7D%20%5Ccdot%20%5Cleft%5B%20%5Cphi%20(%20d_%7B+%7D)%20-e%5E%7By%7D%20%5Cphi%20(%20d_%7B-%7D)%5Cright%5D%5C%5C%0A&amp;%20-F_%7BT%7D%20e%5E%7By%7D%20%5CPhi%20(%20d_%7B-%7D)%5C%5C%0A&amp;%20=-F_%7BT%7D%20e%5E%7By%7D%20%5CPhi%20(%20d_%7B-%7D)%0A%5Cend%7Baligned%7D%0A%5Ctag%7B21%7D"></span></p>
<p>Also:</p>
<p><span id="eq-BS-second-partial-derivative-wrt-y"><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0A%5Cfrac%7B%5Cpartial%20%5E%7B2%7D%20C_%7BBS%7D%7D%7B%5Cpartial%20y%5E%7B2%7D%7D%20&amp;%20=-F_%7BT%7D%5Cfrac%7B%5Cpartial%20%7D%7B%5Cpartial%20y%7D%5Cleft(%20e%5E%7By%7D%20%5CPhi%20(%20d_%7B-%7D)%5Cright)%5C%5C%0A&amp;%20=-F_%7BT%7D%5Cleft(%20e%5E%7By%7D%20%5CPhi%20(%20d_%7B-%7D)%20+e%5E%7By%7D%20%5Cphi%20(%20d_%7B-%7D)%5Cfrac%7B%5Cpartial%20d_%7B-%7D%7D%7B%5Cpartial%20y%7D%5Cright)%5C%5C%0A&amp;%20=-F_%7BT%7D%20e%5E%7By%7D%20%5CPhi%20(%20d_%7B-%7D)%20+%5Cfrac%7BF_%7BT%7D%20e%5E%7By%7D%20%5Cphi%20(%20d_%7B-%7D)%7D%7B%5Csqrt%7Bw%7D%7D%5C%5C%0A&amp;%20=%5Cfrac%7B%5Cpartial%20C_%7BBS%7D%7D%7B%5Cpartial%20y%7D%20+2%5Cfrac%7B%5Cpartial%20C_%7BBS%7D%7D%7B%5Cpartial%20w%7D%0A%5Cend%7Baligned%7D%0A%5Ctag%7B22%7D"></span></p>
<p>Now, the undiscounted call option price <img src="https://latex.codecogs.com/png.latex?C%5Eu(y,T)%20=%20C_%7BBS%7D(y(T),w(y,T))"> is a function of the intermediate variables <img src="https://latex.codecogs.com/png.latex?(y,w)">. So, we may write:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0AC%5Eu(y,T)%20&amp;=%20C_%7BBS%7D(w(y),y)%5C%5C%0AC%5Eu_y(y,T)%20&amp;=%20(C_%7BBS%7D)_w%20%5Ccdot%20w_y%20+%20(C_%7BBS%7D)_y%0A%5Cend%7Baligned%7D%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0AC_%7Byy%7D%20&amp;=%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20y%7D%5Cleft((C_%7BBS%7D)_w%20%5Ccdot%20w_y%20+%20(C_%7BBS%7D)_y%5Cright)%5C%5C%0A&amp;=%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20y%7D%5Cleft%5B(C_%7BBS%7D)_w%20%5Ccdot%20w_y%5Cright%5D%20+%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20y%7D((C_%7BBS%7D)_y)%5C%5C%0A&amp;=%5Cleft%5B%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20y%7D%5C%7B(C_%7BBS%7D)_w%5C%7D%20%5Ccdot%20w_y%20+%20(C_%7BBS%7D)_w%20%5Ccdot%20w_%7Byy%7D%5Cright%5D%20+%20(C_%7BBS%7D)_%7Byy%7D%20+%20(C_%7BBS%7D)_%7Byw%7D%20%5Ccdot%20w_y%5C%5C%0A&amp;=%5Cleft%5B%5C%7B(C_%7BBS%7D)_%7Bww%7D%20%5Ccdot%20w_y%20+%20(C_%7BBS%7D)_%7Bwy%7D%5C%7D%20%5Ccdot%20w_y%20+%20(C_%7BBS%7D)_w%20%5Ccdot%20w_%7Byy%7D%5Cright%5D%20+%20(C_%7BBS%7D)_%7Byy%7D%20+%20(C_%7BBS%7D)_%7Byw%7D%20%5Ccdot%20w_y%5C%5C%0A&amp;=%20(C_%7BBS%7D)_%7Byy%7D%20+%202(C_%7BBS%7D)_%7Bwy%7D%20%5Ccdot%20w_y%20+%20(C_%7BBS%7D)_%7Bww%7D%20%5Ccdot%20(w_y)%5E2%20+%20(C_%7BBS%7D)_w%20%5Ccdot%20w_%7Byy%7D%0A%5Cend%7Baligned%7D%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cleft.%5Cfrac%7B%5Cpartial%20C_u(y,T)%7D%7B%5Cpartial%20T%7D%5Cright%7C_y%20&amp;=%20%5Cleft.%5Cfrac%7B%5Cpartial%20C_%7BBS%7D(w(y,T),T)%7D%7B%5Cpartial%20T%7D%5Cright%7C_%7Bw%7D%20%5Ccdot%20%5Cfrac%7B%5Cpartial%20T%7D%7B%5Cpartial%20T%7D%20+%20%5Cfrac%7B%5Cpartial%20C_%7BBS%7D%7D%7B%5Cpartial%20w%7D%20%5Ccdot%20%5Cfrac%7B%5Cpartial%20w%7D%7B%5Cpartial%20T%7D%5C%5C%0A&amp;=%20rC_%7BBS%7D%20+%20%5Cfrac%7B%5Cpartial%20C_%7BBS%7D%7D%7B%5Cpartial%20w%7D%20%5Ccdot%20%5Cfrac%7B%5Cpartial%20w%7D%7B%5Cpartial%20T%7D%5C%5C%0A%5Cend%7Balign*%7D%0A"></p>
<p>where the last equality follows from the fact that the only explicit dependence of the option price on <img src="https://latex.codecogs.com/png.latex?T"> is through the forward price <img src="https://latex.codecogs.com/png.latex?F_T%20=%20S_0%20%5Cexp(%5Cint_0%5ET%20r%20dt)">.</p>
<p>Substituting these results in the Dupires formula:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cfrac%7B%5Cpartial%20C%5Eu(y,T)%7D%7B%5Cpartial%20T%7D%20&amp;=%20rC%5Eu(y,T)%20+%20%5Cfrac%7B%5Csigma%5E2(y,T)%7D%7B2%7D%5Cleft(%5Cfrac%7B%5Cpartial%5E2%20C_u(y,T)%7D%7B%5Cpartial%20y%5E2%7D%20-%20%5Cfrac%7B%5Cpartial%20C_u(y,T)%7D%7B%5Cpartial%20y%7D%5Cright)%5C%5C%0ArC_%7BBS%7D%20+%20(C_%7BBS%7D)_w%20%5Ccdot%20w_T%20&amp;=%20rC_%7BBS%7D%20+%20%5Csigma_%7BLV%7D%5E2/2((C_%7BBS%7D)_%7Byy%7D%20+%202(C_%7BBS%7D)_%7Bwy%7D%20%5Ccdot%20w_y%20+%20(C_%7BBS%7D)_%7Bww%7D%20%5Ccdot%20(w_y)%5E2%20+%20(C_%7BBS%7D)_w%20%5Ccdot%20w_%7Byy%7D-%20(C_%7BBS%7D)_y)%5C%5C%0A(C_%7BBS%7D)_w%20%5Ccdot%20w_T%20&amp;=%20%5Csigma_%7BLV%7D%5E2/2%5B((C_%7BBS%7D)_%7Byy%7D%20-%20(C_%7BBS%7D)_y)%20+%202(C_%7BBS%7D)_%7Bwy%7D%20%5Ccdot%20w_y%20%20+%20(C_%7BBS%7D)_%7Bww%7D%20%5Ccdot%20(w_y)%5E2%20+%20(C_%7BBS%7D)_w%20%5Ccdot%20w_%7Byy%7D-(C_%7BBS%7D)_w%20%5Ccdot%20w_y%5D%5C%5C%0A(C_%7BBS%7D)_w%20%5Ccdot%20w_T%20&amp;=%20%5Csigma_%7BLV%7D%5E2/2%5B2(C_%7BBS%7D)_w%20+%202(C_%7BBS%7D)_w%20%5Cleft(%5Cfrac%7B1%7D%7B2%7D%20-%20%5Cfrac%7By%7D%7Bw%7D%5Cright)%5Ccdot%20w_y%20+%20%5Cleft(%5Cfrac%7By%5E%7B2%7D%7D%7B2w%5E%7B2%7D%7D%20-%5Cfrac%7B1%7D%7B2w%7D%20-%5Cfrac%7B1%7D%7B8%7D%5Cright)(C_%7BBS%7D)_w%20(w_y)%5E2%20+%20(C_%7BBS%7D)_w%20%5Ccdot%20w_%7Byy%7D-(C_%7BBS%7D)_w%20%5Ccdot%20w_y%5D%5C%5C%0Aw_T%20&amp;=%20%5Csigma_%7BLV%7D%5E2/2%5B2%20+%202%20%5Cleft(%5Cfrac%7B1%7D%7B2%7D%20-%20%5Cfrac%7By%7D%7Bw%7D%5Cright)%5Ccdot%20w_y%20+%20%5Cleft(%5Cfrac%7By%5E%7B2%7D%7D%7B2w%5E%7B2%7D%7D%20-%5Cfrac%7B1%7D%7B2w%7D%20-%5Cfrac%7B1%7D%7B8%7D%5Cright)(w_y)%5E2%20+%20w_%7Byy%7D-%20%20w_y%5D%5C%5C%0A%5Csigma_%7BLV%7D%5E2%20&amp;=%20%5Cfrac%7Bw_T%7D%7B1%20-%20%5Cfrac%7By%7D%7Bw%7Dw_y%20+%20%5Cfrac%7B1%7D%7B4%7D%5Cleft(%5Cfrac%7By%5E2%7D%7B2w%5E2%7D%20-%20%5Cfrac%7B1%7D%7Bw%7D%20-%20%5Cfrac%7B1%7D%7B4%7D%5Cright)(w_y)%5E2%20+%20%5Cfrac%7B1%7D%7B2%7D%20w_%7Byy%7D%7D%0A%5Cend%7Balign*%7D%0A"></p>
<p>This gives us our final result:</p>
<p><span id="eq-local-vol-in-terms-of-implied-vol"><img src="https://latex.codecogs.com/png.latex?%0A%5Cboxed%7B%5Csigma_%7BLV%7D%5E2%20=%20%5Cfrac%7B%5Cfrac%7B%5Cpartial%20w%7D%7B%5Cpartial%20T%7D%7D%7B1%20-%20%5Cfrac%7By%7D%7Bw%7D%5Cfrac%7B%5Cpartial%20w%7D%7B%5Cpartial%20y%7D%20+%20%5Cfrac%7B1%7D%7B4%7D%5Cleft(%5Cfrac%7By%5E2%7D%7B2w%5E2%7D%20-%20%5Cfrac%7B1%7D%7Bw%7D%20-%20%5Cfrac%7B1%7D%7B4%7D%5Cright)(%5Cfrac%7B%5Cpartial%20w%7D%7B%5Cpartial%20y%7D)%5E2%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7B%5Cpartial%5E2%20w%7D%7B%5Cpartial%20y%5E2%7D%7D%7D%0A%5Ctag%7B23%7D"></span></p>
</section>
<section id="implied-variance-is-the-average-of-local-variance-over-the-life-of-the-option-when-there-is-no-skew" class="level2">
<h2 class="anchored" data-anchor-id="implied-variance-is-the-average-of-local-variance-over-the-life-of-the-option-when-there-is-no-skew">Implied variance is the average of local variance over the life of the option when there is no skew</h2>
<p>If the implied volatility <img src="https://latex.codecogs.com/png.latex?%5CSigma"> is independent of the strike, then the skew <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%20w%7D%7B%5Cpartial%20y%7D"> is zero.</p>
<p>So, the Dupires formula becomes:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Csigma_%7BLV%7D%5E2(w,T)%20&amp;=%20%5Cfrac%7B%5Cpartial%20w%7D%7B%5Cpartial%20T%7D%5C%5C%0A%5CSigma%5E2(T)%20T%20&amp;=%20%5Cint_%7BR%7D%20%5Csigma_%7BLV%7D%5E2%20(w,T)%20dT%5C%5C%0A%5CSigma%5E2(T)%20&amp;=%20%5Cfrac%7B1%7D%7BT%7D%5Cint_%7BR%7D%20%5Csigma_%7BLV%7D%5E2%20(w,T)%20dT%5C%5C%0A%5Cend%7Balign*%7D%0A"></p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ul>
<li><a href="https://engineering.nyu.edu/sites/default/files/2018-09/CarrFinResearchLetters2005.pdf">A note sufficient conditions for no arbitrage</a>, <em>Peter Carr and Dilip Madan</em></li>
<li><a href="https://www.amazon.co.uk/Volatility-Surface-Practitioners-Guide-Finance/dp/0471792519/ref=sr_1_1?crid=3VZ8L0LIO7J24&amp;dib=eyJ2IjoiMSJ9.mJ-yHScvO5YUgkVfwPorn8L9K4zyd5H6qIeL1SxlWPs.CMG7pEJaZU-9EsEoRoz9P2TmJo7AyVECPpkvNcTETbQ&amp;dib_tag=se&amp;keywords=jim+gatheral&amp;qid=1760024387&amp;sprefix=JIm+Gatheral%2Caps%2C92&amp;sr=8-1&amp;ufe=app_do%3Aamzn1.fos.95fd378e-6299-4723-b1f1-3952ffba15af">The volatility surface - A practitioners guide</a>, <em>Jim Gatheral</em></li>
</ul>


</section>
</section>

 ]]></description>
  <category>Fin Math</category>
  <guid>http://quantdev.blog/posts/dupire-pde/index.html</guid>
  <pubDate>Tue, 30 Sep 2025 23:00:00 GMT</pubDate>
  <media:content url="http://quantdev.blog/posts/dupire-pde/image.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Challenging exercises in Template Metaprogramming</title>
  <dc:creator>Quasar </dc:creator>
  <link>http://quantdev.blog/posts/exercises-in-template-programming/index.html</link>
  <description><![CDATA[ 




<section id="challenging-exercises-in-template-metaprogramming" class="level1">
<h1>Challenging exercises in Template Metaprogramming</h1>
<section id="typelists-and-stdindex_sequence" class="level2">
<h2 class="anchored" data-anchor-id="typelists-and-stdindex_sequence">Typelists and <code>std::index_sequence</code></h2>
<p>For type metaprogramming, the central data structures are the <em>typelist</em> and <code>std::index_sequence</code>. A <code>TypeList</code> is just a static list of types. A <code>std::index_sequence</code> is an integer sequence known at compile-time. <code>TypeList</code>s and <code>std::index_sequence</code>s differ from run-time data structures, such as <code>std::list</code>, in that they dont allow mutation. Adding an element to a <code>TypeList</code>, does not change the original <code>TypeList</code>: rather it creates a new typelist without modifying the original. If you are familar with functional programming languages like Haskell and F#, theres a lot of parallel between working with typelists in C++ and lists in those languages.</p>
</section>
<section id="implementing-a-typelist" class="level2">
<h2 class="anchored" data-anchor-id="implementing-a-typelist">Implementing a <code>TypeList</code></h2>
<p>A <code>TypeList</code> is implemented as a class template. A particular instance of a typelist is a template specialization that encodes the contents of the typelist as template arguments.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb1-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Ts<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb1-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Ts<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;;</span></span>
<span id="cb1-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Ts<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;{};</span></span>
<span id="cb1-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> SignedIntegralTypes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">signed</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">char</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">short</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb1-8">                            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">long</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">long</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">long</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;;</span></span></code></pre></div>
<p><code>make_index_sequence</code> metafunction is used to create an integer sequence.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_seq<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>seq <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>make_index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;{};</span></span></code></pre></div>
</section>
<section id="manipulating-typelist-and-index_sequence" class="level2">
<h2 class="anchored" data-anchor-id="manipulating-typelist-and-index_sequence">Manipulating <code>TypeList</code> and <code>index_sequence</code></h2>
<p>Manipulating the typelist and <code>index_sequence</code> typically requires breaking the typelist into parts, generally by separting the first element in the list (the head) from the remaining elements in the list (the tail).</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// front implementation</span></span>
<span id="cb3-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> List<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb3-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-4"></span>
<span id="cb3-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb3-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>Tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb3-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb3-9"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb3-10"></span>
<span id="cb3-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> List<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb3-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> seq_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-13"></span>
<span id="cb3-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> First<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Rest<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb3-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> seq_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>First<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>Rest<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb3-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> First<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-17"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb3-18"></span>
<span id="cb3-19"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb3-20">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">static_assert</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>is_same_v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">float</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;);</span></span>
<span id="cb3-21">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> seq_front_result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> seq_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;::</span>value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-22">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>format<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">seq_front result = </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> seq_front_result<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb3-23"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><a href="https://compiler-explorer.com/z/1W5rMr3nr">Compiler Explorer</a></p>
<p>The above implementation splits the typelist elements into the head and tail and then forms a new <code>TypeList</code> specialization from the elements in the tail.</p>
</section>
<section id="implementing-pop_front" class="level2">
<h2 class="anchored" data-anchor-id="implementing-pop_front">Implementing <code>pop_front</code></h2>
<p>The <code>pop_front</code> metafunction removes the first element from the typelist. Its implementation splits the typelist elements into the head and tail and then forms a new typelist from the elements in the tail.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> List<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb4-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> pop_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb4-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> pop_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>Tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb4-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;;</span></span>
<span id="cb4-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;{};</span></span>
<span id="cb4-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb4-9"></span>
<span id="cb4-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> List<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb4-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> seq_pop_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-12"></span>
<span id="cb4-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> First<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Rest<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb4-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> seq_pop_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>First<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>Rest<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb4-15">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Rest<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;;</span></span>
<span id="cb4-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Rest<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;{};</span></span>
<span id="cb4-17"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span></code></pre></div>
<p><a href="https://compiler-explorer.com/z/565qdc3cY">Compiler Explorer</a></p>
</section>
<section id="implementing-push_front" class="level2">
<h2 class="anchored" data-anchor-id="implementing-push_front">Implementing <code>push_front</code></h2>
<p>We can also insert elements onto the front of the typelist by capturing all of the existing elements into a template parameter pack, then creating a new <code>TypeList</code> specialization containing all of those elements:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb5-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> List<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb5-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> push_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Ts<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb5-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> push_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Ts<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb5-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>Ts<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;;</span></span>
<span id="cb5-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>Ts<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;{};</span></span>
<span id="cb5-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb5-9"></span>
<span id="cb5-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> IndexSequenceT<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb5-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> seq_push_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-12"></span>
<span id="cb5-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb5-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> seq_push_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb5-15">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;;</span></span>
<span id="cb5-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;{};</span></span>
<span id="cb5-17"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb5-18"></span>
<span id="cb5-19"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> IndexSequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb5-20"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">seq_push_front_t</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> seq_push_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>IndexSequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
</section>
<section id="implementing-push_back" class="level2">
<h2 class="anchored" data-anchor-id="implementing-push_back">Implementing <code>push_back</code></h2>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// push_back implementation</span></span>
<span id="cb6-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> List<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb6-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> push_back<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-4"></span>
<span id="cb6-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb6-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> push_back<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&gt;&gt;{</span></span>
<span id="cb6-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;;</span></span>
<span id="cb6-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb6-9"></span>
<span id="cb6-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Ts<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb6-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> push_back<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Ts<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb6-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Ts<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...,</span>Element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;;</span></span>
<span id="cb6-13"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb6-14"></span>
<span id="cb6-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// push_back implementation for index_sequence</span></span>
<span id="cb6-16"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> IndexSequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb6-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> seq_push_back<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-18"></span>
<span id="cb6-19"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb6-20"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> seq_push_back<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb6-21">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...,</span>I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;;</span></span>
<span id="cb6-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...,</span>I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;{};</span></span>
<span id="cb6-23"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb6-24"></span>
<span id="cb6-25"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> IndexSequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb6-26"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">seq_push_back_t</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> seq_push_back<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>IndexSequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
</section>
<section id="typelist-algorithms" class="level2">
<h2 class="anchored" data-anchor-id="typelist-algorithms">Typelist algorithms</h2>
<p>The fundamental typelist operations <code>front</code>, <code>push_front</code>, <code>back</code> and <code>push_back</code> can be composed to create more interesting typelist manipulations. For example, we can replace the first element in a typelist by applying <code>push_front</code> to the result of <code>pop_front</code>.</p>
<p>Going further, we can implement algorithms - searches, transformations, reversals as metafunctions operating on typelists.</p>
<section id="indexing" class="level3">
<h3 class="anchored" data-anchor-id="indexing">Indexing</h3>
<p>One of the most fundamental operations on a typelist is to extract a specific element of the list. Let us code up a metafunction to extract the <img src="https://latex.codecogs.com/png.latex?N">th element.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb7-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> List<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb7-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> nth_element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-3"></span>
<span id="cb7-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> First<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Rest<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb7-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> nth_element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>First<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Rest<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb7-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> First<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb7-8"></span>
<span id="cb7-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> First<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Rest<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb7-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> nth_element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>First<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Rest<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> nth_element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Rest<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{};</span></span>
<span id="cb7-11"></span>
<span id="cb7-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> List<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb7-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> seq_nth_element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-14"></span>
<span id="cb7-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb7-16"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> seq_nth_element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb7-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-18"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb7-19"></span>
<span id="cb7-20"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb7-21"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> seq_nth_element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> seq_nth_element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{};</span></span></code></pre></div>
<p><a href="https://compiler-explorer.com/z/oWanY6Y78">Compiler Explorer</a></p>
</section>
<section id="implementing-find_if" class="level3">
<h3 class="anchored" data-anchor-id="implementing-find_if">Implementing <code>find_if</code></h3>
<p>Many typelist algorithms search for data within the typelist. This too can be easily achieved with a recursive template metaprogram.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb8-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;utility&gt;</span></span>
<span id="cb8-2"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;memory&gt;</span></span>
<span id="cb8-3"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;format&gt;</span></span>
<span id="cb8-4"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb8-5"></span>
<span id="cb8-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> List<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Predicate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb8-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> seq_find_if<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-8"></span>
<span id="cb8-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Predicate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb8-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> seq_find_if<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&gt;,</span>Predicate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>false_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb8-13"></span>
<span id="cb8-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> First<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Predicate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb8-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> seq_find_if<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>First<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;,</span>Predicate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bool</span> is_true <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Predicate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>First<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bool</span> more_elements_to_check <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">sizeof</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...(</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb8-18">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>conditional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span></span>
<span id="cb8-19">        is_true<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb8-20">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>integral_constant<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>First<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;,</span> </span>
<span id="cb8-21">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>conditional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>more_elements_to_check<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> seq_find_if<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;,</span>Predicate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>false_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type</span>
<span id="cb8-22">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-23"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb8-24"></span>
<span id="cb8-25"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb8-26"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> my_predicate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-27">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>conditional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;(</span>N <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">),</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>true_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>false_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-28">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bool</span> value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>N <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb8-29"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb8-30"></span>
<span id="cb8-31"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb8-32">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">static_assert</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>is_same_v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span></span>
<span id="cb8-33">        seq_find_if<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;,</span>my_predicate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-34">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>integral_constant<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb8-35">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;);</span></span>
<span id="cb8-36"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><a href="https://compiler-explorer.com/z/rEvb6d9eG">Compiler Explorer</a></p>
</section>
<section id="reversing-a-typelist-and-index_sequence" class="level3">
<h3 class="anchored" data-anchor-id="reversing-a-typelist-and-index_sequence">Reversing a <code>TypeList</code> and <code>index_sequence</code></h3>
<p>When typelists have some ordering among their elements, it is convenient to be able to reverse the ordering of the elements in the typelist when applying some algorithms. The <code>reverse</code> algorithm implements this metafunction:</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb9-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> List<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb9-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> reverse<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb9-3"></span>
<span id="cb9-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// basis case</span></span>
<span id="cb9-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb9-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> reverse<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;{</span></span>
<span id="cb9-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;;</span></span>
<span id="cb9-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb9-9"></span>
<span id="cb9-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Ts<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb9-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> reverse<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Ts<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb9-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> front_el <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Ts<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb9-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> tail <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pop_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Ts<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb9-14">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> push_back<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>front_el<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> reverse<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb9-15"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span></code></pre></div>
<p><a href="https://compiler-explorer.com/z/5j4nTqacz">Compiler Explorer</a></p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb10-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> IndexSequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb10-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> seq_reverse<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-3"></span>
<span id="cb10-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> Head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb10-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> seq_reverse<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;{</span></span>
<span id="cb10-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;;</span></span>
<span id="cb10-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;{};</span></span>
<span id="cb10-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb10-9"></span>
<span id="cb10-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> Head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb10-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> seq_reverse<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>Tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb10-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> seq_push_back<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> seq_reverse<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-13"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span></code></pre></div>
<p><a href="https://compiler-explorer.com/z/437zq688q">Compiler Explorer</a></p>
</section>
<section id="implementing-transform" class="level3">
<h3 class="anchored" data-anchor-id="implementing-transform">Implementing <code>transform</code></h3>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb11-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> IndexSequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb11-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> seq_transform<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-3"></span>
<span id="cb11-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> First<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb11-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> seq_transform<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>First<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;{</span></span>
<span id="cb11-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>First<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;;</span></span>
<span id="cb11-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb11-8"></span>
<span id="cb11-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb11-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> seq_transform<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb11-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> front_el <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> seq_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;::</span>value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> tail <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> seq_pop_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> seq_push_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>front_el<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> seq_transform<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-14"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span></code></pre></div>
<p><a href="https://compiler-explorer.com/z/PrvW7beTE">Compiler Explorer</a></p>
</section>
<section id="remove-duplicates" class="level3">
<h3 class="anchored" data-anchor-id="remove-duplicates">Remove duplicates</h3>
<p>Assume that we a sorted integer sequence such as <img src="https://latex.codecogs.com/png.latex?1,%202,%202,%202,%204,%204,%205,%20%5Cldots">. We are interested to write a function <code>seq_uniq</code> that will remove duplicates from the sequence.</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb12-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> List<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb12-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> seq_uniq<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb12-3"></span>
<span id="cb12-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb12-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> seq_uniq<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;{</span></span>
<span id="cb12-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;;</span></span>
<span id="cb12-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb12-8"></span>
<span id="cb12-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> I1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> I2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb12-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> seq_uniq<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> I2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;{</span></span>
<span id="cb12-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>conditional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span></span>
<span id="cb12-12">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>I1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> I2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">),</span></span>
<span id="cb12-13">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;,</span></span>
<span id="cb12-14">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> I2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb12-15">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb12-16"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb12-17"></span>
<span id="cb12-18"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> First<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Rest<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb12-19"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> seq_uniq<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>First<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>Rest<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb12-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> first <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> First<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb12-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> next <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> seq_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Rest<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;::</span>value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb12-22">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> tail <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Rest<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;;</span></span>
<span id="cb12-23">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> tail_next <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> seq_pop_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Rest<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb12-24">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>conditional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span></span>
<span id="cb12-25">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>first <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> next<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">),</span></span>
<span id="cb12-26">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> seq_uniq<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> seq_push_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>First<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> tail_next<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-27">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> seq_push_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>First<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> seq_uniq<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type</span>
<span id="cb12-28">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb12-29"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span></code></pre></div>
<p><a href="https://compiler-explorer.com/z/fYdznc13P">Compiler Explorer</a></p>
</section>
<section id="implementing-merge-sort" class="level3">
<h3 class="anchored" data-anchor-id="implementing-merge-sort">Implementing Merge Sort</h3>
<p>We can write a cool metafunction to implement merge sort. Id encourage you to try this as a challenge. Lets see what youve got!</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb13-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> V<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb13-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> MergeSort<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb13-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> MergeVecs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span></span>
<span id="cb13-4">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> MergeSort<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> SplitVec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>V<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>left<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb13-5">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> MergeSort<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> SplitVec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>V<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>right<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type</span>
<span id="cb13-6">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb13-8"></span>
<span id="cb13-9"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb13-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">static_assert</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span id="cb13-11">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>is_same_v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span></span>
<span id="cb13-12">            MergeSort<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb13-13">            Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb13-14">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb13-15">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb13-16"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>Heres my implementation of merge-sort:</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb14-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb14-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> Vec <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;;</span></span>
<span id="cb14-3"></span>
<span id="cb14-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> List<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Indexer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb14-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> SelectVec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-6"></span>
<span id="cb14-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Js<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb14-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> SelectVec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Js<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb14-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>seq_nth_element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Js<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;::</span>value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;;</span></span>
<span id="cb14-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb14-11"></span>
<span id="cb14-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> Start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> List<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Indexer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb14-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> VecSliceHelper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-14"></span>
<span id="cb14-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> Start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Js<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb14-16"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> VecSliceHelper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Js<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb14-17">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>seq_nth_element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Start <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Js<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;::</span>value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;;</span></span>
<span id="cb14-18"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb14-19"></span>
<span id="cb14-20"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> Start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> End<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> V<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb14-21"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> VecSlice<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-22"></span>
<span id="cb14-23"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> Start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> End<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb14-24"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> VecSlice<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> End<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb14-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> num_elements <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> End <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> Start <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-26">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>make_index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>num_elements<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;;</span></span>
<span id="cb14-27">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> VecSliceHelper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;,</span> s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-28"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb14-29"></span>
<span id="cb14-30"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> V<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb14-31"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> SplitVec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-32"></span>
<span id="cb14-33"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> I1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> I2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb14-34"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> SplitVec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> I2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;{</span></span>
<span id="cb14-35">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> left <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;;</span></span>
<span id="cb14-36">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> right <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;;</span></span>
<span id="cb14-37"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb14-38"></span>
<span id="cb14-39"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb14-40"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> SplitVec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb14-41">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> N <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">sizeof</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...(</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb14-42">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> mid <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> N <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-43">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> left <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> VecSlice<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>mid<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-44">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> right <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> VecSlice<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>mid<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-45"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb14-46"></span>
<span id="cb14-47"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Vec1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Vec2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb14-48"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> MergeHelper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-49"></span>
<span id="cb14-50"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Base cases</span></span>
<span id="cb14-51"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb14-52"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> MergeHelper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&gt;,</span> Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&gt;,</span> Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb14-53">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;;</span></span>
<span id="cb14-54"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb14-55"></span>
<span id="cb14-56"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// When no elements remain in right subarray</span></span>
<span id="cb14-57"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> I1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb14-58"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> MergeHelper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;,</span> Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&gt;,</span> Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb14-59">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> element <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> seq_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;::</span>value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-60">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> tail <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> seq_pop_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-61">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> seq_push_back<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-62">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> MergeHelper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&gt;,</span> result<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-63"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb14-64"></span>
<span id="cb14-65"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// When no elements remain in left subarray</span></span>
<span id="cb14-66"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> I2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb14-67"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> MergeHelper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&gt;,</span> Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;,</span> Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb14-68">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> element <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> seq_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;::</span>value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-69">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> tail <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> seq_pop_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-70">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> seq_push_back<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-71">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> MergeHelper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&gt;,</span> result<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-72"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb14-73"></span>
<span id="cb14-74"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// compare the head elements of both vectors, </span></span>
<span id="cb14-75"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// pop off the smaller of the two and insert it into the results array</span></span>
<span id="cb14-76"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> I1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> I2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb14-77"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> MergeHelper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;,</span> Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;,</span> Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb14-78">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> left <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> right <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;;</span></span>
<span id="cb14-79">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> left_tail <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> seq_pop_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>left<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-80">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> right_tail <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> seq_pop_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>right<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-81">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;;</span></span>
<span id="cb14-82"></span>
<span id="cb14-83">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> seq_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;::</span>value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-84">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> q <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> seq_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;::</span>value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-85">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>conditional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span></span>
<span id="cb14-86">        p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> q<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-87">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> MergeHelper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>left_tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> right<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> seq_push_back<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> result<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-88">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> MergeHelper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>left<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> right_tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> seq_push_back<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>q<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> result<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type</span>
<span id="cb14-89">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-90"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb14-91"></span>
<span id="cb14-92"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Vec1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Vec2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb14-93"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> Merge<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-94"></span>
<span id="cb14-95"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Js<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb14-96"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> Merge<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;,</span>Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Js<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;</span></span>
<span id="cb14-97"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-98">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> MergeHelper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;,</span>Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Js<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;,</span>Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&gt;&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-99"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb14-100"></span>
<span id="cb14-101"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> V<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb14-102"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> MergeSort<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-103"></span>
<span id="cb14-104"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&gt;</span></span>
<span id="cb14-105"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> MergeSort<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&gt;&gt;{</span></span>
<span id="cb14-106">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&gt;;</span></span>
<span id="cb14-107"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb14-108"></span>
<span id="cb14-109"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb14-110"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> MergeSort<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;{</span></span>
<span id="cb14-111">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;;</span></span>
<span id="cb14-112"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb14-113"></span>
<span id="cb14-114"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb14-115"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> MergeSort<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb14-116">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Merge<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span></span>
<span id="cb14-117">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> MergeSort<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> SplitVec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;::</span>left<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-118">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> MergeSort<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> SplitVec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;::</span>right<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type</span>
<span id="cb14-119">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-120"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span></code></pre></div>
<p><a href="https://compiler-explorer.com/z/G1vnenYaP">Compiler Explorer</a></p>
</section>
<section id="implementing-zip" class="level3">
<h3 class="anchored" data-anchor-id="implementing-zip">Implementing <code>zip</code></h3>
<p>Lets say you have a bunch of compile-time vectors. Wed want to write a metafunction that takes multiple vectors and zips them with <code>*</code>. For example, given the input:</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb15-1">Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;,</span> Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;,</span> Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
<p>produce:</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb16-1">Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">162</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
<p>That is:</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb17-1">Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
<p>You can try writing your implementation using the below as a starting point:</p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb18-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;type_traits&gt;</span></span>
<span id="cb18-2"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb18-3"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;utility&gt;</span></span>
<span id="cb18-4"></span>
<span id="cb18-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// DEFINITION: Compile-time integer vector defined as: </span></span>
<span id="cb18-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb18-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb18-8"></span>
<span id="cb18-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// The code below will assume a 'zip' metafunction is used, but feel free to use a different approach. </span></span>
<span id="cb18-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// If you do, please adjust the static assert accordingly. </span></span>
<span id="cb18-11"></span>
<span id="cb18-12"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb18-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">static_assert</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>is_same<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span></span>
<span id="cb18-14">            zip<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;,</span> Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;,</span> Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb18-15">            Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;::</span>value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb18-16"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>Put on your thinking cap and happy coding! When youre done with your attempt, you can take a look below at my solution:</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb19-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;type_traits&gt;</span></span>
<span id="cb19-2"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb19-3"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;utility&gt;</span></span>
<span id="cb19-4"></span>
<span id="cb19-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// DEFINITION: Compile-time integer vector defined as: </span></span>
<span id="cb19-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb19-8"></span>
<span id="cb19-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// The code below will assume a 'zip' metafunction is used, but feel free to use a different approach. </span></span>
<span id="cb19-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// If you do, please adjust the static assert accordingly. </span></span>
<span id="cb19-11"></span>
<span id="cb19-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// A getter for the nth-element of the compile-time sequence </span></span>
<span id="cb19-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// of integers</span></span>
<span id="cb19-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> List<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb19-16"></span>
<span id="cb19-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Base case</span></span>
<span id="cb19-18"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> Head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-19"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>Tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb19-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>  </span>
<span id="cb19-21"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb19-22"></span>
<span id="cb19-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// get&lt;N,Vector&lt;I1,I2,...&gt;&gt; inherits from get&lt;N-1,Vector&lt;I2,...&gt;&gt;</span></span>
<span id="cb19-24"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> Head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-25"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>Tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{};</span></span>
<span id="cb19-26"></span>
<span id="cb19-27"></span>
<span id="cb19-28"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-29"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb19-30">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;::</span>value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb19-31"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb19-32"></span>
<span id="cb19-33"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> List<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-34"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> pop_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb19-35"></span>
<span id="cb19-36"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-37"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> pop_front<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb19-38">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;;</span></span>
<span id="cb19-39"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb19-40"></span>
<span id="cb19-41"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Let's design a metafunction zip that accepts a variadic pack</span></span>
<span id="cb19-42"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// of Vector's.</span></span>
<span id="cb19-43"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Template declaration</span></span>
<span id="cb19-44"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Vectors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-45"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> zip<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb19-46"></span>
<span id="cb19-47"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Partial specialization</span></span>
<span id="cb19-48"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-49"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> zip<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb19-50">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;;</span></span>
<span id="cb19-51"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb19-52"></span>
<span id="cb19-53"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Indexes<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> V<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> List<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-54"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> zip_impl<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb19-55"></span>
<span id="cb19-56"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Elements<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-57"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> zip_impl<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;,</span> Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Elements<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb19-58">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Elements<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;;</span></span>
<span id="cb19-59"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb19-60"></span>
<span id="cb19-61"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Elements<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Vectors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-62"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> zip_impl<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;,</span>Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Elements<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;,</span> Vectors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;{</span></span>
<span id="cb19-63">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> first <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Elements<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;;</span></span>
<span id="cb19-64">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> rest <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> zip_impl<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;,</span> Vectors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb19-65">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;(</span>get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> first<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> rest<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)...&gt;;</span></span>
<span id="cb19-66"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb19-67"></span>
<span id="cb19-68"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Vectors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-69"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> zip<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;,</span> Vectors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;{</span></span>
<span id="cb19-70">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> N <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">sizeof</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...(</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb19-71">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> seq <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>make_index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;;</span></span>
<span id="cb19-72">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> zip_impl<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>seq<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;,</span>Vectors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb19-73"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb19-74"></span>
<span id="cb19-75"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">TEST</span></span>
<span id="cb19-76"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb19-77"></span>
<span id="cb19-78">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Test case #1</span></span>
<span id="cb19-79">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">static_assert</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;::</span>value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb19-80">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">static_assert</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>is_same<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span></span>
<span id="cb19-81">        zip<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;,</span> Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;,</span> Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;::</span>type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb19-82">        Vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;::</span>value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb19-83">    </span>
<span id="cb19-84">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">TASK</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: Add more test cases here</span></span>
<span id="cb19-85">    </span>
<span id="cb19-86">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">TASK</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: Ensure it compiles before submission</span></span>
<span id="cb19-87">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb19-88"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><a href="https://compiler-explorer.com/z/7bqq6vY1o">Compiler Explorer</a></p>
</section>
</section>
<section id="basic-stdtuple-design" class="level2">
<h2 class="anchored" data-anchor-id="basic-stdtuple-design">Basic <code>std::tuple</code> design</h2>
<p>A tuple is an arbitrary collection of heterogenous data. It is a recursive data-structure. A <code>tuple</code> has a static component and a run-time component. The list of types are baked into the tuple definition at compile-time. The actual values/objects held by the tuple can be objects known at run-time.</p>
<p>We will design a <code>tuple</code> class template. Implementing your own version <code>tuple</code> type is a good exercise to flex your metaprogramming muscles.</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb20-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;utility&gt;</span></span>
<span id="cb20-2"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;memory&gt;</span></span>
<span id="cb20-3"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;format&gt;</span></span>
<span id="cb20-4"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb20-5"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;cassert&gt;</span></span>
<span id="cb20-6"></span>
<span id="cb20-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">namespace</span> dev </span>
<span id="cb20-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb20-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// TypeList definition</span></span>
<span id="cb20-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Ts<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb20-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb20-12">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Ts<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;;</span></span>
<span id="cb20-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Ts<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;{};</span></span>
<span id="cb20-14">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb20-15"></span>
<span id="cb20-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// TypeList Indexing </span></span>
<span id="cb20-17">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> I<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> List<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb20-18">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> nth_element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb20-19"></span>
<span id="cb20-20">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> First<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Rest<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb20-21">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> nth_element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>First<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Rest<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{</span></span>
<span id="cb20-22">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> First<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb20-23">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb20-24"></span>
<span id="cb20-25">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> First<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Rest<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb20-26">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> nth_element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>First<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Rest<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> nth_element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Rest<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;{};</span></span>
<span id="cb20-27"></span>
<span id="cb20-28">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Implement tuple. This is a forward declaration.</span></span>
<span id="cb20-29">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Types<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb20-30">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb20-31"></span>
<span id="cb20-32">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Base case</span></span>
<span id="cb20-33">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&gt;</span></span>
<span id="cb20-34">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&gt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb20-35"></span>
<span id="cb20-36">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb20-37">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">requires</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>is_trivially_default_constructible_v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb20-38">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;{</span></span>
<span id="cb20-39">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TypeList<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;;</span></span>
<span id="cb20-40"></span>
<span id="cb20-41">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">private</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb20-42">        Head <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_head</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb20-43">        tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_tail</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb20-44"></span>
<span id="cb20-45">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">public</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb20-46">        tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span></span>
<span id="cb20-47">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_head</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb20-48">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_tail</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb20-49">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb20-50"></span>
<span id="cb20-51">        tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Head head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb20-52">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_head</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb20-53">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_tail</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...}</span></span>
<span id="cb20-54">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb20-55"></span>
<span id="cb20-56">        Head head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb20-57">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_head</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb20-58">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb20-59"></span>
<span id="cb20-60">        tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;</span> tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb20-61">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_tail</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb20-62">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb20-63"></span>
<span id="cb20-64">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> empty<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb20-65">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&gt;();</span></span>
<span id="cb20-66">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb20-67"></span>
<span id="cb20-68">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> initialize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Head head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb20-69">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_head</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb20-70">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">sizeof</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...(</span>Tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">))</span></span>
<span id="cb20-71">                <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_tail</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>initialize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...);</span></span>
<span id="cb20-72">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb20-73">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb20-74"></span>
<span id="cb20-75">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Implement get</span></span>
<span id="cb20-76">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">unsigned</span> N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Types<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb20-77">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Types<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&amp;</span> tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb20-78">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>N <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb20-79">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb20-80">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span></span>
<span id="cb20-81">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;(</span>tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>tail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">());</span></span>
<span id="cb20-82">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb20-83"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb20-84"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb20-85">    dev<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> tup<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb20-86">    <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">assert</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;(</span>tup<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb20-87"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><a href="https://compiler-explorer.com/z/ETdd181Mh">Compiler Explorer</a></p>
</section>
<section id="tuple-algorithms" class="level2">
<h2 class="anchored" data-anchor-id="tuple-algorithms">Tuple Algorithms</h2>
<section id="implementing-transform-for-a-stdtuplet1t2...tn" class="level3">
<h3 class="anchored" data-anchor-id="implementing-transform-for-a-stdtuplet1t2...tn">Implementing <code>transform</code> for a <code>std::tuple{t1,t2,...,tn}</code></h3>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb21-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> TupleT<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb21-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> transform_impl<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>TupleT tup<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Func func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;</span> indexes<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb21-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>make_tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;(</span>tup<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">))...);</span></span>
<span id="cb21-4"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb21-5"></span>
<span id="cb21-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// transform</span></span>
<span id="cb21-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> TupleT<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Fn<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb21-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> transform<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Fn func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> TupleT tup<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb21-9"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb21-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> index_seq <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>make_index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>tuple_size_v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>TupleT<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;{};</span></span>
<span id="cb21-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> transform_impl<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>tup<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> index_seq<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb21-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</section>
<section id="implementing-select_tuple-for-a-stdtuplet1...tn" class="level3">
<h3 class="anchored" data-anchor-id="implementing-select_tuple-for-a-stdtuplet1...tn">Implementing <code>select_tuple</code> for a <code>std::tuple{t1,...,tn}</code></h3>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb22-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// select_tuple</span></span>
<span id="cb22-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> TupleT<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb22-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> select_tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>TupleT tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;</span> idx_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb22-4"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb22-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>make_tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">((</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;(</span>tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">))...);</span></span>
<span id="cb22-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</section>
<section id="reversing-a-tuple" class="level3">
<h3 class="anchored" data-anchor-id="reversing-a-tuple">Reversing a tuple</h3>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb23-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> TupleT<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb23-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> reverse_tuple_impl<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>TupleT tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;</span> idx_seq<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb23-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> rev_idx_seq <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> seq_reverse<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Is<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;&gt;::</span>value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb23-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> select_tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> rev_idx_seq<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb23-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb23-6"></span>
<span id="cb23-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> TupleT<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb23-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> reverse_tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>TupleT tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb23-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>idx_sequence <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>make_index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>tuple_size_v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>TupleT<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;{};</span></span>
<span id="cb23-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> reverse_tuple_impl<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> idx_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb23-11"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</section>
<section id="implementing-tuple-concatenation" class="level3">
<h3 class="anchored" data-anchor-id="implementing-tuple-concatenation">Implementing tuple concatenation</h3>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb24-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> TupleT1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> TupleT2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> I1s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> I2s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb24-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> cat_tuple_impl<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>TupleT1 tuple1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> TupleT2 tuple2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I1s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;</span> seq1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I2s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;</span> seq2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb24-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>make_tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I1s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;(</span>tuple1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)...,</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I2s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;(</span>tuple2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)...);</span></span>
<span id="cb24-4"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb24-5"></span>
<span id="cb24-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> TupleT1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> TupleT2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb24-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> cat_tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>TupleT1 t1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> TupleT2 t2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb24-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb24-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>seq1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>make_index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>tuple_size_v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>TupleT1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;{};</span></span>
<span id="cb24-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>seq2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>make_index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>tuple_size_v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>TupleT2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;{};</span></span>
<span id="cb24-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> cat_tuple_impl<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>t1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> t2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> seq1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> seq2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb24-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</section>
<section id="implementing-zip-for-a-pair-of-tuples" class="level3">
<h3 class="anchored" data-anchor-id="implementing-zip-for-a-pair-of-tuples">Implementing <code>zip</code> for a pair of tuples</h3>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb25-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> TupleT1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> TupleT2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> I1s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> I2s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb25-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> zip_tuple_impl<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>TupleT1 tuple1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> TupleT2 tuple2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I1s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;</span> seq1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I2s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...&gt;</span> seq2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb25-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>make_tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>make_tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I1s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;(</span>tuple1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">),</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>I2s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;(</span>tuple2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">))...);</span></span>
<span id="cb25-4"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb25-5"></span>
<span id="cb25-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> TupleT1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> TupleT2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb25-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> zip_tuple<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>TupleT1 t1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> TupleT2 t2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb25-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>seq1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>make_index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>tuple_size_v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>TupleT1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;{};</span></span>
<span id="cb25-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>seq2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>make_index_sequence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>tuple_size_v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>TupleT2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;{};</span></span>
<span id="cb25-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> zip_tuple_impl<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>t1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> t2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> seq1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> seq2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb25-11"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</section>
<section id="implementing-filter-for-a-tuple" class="level3">
<h3 class="anchored" data-anchor-id="implementing-filter-for-a-tuple">Implementing <code>filter</code> for a tuple</h3>


</section>
</section>
</section>

 ]]></description>
  <category>C++</category>
  <guid>http://quantdev.blog/posts/exercises-in-template-programming/index.html</guid>
  <pubDate>Fri, 22 Aug 2025 23:00:00 GMT</pubDate>
  <media:content url="http://quantdev.blog/posts/exercises-in-template-programming/cpp.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>C++ Type erasure</title>
  <dc:creator>Quasar </dc:creator>
  <link>http://quantdev.blog/posts/type-erasure/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Once you instantiate a <code>std::function</code> object, how is it, that <em>you are able to stick objects of different actual types e.g.&nbsp;an anonymous lambda, a free-standing function or a function-pointer (with only a common function signature)</em> to it? This is achieved through <strong>type erasure</strong>.</p>
<p>Type erasure is a programming technique by which the explicit type information is removed from the program. It is a type of <em>abstraction</em> that ensures that the program does not explicitly depend on some of the data-types. You might wonder, how is it, that a program is written in a strongly typed language but does not use the actual types?</p>
</section>
<section id="how-does-type-erasure-look-like" class="level1">
<h1>How does type erasure look like?</h1>
<p>Lets see what a program with explicit types looks like. Consider a smart pointer such as <a href="https://en.cppreference.com/w/cpp/memory/unique_ptr.html"><code>std::unique_ptr&lt;T,Deleter&gt;</code></a> in the standard library that models exclusive ownership of the managed resource.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb1-1"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb1-2">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>unique_ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">new</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}};</span></span>
<span id="cb1-3"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>Here is a unique pointer. It creates and deletes an <code>int</code>. The deletion is not explicitly visible, in fact nothing here tells you how the deletion will take place. But, its done by calling a callable object <code>std::default_delete</code>, which is the default deleter and under the hood, it calls the default <code>delete ptr</code>.</p>
<p>Suppose, however, we are interested to allocate/deallocate memory from our own heap/memory pool. In such case, wed have to override the global <code>new</code> operator and pass the <code>Heap*</code> pointer. Thats what will be used for allocations.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> Heap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb2-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/* ... */</span></span>
<span id="cb2-3">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> allocate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb2-4">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> deallocate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> ptr_to_block<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb2-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">new</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Heap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> heap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb2-8">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> heap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>allocate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb2-9"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>Notice that, you dont have <code>operator delete()</code> with arguments. You can write one, it will compile, but you cant invoke it. In order to actually release memory on the heap, you have to do something else. You have to write your own custom deleter.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> MyDeleter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/* ... */</span></span>
<span id="cb3-3">    Heap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">heap_</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-4">    </span>
<span id="cb3-5">    MyDeleter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Heap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> heap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">heap_</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>heap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb3-6">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb3-7"></span>
<span id="cb3-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb3-9">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()(</span>T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb3-10">        ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;~</span>T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span>                  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// invoke d'tor</span></span>
<span id="cb3-11">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">heap_</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>deallocate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span>     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// release memory</span></span>
<span id="cb3-12">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-13"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>The function call <code>operator()</code> is overloaded and it accepts a pointer-to-<code>T</code>. It invokes the destructor <code>~T()</code> and releases the memory occupied on the heap. The destructor has to be explicitly invoked, because you cant call <code>operator delete</code> with arguments. Now, how do you hook this up to the <code>unique_ptr</code>? You pass it as a constructor argument. But, we also need to refer to a different type <code>unique_ptr&lt;int,MyDeleter&gt;</code>.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb4-1"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb4-2">    Heap myHeap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-3"></span>
<span id="cb4-4">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>unique_ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>MyDeleter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">new</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(&amp;</span>heap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">),</span> MyDeleter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(&amp;</span>heap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)};</span></span>
<span id="cb4-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>This creates and deletes an <code>int</code> on the heap.</p>
<p>Notice that, <code>unique_ptr</code>s to the same type, but with different deleters are different types too. So, for example, you cant assign from one to the other. You can actually deduce the <code>Deleter</code> type. If you have a <code>unique_ptr</code> object, you can actually interrogate its <code>deleter_type</code>. The <code>deleter_type</code> is embedded in the <code>unique_ptr</code> type.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb5-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb5-2"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;memory&gt;</span></span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb5-5">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>unique_ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">new</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)};</span></span>
<span id="cb5-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">static_assert</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>is_same_v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">decltype</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)::</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">deleter_type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>default_delete<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;);</span></span>
<span id="cb5-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><a href="https://compiler-explorer.com/z/GaPsecqGh">Compiler Explorer</a></p>
<p>Now, lets look at the <a href="https://en.cppreference.com/w/cpp/memory/shared_ptr.html"><code>shared_ptr&lt;T&gt;</code></a> and contrast it with <code>unique_ptr</code>. If you dont specify any deleters, they look exactly the same:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb6-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>unique_ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> u_ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">new</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb6-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>shared_ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">s_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">new</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span></code></pre></div>
<p>If you do specify a deleter, theres a big difference. The constructor looks exactly the same.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb7-1"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb7-2">    Heap myHeap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-3">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>unique_ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>MyDeleter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>  u_ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">new</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(&amp;</span>heap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">),</span> MyDeleter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(&amp;</span>heap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb7-4">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>shared_ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">s_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">new</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(&amp;</span>heap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">),</span> MyDeleter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(&amp;</span>heap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb7-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>But, in the <code>unique_ptr</code> the type of the deleter is the second template argument, whereas with the <code>shared_ptr</code> there is no mention of the deleter with the type. So, if you have an object of type <code>shared_ptr</code>, you cannot deduce which deleter was used to construct it. All <code>shared_ptr</code> instances with the same pointer type <code>T*</code>, are of the same type, even if they have different deleters.</p>
<p>So, the deleter type has been erased. Thats what it means to erase a type. Observe that the constructor call site is the last mention of the deleter type. From this point forward, you wont see this type again.</p>
<p>Since, shared pointers with different deleters have the same type, you can assign one to the other.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb8-1"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb8-2">    Heap myHeap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-3">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>shared_ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>    p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">new</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb8-4">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>shared_ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>    q<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">new</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(&amp;</span>myHeap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">),</span> MyDeleter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(&amp;</span>myHeap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb8-5">    q <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Ok, they are the same type</span></span>
<span id="cb8-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Proper deleters are called</span></span></code></pre></div>
<p>Also, when each shared pointer goes out of scope, the correct deleter is invoked. So, erased types are not explicitly visible in the program; they are hidden somewhere.</p>
</section>
<section id="type-erasure-as-a-design-pattern" class="level1">
<h1>Type erasure as a design pattern</h1>
<p>The ultimate type-erased object in C++ is <code>std::function</code>. Another one is <code>std::any</code>.</p>
<p><code>std::function&lt;F&gt;</code> is a type that is instantiated from the signature of a callable.</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb9-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb9-2"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;functional&gt;</span></span>
<span id="cb9-3"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;vector&gt;</span></span>
<span id="cb9-4"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;numeric&gt;</span></span>
<span id="cb9-5"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;algorithm&gt;</span></span>
<span id="cb9-6"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;cmath&gt;</span></span>
<span id="cb9-7"></span>
<span id="cb9-8"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span> gravitational_potential<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb9-9">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span> r_squared <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>accumulate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>begin<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(),</span>x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>end<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(),</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,[](</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span> accum<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span> element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb9-10">        accum <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> element <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb9-11">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> accum<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb9-12">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">});</span></span>
<span id="cb9-13">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span> r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sqrt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>r_squared<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb9-14"></span>
<span id="cb9-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span> G <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.6743e-11</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb9-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span> M <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.972e+24</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb9-17">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span> potential <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>G<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>M<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb9-18">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> potential<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb9-19"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb9-20"></span>
<span id="cb9-21"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb9-22">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>function<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;)&gt;</span> scalarValuedFunc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb9-23"></span>
<span id="cb9-24">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// the paraboloid z = x_0^2 + x_1^2 + ... + x_{n-1}^2 </span></span>
<span id="cb9-25">    scalarValuedFunc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[](</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb9-26">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>accumulate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>begin<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(),</span>x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>end<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(),</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,[](</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span> accum<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span> element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb9-27">            accum <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> element <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb9-28">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> accum<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb9-29">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">});</span></span>
<span id="cb9-30">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb9-31"></span>
<span id="cb9-32">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Gravitational potential U at the point (x_0,...,x_{n-1}) in space</span></span>
<span id="cb9-33">    scalarValuedFunc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gravitational_potential<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb9-34">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb9-35"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><a href="https://compiler-explorer.com/z/b8K3Go5nh">Compiler Explorer</a></p>
<p>The lambda and the free-standing function have different types. <code>scalarValuedFunc</code> has only one type, but can store any of these callable objects. Our <code>std::function</code> has only one type, and somehow, we can stick all these different types into it.</p>
<p>If you look at it from the design point of view, what it does is, it abstracts away all the behavior of the type you erase, except the set of behaviors you consider relevant. Its a very flexible abstraction. In my case, I say, whats relevant is, I can invoke this type with a <code>vector</code> of reals and I get back a real. Thats the only behavior of this type, that to me, at this moment is relevant. All other behavior is abstracted away.</p>
<p>Fundamentally, type erasure is an abstraction technique that allows you to separate interface from implementation, and when we talk about the interface, its actually a subset of the interface. Its a subset of the interface, that we deem relevant for our particular problem.</p>
<p>Inheritance does the same thing. But, inheritance is significantly less flexible. Firstly, with inheritance, the interface you inherit - that has to be the whole interface, you cant pick and choose. You can separate it from the implementation, but you dont get to pick and choose like half of the interface. Second, it is much more intrusive. You cant take an arbitrary class with the same interface and say, I want to use it through inheritance. No, you have to derive it from the base class.</p>
</section>
<section id="how-does-type-erasure-work" class="level1">
<h1>How does type erasure work?</h1>
<p>Consider the following C code.</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource c number-lines code-with-copy"><code class="sourceCode c"><span id="cb10-1"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> qsort<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> base<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> nmemb<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_t</span> size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(*</span>compare<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">const</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">const</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*)</span>        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// no mention of specific types</span></span>
<span id="cb10-3"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb10-4"></span>
<span id="cb10-5"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> less<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">const</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> a<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">const</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb10-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">const</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*)</span>a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">const</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*)</span>b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// type information recovered</span></span>
<span id="cb10-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-8"></span>
<span id="cb10-9"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> a<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">];</span></span>
<span id="cb10-10">qsort<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>a<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">),</span> less<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span>                  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// type of less erased here</span></span></code></pre></div>
<p><code>qsort()</code> comes from the standard C library. It takes <code>void*</code> pointer-to-array, <code>size_t</code> array count, <code>size_t</code> size of types you are trying to sort, and a comparator. The comparison function takes <code>void*</code>. It is used to compare whatever types you are actually sorting. Inside <code>qsort</code>, there is no mention of the type that you are going to sort.</p>
<p>The function call site is the last time in your execution flow, where you have the mention of the type <code>int</code>. From that moment on, there is no mention of <code>int</code> during the sorting process.</p>
<p>When you write the comparison function, the signature <code>int (*)(void*, void*)</code> is fixed. But, you know what you are writing this for. You are writing a comparator for <code>int</code>s. So, inside the function, I am going to recover the type information. So, the entire type erasure mechanism is seen here. The type is known at the invocation point and its the last time it is known. This is type erasure in C. The general code does not depend on which type we are sorting. All interfaces are completely generic and do not contain any type information.</p>
<p>I still need to perform a type dependent action at some point.</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource c number-lines code-with-copy"><code class="sourceCode c"><span id="cb11-1"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> less<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">const</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> a<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">const</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb11-2">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">const</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*)</span>a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">const</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*)</span>b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// type information recovered</span></span>
<span id="cb11-3"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>So, I have to generate some code that has a type-less or type agnostic interface, but the code itself is aware of the types. This act of recovering the types from typeless information is called reification (recovery). The comparator <code>int less(void*, void*)</code> performs the reification and executes type dependent code. Type reification in C is manual. From an understanding point of view, the only thing C++ adds to this, is that C++ automatically generates type reification functions.</p>
<p>The general code does not depend on the erased type. The call site is the last place where the actual type is known. Type is reified when type dependent action is performed. The type is hidden in the code of the function that performs this action. The function is invoked through a type-agnostic interface. The type dependent code converts from the abstract to the concrete type. In C++, we can have the compiler generate the type dependent code.</p>
</section>
<section id="type-erasure---the-basic-mechanics" class="level1">
<h1>Type erasure - the basic mechanics</h1>
<p>The classic type erasure pattern can be realized by first coding up a <em>type-agnostic interface</em> (a <code>Concept</code> class). Then we use an <code>Impl</code> class that wraps up the concrete type &amp; provides the <em>type-dependent implementation</em>. Finally, we use dynamic polymorphism via virtual functions, but the caller only sees the interface. Finally, we use dynamic polymorphism via virtual functions, but the caller only sees the interface.</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Type erasure 101</span></span>
<span id="cb12-2"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb12-3"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;memory&gt;</span></span>
<span id="cb12-4"></span>
<span id="cb12-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">namespace</span> dev<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb12-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> function<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb12-7">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">public</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb12-8"></span>
<span id="cb12-9">        function<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span></span>
<span id="cb12-10">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">nullptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb12-11">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb12-12"></span>
<span id="cb12-13">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Callable<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb12-14">        function<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Callable callable<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb12-15">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>make_unique<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Impl<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Callable<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;(</span>callable<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)}</span></span>
<span id="cb12-16">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb12-17"></span>
<span id="cb12-18">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()(){</span></span>
<span id="cb12-19">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(*</span>ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)();</span></span>
<span id="cb12-20">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb12-21">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Type-agnostic interface</span></span>
<span id="cb12-22">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> Concept<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb12-23">            <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb12-24">            <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Concept<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){}</span></span>
<span id="cb12-25">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb12-26"></span>
<span id="cb12-27">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Type-dependent implementation</span></span>
<span id="cb12-28">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Callable<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb12-29">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> Impl <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">public</span> Concept<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb12-30"></span>
<span id="cb12-31">            Impl<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Callable callable<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb12-32">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_callable</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>callable<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb12-33">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb12-34"></span>
<span id="cb12-35">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">override</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb12-36">                <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_callable</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb12-37">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb12-38">            Callable <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_callable</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb12-39">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb12-40"></span>
<span id="cb12-41">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>unique_ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Concept<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb12-42">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb12-43"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb12-44"></span>
<span id="cb12-45"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> foo<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb12-46">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"foo()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb12-47"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb12-48"></span>
<span id="cb12-49"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> bar<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb12-50">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bar()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb12-51"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb12-52"></span>
<span id="cb12-53"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb12-54">    dev<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>function f<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb12-55">    f <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[](){</span></span>
<span id="cb12-56">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Anonymous lambda"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb12-57">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb12-58">    f<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb12-59"></span>
<span id="cb12-60">    f <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> foo<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb12-61">    f<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb12-62"></span>
<span id="cb12-63">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(*</span>func_ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)();</span></span>
<span id="cb12-64">    func_ptr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> bar<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb12-65">    f <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> func_ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb12-66">    f<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb12-67">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb12-68"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><a href="https://godbolt.org/z/EfdTKc4hz">Compiler Explorer</a></p>
</section>
<section id="type-erasure---adding-support-for-a-custom-deleter-to-the-shared_ptr" class="level1">
<h1>Type erasure - Adding support for a custom deleter to the <code>shared_ptr</code></h1>
<p>Suppose wed like to add support for a custom deleter to the <code>shared_ptr</code>.</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb13-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb13-2"></span>
<span id="cb13-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb13-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> shared_ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb13-5"></span>
<span id="cb13-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">private</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb13-7">    T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_underlying_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-8">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>atomic<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">unsigned</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">long</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_ref_count</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// something about the deleter</span></span>
<span id="cb13-10"></span>
<span id="cb13-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">public</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb13-12">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Templated constructor</span></span>
<span id="cb13-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Deleter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb13-14">    shared_ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Deleter deleter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb13-15">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_underlying_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb13-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// ???  </span></span>
<span id="cb13-17">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb13-18"></span>
<span id="cb13-19">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Destructor</span></span>
<span id="cb13-20">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>shared_ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb13-21">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Decrement the ref-count. If m_ref_count == 0, </span></span>
<span id="cb13-22">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// delete m_underlying_ptr using deleter </span></span>
<span id="cb13-23">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb13-24"></span>
<span id="cb13-25">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Pointer like functions</span></span>
<span id="cb13-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;()</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb13-27">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_underlying_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-28">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb13-29"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span></code></pre></div>
<p><a href="https://compiler-explorer.com/z/8oq3Kf361">Compiler Explorer</a></p>
<p>We add a templated constructor <code>shared_ptr(T*, Deleter )</code> that accepts a raw pointer and a custom deleter as the second argument to the design of our <code>shared_ptr</code>.</p>
<p>Lets now write a <code>Concept</code> and <code>Impl</code> class that support destruction using an instance of the custom <code>Deleter</code> type.</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb14-1">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> destroy_wrapper <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// RAII class</span></span>
<span id="cb14-2">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-3">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/* ... */</span></span>
<span id="cb14-4"></span>
<span id="cb14-5">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Concept class</span></span>
<span id="cb14-6">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> destroyer_base</span>
<span id="cb14-7">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-8">            <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-9">            <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>destroyer_base<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">default</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-10">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb14-11"></span>
<span id="cb14-12">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Impl class</span></span>
<span id="cb14-13">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Deleter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb14-14">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> destroyer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">public</span> destroyer_base</span>
<span id="cb14-15">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-16">            <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">explicit</span> destroyer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Deleter deleter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb14-17">              <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> destroyer_base<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span></span>
<span id="cb14-18">              <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_deleter</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> deleter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb14-19">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-20">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb14-21"></span>
<span id="cb14-22">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()(</span>T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">override</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_deleter</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb14-23"></span>
<span id="cb14-24">            Deleter <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_deleter</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-25">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb14-26"></span>
<span id="cb14-27">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>destroy_wrapper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb14-28">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>unique_ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>destroyer_base<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_destroyer_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-29">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span></code></pre></div>
<p>The <code>destroyer_base</code> is the <em>Concept</em> class and the <code>destroyer</code> is its type-dependent <em>implementation</em>.</p>
<p>The wrapper class <code>destroyer_wrapper</code> wraps objects of different types (<code>destoyer&lt;Deleter&gt;</code>) into a common wrapper and treats them as though they are the same unified interface.</p>
<p>THe updated design of the <code>shared_ptr&lt;T&gt;</code> class would look something like this:</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb15-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb15-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> shared_ptr</span>
<span id="cb15-3"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb15-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">private</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb15-5">    T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_underlying_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb15-6">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>atomic<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">unsigned</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">long</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_ref_count_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb15-7">    destroyer_wrapper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_destroyer_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb15-8"></span>
<span id="cb15-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">public</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb15-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Templated constructor</span></span>
<span id="cb15-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Deleter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb15-12">    shared_ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Deleter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> deleter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb15-13">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_underlying_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> ptr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb15-14">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_ref_count_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">nullptr</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb15-15">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_destroyer_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">nullptr</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb15-16">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb15-17">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb15-18">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_destroyer_ptr</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">new</span> destroy_wrapper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>forward<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Deleter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;(</span>deleter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">));</span></span>
<span id="cb15-19">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_ref_count_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>store<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">u</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb15-20">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">catch</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>exception<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> ex<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb15-21">            <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">delete</span> ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb15-22">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">throw</span> ex<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb15-23">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb15-24">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb15-25"></span>
<span id="cb15-26">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/* ... */</span></span>
<span id="cb15-27"></span>
<span id="cb15-28">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> destroy_wrapper <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// RAII class</span></span>
<span id="cb15-29">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb15-30">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Deleter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb15-31">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">explicit</span> destroy_wrapper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Deleter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> deleter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb15-32">          <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_destroyer_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>make_unique<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>destroyer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>forward<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Deleter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;(</span>deleter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">))</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb15-33">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb15-34">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb15-35">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// destroy_wrapper is a wrapper over a unique_ptr&lt;destroyer_base&gt;.</span></span>
<span id="cb15-36">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// It is intended to be move-constructible ONLY.</span></span>
<span id="cb15-37">        destroy_wrapper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>destroy_wrapper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">noexcept</span></span>
<span id="cb15-38">          <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_destroyer_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>exchange<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_destroyer_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">nullptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb15-39">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb15-40">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb15-41"></span>
<span id="cb15-42">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()(</span>pointer ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb15-43">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb15-44">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(*</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_destroyer_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)(</span>ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Virtual polymorphism</span></span>
<span id="cb15-45">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb15-46"></span>
<span id="cb15-47">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> destroyer_base</span>
<span id="cb15-48">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb15-49">            <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()(</span>pointer ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb15-50">            <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>destroyer_base<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">default</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb15-51">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb15-52"></span>
<span id="cb15-53">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Deleter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb15-54">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> destroyer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">public</span> destroyer_base</span>
<span id="cb15-55">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb15-56">            <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">explicit</span> destroyer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Deleter deleter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb15-57">              <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> destroyer_base<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span></span>
<span id="cb15-58">              <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_deleter</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> deleter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb15-59">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb15-60">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb15-61"></span>
<span id="cb15-62">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()(</span>pointer ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">override</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_deleter</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb15-63"></span>
<span id="cb15-64">            Deleter <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_deleter</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb15-65">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb15-66"></span>
<span id="cb15-67">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>destroy_wrapper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb15-68">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>unique_ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>destroyer_base<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_destroyer_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb15-69">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb15-70"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span></code></pre></div>


</section>

 ]]></description>
  <category>C++</category>
  <guid>http://quantdev.blog/posts/type-erasure/index.html</guid>
  <pubDate>Sat, 28 Jun 2025 23:00:00 GMT</pubDate>
  <media:content url="http://quantdev.blog/posts/type-erasure/cpp.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>deducing this</title>
  <dc:creator>Quasar </dc:creator>
  <link>http://quantdev.blog/posts/deducing-this/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Member functions can be overloaded by <code>cv</code>-qualifiers and reference qualifiers <code>&amp;</code> (ref) and <code>&amp;&amp;</code> (ref-ref).</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/* </span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Member functions can be overloaded by cv-qualifiers and </span></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">reference qualifiers.</span></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*/</span></span>
<span id="cb1-5"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Implicit</span></span>
<span id="cb1-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> X<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb1-8">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> f<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;{</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X::f() &amp;"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb1-9">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> f<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;{</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X::f() const&amp;"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb1-10">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> f<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X::f() &amp;&amp;"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb1-11">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> f<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X::f() const&amp;&amp;"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb1-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb1-13"></span>
<span id="cb1-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//Explicit</span></span>
<span id="cb1-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> Y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb1-16">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> f<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span> Y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y::f() &amp;"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb1-17">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> f<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> Y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y::f() const&amp;"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb1-18">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> f<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span> Y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y::f() &amp;&amp;"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb1-19">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> f<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> Y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y::f() const &amp;&amp;"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb1-20"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb1-21"></span>
<span id="cb1-22"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb1-23">    X x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> Y y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> X c_x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> Y c_y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-25"></span>
<span id="cb1-26">    x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>f<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb1-27">    c_x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>f<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb1-28">    X<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">().</span>f<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb1-29">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">const_cast</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> X<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;&gt;(</span>X<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()).</span>f<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb1-30"></span>
<span id="cb1-31">    y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>f<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb1-32">    c_y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>f<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb1-33">    Y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">().</span>f<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb1-34">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">const_cast</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> Y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;&gt;(</span>Y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()).</span>f<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb1-35">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-36"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><a href="https://godbolt.org/z/ofYxKd95s">Compiler Explorer</a></p>
</section>
<section id="deducing-this-feature" class="level1">
<h1>deducing <code>this</code> feature</h1>
<p>If <code>const</code> and non-<code>const</code> overloads of a method and (ref)<code>&amp;</code> and (ref-ref)<code>&amp;&amp;</code> overloads share the same implementation, then we can de-duplicate these overloads and allow the compiler to automatically deduce the object type, on which the member function was invoked using this feature.</p>
<p>The real value of <code>deducing</code> this comes from using the type <code>Self</code> in some way in the body e.g.&nbsp;using <code>std::forward_like&lt;T,U&gt;</code> to propagate an owning-objects value category to its member data.</p>
<p>Consider the following example. We are writing a homegrown version of <code>vector&lt;T&gt;</code> container and want to implement the <code>begin()</code> method.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb2-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb2-2"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;memory&gt;</span></span>
<span id="cb2-3"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;type_traits&gt;</span></span>
<span id="cb2-4"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;concepts&gt;</span></span>
<span id="cb2-5"></span>
<span id="cb2-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb2-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb2-8">    T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-9">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>size_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_size</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-10">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>size_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_capacity</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-11"></span>
<span id="cb2-12">    vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span></span>
<span id="cb2-13">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">new</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]}</span></span>
<span id="cb2-14">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_size</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb2-15">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_capacity</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb2-16">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb2-17"></span>
<span id="cb2-18">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> U<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb2-19">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> Iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb2-20">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">difference_type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>ptrdiff_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-21">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">value_type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> U<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-22"></span>
<span id="cb2-23">        Iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">default</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-24"></span>
<span id="cb2-25">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">explicit</span> Iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>U<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb2-26">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb2-27">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb2-28"></span>
<span id="cb2-29">        U<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-30">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb2-31"></span>
<span id="cb2-32">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> iterator <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;;</span></span>
<span id="cb2-33">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> const_iterator <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;;</span></span>
<span id="cb2-34"></span>
<span id="cb2-35">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> begin<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb2-36">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> Iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb2-37">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//              ^----------</span></span>
<span id="cb2-38">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//               T* const, if self is const</span></span>
<span id="cb2-39">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//               T*, otherwise</span></span>
<span id="cb2-40">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb2-41"></span>
<span id="cb2-42">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> end<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb2-43">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> Iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_data</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_size</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb2-44">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb2-45"></span>
<span id="cb2-46">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb2-47">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">delete</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[]</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-48">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb2-49"></span>
<span id="cb2-50"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb2-51"></span>
<span id="cb2-52"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb2-53"></span>
<span id="cb2-54">    vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-55">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> cv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-56"></span>
<span id="cb2-57">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">static_assert</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span id="cb2-58">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>is_same_v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span></span>
<span id="cb2-59">            <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">decltype</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>begin<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()),</span></span>
<span id="cb2-60">            vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>Iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb2-61">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb2-62">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb2-63"></span>
<span id="cb2-64">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">static_assert</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span id="cb2-65">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>is_same_v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span></span>
<span id="cb2-66">            <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">decltype</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>cv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>begin<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()),</span></span>
<span id="cb2-67">            vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>Iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb2-68">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb2-69">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb2-70">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-71"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><a href="https://godbolt.org/z/o16zrj6GT">Compiler Explorer</a></p>
<p>Instead of writing traditional <code>const</code> and non-<code>const</code> variants of <code>begin()</code>, we are using the deducing <code>this</code> feature to de-duplicate overloads.</p>
<p>While at the outset, this code might look fine, be warned that <code>std::is_same_v&lt;decltype(cv.begin()),vector&lt;double&gt;::Iterator&lt;const double&gt;&gt;</code> returns <code>false_type</code>. <code>T* m_data</code> of a <code>const</code> object becomes <code>T* const m_data</code>, that is <code>const</code> ends up on the top-level of that type. <code>const</code> qualifiers on the top-level <code>Iterator</code> class are then discarded when template argument deduction is performed on the implicit function-template powering the constructor call <code>Iterator(self.m_data)</code>. The client may write hostile code and modify the contents of the <code>const vector</code> through the iterator object. What we want is a pointer-to-<code>const T</code> instead of a <code>const</code>-pointer-to-<code>T</code>.</p>
<p>We can branch on the <code>const</code>-ness of <code>self</code> and return the correct iterator type.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb3-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb3-2"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;memory&gt;</span></span>
<span id="cb3-3"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;type_traits&gt;</span></span>
<span id="cb3-4"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;concepts&gt;</span></span>
<span id="cb3-5"></span>
<span id="cb3-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb3-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-8">    T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-9">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>size_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_size</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-10">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>size_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_capacity</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-11"></span>
<span id="cb3-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> U<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb3-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> Iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-14">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">difference_type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>ptrdiff_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-15">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">value_type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> U<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-16">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> reference <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> U<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;;</span></span>
<span id="cb3-17">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> const_reference <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> U<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;;</span></span>
<span id="cb3-18">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> pointer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> U<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*;</span></span>
<span id="cb3-19"></span>
<span id="cb3-20">        U<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-21"></span>
<span id="cb3-22">        Iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">default</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-23"></span>
<span id="cb3-24">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">explicit</span> Iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>U<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb3-25">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-26">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb3-27">        </span>
<span id="cb3-28">        Iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++(){</span></span>
<span id="cb3-29">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-30">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-31">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-32"></span>
<span id="cb3-33">        Iterator <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb3-34">            <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> temp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb3-35">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-36">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> temp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-37">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-38"></span>
<span id="cb3-39">        Iterator <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb3-40">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> Iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_ptr</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb3-41">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-42"></span>
<span id="cb3-43">        U<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*(){</span></span>
<span id="cb3-44">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-45">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-46"></span>
<span id="cb3-47">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=&gt;(</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> Iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-48">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=&gt;</span>other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-49">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-50"></span>
<span id="cb3-51">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bool</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==(</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> Iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-52">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-53">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-54">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb3-55"></span>
<span id="cb3-56">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> iterator <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;;</span></span>
<span id="cb3-57">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> const_iterator <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;;</span></span>
<span id="cb3-58"></span>
<span id="cb3-59">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> begin<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb3-60">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>is_const_v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>remove_reference_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">decltype</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)&gt;&gt;)</span></span>
<span id="cb3-61">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> const_iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb3-62">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span></span>
<span id="cb3-63">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb3-64">            </span>
<span id="cb3-65">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-66"></span>
<span id="cb3-67">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> end<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb3-68">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>is_const_v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>remove_reference_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">decltype</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)&gt;&gt;)</span></span>
<span id="cb3-69">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> const_iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_data</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_size</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb3-70">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span></span>
<span id="cb3-71">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb3-72">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-73"></span>
<span id="cb3-74">    vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>size_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb3-75">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">static_cast</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*&gt;(::</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">new</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">sizeof</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">))</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-76">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_size</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-77">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_capacity</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-78">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-79">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>begin<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()};</span></span>
<span id="cb3-80">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-81">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(;</span>p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>begin<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()+</span>n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);++</span>p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb3-82">                <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">new</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">static_cast</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*&gt;(</span>p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">))</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb3-83">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-84">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">catch</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(...){</span></span>
<span id="cb3-85">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> q<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>begin<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()};</span> q<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span>p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++</span>q<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb3-86">                q<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;~</span>T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb3-87">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">delete</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb3-88">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">throw</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-89">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-90"></span>
<span id="cb3-91">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_size</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-92">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-93"></span>
<span id="cb3-94">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb3-95">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>destroy<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>begin<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(),</span> end<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">());</span></span>
<span id="cb3-96">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">delete</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb3-97">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-98"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb3-99"></span>
<span id="cb3-100"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> IterType<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb3-101"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> foo<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>IterType iter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb3-102">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"foo(IterType iter)"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">", *iter = "</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>iter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-103"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-104"></span>
<span id="cb3-105"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb3-106">    vector v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb3-107">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> vector cv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb3-108">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">static_assert</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span id="cb3-109">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>is_same_v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span></span>
<span id="cb3-110">            <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">decltype</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>begin<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()),</span></span>
<span id="cb3-111">            vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>Iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb3-112">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb3-113">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb3-114"></span>
<span id="cb3-115">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">static_assert</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span></span>
<span id="cb3-116">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>is_same_v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span></span>
<span id="cb3-117">            <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">decltype</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>cv<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>begin<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()),</span></span>
<span id="cb3-118">            vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>Iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb3-119">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb3-120">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb3-121"></span>
<span id="cb3-122">    foo<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span>begin<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">());</span></span>
<span id="cb3-123">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-124"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><a href="https://godbolt.org/z/nhfhW6z14">Compiler Explorer</a></p>
</section>
<section id="a-small-digression---auto-deduction-rules" class="level1">
<h1>A small digression - <code>auto</code> deduction rules</h1>
<p>In the below code snippet, can you tell why the static assertion passes?</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb4-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb4-2"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;concepts&gt;</span></span>
<span id="cb4-3"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;type_traits&gt;</span></span>
<span id="cb4-4"></span>
<span id="cb4-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb4-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> Wrapper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb4-7">    T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-8"></span>
<span id="cb4-9">    Wrapper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> val<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb4-10">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">new</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>val<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)}</span></span>
<span id="cb4-11">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb4-12"></span>
<span id="cb4-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span> Wrapper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb4-14">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-15">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb4-16"></span>
<span id="cb4-17">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span> Wrapper <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb4-18">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-19">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb4-20"></span>
<span id="cb4-21">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span> Wrapper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb4-22">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-23">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb4-24"></span>
<span id="cb4-25">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span> Wrapper <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb4-26">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-27">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb4-28"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb4-29"></span>
<span id="cb4-30"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb4-31">    Wrapper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> wrapper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb4-32">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> Wrapper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> const_wrapper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb4-33"></span>
<span id="cb4-34">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">static_assert</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>is_same_v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span></span>
<span id="cb4-35">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">decltype</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>const_wrapper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()),</span></span>
<span id="cb4-36">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb4-37">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;);</span></span>
<span id="cb4-38"></span>
<span id="cb4-39">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// const_wrapper.m_data = new int(10);  m_data is immutable</span></span>
<span id="cb4-40">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>const_wrapper<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_data</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-41">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-42"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><a href="https://compiler-explorer.com/z/bGMPYT6vh">Compiler Explorer</a></p>
<p>The static assertion passes, because <code>get()</code> returns <code>auto</code>. It is, as if, we are returning by value. <code>auto</code> always deduces a non-<code>const</code>, non-reference object.</p>
</section>
<section id="propagating-the-value-category-of-the-owning-object" class="level1">
<h1>Propagating the value category of the owning object</h1>
<p>Consider a highly simplified version of <code>optional&lt;T&gt;</code> which is a wrapper type for representing nullable <code>T</code> objects which may/may not contain a value.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb5-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb5-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> optional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-3">    T <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_storage</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-4">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bool</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_is_initialized</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-5"></span>
<span id="cb5-6">    optional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>T <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb5-7">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_storage</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb5-8">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_is_initialized</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb5-9">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-10">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">new</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">static_cast</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*&gt;&amp;</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_storage</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">));</span></span>
<span id="cb5-11">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-12"></span>
<span id="cb5-13">    optional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span></span>
<span id="cb5-14">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_storage</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb5-15">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_is_initialized</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-16">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb5-17"></span>
<span id="cb5-18">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/* ... */</span></span>
<span id="cb5-19"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span></code></pre></div>
<p>From a design perspective, we would like that getters such as <code>optional&lt;T&gt;::get()</code> should propagate the value-category of the owning object to its member data.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb6-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;utility&gt;</span></span>
<span id="cb6-2"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb6-3"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;type_traits&gt;</span></span>
<span id="cb6-4"></span>
<span id="cb6-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb6-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> optional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-7">    T <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_storage</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-8">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bool</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_is_initialized</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-9"></span>
<span id="cb6-10">    optional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>T <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb6-11">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_storage</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb6-12">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_is_initialized</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb6-13">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-14">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">new</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">static_cast</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*&gt;(&amp;</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_storage</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">))</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// placement new</span></span>
<span id="cb6-15">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-16">    </span>
<span id="cb6-17">    optional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span></span>
<span id="cb6-18">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_storage</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb6-19">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_is_initialized</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-20">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb6-21"></span>
<span id="cb6-22">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> Self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb6-23">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">decltype</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span> Self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb6-24">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>forward<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">decltype</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)&gt;(</span>self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_storage</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-25">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-26"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb6-27"></span>
<span id="cb6-28"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb6-29">    optional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> opt_d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">42.0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb6-30">    opt_d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb6-31"></span>
<span id="cb6-32">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> optional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> copt_d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb6-33">    copt_d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb6-34"></span>
<span id="cb6-35">    optional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">17.0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span>value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb6-36">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">static_cast</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>optional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&amp;&amp;&gt;(</span>optional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">28.0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)).</span>value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb6-37">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-38"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><a href="https://compiler-explorer.com/z/EjzzfsrGs">Compiler Explorer</a></p>
<p>One function template does it. This is equivalent to writing:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb7-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;utility&gt;</span></span>
<span id="cb7-2"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb7-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb7-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> optional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-5">    T <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_storage</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-6">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bool</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_is_initialized</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-7"></span>
<span id="cb7-8">    optional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>T <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb7-9">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_storage</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb7-10">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_is_initialized</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb7-11">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb7-12"></span>
<span id="cb7-13">    optional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span></span>
<span id="cb7-14">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_storage</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb7-15">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_is_initialized</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-16">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb7-17"></span>
<span id="cb7-18">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/*</span></span>
<span id="cb7-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    template&lt;typename Self&gt;</span></span>
<span id="cb7-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    decltype(auto) value(this Self&amp;&amp; self){</span></span>
<span id="cb7-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        return std::forward&lt;decltype(self)&gt;(self).m_storage;</span></span>
<span id="cb7-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    }</span></span>
<span id="cb7-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    */</span></span>
<span id="cb7-24">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">decltype</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span> optional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb7-25">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value(this optional&amp;)"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-26">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_storage</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-27">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-28"></span>
<span id="cb7-29">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">decltype</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span> optional <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb7-30">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value(this optional const&amp;)"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-31">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_storage</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb7-32">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-33"></span>
<span id="cb7-34">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">decltype</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span> optional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb7-35">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value(this optional &amp;&amp;)"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-36">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>move<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_storage</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb7-37">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-38"></span>
<span id="cb7-39">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">decltype</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span> optional <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb7-40">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value(this optional const &amp;&amp;)"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-41">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>move<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>self<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_storage</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb7-42">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-43"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb7-44"></span>
<span id="cb7-45"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb7-46">    optional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> opt_d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">42.0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb7-47">    opt_d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb7-48"></span>
<span id="cb7-49">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> optional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> copt_d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb7-50">    copt_d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb7-51"></span>
<span id="cb7-52">    optional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">17.0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span>value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb7-53">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">static_cast</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>optional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;&gt;(</span>optional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;(</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">28.0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)).</span>value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb7-54">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-55"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><a href="https://compiler-explorer.com/z/oeGvjE418">Compiler Explorer</a></p>
</section>
<section id="getter-return-types" class="level1">
<h1>Getter return types</h1>
<p>If we need to propagate both <code>const</code>-ness and the value category of the owning object <code>o</code> to its <code>T m_data</code> data-member, we could use <code>std::forward_like&lt;T,U&gt;</code> defined in the <code>&lt;utility&gt;</code> header.</p>


</section>

 ]]></description>
  <category>C++</category>
  <guid>http://quantdev.blog/posts/deducing-this/index.html</guid>
  <pubDate>Thu, 19 Jun 2025 23:00:00 GMT</pubDate>
  <media:content url="http://quantdev.blog/posts/deducing-this/cpp.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>A bounded SPSC lock-free queue implementation</title>
  <dc:creator>Quasar </dc:creator>
  <link>http://quantdev.blog/posts/spsc_lockfree_queue/index.html</link>
  <description><![CDATA[ 




<section id="designing-the-spsc_queue-data-structure" class="level1">
<h1>Designing the <code>spsc_queue</code> data-structure</h1>
<p>There are several important performance considerations, when implementing an SPSC lock-free queue.</p>
<section id="read_index-and-write_index-indices" class="level2">
<h2 class="anchored" data-anchor-id="read_index-and-write_index-indices"><code>read_index</code> and <code>write_index</code> indices</h2>
<p>A queue needs to keep track of the <code>read_index</code> (the head of the queue) and the <code>write_index</code> (the tail of the queue). These indices should be atomically incremented.</p>
</section>
<section id="why-implementing-growing-lock-free-queues-is-much-harder" class="level2">
<h2 class="anchored" data-anchor-id="why-implementing-growing-lock-free-queues-is-much-harder">Why implementing growing lock-free queues is much harder?</h2>
<p>Lock-free queues are generally bounded queues. Imagine a scenario where the underlying data-structure of a lock-free queue is <code>std::vector&lt;T&gt;</code> which can grow dynamically in size.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb1-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> spsc_queue<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb1-2">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_buffer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-3">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>atomic<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>size_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_write_index</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb1-4">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>atomic<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>size_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_read_index</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb1-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span></code></pre></div>
<p>Now, a writer thread <code>W</code> that wants to write an element to the queue, performs <code>push_back()</code> on the vector. Assume that the vectors <code>size() == capacity()</code>, so it is full. Internally the vector does the following steps:</p>
<ul>
<li><p>A new heap memory allocation is performed with a larger capacity equal to two times the original capacity.</p></li>
<li><p>Move/copy construct elements of type <code>T</code> from the old memory block to the new memory block.</p></li>
<li><p>Free the old memory block.</p></li>
</ul>
<p><code>m_buffer</code> is reassigned to the new memory block. Since there is more room for the new element, it Will be copied/moved to <code>m_buffer[write_index + 1]</code>.</p>
<p>At this point a reader thread <code>R</code> wants to pop an element off the queue.</p>
<p>The writer thread <code>W</code>, however, hasnt synchronized with the reader thread <code>R</code>.</p>
<p>So, the reader thread <code>R</code> accesses <code>m_buffer[read_index]</code>. However, in this thread <code>m_buffer</code> still refers to the old memory block. This is UB(undefined behavior).</p>
<p>Consequently, lock-free queues are usually bounded. You can implement growing lock-free queues, its much harder and potentially has higher overhead compared to a fixed-capacity queue.</p>
</section>
<section id="cache-lines-and-cache-coherency." class="level2">
<h2 class="anchored" data-anchor-id="cache-lines-and-cache-coherency.">Cache lines and cache coherency.</h2>
<p>A cache-line is typically <img src="https://latex.codecogs.com/png.latex?64">-bytes on most machines.</p>
<p>If cache line X is in the cache of multiple cores, and one of these cores mutates its data, then the change must be reflected in all the cores owning X via a cache coherency mechanism</p>
<p>For simplicity, suppose there are <img src="https://latex.codecogs.com/png.latex?2"> cores - A and B. Further assume, that core A reads and writes to a variable <code>a</code>, core B reads and writes to a variable <code>b</code>, and <code>a</code> and <code>b</code> are close to each other in main memory - they are on the same cache line.</p>
<p>Core A first reads the value of <code>a</code> from main memory. It therefore loads the entire cache line and marks it as <strong>exclusive</strong> access as it is the only core operating on this cache line. Core B decides to read the value of <code>b</code>. Since, <code>a</code> and <code>b</code> are close and reside on the same cache line, Core B loads the same cache line and both cores tag their cache lines as <strong>shared</strong> access.</p>
<p>Now, lets suppose core A decides to change the value of <code>a</code>. The core A stores this change only in its store buffer and marks its cache line as <strong>modified</strong>. It also communicates this change to core B, and this core in turn will mark its cache as <strong>invalidated</strong>.</p>
<p>Thats how different cores ensure their caches are coherent with each other.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="http://quantdev.blog/posts/spsc_lockfree_queue/https:/wiki.cdot.senecapolytechnic.ca/w/imgs/CPUCacheline.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">CPU Cache line</figcaption>
</figure>
</div>
</section>
<section id="false-sharing" class="level2">
<h2 class="anchored" data-anchor-id="false-sharing">False Sharing</h2>
<p>False-sharing occurs when threads on different processors modify different variables residing on the same cache-line.</p>
<p>What happens now, when core B decides to re-read the value of <code>b</code>? Since, the cache line for core B is invalidated, it should now read the value of <code>b</code> from main memory again. This will force the core A to flush its store buffer, and then core B re-fetches the latest cache-line version from main memory. Both cores end up with the latest cache-line version in the <strong>shared</strong> state again.</p>
<p>So, this imposes a cache miss to one core and an early buffer flush to another one, even though the two cores werent operating on the same memory location. This is called <strong>false-sharing</strong>.</p>
<p>Keeping objects close in memory is often very desirable for performance reasons. False sharing is a potential risk for multithreaded applications that mutate data.</p>
</section>
<section id="avoiding-false-sharing" class="level2">
<h2 class="anchored" data-anchor-id="avoiding-false-sharing">Avoiding false sharing</h2>
<p>To avoid false-sharing, the <a href="https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0154r1.html"><code>std::hardware_destructive_interference_size</code></a> constant defined in the <code>thread</code> header, is used to determine the cache-line size and is to be used with <code>alignas()</code>.</p>
<p>So, we define our <code>spspc_queue</code> class as follows:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Queueable T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>size_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb2-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> spsc_queue<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb2-3">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">private</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb2-4">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>size_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-5">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">value_type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-6">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> reference <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;;</span></span>
<span id="cb2-7"></span>
<span id="cb2-8">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>size_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_capacity</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb2-9">        T <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_buffer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_capacity</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">];</span></span>
<span id="cb2-10">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">alignas</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>hardware_destructive_interference_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>atomic<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>size_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_read_index</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb2-11">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">alignas</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>hardware_destructive_interference_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>atomic<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>size_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_write_index</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb2-12">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span></code></pre></div>
</section>
<section id="implementing-try_push-and-try_pop-methods" class="level2">
<h2 class="anchored" data-anchor-id="implementing-try_push-and-try_pop-methods">Implementing <code>try_push</code> and <code>try_pop</code> methods</h2>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb3-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb3-2"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;atomic&gt;</span></span>
<span id="cb3-3"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;type_traits&gt;</span></span>
<span id="cb3-4"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;concepts&gt;</span></span>
<span id="cb3-5"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;vector&gt;</span></span>
<span id="cb3-6"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;optional&gt;</span></span>
<span id="cb3-7"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;thread&gt;</span></span>
<span id="cb3-8"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;math.h&gt;</span></span>
<span id="cb3-9"></span>
<span id="cb3-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">namespace</span> dev<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-11">    </span>
<span id="cb3-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb3-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">concept</span> Queueable <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>default_initializable<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>move_constructible<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;;</span></span>
<span id="cb3-14"></span>
<span id="cb3-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/**</span></span>
<span id="cb3-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">     * </span><span class="an" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@brief</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> The `spsc_queue` class provides a single-reader, single-writer</span></span>
<span id="cb3-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">     * fifo queue. </span></span>
<span id="cb3-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">     */</span></span>
<span id="cb3-19">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Queueable T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>size_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb3-20">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> spsc_queue<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-21">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">private</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-22">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">size_type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>size_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-23">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">value_type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-24">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> reference <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;;</span></span>
<span id="cb3-25"></span>
<span id="cb3-26">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">static</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">constexpr</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>size_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_capacity</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)};</span></span>
<span id="cb3-27">        T <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_buffer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_capacity</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">];</span></span>
<span id="cb3-28">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">alignas</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>hardware_destructive_interference_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>atomic<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>size_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_read_index</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb3-29">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">alignas</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>hardware_destructive_interference_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>atomic<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>size_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_write_index</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb3-30"></span>
<span id="cb3-31">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">public</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-32">        spsc_queue<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">default</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-33">        spsc_queue<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> spsc_queue<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">delete</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-34">        spsc_queue<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=(</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> spsc_queue<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">delete</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-35">        spsc_queue<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>spsc_queue<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">delete</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-36">        spsc_queue<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=(</span>spsc_queue<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">delete</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-37"></span>
<span id="cb3-38">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/**</span></span>
<span id="cb3-39"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">         * </span><span class="an" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@brief</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> pushes an element onto the ringbuffer.</span></span>
<span id="cb3-40"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">         * </span><span class="an" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@param</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span><span class="cv" style="color: #5E5E5E;
background-color: null;
font-style: italic;">`element`</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> will be pushed to the queue unless the queue is not full</span></span>
<span id="cb3-41"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">         */</span></span>
<span id="cb3-42">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> U<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb3-43">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">requires</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>is_convertible_v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>U<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb3-44">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bool</span> try_push<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>U<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb3-45">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>size_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>write_index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_write_index</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>load<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>memory_order_relaxed<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb3-46">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>size_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>next_write_index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>write_index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_capacity</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb3-47"></span>
<span id="cb3-48">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>next_write_index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_read_index</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>load<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>memory_order_acquire<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">))</span></span>
<span id="cb3-49">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-50">                <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_buffer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span>write_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>forward<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>U<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;(</span>element<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb3-51">                <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_write_index</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>store<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>next_write_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>memory_order_release<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb3-52">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-53">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span>   </span>
<span id="cb3-54">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-55">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-56">        </span>
<span id="cb3-57">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>optional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> try_pop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb3-58">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>optional<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> result<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>nullopt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb3-59">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>size_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>read_index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_read_index</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>load<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>memory_order_relaxed<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb3-60"></span>
<span id="cb3-61">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>read_index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_write_index</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>load<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>memory_order_acquire<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">))</span></span>
<span id="cb3-62">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-63"></span>
<span id="cb3-64">            result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>move<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_buffer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span>read_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]);</span></span>
<span id="cb3-65">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_read_index</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>store<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">((</span>read_index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_capacity</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">),</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>memory_order_release<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb3-66">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-67">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-68">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb3-69"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>


</section>
</section>

 ]]></description>
  <category>C++</category>
  <guid>http://quantdev.blog/posts/spsc_lockfree_queue/index.html</guid>
  <pubDate>Sat, 07 Jun 2025 23:00:00 GMT</pubDate>
  <media:content url="http://quantdev.blog/posts/spsc_lockfree_queue/cpp.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Storage Durations in C++</title>
  <dc:creator>Quasar </dc:creator>
  <link>http://quantdev.blog/posts/storage-duration/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Two key properties of an object in C++ are storage and linkage.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Storage Duration.</strong> The storage duration is the property of an object that defines the minimum potential lifetime of the storage containing the object. The storage duration is determined by the construct used to create the object.</p>
</div>
</div>
<p>An object in C++ has one of the following storage durations:</p>
<ul>
<li><p><code>automatic</code> : Automatic means that the storage is allocated at the start of the scope. Most local variables have <code>automatic</code> storage duration (except those declared as <code>static</code>, <code>extern</code> or <code>thread_local</code> ).</p></li>
<li><p><code>static</code> : The storage for an object is allocated when the program begins usually before the <code>main()</code> function starts and is deallocated when the program ends. Theres only one instance of such an object in the whole program.</p></li>
<li><p><code>thread</code> : The storage for an object is tied to a thread: its started when a thread begins and is deallocated when the thread ends. Each thread has its own copy of the object.</p></li>
<li><p><code>dynamic</code> : The storage for an object is allocated and deallocated using explicit dynamic memory allocation functions.</p></li>
</ul>
<p>The definition of the second property linkage from the standard is as follows:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Linkage.</strong> A name is said to have a linkage when it can denote the same object, reference , function type, template, namespace as a name introduced in another scope.</p>
</div>
</div>
<p>We can have several linkage types:</p>
<ul>
<li><code>external</code> linkage : External means that the name can be referred to in scopes within the same translation unit or outside. Non-<code>const</code> global variables have <code>extern</code> storage duration.</li>
</ul>


</section>

 ]]></description>
  <category>C++</category>
  <guid>http://quantdev.blog/posts/storage-duration/index.html</guid>
  <pubDate>Wed, 21 May 2025 23:00:00 GMT</pubDate>
  <media:content url="http://quantdev.blog/posts/storage-duration/cpp.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>The virtual keyword</title>
  <dc:creator>Quasar </dc:creator>
  <link>http://quantdev.blog/posts/virtualization/index.html</link>
  <description><![CDATA[ 




<section id="virtual-functions" class="level1">
<h1><code>virtual</code> functions</h1>
<p>The <code>virtual</code> keyword specifies that a non-static member function is <code>virtual</code> and supports dynamic dispatch. It may only appear in the initial declaration of a non-static member function (i.e., when it is declared in the class definition).</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb1-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> Base</span>
<span id="cb1-4"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb1-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">public</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb1-6">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> foo<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb1-7">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Base::foo()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-8">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb1-9"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> Derived <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">public</span> Base<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb1-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">public</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb1-13">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> foo<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb1-14">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Derived::foo()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-15">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb1-16"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb1-17"></span>
<span id="cb1-18"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb1-19">    Base base_obj<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-20">    Derived derived_obj<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-21">    Base<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> base_ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">nullptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb1-22"></span>
<span id="cb1-23">    base_ptr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span>base_obj<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-24">    base_ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>foo<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb1-25"></span>
<span id="cb1-26">    base_ptr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span>derived_obj<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-27">    base_ptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>foo<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb1-28">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-29"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>Run at <a href="https://godbolt.org/z/jG9bG4Yrs">Compiler Explorer</a></p>
<p>Output:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb2-1">Base::foo()</span>
<span id="cb2-2">Base::foo()</span></code></pre></div>
<p>The version of <code>foo</code> invoked is determined at compile time, based on the pointer type.</p>
<p>If we declare the <code>foo()</code> as a virtual method, then the version of <code>foo()</code> invoked is resolved dynamically on-the-fly depending on <strong>the type of object being pointed to</strong> (<em>pointee</em>).</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb3-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb3-2"></span>
<span id="cb3-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> Base</span>
<span id="cb3-4"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">public</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> foo<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb3-7">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Base::foo()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-8">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-9"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb3-10"></span>
<span id="cb3-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> Derived <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">public</span> Base<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">public</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-13">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> foo<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">override</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//override is optional</span></span>
<span id="cb3-14">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Derived::foo()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-15">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-16"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb3-17"></span>
<span id="cb3-18"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb3-19">    Base b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-20">    Derived d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-21">    </span>
<span id="cb3-22">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Virtual function call through reference</span></span>
<span id="cb3-23">    Base<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> br <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// the type of br is Base&amp;</span></span>
<span id="cb3-24">    Base<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> dr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// the type of dr is Base&amp;</span></span>
<span id="cb3-25">    br<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>foo<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span>       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Calls Base::foo()</span></span>
<span id="cb3-26">    dr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>foo<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span>       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Calls Derived::foo()</span></span>
<span id="cb3-27"></span>
<span id="cb3-28">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Virtual function call through pointers</span></span>
<span id="cb3-29">    Base<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> bp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span>b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// type of bp is Base*</span></span>
<span id="cb3-30">    Base<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> dp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span>d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// type of dp is Base* as well</span></span>
<span id="cb3-31">    bp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>foo<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span>      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Calls Base::foo()</span></span>
<span id="cb3-32">    dp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>foo<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span>      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Calls Derived::foo()</span></span>
<span id="cb3-33"></span>
<span id="cb3-34">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Non-virtual function calls</span></span>
<span id="cb3-35">    br<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>Base<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>foo<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb3-36">    dr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>Base<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>foo<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb3-37">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-38"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>Run at <a href="https://godbolt.org/z/aYhbofMPb">Compiler Explorer</a></p>
<p>Output:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb4-1">Base::foo()</span>
<span id="cb4-2">Derived::foo()</span>
<span id="cb4-3">Base::foo()</span>
<span id="cb4-4">Derived::foo()</span>
<span id="cb4-5">Base::foo()</span>
<span id="cb4-6">Base::foo()</span></code></pre></div>
<p>A derived class <code>virtual</code> function is considered an override if and only if it has the same</p>
<ul>
<li>name</li>
<li>parameter type list (but not the return type)</li>
<li>cv-qualifiers</li>
<li>ref-qualifiers</li>
</ul>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb5-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb5-2"></span>
<span id="cb5-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> Base</span>
<span id="cb5-4"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">public</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb5-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> vf<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb5-7">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Base::vf()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-8">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-9"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb5-10"></span>
<span id="cb5-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> Derived <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">public</span> Base<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">public</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb5-13">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> vf<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-14">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Derived::vf() const"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-15">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-16"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb5-17"></span>
<span id="cb5-18"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb5-19">    Base b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-20">    Derived d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> Derived const_d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-22"></span>
<span id="cb5-23">    Base<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> bp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">nullptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb5-24"></span>
<span id="cb5-25">    bp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span>b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-26">    bp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>vf<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb5-27"></span>
<span id="cb5-28">    bp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span>d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-29">    bp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>vf<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb5-30">    d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>vf<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb5-31">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-32"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>Output:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb6-1">Base::vf()</span>
<span id="cb6-2">Base::vf()</span>
<span id="cb6-3">Derived::vf() const</span></code></pre></div>
<p>In the above code snippet, the compiler does not treat <code>void Derived::vf() const</code> as an override for the base class virtual member function <code>void Base::vf()</code>.</p>
<section id="dynamic-dispatch" class="level2">
<h2 class="anchored" data-anchor-id="dynamic-dispatch">Dynamic dispatch</h2>
<p>A member function defined as <code>virtual</code> in the base class will be <code>virtual</code> in all child classes.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb7-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb7-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> vf<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb7-4">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A::vf()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-5">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-6"></span>
<span id="cb7-7">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> g<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb7-8">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A::g()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-9">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb7-11"> </span>
<span id="cb7-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> B <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-13">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> vf<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">override</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-14">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B::vf()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-15">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-16"></span>
<span id="cb7-17">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> g<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb7-18">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B::g()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-19">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-20"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb7-21"></span>
<span id="cb7-22"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> C <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> B<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-23">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> vf<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">override</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-24">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C::vf()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-25">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-26"></span>
<span id="cb7-27">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> g<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb7-28">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C::g()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-29">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-30"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb7-31"></span>
<span id="cb7-32"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> D <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-33">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> g<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb7-34">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D::g()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-35">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-36"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb7-37"></span>
<span id="cb7-38"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span></span>
<span id="cb7-39"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-40">    A a<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> B b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> C c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> D d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-41">    A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> a_as_aptr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span>a<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-42">    A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b_as_aptr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span>b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-43">    A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> c_as_aptr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span>c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-44">    A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> d_as_aptr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span>d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-45"></span>
<span id="cb7-46">    a_as_aptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>vf<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb7-47">    b_as_aptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>vf<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb7-48">    c_as_aptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>vf<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb7-49">    d_as_aptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>vf<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb7-50"></span>
<span id="cb7-51">    a_as_aptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>g<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb7-52">    b_as_aptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>g<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb7-53">    c_as_aptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>g<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb7-54">    d_as_aptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>g<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb7-55"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>Run at <a href="https://godbolt.org/z/zxeo53ah6">Compiler Explorer</a></p>
<p>Output:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb8-1">A::vf()</span>
<span id="cb8-2">B::vf()</span>
<span id="cb8-3">C::vf()</span>
<span id="cb8-4">C::vf()</span>
<span id="cb8-5">A::g()</span>
<span id="cb8-6">A::g()</span>
<span id="cb8-7">A::g()</span>
<span id="cb8-8">A::g()</span></code></pre></div>
<p>Because <code>vf()</code> is a virtual function, the dynamic type (type of the pointee object) is used at run-time to resolve calls to <code>b_as_aptr-&gt;vf()</code> or <code>c_as_aptr-&gt;vf()</code>. With non-virtual functions such as <code>g()</code>, the compiler uses the static type to determine what function to call, and it can do so at compile-time.</p>
</section>
<section id="override-a-useful-feature-to-prevent-bugs" class="level2">
<h2 class="anchored" data-anchor-id="override-a-useful-feature-to-prevent-bugs"><code>override</code>: a useful feature to prevent bugs</h2>
<p>Every time you define a method in the derived class that override <code>virtual</code> member function in the base class, as a good practice, tag it <code>override</code>. This way, you show that your intention for the derived class is to override the behavior of <code>vf</code> in the base class.</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb9-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb9-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> Base<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb9-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> vf<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb9-4">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"void Base::vf()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb9-5">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb9-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb9-7"></span>
<span id="cb9-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> Derived <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">public</span> Base<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb9-9">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> vf<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">override</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb9-10">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"void Derived::vf()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb9-11">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb9-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span></code></pre></div>
<p>If a function is declared with specifier <code>override</code> but does not override a base class <code>virtual</code> member function, the program is ill-formed and will not compile.</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb10-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb10-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> Base<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> vf<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb10-4">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"void Base::vf()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-5">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb10-7"></span>
<span id="cb10-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> Derived <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">public</span> Base<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-9">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> vf<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">long</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">override</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-10">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"void Derived::vf()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-11">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span></code></pre></div>
<p>Run at <a href="https://godbolt.org/z/jGcW14Gfs">Compiler Explorer</a></p>
<p><code>Base::vf()</code> does not need to be accessible or visible to be overriden. <code>Base::vf()</code> can be declared as <code>private</code>, or <code>Base</code> can be inherited using <code>private</code> inheritance.</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb11-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb11-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> B</span>
<span id="cb11-3"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb11-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> do_f<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// private member</span></span>
<span id="cb11-5">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B::do_f()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-6">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb11-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">public</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb11-8">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> f<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> do_f<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// public interface</span></span>
<span id="cb11-9"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb11-10"> </span>
<span id="cb11-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> D <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">public</span> B</span>
<span id="cb11-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb11-13">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> do_f<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">override</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// overrides B::do_f</span></span>
<span id="cb11-14">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D::do_f()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-15">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb11-16"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb11-17"> </span>
<span id="cb11-18"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span></span>
<span id="cb11-19"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb11-20">    D d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-21">    B<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> bp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span>d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb11-22">    bp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>f<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// internally calls D::do_f();</span></span>
<span id="cb11-23"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>Run at <a href="https://godbolt.org/z/Ge9vob6hG">Compiler Explorer</a></p>
</section>
</section>
<section id="virtual-destructors" class="level1">
<h1><code>virtual</code> destructors</h1>
<p>Consider the following code snippet, where we intend to use a class hierarchy polymorphically:</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb12-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb12-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb12-3">    A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb12-4">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~A()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb12-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb12-6"></span>
<span id="cb12-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> B <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb12-8">    B<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb12-9">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>B<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~B()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb12-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb12-11"></span>
<span id="cb12-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> C <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> B<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb12-13">    C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb12-14">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~C()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb12-15"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb12-16"></span>
<span id="cb12-17"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb12-18">    A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> c_as_aptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">new</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()};</span></span>
<span id="cb12-19">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">delete</span> c_as_aptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb12-20">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb12-21"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>Run at <a href="https://godbolt.org/z/GoTGsrKq8">Compiler Explorer</a></p>
<p>Output:</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb13-1">A()</span>
<span id="cb13-2">B()</span>
<span id="cb13-3">C()</span>
<span id="cb13-4">~A()</span></code></pre></div>
<p><code>new C()</code> dynamically allocates memory on the heap and default-initializes a <code>C()</code> object in this memory block. The address of the newly constructed object is stored in <code>c_as_aptr</code> pointer variable.</p>
<p>If we comment out line 19, we shall leak memory. All calls to <code>new</code> or <code>new[]</code> must be matched by corresponding calls to <code>delete</code> or <code>delete[]</code>.</p>
<p><code>delete T</code> for a type <code>T</code> calls the destructor <code>~T()</code> and deallocates the memory space occupied by <code>T</code>.</p>
<p>Since the base-class destructor <code>~A()</code> is a non-virtual function, <code>delete c_as_aptr</code> has undefined behavior. In most implementations, the call to the destructor will be resolved like any non-virtual code, meaning that the destructor of the base class will be called but not the one of the derived class, resulting in a resources leak.</p>
<p>Always make base classes destructors virtual when theyre meant to be manipulated polymorphically.</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb14-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb14-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-3">    A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb14-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~A()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb14-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb14-6"></span>
<span id="cb14-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> B <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-8">    B<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb14-9">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>B<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~B()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb14-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb14-11"></span>
<span id="cb14-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> C <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> B<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-13">    C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb14-14">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~C()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb14-15"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb14-16"></span>
<span id="cb14-17"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb14-18">    A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> c_as_aptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">new</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()};</span></span>
<span id="cb14-19">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">delete</span> c_as_aptr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-20">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-21"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>Run at <a href="https://godbolt.org/z/zh5rT9T5d">Compiler Explorer</a></p>
<p>Output:</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb15-1">A()</span>
<span id="cb15-2">B()</span>
<span id="cb15-3">C()</span>
<span id="cb15-4">~C()</span>
<span id="cb15-5">~B()</span>
<span id="cb15-6">~A()</span></code></pre></div>
</section>
<section id="virtual-inheritance-and-the-diamond-problem" class="level1">
<h1><code>virtual</code> inheritance and the diamond problem</h1>
<p>Unlike non-virtual inheritance described above, <code>virtual</code> inheritance uses the keyword <code>virtual</code> as the access specifier, when inheriting from a base class.</p>
<p>The difference between conventional inheritance and <code>virtual</code> inheritance is that <code>virtual</code> inheritance allows a diamond class hierarchy and child classes inherit only one copy of the <code>virtual</code> base class.</p>
<p>Consider the following code snippet:</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb16-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb16-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> B <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> A <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb16-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> C <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> A <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb16-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> D <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> B<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> C <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span></code></pre></div>
<p>Here, <code>D</code> inherits indirectly from <code>A</code>, it inherits a copy of class <code>A</code> from via <code>B</code> and a second copy of class <code>A</code> via <code>C</code>. So, <code>D</code> inherits two copies of class <code>A</code>.</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb17-1">A   A</span>
<span id="cb17-2">|   |</span>
<span id="cb17-3">B   C</span>
<span id="cb17-4"> \ /</span>
<span id="cb17-5">  D</span></code></pre></div>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb18-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb18-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb18-3">    A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;}</span></span>
<span id="cb18-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~A()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb18-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb18-6"></span>
<span id="cb18-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> B <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb18-8">    B<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;}</span></span>
<span id="cb18-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>B<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~B()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb18-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb18-11"></span>
<span id="cb18-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> C <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb18-13">    C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;}</span></span>
<span id="cb18-14">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~C()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb18-15"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb18-16"></span>
<span id="cb18-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> D <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> B<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb18-18">    D<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;}</span></span>
<span id="cb18-19">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>D<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~D()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb18-20"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb18-21"></span>
<span id="cb18-22"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb18-23">    D d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb18-24">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb18-25"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>Run at <a href="https://godbolt.org/z/Mf4bjo3xK">Compiler Explorer</a></p>
<p>Output:</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb19-1">A()</span>
<span id="cb19-2">B()</span>
<span id="cb19-3">A()</span>
<span id="cb19-4">C()</span>
<span id="cb19-5">D()</span>
<span id="cb19-6">~D()</span>
<span id="cb19-7">~C()</span>
<span id="cb19-8">~A()</span>
<span id="cb19-9">~B()</span>
<span id="cb19-10">~A()</span></code></pre></div>
<p>To solve this problem, we must make <code>A</code> as a <code>virtual</code> base class for both <code>B</code> and <code>C</code>. <code>D</code> inherits from both <code>B</code> and <code>C</code>. This time, because <code>A</code> is inherited virtually by <code>B</code> and <code>C</code> only one instance of the <code>A</code> subobject will be created for `D.</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb20-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb20-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb20-3">    A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;}</span></span>
<span id="cb20-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~A()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb20-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb20-6"></span>
<span id="cb20-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> B <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">public</span> A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb20-8">    B<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;}</span></span>
<span id="cb20-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>B<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~B()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb20-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb20-11"></span>
<span id="cb20-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> C <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">public</span> A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb20-13">    C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;}</span></span>
<span id="cb20-14">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~C()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb20-15"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb20-16"></span>
<span id="cb20-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> D <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">public</span> B<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">public</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb20-18">    D<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;}</span></span>
<span id="cb20-19">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>D<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~D()"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb20-20"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb20-21"></span>
<span id="cb20-22"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb20-23">    D d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb20-24">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb20-25"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>Run at <a href="https://godbolt.org/z/9ME45Gbod">Compiler Explorer</a></p>
<p>Output:</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb21-1">A()</span>
<span id="cb21-2">B()</span>
<span id="cb21-3">C()</span>
<span id="cb21-4">D()</span>
<span id="cb21-5">~D()</span>
<span id="cb21-6">~C()</span>
<span id="cb21-7">~B()</span>
<span id="cb21-8">~A()</span></code></pre></div>
</section>
<section id="class-hierarchy-virtual-tables-virtual-table-table" class="level1">
<h1>Class Hierarchy, Virtual Tables, Virtual Table Table</h1>
<p>Consider the following class hierarchy:</p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb22-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb22-2">    A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">default</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb22-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> foo<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb22-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> baz<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb22-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">default</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb22-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb22-7"></span>
<span id="cb22-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> B<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb22-9">    B<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">default</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb22-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> foo<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){};</span></span>
<span id="cb22-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> baz<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){};</span></span>
<span id="cb22-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>B<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">default</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb22-13"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb22-14"></span>
<span id="cb22-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> C <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> B<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb22-16">    C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">default</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb22-17">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> foo<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">override</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb22-18">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> c_bar<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb22-19">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> bar<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb22-20">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">default</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb22-21"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb22-22"></span>
<span id="cb22-23"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> D <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> A<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb22-24">    D<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">default</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb22-25">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Overriding A virtual functions</span></span>
<span id="cb22-26">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> foo<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">override</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb22-27">    </span>
<span id="cb22-28">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Overriding C virtual functions</span></span>
<span id="cb22-29">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> bar<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">override</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb22-30"></span>
<span id="cb22-31">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// non-virtual functions</span></span>
<span id="cb22-32">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> d_bar<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb22-33">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">virtual</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>D<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">default</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb22-34"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb22-35"></span>
<span id="cb22-36"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb22-37">    D d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb22-38">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb22-39"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>We could dump the class hierarchy information including the virtual table information, using the <code>gcc</code> compiler flag <code>-fdump-lang-class</code>.</p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb23-1">[quantdev@quasar-arch virtual_tables]$ g++ -g -fdump-lang-class main.cpp -o main</span>
<span id="cb23-2">[quantdev@quasar-arch virtual_tables]$ cat main.cpp.001l.class</span>
<span id="cb23-3">Vtable for A</span>
<span id="cb23-4">A::_ZTV1A: 6 entries</span>
<span id="cb23-5">0     (int (*)(...))0</span>
<span id="cb23-6">8     (int (*)(...))(&amp; _ZTI1A)</span>
<span id="cb23-7">16    (int (*)(...))__cxa_pure_virtual</span>
<span id="cb23-8">24    (int (*)(...))A::baz</span>
<span id="cb23-9">32    0</span>
<span id="cb23-10">40    0</span>
<span id="cb23-11"></span>
<span id="cb23-12">Class A</span>
<span id="cb23-13">   size=8 align=8</span>
<span id="cb23-14">   base size=8 base align=8</span>
<span id="cb23-15">A (0x0x7cb4a0bd8000) 0 nearly-empty</span>
<span id="cb23-16">    vptr=((&amp; A::_ZTV1A) + 16)</span>
<span id="cb23-17"></span>
<span id="cb23-18">Vtable for B</span>
<span id="cb23-19">B::_ZTV1B: 6 entries</span>
<span id="cb23-20">0     (int (*)(...))0</span>
<span id="cb23-21">8     (int (*)(...))(&amp; _ZTI1B)</span>
<span id="cb23-22">16    (int (*)(...))B::foo</span>
<span id="cb23-23">24    (int (*)(...))B::baz</span>
<span id="cb23-24">32    (int (*)(...))B::~B</span>
<span id="cb23-25">40    (int (*)(...))B::~B</span>
<span id="cb23-26"></span>
<span id="cb23-27">Class B</span>
<span id="cb23-28">   size=8 align=8</span>
<span id="cb23-29">   base size=8 base align=8</span>
<span id="cb23-30">B (0x0x7cb4a0bd8120) 0 nearly-empty</span>
<span id="cb23-31">    vptr=((&amp; B::_ZTV1B) + 16)</span>
<span id="cb23-32"></span>
<span id="cb23-33">Vtable for C</span>
<span id="cb23-34">C::_ZTV1C: 7 entries</span>
<span id="cb23-35">0     (int (*)(...))0</span>
<span id="cb23-36">8     (int (*)(...))(&amp; _ZTI1C)</span>
<span id="cb23-37">16    (int (*)(...))C::foo</span>
<span id="cb23-38">24    (int (*)(...))B::baz</span>
<span id="cb23-39">32    (int (*)(...))C::~C</span>
<span id="cb23-40">40    (int (*)(...))C::~C</span>
<span id="cb23-41">48    (int (*)(...))C::bar</span>
<span id="cb23-42"></span>
<span id="cb23-43">Class C</span>
<span id="cb23-44">   size=8 align=8</span>
<span id="cb23-45">   base size=8 base align=8</span>
<span id="cb23-46">C (0x0x7cb4a0a0e618) 0 nearly-empty</span>
<span id="cb23-47">    vptr=((&amp; C::_ZTV1C) + 16)</span>
<span id="cb23-48">B (0x0x7cb4a0bd8180) 0 nearly-empty</span>
<span id="cb23-49">      primary-for C (0x0x7cb4a0a0e618)</span>
<span id="cb23-50"></span>
<span id="cb23-51">Vtable for D</span>
<span id="cb23-52">D::_ZTV1D: 13 entries</span>
<span id="cb23-53">0     (int (*)(...))0</span>
<span id="cb23-54">8     (int (*)(...))(&amp; _ZTI1D)</span>
<span id="cb23-55">16    (int (*)(...))D::foo</span>
<span id="cb23-56">24    (int (*)(...))B::baz</span>
<span id="cb23-57">32    (int (*)(...))D::~D</span>
<span id="cb23-58">40    (int (*)(...))D::~D</span>
<span id="cb23-59">48    (int (*)(...))D::bar</span>
<span id="cb23-60">56    (int (*)(...))-8</span>
<span id="cb23-61">64    (int (*)(...))(&amp; _ZTI1D)</span>
<span id="cb23-62">72    (int (*)(...))D::_ZThn8_N1D3fooEv</span>
<span id="cb23-63">80    (int (*)(...))A::baz</span>
<span id="cb23-64">88    (int (*)(...))D::_ZThn8_N1DD1Ev</span>
<span id="cb23-65">96    (int (*)(...))D::_ZThn8_N1DD0Ev</span>
<span id="cb23-66"></span>
<span id="cb23-67">Class D</span>
<span id="cb23-68">   size=16 align=8</span>
<span id="cb23-69">   base size=16 base align=8</span>
<span id="cb23-70">D (0x0x7cb4a0be7000) 0</span>
<span id="cb23-71">    vptr=((&amp; D::_ZTV1D) + 16)</span>
<span id="cb23-72">C (0x0x7cb4a0a0e8f0) 0 nearly-empty</span>
<span id="cb23-73">      primary-for D (0x0x7cb4a0be7000)</span>
<span id="cb23-74">B (0x0x7cb4a0bd8240) 0 nearly-empty</span>
<span id="cb23-75">        primary-for C (0x0x7cb4a0a0e8f0)</span>
<span id="cb23-76">A (0x0x7cb4a0bd82a0) 8 nearly-empty</span>
<span id="cb23-77">      vptr=((&amp; D::_ZTV1D) + 72)</span></code></pre></div>
<section id="vtable-for-class-a" class="level2">
<h2 class="anchored" data-anchor-id="vtable-for-class-a"><code>vtable</code> for <code>class A</code></h2>
<p><code>A::_ZTV1A: 6 entries</code> says the name of the <code>vtable</code>, which is a static array, is <code>A::_ZTV1A</code> and there are <img src="https://latex.codecogs.com/png.latex?6"> function pointer entries in this static array. The offset of each entry is <img src="https://latex.codecogs.com/png.latex?8"> bytes.</p>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb24-1">Vtable for A</span>
<span id="cb24-2">A::_ZTV1A: 6 entries</span>
<span id="cb24-3">0     (int (*)(...))0</span>
<span id="cb24-4">8     (int (*)(...))(&amp; _ZTI1A)</span>
<span id="cb24-5">16    (int (*)(...))__cxa_pure_virtual</span>
<span id="cb24-6">24    (int (*)(...))A::baz</span>
<span id="cb24-7">32    0</span>
<span id="cb24-8">40    0</span>
<span id="cb24-9"></span>
<span id="cb24-10">Class A</span>
<span id="cb24-11">   size=8 align=8</span>
<span id="cb24-12">   base size=8 base align=8</span>
<span id="cb24-13">A (0x0x7cb4a0bd8000) 0 nearly-empty</span>
<span id="cb24-14">    vptr=((&amp; A::_ZTV1A) + 16)</span></code></pre></div>
<p><code>16 (int (*)(...))__cxa_pure_virtual</code> and <code>24 (int (*)(...))A::baz</code> are pointers to the pure virtual function <code>A::foo()=0</code> and the virtual function <code>A::baz()</code> respectively.</p>
</section>
<section id="vtable-for-class-b" class="level2">
<h2 class="anchored" data-anchor-id="vtable-for-class-b"><code>vtable</code> for <code>class B</code></h2>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb25-1">Vtable for B</span>
<span id="cb25-2">B::_ZTV1B: 6 entries</span>
<span id="cb25-3">0     (int (*)(...))0</span>
<span id="cb25-4">8     (int (*)(...))(&amp; _ZTI1B)</span>
<span id="cb25-5">16    (int (*)(...))B::foo</span>
<span id="cb25-6">24    (int (*)(...))B::baz</span>
<span id="cb25-7">32    (int (*)(...))B::~B</span>
<span id="cb25-8">40    (int (*)(...))B::~B</span>
<span id="cb25-9"></span>
<span id="cb25-10">Class B</span>
<span id="cb25-11">   size=8 align=8</span>
<span id="cb25-12">   base size=8 base align=8</span>
<span id="cb25-13">B (0x0x7cb4a0bd8120) 0 nearly-empty</span>
<span id="cb25-14">    vptr=((&amp; B::_ZTV1B) + 16)</span></code></pre></div>
<p>Again, <code>16 (int (*)(...))B::foo</code> and <code>24 (int (*)(...))B::baz</code> are pointers to the <code>virtual</code> functions <code>B::foo()</code> and <code>B::baz()</code>.</p>
<p>The entries for virtual destructors are actually pairs of entries.</p>
<p>The first destructor, <code>32 (int (*)(...))B::~B</code> called <em>the complete object destructor</em>, only performs destruction of variables that live on the stack having automatic storage duration. This memory does not need to be deallocated.</p>
<p>The second destructor, <code>40 (int (*)(...))B::~B</code> called <em>the deleting destructor of</em> <code>T</code> is function, that in addition, to calling the complete object destructor, also calls the appropriate deallocation function for <code>T</code> (<code>operator delete</code> on <code>T</code>).</p>
<p>Since the class <code>A</code> has atleast one pure <code>virtual</code> method, it cannot be instantiated directly, hence its <code>vtable</code> does not contain entries for destructors.</p>
</section>
<section id="vtable-for-class-c" class="level2">
<h2 class="anchored" data-anchor-id="vtable-for-class-c"><code>vtable</code> for <code>class C</code></h2>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb26-1">Vtable for C</span>
<span id="cb26-2">C::_ZTV1C: 7 entries</span>
<span id="cb26-3">0     (int (*)(...))0</span>
<span id="cb26-4">8     (int (*)(...))(&amp; _ZTI1C)</span>
<span id="cb26-5">16    (int (*)(...))C::foo</span>
<span id="cb26-6">24    (int (*)(...))B::baz</span>
<span id="cb26-7">32    (int (*)(...))C::~C</span>
<span id="cb26-8">40    (int (*)(...))C::~C</span>
<span id="cb26-9">48    (int (*)(...))C::bar</span>
<span id="cb26-10"></span>
<span id="cb26-11">Class C</span>
<span id="cb26-12">   size=8 align=8</span>
<span id="cb26-13">   base size=8 base align=8</span>
<span id="cb26-14">C (0x0x7cb4a0a0e618) 0 nearly-empty</span>
<span id="cb26-15">    vptr=((&amp; C::_ZTV1C) + 16)</span>
<span id="cb26-16">B (0x0x7cb4a0bd8180) 0 nearly-empty</span>
<span id="cb26-17">      primary-for C (0x0x7cb4a0a0e618)</span></code></pre></div>
<p><code>C</code> is a child class of <code>B</code>. <code>16 (int (*)(...))C::foo</code> is a pointer to the overriding function of <code>B::foo()</code> - <code>C::foo()</code> and <code>24 (int (*)(...))B::baz</code> is a pointer to the inherited function <code>B::baz()</code>.</p>
<p><code>32 (int (*)(...))C::~C</code> and <code>40 (int (*)(...))C::~C</code> are the pairs of destrutors.</p>
<p><code>48 (int (*)(...))C::bar</code> is the pointer to the subclass method <code>C::bar()</code>.</p>
</section>
<section id="vtable-for-class-d" class="level2">
<h2 class="anchored" data-anchor-id="vtable-for-class-d"><code>vtable</code> for <code>class D</code></h2>
<p><code>D</code> inherits from both <code>A</code> and <code>C</code> (indirectly from <code>B</code>).</p>
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb27-1">Vtable for D</span>
<span id="cb27-2">D::_ZTV1D: 13 entries</span>
<span id="cb27-3">0     (int (*)(...))0</span>
<span id="cb27-4">8     (int (*)(...))(&amp; _ZTI1D)</span>
<span id="cb27-5">16    (int (*)(...))D::foo</span>
<span id="cb27-6">24    (int (*)(...))B::baz</span>
<span id="cb27-7">32    (int (*)(...))D::~D</span>
<span id="cb27-8">40    (int (*)(...))D::~D</span>
<span id="cb27-9">48    (int (*)(...))D::bar</span>
<span id="cb27-10">56    (int (*)(...))-8</span>
<span id="cb27-11">64    (int (*)(...))(&amp; _ZTI1D)</span>
<span id="cb27-12">72    (int (*)(...))D::_ZThn8_N1D3fooEv</span>
<span id="cb27-13">80    (int (*)(...))A::baz</span>
<span id="cb27-14">88    (int (*)(...))D::_ZThn8_N1DD1Ev</span>
<span id="cb27-15">96    (int (*)(...))D::_ZThn8_N1DD0Ev</span>
<span id="cb27-16"></span>
<span id="cb27-17">Class D</span>
<span id="cb27-18">   size=16 align=8</span>
<span id="cb27-19">   base size=16 base align=8</span>
<span id="cb27-20">D (0x0x7cb4a0be7000) 0</span>
<span id="cb27-21">    vptr=((&amp; D::_ZTV1D) + 16)</span>
<span id="cb27-22">C (0x0x7cb4a0a0e8f0) 0 nearly-empty</span>
<span id="cb27-23">      primary-for D (0x0x7cb4a0be7000)</span>
<span id="cb27-24">B (0x0x7cb4a0bd8240) 0 nearly-empty</span>
<span id="cb27-25">        primary-for C (0x0x7cb4a0a0e8f0)</span>
<span id="cb27-26">A (0x0x7cb4a0bd82a0) 8 nearly-empty</span>
<span id="cb27-27">      vptr=((&amp; D::_ZTV1D) + 72)</span></code></pre></div>
<p><code>16 (int (*)(...))D::foo</code> is a pointer to the overriding function of <code>A:foo()</code> and <code>C::foo()</code> - <code>D::foo()</code>.</p>
<p><code>24 (int (*)(...))B::baz</code> and <code>80 (int (*)(...))A::baz</code> are pointers to the copies of <code>baz()</code> inherited through the parents <code>A</code> and <code>B</code>.</p>
<p><code>32 (int (*)(...))D::~D</code> and <code>40 (int (*)(...))D::~D</code> are pairs of destructors.</p>
<p><code>48 (int (*)(...))D::bar</code> is a pointer to the overriding function of <code>C::bar()</code> - <code>D::bar()</code>.</p>
<p>When a class inherits from multiple base classes ( as in the case of <code>class D</code> inheriting from both <code>A</code> and <code>C</code>), the memory layout of the derived class <code>D</code> includes subobjects for each of the base class. The <code>this</code> pointer must be adjusted to point to the correct subobject when calling a virtual function from one of the base classes.</p>
<p>The <em>vcall-offset</em> is an adjustment value that ensures that the <code>this</code> pointer points to the correct base class subobject, when a <code>virtual</code> function is invoked.</p>
<p>The <em>vcall-offset</em> is stored in the <code>vtable</code> as an entry (in this case, <code>-8</code>). When a virtual function is called, the <em>vcall-offset</em> is added to the current <code>this</code> pointer to adjust it to the correct base class subobject.</p>
<p>If the <code>this</code> pointer points to the <code>D</code> subobject, adding the <em>vcall-offset</em> <code>-8</code> adjusts it to point to the <code>A</code> subobject inherited directly by <code>D</code>.</p>
</section>
</section>
<section id="class-memory-layout" class="level1">
<h1>Class memory layout</h1>
<p>The <code>pahole</code> utility is used to inspect the object memory layout in linux. Install <code>pahole</code> using your package manager:</p>
<div class="sourceCode" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb28-1">[quantdev@quasar-arch virtual_tables]$ sudo pacman -S pahole</span></code></pre></div>
<p>The output of running <code>pahole</code> on our binary is as follows:</p>
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb29-1">[quantdev@quasar-arch virtual_tables]$ pahole main</span>
<span id="cb29-2">struct D : C, A {</span>
<span id="cb29-3">        /* struct C                   &lt;ancestor&gt;; */     /*     0     8 */</span>
<span id="cb29-4">        /* struct A                   &lt;ancestor&gt;; */     /*     8     8 */</span>
<span id="cb29-5">        void D(struct D *, const struct D  &amp;);</span>
<span id="cb29-6"></span>
<span id="cb29-7">        void D(struct D *);</span>
<span id="cb29-8"></span>
<span id="cb29-9">        virtual void foo(struct D *);</span>
<span id="cb29-10"></span>
<span id="cb29-11">        virtual void bar(struct D *);</span>
<span id="cb29-12"></span>
<span id="cb29-13">        void d_bar(struct D *);</span>
<span id="cb29-14"></span>
<span id="cb29-15">        virtual void ~D(struct D *);</span>
<span id="cb29-16"></span>
<span id="cb29-17">        /* vtable has 2 entries: {</span>
<span id="cb29-18">           [0] = foo((null)), </span>
<span id="cb29-19">           [4] = bar((null)), </span>
<span id="cb29-20">        } */</span>
<span id="cb29-21">        /* size: 16, cachelines: 1, members: 2 */</span>
<span id="cb29-22">        /* last cacheline: 16 bytes */</span>
<span id="cb29-23">};</span>
<span id="cb29-24">struct C : B {</span>
<span id="cb29-25">        /* struct B                   &lt;ancestor&gt;; */     /*     0     8 */</span>
<span id="cb29-26">        void C(struct C *, const struct C  &amp;);</span>
<span id="cb29-27"></span>
<span id="cb29-28">        void C(struct C *);</span>
<span id="cb29-29"></span>
<span id="cb29-30">        virtual void foo(struct C *);</span>
<span id="cb29-31"></span>
<span id="cb29-32">        void c_bar(const struct C  *);</span>
<span id="cb29-33"></span>
<span id="cb29-34">        virtual void bar(struct C *);</span>
<span id="cb29-35"></span>
<span id="cb29-36">        virtual void ~C(struct C *);</span>
<span id="cb29-37"></span>
<span id="cb29-38">        /* vtable has 2 entries: {</span>
<span id="cb29-39">           [0] = foo((null)), </span>
<span id="cb29-40">           [4] = bar((null)), </span>
<span id="cb29-41">        } */</span>
<span id="cb29-42">        /* size: 8, cachelines: 1, members: 1 */</span>
<span id="cb29-43">        /* last cacheline: 8 bytes */</span>
<span id="cb29-44">};</span>
<span id="cb29-45">struct A {</span>
<span id="cb29-46">        void A(struct A *, const struct A  &amp;);</span>
<span id="cb29-47"></span>
<span id="cb29-48">        int ()(void) * *           _vptr.A;              /*     0     8 */</span>
<span id="cb29-49">        void A(struct A *);</span>
<span id="cb29-50"></span>
<span id="cb29-51">        virtual void foo(struct A *);</span>
<span id="cb29-52"></span>
<span id="cb29-53">        virtual void baz(struct A *);</span>
<span id="cb29-54"></span>
<span id="cb29-55">        virtual void ~A(struct A *);</span>
<span id="cb29-56"></span>
<span id="cb29-57">        /* vtable has 2 entries: {</span>
<span id="cb29-58">           [0] = foo((null)), </span>
<span id="cb29-59">           [1] = baz((null)), </span>
<span id="cb29-60">        } */</span>
<span id="cb29-61">        /* size: 8, cachelines: 1, members: 1 */</span>
<span id="cb29-62">        /* last cacheline: 8 bytes */</span>
<span id="cb29-63">};</span>
<span id="cb29-64">struct B {</span>
<span id="cb29-65">        void B(struct B *, const struct B  &amp;);</span>
<span id="cb29-66"></span>
<span id="cb29-67">        int ()(void) * *           _vptr.B;              /*     0     8 */</span>
<span id="cb29-68">        void B(struct B *);</span>
<span id="cb29-69"></span>
<span id="cb29-70">        virtual void foo(struct B *);</span>
<span id="cb29-71"></span>
<span id="cb29-72">        virtual void baz(struct B *);</span>
<span id="cb29-73"></span>
<span id="cb29-74">        virtual void ~B(struct B *);</span>
<span id="cb29-75"></span>
<span id="cb29-76">        /* vtable has 2 entries: {</span>
<span id="cb29-77">           [0] = foo((null)), </span>
<span id="cb29-78">           [1] = baz((null)), </span>
<span id="cb29-79">        } */</span>
<span id="cb29-80">        /* size: 8, cachelines: 1, members: 1 */</span>
<span id="cb29-81">        /* last cacheline: 8 bytes */</span>
<span id="cb29-82">};</span></code></pre></div>
<p>As an example, <code>struct D</code> has <code>size: 16</code> and consists of two subobjects <code>C</code> and <code>A</code>.</p>
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode numberSource shell number-lines code-with-copy"><code class="sourceCode"><span id="cb30-1">struct D {</span>
<span id="cb30-2">    struct C c; /* 0x0 */</span>
<span id="cb30-3">    struct A a; /* 0x8 */</span>
<span id="cb30-4">    /* size: 0x10, cachelines: 1, members: 2 */</span>
<span id="cb30-5">};</span></code></pre></div>

</section>

<div id="quarto-appendix" class="default"><section id="references" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">References</h2><div class="quarto-appendix-contents">

<ul>
<li><a href="https://leimao.github.io/blog/CPP-Virtual-Table/">Virtual Tables</a>.</li>
</ul>


</div></section></div> ]]></description>
  <category>C++</category>
  <guid>http://quantdev.blog/posts/virtualization/index.html</guid>
  <pubDate>Wed, 21 May 2025 23:00:00 GMT</pubDate>
  <media:content url="http://quantdev.blog/posts/virtualization/cpp.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Quanto Options</title>
  <dc:creator>Quasar </dc:creator>
  <link>http://quantdev.blog/posts/quanto-options/index.html</link>
  <description><![CDATA[ 




<section id="a-quick-refresher" class="level1">
<h1>A quick refresher</h1>
<p>A quanto option is a derivative where the underlying is denominated in one currency, but the option-payoff is settled in a different one (the quanto-currency) at a pre-defined fixed exchange rate <img src="https://latex.codecogs.com/png.latex?Q">.</p>
<p>I take the example of gold quoted as <img src="https://latex.codecogs.com/png.latex?XAU/USD"> that is quantoed in <img src="https://latex.codecogs.com/png.latex?INR">.</p>
<p>Define :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0AS_T%20&amp;:=%20%5Ctext%7BPrice%20of%20gold%20in%20the%20underlying%20currency%7D%20%5C%5C%0AX_T%20&amp;:=%20%5Ctext%7BPrice%20of%20the%20underlying%20currency%20in%20quanto%20currency%20terms%7D%5C%5C%0AK%20&amp;:=%20%5Ctext%7BStrike%20expressed%20in%20underlying%20currency%20terms%7D%5C%5C%0AQ%20&amp;:=%20%5Ctext%7BPre-specified%20exchange%20rate%7D%0A%5Cend%7Balign*%7D%0A"></p>
<p>Since the payoff is in <img src="https://latex.codecogs.com/png.latex?INR">, we take <img src="https://latex.codecogs.com/png.latex?INR"> as the base currency or numeraire in the Black-Scholes model.</p>
<p>Then, the payoff of the quanto-call option is:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AV_T%20=%20Q%5Cleft(%5Cfrac%7BS_T%7D%7BX_T%7D%20-%20K%5Cright)%5E%7B+%7D%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?S_T/X_T"> has units <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7BXAU%7D%7BUSD%7D">, and <img src="https://latex.codecogs.com/png.latex?Q"> - the pre-specified conversion factor has units <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7BUSD%7D%7BINR%7D">.</p>
</section>
<section id="the-setup" class="level1">
<h1>The Setup</h1>
<p>The domestic risk-neutral measure <img src="https://latex.codecogs.com/png.latex?Q%5E%7BINR%7D"> is the probability measure linked to the domestic money-market account <img src="https://latex.codecogs.com/png.latex?M_T%5E%7BINR%7D">.</p>
<p>The risk-neutral measure <img src="https://latex.codecogs.com/png.latex?Q%5E%7BUSD%7D"> is the probability measure linked to the underlying money-market account expressed in quanto currency terms, <img src="https://latex.codecogs.com/png.latex?(M_T%5E%7BUSD%7D%20%5Ccdot%20X_T)">. <img src="https://latex.codecogs.com/png.latex?M_T%5E%7BUSD%7D"> has units <img src="https://latex.codecogs.com/png.latex?USD%5E%7B-1%7D"> and <img src="https://latex.codecogs.com/png.latex?X_T"> has units <img src="https://latex.codecogs.com/png.latex?USD%20%5Ccdot%20INR%5E%7B-1%7D">.</p>
<p>Consider the Black-Scholes model:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%7BXAU/INR%20:%20%7D%20%5Cquad%20dS_t%20&amp;=%20r_%7BINR%7D%20S_t%20dt%20+%20%5Csigma_S%20S_t%20dW_%7BS%7D%5E%7BQ%5E%7BINR%7D%7D(t)%20%5C%5C%0A%7BUSD/INR%20:%20%7D%20%5Cquad%20dX_t%20&amp;=%20(r_%7BINR%7D%20-%20r_%7BUSD%7D)X_t%20dt%20+%20%5Csigma_X%20X(t)%20dW_X%5E%7BQ%5E%7BINR%7D%7D(t)%5C%5C%0AdW_%7BS%7D%5E%7BQ%5E%7BINR%7D%7D(t)%20%5Ccdot%20dW_X%5E%7BQ%5E%7BINR%7D%7D(t)%20&amp;=%20%5Crho_%7B(f,q),(d,q)%7D%20dt%0A%5Cend%7Balign*%7D%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?(W%5E%7BQ%5E%7BINR%7D%7D(t),t%5Cgeq%200)"> is a <img src="https://latex.codecogs.com/png.latex?Q%5E%7BINR%7D">-standard brownian motion.</p>
</section>
<section id="the-evolution-of-the-underlying-xau-usd" class="level1">
<h1>The evolution of the underlying XAU-USD</h1>
<p>The actual underlying is :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BXAU/USD%20%7D%20:=%20%5Cfrac%7BS(t)%7D%7BX(t)%7D%0A"></p>
<p>Using Itos formula, we obtain:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0Ad%5Cleft(%5Cfrac%7B1%7D%7BX_t%7D%5Cright)%20&amp;=%20-%5Cfrac%7B1%7D%7BX_t%5E2%7DdX_t%20+%20%5Cfrac%7B1%7D%7B2%7D%5Ccdot%5Cfrac%7B2%7D%7BX_t%5E3%7D%20(dX_t)%5E2%20%5C%5C%0A&amp;=%20-%5Cfrac%7B1%7D%7BX_t%7D%5B(r_%7BINR%7D%20-%20r_%7BUSD%7D)%20dt%20+%20%5Csigma_X%20dW_X%5E%7BQ%5E%7BINR%7D%7D(t)%5D%20+%20%5Cfrac%7B1%7D%7BX_t%7D%5Csigma_X%5E2%20dt%5C%5C%0A&amp;=%20%5Cfrac%7B1%7D%7BX_t%7D%20%5B(%5Csigma_X%5E2%20+%20r_%7BUSD%7D%20-%20r_%7BINR%7D)%20dt%20-%20%5Csigma_X%20dW_X%5E%7BQ%5E%7BINR%7D%7D(t)%5D%0A%5Cend%7Balign*%7D%0A"></p>
<p>and hence:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0Ad%5Cleft(%5Cfrac%7BS_t%7D%7BX_t%7D%5Cright)%20&amp;=%20S_t%20%5Ccdot%20d%5Cleft(%5Cfrac%7B1%7D%7BX_t%7D%5Cright)%20+%20%5Cfrac%7B1%7D%7BX_t%7D%20dS_t%20+%20dS_t%20%5Ccdot%20d%5Cleft(%5Cfrac%7B1%7D%7BX_t%7D%5Cright)%5C%5C%0A&amp;=%20%5Cfrac%7BS_t%7D%7BX_t%7D%5B(%5Csigma_X%5E2%20+%20r_%7BUSD%7D%20-%20r_%7BINR%7D)%20dt%20-%20%5Csigma_X%20dW_X%5E%7BQ%5E%7BINR%7D%7D(t)%5D%20+%20%5Cfrac%7BS_t%7D%7BX_t%7D%5Br_%7BINR%7D%20dt%20+%20%5Csigma_S%20dW_%7BS%7D%5E%7BQ%5E%7BINR%7D%7D(t)%5D%20%5C%5C%0A&amp;-%5Cfrac%7BS_t%7D%7BX_t%7D%20%5B((%5Csigma_X%5E2%20+%20r_%7BUSD%7D%20-%20r_%7BINR%7D)%20dt%20-%20%5Csigma_X%20dW_X%5E%7BQ%5E%7BINR%7D%7D(t))(r_%7BINR%7D%20dt%20+%20%5Csigma_S%20dW_%7BS%7D%5E%7BQ%5E%7BINR%7D%7D(t))%5D%20%5C%5C%0A&amp;=%5Cfrac%7BS_t%7D%7BX_t%7D%5B(%5Csigma_X%5E2%20+r_%7BUSD%7D%20+%20%5Crho%20%5Csigma_X%20%5Csigma_S%20)%20dt%20+%20%5Csigma_S%20dW_S%5E%7BQ%5E%7BINR%7D(t)%7D%20-%20%5Csigma_X%20dW_X%5E%7BQ%5E%7BINR%7D%7D(t)%5D%0A%5Cend%7Balign*%7D%0A"></p>
<p>We can find an orthogonal decomposition of the random vector process <img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Bbmatrix%7D%20W_S%5E%7BQ%5E%7BINR%7D%7D(t)%20%5C%5C%20W_X%5E%7BQ%5E%7BINR%7D%7D(t)%5Cend%7Bbmatrix%7D">.</p>
<p>Define : <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bbmatrix%7D%0AW_S%5E%7BQ%5E%7BINR%7D%7D(t)%20%5C%5C%0AW_X%5E%7BQ%5E%7BINR%7D%7D(t)%0A%5Cend%7Bbmatrix%7D%20=%0A%5Cbegin%7Bbmatrix%7D%0AZ_S%5E%7BQ%5E%7BINR%7D%7D(t)%20%5C%5C%0A%5Crho%20Z_S%5E%7BQ%5E%7BINR%7D%7D(t)%20+%20%5Csqrt%7B1-%5Crho%5E2%7D%20Z_X%5E%7BQ%5E%7BINR%7D%7D(t)%0A%5Cend%7Bbmatrix%7D%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?Z_S%5E%7BQ%5E%7BINR%7D%7D(t)"> and <img src="https://latex.codecogs.com/png.latex?Z_X%5E%7BQ%5E%7BINR%7D%7D(t)"> are independent standard brownian motions.</p>
<p>So, the SDE can be written as:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0Ad%5Cleft(%5Cfrac%7BS_t%7D%7BX_t%7D%5Cright)%20&amp;=%20%5Cfrac%7BS_t%7D%7BX_t%7D%5B(%5Csigma_X%5E2%20+r_%7BUSD%7D%20+%20%5Crho%20%5Csigma_X%20%5Csigma_S%20)%20dt%20+%20%5Csigma_S%20dZ_S%5E%7BQ%5E%7BINR%7D%7D(t)%20-%20%5Csigma_X%20(%5Crho%20%5Ccdot%20dZ_S%5E%7BQ%5E%7BINR%7D%7D(t)%20+%20%20%5Csqrt%7B1-%5Crho%5E2%7D%20%5Ccdot%20dZ_X%5E%7BQ%5E%7BINR%7D%7D(t))%5D%20%5C%5C%0A&amp;=%5Cfrac%7BS_t%7D%7BX_t%7D%5B(%5Csigma_X%5E2%20+r_%7BUSD%7D%20+%20%5Crho%20%5Csigma_X%20%5Csigma_S%20)%20dt%20+%20(%5Csigma_S%20-%20%5Crho%20%5Csigma_X%20)%20dZ_S%5E%7BQ%5E%7BINR%7D%7D(t)%20-%20(%5Csigma_X%20%5Csqrt%7B1-%5Crho%5E2%7D)%20dZ_X%5E%7BQ%5E%7BINR%7D%7D(t)%5D%0A%5Cend%7Balign*%7D%0A"></p>
<p>Define:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AB%5E%7BQ%5E%7BINR%7D%7D(t)%20=%20%5Cfrac%7B(%5Csigma_S%20-%20%5Crho%20%5Csigma_X%20)%20Z_S%5E%7BQ%5E%7BINR%7D%7D(t)%20-%20(%5Csigma_X%20%5Csqrt%7B1-%5Crho%5E2%7D)%20Z_X%5E%7BQ%5E%7BINR%7D%7D(t)%7D%7B(%5Csigma_S%20-%20%5Crho%20%5Csigma_X%20)%5E2%20+%20(%5Csigma_X%20%5Csqrt%7B1-%5Crho%5E2%7D)%5E2%7D%0A"></p>
<p>Its easy to see that <img src="https://latex.codecogs.com/png.latex?B%5E%7BQ%5E%7BINR%7D%7D(t)"> is Gaussian and has mean and variance given by <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BN%7D(0,t)">.</p>
<p>Consequently, we can re-write the SDE as:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ad%5Cleft(%5Cfrac%7BS_t%7D%7BX_t%7D%5Cright)%20=%20%5Cfrac%7BS_t%7D%7BX_t%7D%5B(%5Csigma_X%5E2%20+r_%7BUSD%7D%20+%20%5Crho%20%5Csigma_X%20%5Csigma_S%20)%20dt%20+%20(%5Csigma_S%5E2%20-%202%5Crho%20%5Csigma_S%20%5Csigma_X%20+%20%5Csigma_X%5E2)dB%5E%7BQ%5E%7BINR%7D%7D(t)%5D%0A"></p>
<p>Thus, <img src="https://latex.codecogs.com/png.latex?(%5Cfrac%7BS_t%7D%7BX_t%7D)_%7Bt%5Cgeq%200%7D"> follows a geometric brownian motion:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7BS_t%7D%7BX_t%7D%20=%20%5Cfrac%7BS_0%7D%7BX_0%7D%5Cexp%5Cleft%5B%5Cleft(%5Calpha%20-%20%5Cfrac%7B%5Cbeta%5E2%7D%7B2%7D%5Cright)T+%5Cbeta%20B%5E%7BQ%5E%7BINR%7D%7D(T)%5Cright%5D%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?%5Calpha%20=%20%5Csigma_X%5E2%20+r_%7BUSD%7D%20+%20%5Crho%20%5Csigma_X%20%5Csigma_S">, <img src="https://latex.codecogs.com/png.latex?%5Cbeta%20=%20%5Csigma_S%5E2%20-%202%5Crho%20%5Csigma_S%20%5Csigma_X%20+%20%5Csigma_X%5E2"></p>
<p>This can easily be plugged into the Black formula to derive analytic expressions for quanto vanilla calls and puts.</p>


</section>

 ]]></description>
  <category>Fin Math</category>
  <guid>http://quantdev.blog/posts/quanto-options/index.html</guid>
  <pubDate>Thu, 15 May 2025 23:00:00 GMT</pubDate>
  <media:content url="http://quantdev.blog/posts/quanto-options/image.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Custom iterators and Iterator concepts</title>
  <dc:creator>Quasar </dc:creator>
  <link>http://quantdev.blog/posts/custom-iterators/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>An iterator is a generalization of a pointer. C++ STL containers usually expose iterators as part of their interface. They abstract away lower-level implementation details of traversing through container types, thus freeing the container-user to focus on algorithm design/business logic.</p>
</section>
<section id="traditional-c-iterators" class="level1">
<h1>Traditional C++ iterators</h1>
<p>Iterators have been around since before C++11, but they really hit mainstream since C++11 started shipping. The STL containers all implement their own iterators, however, its possible for developers to write their own iterators for custom collections.</p>
<p>In the past, youd implement iterators using <a href="https://en.cppreference.com/w/cpp/iterator/iterator_tags">tagging</a>. A tag is simply an empty struct, with no data or behavior. It is often used to perform static dispatching (compile-time polymorphism). Here is a minimalistic example:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb1-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iostream&gt;</span></span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">namespace</span> dev<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb1-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> random_access_iterator_tag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb1-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> forward_iterator_tag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{};</span></span>
<span id="cb1-6"></span>
<span id="cb1-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb1-9">        T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-10">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>size_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_size</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-11">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>size_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_capacity</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-12">        </span>
<span id="cb1-13">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb1-14">            <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> iterator_category <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> random_access_iterator_tag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-15">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/* .... */</span></span>
<span id="cb1-16">            T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-17">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb1-18"></span>
<span id="cb1-19">        iterator begin<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb1-20">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">));</span></span>
<span id="cb1-21">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb1-22">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb1-23"></span>
<span id="cb1-24">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-25">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> list<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb1-26">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> node<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb1-27">            T data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-28">            node<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> next<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-29">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb1-30"></span>
<span id="cb1-31">        node<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-32">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>size_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_size</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-33">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb1-34">            <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> iterator_category <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> forward_iterator_tag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-35">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/* .... */</span></span>
<span id="cb1-36">            node<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-37">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb1-38"></span>
<span id="cb1-39">        iterator begin<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb1-40">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">));</span></span>
<span id="cb1-41">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb1-42">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb1-43"></span>
<span id="cb1-44">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> It<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-45">    It advance<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>It iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>size_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> forward_iterator_tag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb1-46">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Advance a foward iterator"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-47">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-48">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb1-49"></span>
<span id="cb1-50">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> It<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-51">    It advance<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>It iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>size_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> </span>n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> random_access_iterator_tag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb1-52">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Advance a random access iterator"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-53">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-54">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb1-55"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb1-56"></span>
<span id="cb1-57"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb1-58">    dev<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-59">    dev<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>list<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> lst<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-60"></span>
<span id="cb1-61">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> it <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> vec<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>begin<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb1-62">    dev<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>advance<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>it<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> dev<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>iterator_category<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">());</span></span>
<span id="cb1-63"></span>
<span id="cb1-64">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> it2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> lst<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>begin<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb1-65">    dev<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>advance<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>it2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> dev<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>list<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span>iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>iterator_category<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">());</span></span>
<span id="cb1-66"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><a href="https://godbolt.org/z/q7YGG8oj5">Compiler Explorer</a></p>
<p>An iterator over a custom array-like sequence of elements would look like the following:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb2-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iterator&gt;</span></span>
<span id="cb2-2"></span>
<span id="cb2-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb2-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> Iterator <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb2-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> iterator_category <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>forward_iterator_tag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">value_type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">difference_type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>ptrdiff_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> pointer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*;</span></span>
<span id="cb2-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> reference <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;;</span></span>
<span id="cb2-10"></span>
<span id="cb2-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// ...rest of iterator implementation here</span></span>
<span id="cb2-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span></code></pre></div>
<p>This requires you to write a lot of boiler-plate code. While tagging works, it puts an extra-burden on the developer.</p>
</section>
<section id="modern-c-iterators" class="level1">
<h1>Modern C++ iterators</h1>
<p>C++20 has a language feature called <a href="https://quantdev.blog/posts/c++20-concepts/index.html">concepts</a> - a set of named constaints that a type should satisfy. So, we can now implement iterators based on their behavior, rather than their <em>identity</em>. This is often referred to as <strong>duck typing</strong>: the idea that <em>if an entity looks like a duck and quacks like a duck, it must be a duck.</em></p>
<p>A new system of iterators based on concepts has been introduced.</p>
<ul>
<li><a href="https://en.cppreference.com/w/cpp/iterator/input_iterator"><code>std::input_iterator</code></a></li>
<li><a href="https://en.cppreference.com/w/cpp/iterator/output_iterator"><code>std::output_iterator</code></a></li>
<li><a href="https://en.cppreference.com/w/cpp/iterator/forward_iterator"><code>std::forward_iterator</code></a></li>
<li><a href="https://en.cppreference.com/w/cpp/iterator/bidirectional_iterator"><code>std::birdirectional_iterator</code></a></li>
<li><a href="https://en.cppreference.com/w/cpp/iterator/random_access_iterator"><code>std::random_access_iterator</code></a></li>
<li><a href="https://en.cppreference.com/w/cpp/iterator/contiguous_iterator"><code>std::contiguous_iterator</code></a></li>
</ul>
<p>Before we deep-dive into these iterator concepts, lets understand <a href="https://en.cppreference.com/w/cpp/iterator/sentinel_for"><code>std::sentinel_for</code></a> concept.</p>
<p>A sentinel signals the end of a sequence of values. Prior to C++20, when traversing a collection, the way youd check if youve hit the end of the collection was to compare your current iterator with an <code>end()</code> iterator.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb3-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include</span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;vector&gt;</span></span>
<span id="cb3-2"></span>
<span id="cb3-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb3-4">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">double</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb3-5"></span>
<span id="cb3-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Traverse a std::vector</span></span>
<span id="cb3-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> it <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>begin<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()};</span> it<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span>v<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>end<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++</span>it<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb3-8">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>cout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> &lt;&lt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>it <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb3-9">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>Usually, this end iterator was just a case of your normal iterator that had some internal state identifying it as one past the last element of the container.</p>
<p>Beginning C++20, you can actually use any type as a sentinel for an iterator so long as the type satisfies the <code>std::sentinel_for</code> concept. <code>std::sentinel_for</code> concept requires</p>
<section id="stdinput_or_output_iterator" class="level2">
<h2 class="anchored" data-anchor-id="stdinput_or_output_iterator"><code>std::input_or_output_iterator</code></h2>
<p>The <code>input_or_output_iterator</code> is the basis of the iterator concept taxonomy. It only requires that an iterator type <code>It</code> supports the operations for dereferencing and incrementing the iterator.</p>
</section>
<section id="stdoutput_iterator" class="level2">
<h2 class="anchored" data-anchor-id="stdoutput_iterator"><code>std::output_iterator</code></h2>
<p><code>std::output_iterator</code> concept models the idea of a write-only iterator. E.g. such an iterator can be used to write to the standard output stream. Hence, they can only be dereferenced on the left-hand side of an assignment operator.</p>
<p>Since, they are single pass, we dont even need to implement an equality comparison operator, because they dont have an end iterator or sentinel value to compare against.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb4-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;cstddef&gt;</span></span>
<span id="cb4-2"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iterator&gt;</span></span>
<span id="cb4-3"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;concepts&gt;</span></span>
<span id="cb4-4"></span>
<span id="cb4-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb4-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> SimpleOutputIterator <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb4-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">difference_type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>ptrdiff_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">value_type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> pointer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*;</span></span>
<span id="cb4-10"></span>
<span id="cb4-11">    pointer <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_buffer_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-12"></span>
<span id="cb4-13">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Default constructor</span></span>
<span id="cb4-14">    SimpleOutputIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">default</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-15"></span>
<span id="cb4-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Constructor</span></span>
<span id="cb4-17">    SimpleOutputIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>pointer start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb4-18">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_buffer_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb4-19"></span>
<span id="cb4-20">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Dereference operator</span></span>
<span id="cb4-21">    T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb4-22">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_buffer_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-23">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb4-24"></span>
<span id="cb4-25">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Pre-increment</span></span>
<span id="cb4-26">    SimpleOutputIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb4-27">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_buffer_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-28">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb4-29">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb4-30"></span>
<span id="cb4-31">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Post-increment</span></span>
<span id="cb4-32">    SimpleOutputIterator <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb4-33">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> tmp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-34">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++(*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb4-35">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> tmp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-36">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb4-37"></span>
<span id="cb4-38"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb4-39"></span>
<span id="cb4-40"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">static_assert</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>output_iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>SimpleOutputIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;);</span></span>
<span id="cb4-41"></span>
<span id="cb4-42"></span>
<span id="cb4-43"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb4-44">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb4-45"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><a href="https://godbolt.org/z/nEEh35q45">Compiler Explorer</a></p>
</section>
<section id="stdinput_iterator" class="level2">
<h2 class="anchored" data-anchor-id="stdinput_iterator"><code>std::input_iterator</code></h2>
<p><code>std::input_iterator</code> concept models the idea of a read-only iterator. Such an iterator, for example, can be used read packets data from a network socket.</p>
<p>Input iterators are also single-pass, because once youve read a byte of data from a network socket, you cant read it again. They must also be comparable to some sentinel value such as <code>EOF</code>, <code>\0</code>, to signal the end of data etc.</p>
<p>However, the equality comparison operator <code>bool operator==(It, Sen)</code> is only used by the algorithm operating on the container, and therefore its the responsibility of the algorithm writer to supply an implementation of <code>bool operator==(It, Sen)</code>. This definition is not required in the container implementation.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb5-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;cstddef&gt;</span></span>
<span id="cb5-2"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iterator&gt;</span></span>
<span id="cb5-3"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;concepts&gt;</span></span>
<span id="cb5-4"></span>
<span id="cb5-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb5-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> SimpleInputIterator <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">difference_type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>ptrdiff_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">value_type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> pointer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*;</span></span>
<span id="cb5-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> reference <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;;</span></span>
<span id="cb5-11"></span>
<span id="cb5-12">    pointer <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_socket_fd</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-13"></span>
<span id="cb5-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Default constructor</span></span>
<span id="cb5-15">    SimpleInputIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">default</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-16"></span>
<span id="cb5-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Constructor</span></span>
<span id="cb5-18">    SimpleInputIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>pointer start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb5-19">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_socket_fd</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb5-20"></span>
<span id="cb5-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Dereference operator</span></span>
<span id="cb5-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*()</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-23">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_socket_fd</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-24">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-25"></span>
<span id="cb5-26">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Pre-increment</span></span>
<span id="cb5-27">    SimpleInputIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-28">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_socket_fd</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-29">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb5-30">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-31"></span>
<span id="cb5-32">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Post-increment</span></span>
<span id="cb5-33">    SimpleInputIterator <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-34">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> tmp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-35">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++(*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb5-36">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> tmp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-37">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-38"></span>
<span id="cb5-39"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb5-40"></span>
<span id="cb5-41"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">static_assert</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>input_iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>SimpleInputIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;);</span></span>
<span id="cb5-42"></span>
<span id="cb5-43"></span>
<span id="cb5-44"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(){</span></span>
<span id="cb5-45">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-46"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><a href="https://godbolt.org/z/4ocGnaaPM">Compiler Explorer</a></p>
</section>
<section id="stdforward_iterator" class="level2">
<h2 class="anchored" data-anchor-id="stdforward_iterator"><code>std::forward_iterator</code></h2>
<p><code>std::forward_iterator</code> requires that the iterator type be an input (read-only) iterator and also be <a href="https://en.cppreference.com/w/cpp/iterator/incrementable">std::incrementable</a>.</p>
<p><code>std::input_iterator</code> only requires the iterator be <code>std::weakly_incrementable</code>. So while it supports the increment <code>operator++()</code>, if <code>i</code> and <code>j</code> are two instances of the iterator type <code>It</code>, <code>i == j</code> does not imply <code>++i == ++j</code>. That is, algorithms on weakly-incrementable types must be single-pass algorithms.</p>
<p><code>std::incrementable</code> concept informally means that <code>i == j</code> <img src="https://latex.codecogs.com/png.latex?%5Cimplies"> <code>++i == ++j</code>. Algorithms on incrementable types are multi-pass algorithms.</p>
<p>You might use an iterator satisfying <code>std::forward_iterator</code> concept to traverse through a <code>std::forward_list</code> (a singly linked-list).</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb6-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;cstddef&gt;</span></span>
<span id="cb6-2"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iterator&gt;</span></span>
<span id="cb6-3"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;concepts&gt;</span></span>
<span id="cb6-4"></span>
<span id="cb6-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb6-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> list_node <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-7">    T <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-8">    list_node<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_next</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-9"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb6-10"></span>
<span id="cb6-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb6-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> SimpleForwardIterator <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">difference_type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>ptrdiff_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-14">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">value_type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// The value type is T, not list_node&lt;T&gt;</span></span>
<span id="cb6-15">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> pointer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*;</span></span>
<span id="cb6-16">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> reference <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;;</span></span>
<span id="cb6-17"></span>
<span id="cb6-18">    list_node<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_node_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-19"></span>
<span id="cb6-20">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Default constructor</span></span>
<span id="cb6-21">    SimpleForwardIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">default</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-22"></span>
<span id="cb6-23">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Constructor</span></span>
<span id="cb6-24">    SimpleForwardIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>list_node<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;*</span> start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb6-25">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_node_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb6-26"></span>
<span id="cb6-27">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Dereference operator</span></span>
<span id="cb6-28">    reference <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*()</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-29">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_node_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Return the data stored in the node</span></span>
<span id="cb6-30">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-31"></span>
<span id="cb6-32">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Pre-increment</span></span>
<span id="cb6-33">    SimpleForwardIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-34">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_node_ptr</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_node_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_next</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-35">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-36">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-37"></span>
<span id="cb6-38">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Post-increment</span></span>
<span id="cb6-39">    SimpleForwardIterator <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-40">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> tmp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-41">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++(*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb6-42">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> tmp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-43">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-44"></span>
<span id="cb6-45">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Equality comparison</span></span>
<span id="cb6-46">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bool</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==(</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> SimpleForwardIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-47">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_node_ptr</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_node_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-48">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-49"></span>
<span id="cb6-50">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Inequality comparison</span></span>
<span id="cb6-51">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bool</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=(</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> SimpleForwardIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-52">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!(*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb6-53">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-54"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb6-55"></span>
<span id="cb6-56"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">static_assert</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>forward_iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>SimpleForwardIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;);</span></span>
<span id="cb6-57"></span>
<span id="cb6-58"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-59">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-60"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><a href="https://godbolt.org/z/edEr4oedn">Compiler Explorer</a></p>
</section>
<section id="stdbidirectional_iterator" class="level2">
<h2 class="anchored" data-anchor-id="stdbidirectional_iterator"><code>std::bidirectional_iterator</code></h2>
<p>A <code>std::list</code> is a doubly linked that supports both traversals in the forward as well as reverse direction. When we want to be able to move forward and backwards across our collection, we must implement an iterator satisfying <code>std::bidirectional_iterator</code> concept.</p>
<p>You need to implement pre-increment, post-increment, pre-decrement and post-decrement operations.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb7-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;cstddef&gt;</span></span>
<span id="cb7-2"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iterator&gt;</span></span>
<span id="cb7-3"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;concepts&gt;</span></span>
<span id="cb7-4"></span>
<span id="cb7-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb7-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> list_node <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-7">    T <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-8">    list_node<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_next</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-9">    list_node<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_prev</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb7-11"></span>
<span id="cb7-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb7-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> SimpleBidirectionalIterator <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-14">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">difference_type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>ptrdiff_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-15">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">value_type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// The value type is T, not list_node&lt;T&gt;</span></span>
<span id="cb7-16">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> pointer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*;</span></span>
<span id="cb7-17">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> reference <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;;</span></span>
<span id="cb7-18"></span>
<span id="cb7-19">    list_node<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_node_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-20"></span>
<span id="cb7-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Default constructor</span></span>
<span id="cb7-22">    SimpleBidirectionalIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">default</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-23"></span>
<span id="cb7-24">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Constructor</span></span>
<span id="cb7-25">    SimpleBidirectionalIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>list_node<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;*</span> start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb7-26">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_node_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb7-27"></span>
<span id="cb7-28">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Dereference operator</span></span>
<span id="cb7-29">    reference <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*()</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-30">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_node_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_data</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Return the data stored in the node</span></span>
<span id="cb7-31">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-32"></span>
<span id="cb7-33">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Pre-increment</span></span>
<span id="cb7-34">    SimpleBidirectionalIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-35">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_node_ptr</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_node_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_next</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-36">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-37">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-38"></span>
<span id="cb7-39">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Post-increment</span></span>
<span id="cb7-40">    SimpleBidirectionalIterator <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-41">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> tmp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-42">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++(*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb7-43">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> tmp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-44">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-45"></span>
<span id="cb7-46">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Pre-decrement</span></span>
<span id="cb7-47">    SimpleBidirectionalIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--(){</span></span>
<span id="cb7-48">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_node_ptr</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_node_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_prev</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-49">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-50">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-51"></span>
<span id="cb7-52">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Post-decrement</span></span>
<span id="cb7-53">    SimpleBidirectionalIterator <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">){</span></span>
<span id="cb7-54">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> tmp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-55">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--(*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb7-56">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> tmp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-57">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-58"></span>
<span id="cb7-59">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Equality comparison</span></span>
<span id="cb7-60">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bool</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==(</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> SimpleBidirectionalIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-61">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_node_ptr</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_node_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-62">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-63"></span>
<span id="cb7-64">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Inequality comparison</span></span>
<span id="cb7-65">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bool</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=(</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> SimpleBidirectionalIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-66">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!(*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb7-67">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-68"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb7-69"></span>
<span id="cb7-70"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">static_assert</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>bidirectional_iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>SimpleBidirectionalIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;);</span></span>
<span id="cb7-71"></span>
<span id="cb7-72"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-73">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb7-74"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><a href="https://godbolt.org/z/o4cY68zse">Compiler Explorer</a></p>
</section>
<section id="stdrandom_access_iterator" class="level2">
<h2 class="anchored" data-anchor-id="stdrandom_access_iterator"><code>std::random_access_iterator</code></h2>
<p>Containers such as <code>std::vector&lt;T&gt;</code> and <code>std::array&lt;T,N&gt;</code> are a collection of elements that are stored contiguously in memory. Hence, the element at index <code>i</code> can be accessed in <img src="https://latex.codecogs.com/png.latex?O(1)"> constant-time.</p>
<p>What if I want to code up an iterator for jumping around the collection? Such an iterator must satisfy the <code>std::random_access_iterator</code> concept. The <code>std::random_access_iterator</code> concept requires that advancement with <code>+=</code>, <code>-=</code>, <code>+</code> and <code>-</code>, computation of distance between two elements and element access using the indexing operator <code>[]</code> be constant-time operations.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb8-1"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;cstddef&gt;</span></span>
<span id="cb8-2"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;iterator&gt;</span></span>
<span id="cb8-3"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">#include </span><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">&lt;concepts&gt;</span></span>
<span id="cb8-4"></span>
<span id="cb8-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb8-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">struct</span> SimpleRandomAccessIterator <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">difference_type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>ptrdiff_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">value_type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> pointer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*;</span></span>
<span id="cb8-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">using</span> reference <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;;</span></span>
<span id="cb8-11"></span>
<span id="cb8-12">    T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_raw_data_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-13"></span>
<span id="cb8-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Default constructor</span></span>
<span id="cb8-15">    SimpleRandomAccessIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">default</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-16"></span>
<span id="cb8-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Constructor</span></span>
<span id="cb8-18">    SimpleRandomAccessIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb8-19">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_raw_data_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span></span>
<span id="cb8-20"></span>
<span id="cb8-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Dereference operator</span></span>
<span id="cb8-22">    reference <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*()</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-23">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_raw_data_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-24">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-25"></span>
<span id="cb8-26">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Pre-increment</span></span>
<span id="cb8-27">    SimpleRandomAccessIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-28">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_raw_data_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-29">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-30">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-31"></span>
<span id="cb8-32">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Post-increment</span></span>
<span id="cb8-33">    SimpleRandomAccessIterator <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-34">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> tmp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-35">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">++(*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb8-36">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> tmp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-37">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-38"></span>
<span id="cb8-39">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Pre-decrement</span></span>
<span id="cb8-40">    SimpleRandomAccessIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-41">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_raw_data_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-42">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-43">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-44"></span>
<span id="cb8-45">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Post-decrement</span></span>
<span id="cb8-46">    SimpleRandomAccessIterator <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-47">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">auto</span> tmp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-48">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--(*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb8-49">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> tmp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-50">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-51"></span>
<span id="cb8-52">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Array subscript operator</span></span>
<span id="cb8-53">    reference <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[](</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">difference_type</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-54">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_raw_data_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span>n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">];</span></span>
<span id="cb8-55">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-56"></span>
<span id="cb8-57">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Compound addition</span></span>
<span id="cb8-58">    SimpleRandomAccessIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">difference_type</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-59">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_raw_data_ptr</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-60">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-61">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-62"></span>
<span id="cb8-63">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Compound subtraction</span></span>
<span id="cb8-64">    SimpleRandomAccessIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-=(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">difference_type</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-65">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_raw_data_ptr</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-=</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-66">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-67">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-68"></span>
<span id="cb8-69">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Addition</span></span>
<span id="cb8-70">    SimpleRandomAccessIterator <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">difference_type</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-71">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> SimpleRandomAccessIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_raw_data_ptr</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb8-72">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-73"></span>
<span id="cb8-74">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Subtraction</span></span>
<span id="cb8-75">    SimpleRandomAccessIterator <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">difference_type</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-76">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> SimpleRandomAccessIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_raw_data_ptr</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb8-77">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-78"></span>
<span id="cb8-79">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Distance between iterators</span></span>
<span id="cb8-80">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">difference_type</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-(</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> SimpleRandomAccessIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-81">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_raw_data_ptr</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_raw_data_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-82">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-83"></span>
<span id="cb8-84">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Equality comparison</span></span>
<span id="cb8-85">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bool</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==(</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> SimpleRandomAccessIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-86">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_raw_data_ptr</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_raw_data_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-87">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-88"></span>
<span id="cb8-89">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Inequality comparison</span></span>
<span id="cb8-90">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bool</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=(</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> SimpleRandomAccessIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-91">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!(*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">this</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb8-92">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-93"></span>
<span id="cb8-94">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Relational operators</span></span>
<span id="cb8-95">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bool</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;(</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> SimpleRandomAccessIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-96">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_raw_data_ptr</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_raw_data_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-97">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-98"></span>
<span id="cb8-99">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bool</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=(</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> SimpleRandomAccessIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-100">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_raw_data_ptr</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_raw_data_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-101">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-102"></span>
<span id="cb8-103">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bool</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;(</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> SimpleRandomAccessIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-104">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_raw_data_ptr</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_raw_data_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-105">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-106"></span>
<span id="cb8-107">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">bool</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=(</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> SimpleRandomAccessIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-108">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_raw_data_ptr</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> other<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_raw_data_ptr</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-109">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-110"></span>
<span id="cb8-111">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// Friend operator+ for n + iterator</span></span>
<span id="cb8-112">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">template</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> U<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb8-113">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">friend</span> SimpleRandomAccessIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>U<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">operator</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+(</span></span>
<span id="cb8-114">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">typename</span> SimpleRandomAccessIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>U<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;::</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">difference_type</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-115">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">const</span> SimpleRandomAccessIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>U<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&amp;</span> it</span>
<span id="cb8-116">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-117">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> SimpleRandomAccessIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>U<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;(</span>it<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">m_raw_data_ptr</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb8-118">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-119"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">};</span></span>
<span id="cb8-120"></span>
<span id="cb8-121"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">static_assert</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">std::</span>random_access_iterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>SimpleRandomAccessIterator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;);</span></span>
<span id="cb8-122"></span>
<span id="cb8-123"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">int</span> main<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-124">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb8-125"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><a href="https://godbolt.org/z/8xYY4G75W">Compiler Explorer</a></p>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="references" class="level1 appendix"><h2 class="anchored quarto-appendix-heading">References</h2><div class="quarto-appendix-contents">

<ul>
<li><a href="https://hitchcock.codes/blog/cpp-iterators-in-depth">cpp iterators in depth</a> by Braden Hitchcock.</li>
</ul>


</div></section></div> ]]></description>
  <category>C++</category>
  <guid>http://quantdev.blog/posts/custom-iterators/index.html</guid>
  <pubDate>Sun, 04 May 2025 23:00:00 GMT</pubDate>
  <media:content url="http://quantdev.blog/posts/custom-iterators/cpp.jpg" medium="image" type="image/jpeg"/>
</item>
</channel>
</rss>
