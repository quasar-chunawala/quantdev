<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Quasar">
<meta name="dcterms.date" content="2024-11-15">

<title>quantdev.blog - Tridiagonal Systems</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;800&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap')
</style>
<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9993009899870547" crossorigin="anonymous"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">quantdev.blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/quasar-chunawala" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../roadmap.html" rel="" target="">
 <span class="menu-text">Roadmaps</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml" rel="" target=""><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Tridiagonal Systems</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Numerical Methods</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Quasar </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 15, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#thomas-algorithm" id="toc-thomas-algorithm" class="nav-link" data-scroll-target="#thomas-algorithm">Thomas Algorithm</a>
  <ul class="collapse">
  <li><a href="#stage-1" id="toc-stage-1" class="nav-link" data-scroll-target="#stage-1">Stage 1</a></li>
  <li><a href="#stage-2" id="toc-stage-2" class="nav-link" data-scroll-target="#stage-2">Stage 2</a></li>
  </ul></li>
  <li><a href="#computational-solution" id="toc-computational-solution" class="nav-link" data-scroll-target="#computational-solution">Computational Solution</a></li>
  <li><a href="#deriving-the-one-dimensional-heat-equation" id="toc-deriving-the-one-dimensional-heat-equation" class="nav-link" data-scroll-target="#deriving-the-one-dimensional-heat-equation">Deriving the one-dimensional Heat equation</a></li>
  <li><a href="#the-crank-nicolson-and-theta-methods" id="toc-the-crank-nicolson-and-theta-methods" class="nav-link" data-scroll-target="#the-crank-nicolson-and-theta-methods">The Crank-Nicolson and Theta methods</a>
  <ul class="collapse">
  <li><a href="#computational-solution-1" id="toc-computational-solution-1" class="nav-link" data-scroll-target="#computational-solution-1">Computational Solution</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>The special case of a system of linear equations that is <em>tridiagonal</em>, that is, has non-zero elements only on the diagonal plus or minus one column, is one that occurs frequently. Also common are systems that are <em>band-diagonal</em>, with non-zero elements only along a few diagonal lines adjacent to the main diagonal (above and below).</p>
<p>For triadiagonal sets, the procedures <span class="math inline">\(LU\)</span>-decomposition, forward- and back- substitution each take only <span class="math inline">\(O(n)\)</span> operations and the whole solution can be coded very concisely. In this blog post, I am going to explore solving triadiagonal matrix systems. I closely follow Daniel Duffy’s exposition in <em>Chapter 13</em> of his excellent book <a href="https://www.amazon.co.uk/Financial-Instrument-Pricing-Using-Finance-ebook/dp/B07H51DPQP/ref=sr_1_1?crid=35L1ITLEUA1S&amp;dib=eyJ2IjoiMSJ9.FeGDbbRPp2NQKdDQycirWzCkF5j0TlM92l9p6jCKk-U.9ZQRlCNBa5pshnZTad_fcM8KxN4SyD60z1tCbwwwE-g&amp;dib_tag=se&amp;keywords=Financial+Instrument+Pricing+Using+C%2B%2B&amp;nsdOptOutParam=true&amp;qid=1731655789&amp;sprefix=financial+instrument+pricing+using+c%2B%2B%2Caps%2C177&amp;sr=8-1">Financial Instrument Pricing using C++</a>.</p>
<p>Let <span class="math inline">\(A\)</span> be a <span class="math inline">\(m \times n\)</span> general banded matrix with <span class="math inline">\(kl\)</span> subdiagonals and <span class="math inline">\(ku\)</span> superdiagonals. Then, <span class="math inline">\(a_{ij}=0\)</span>, when <span class="math inline">\(|i - j| &gt; kl + ku + 1\)</span>. All non-zero elements are positioned on the main diagonal, <span class="math inline">\(kl\)</span> subdiagonals below it and <span class="math inline">\(ku\)</span> superdiagonals above it.</p>
<ul>
<li><p>A <em>diagonal</em> matrix is a <span class="math inline">\(n \times n\)</span> band matrix with <span class="math inline">\(kl = ku = 0\)</span>.</p></li>
<li><p>A <em>Toeplitz</em> matrix is a <span class="math inline">\(n \times n\)</span> band matrix <span class="math inline">\(T_n=[t_{k,j};k,j=0,1,\ldots,n-1]\)</span> where <span class="math inline">\(t_{k,j}=t_{k-j}\)</span>. That is, a matrix of the form: <span class="math display">\[
T_n = \begin{bmatrix}
t_0 &amp; t_{-1} &amp; t_{-2} &amp; \ldots &amp; t_{-(n-1)}\\
t_1 &amp; t_0 &amp; t_{-1} &amp; \ldots &amp; t_{-(n-2)}\\
t_2 &amp; t_1 &amp; t_{0} &amp; \ldots &amp; t_{-(n-3)}\\
\vdots &amp; &amp; &amp; \ddots &amp; \\
t_{n-1} &amp; t_{n-2} &amp; t_{n-3} &amp; \ldots &amp; t_{0}
\end{bmatrix}
\]</span></p></li>
<li><p>A <em>tridiagonal</em> (Jacobi) matrix is a <span class="math inline">\(n \times n\)</span> band matrix of width three <span class="math inline">\(kl = ku = 1\)</span>. <span class="math display">\[
\begin{bmatrix}
b_0 &amp; c_0 &amp; 0 &amp; \ldots \\
a_1 &amp; b_1 &amp; c_1 &amp; \ldots \\
0 &amp; a_2 &amp; b_2 &amp; \ldots \\
&amp; &amp; &amp; \ldots \\
&amp; &amp; &amp; \ldots &amp; a_{n-2} &amp; b_{n-2} &amp; c_{n-2}\\
&amp; &amp; &amp; \ldots &amp; 0 &amp; a_{n-1} &amp; b_{n-1}
\end{bmatrix}
\]</span></p></li>
</ul>
<p>Consider a two-point boundary value problem on the interval <span class="math inline">\((0,1)\)</span> with Dirichlet boundary conditions:</p>
<p><span id="eq-two-point-bvp"><span class="math display">\[
\begin{align*}
\frac{d^2 u}{d x^2} &amp;= f(x), \quad 0 &lt; x &lt; 1\\
u(0) &amp;= \phi, \\
u(1) &amp;= \psi
\end{align*}
\tag{1}\]</span></span></p>
<p>We approximate the solution <span class="math inline">\(u\)</span> by creating a <em>discrete mesh of points</em> defined by <span class="math inline">\(\{x_j\}\)</span>, <span class="math inline">\(j=0,\ldots,N\)</span> where <span class="math inline">\(N\)</span> is a positive integer. At each interior mesh point the second derivative in the <a href="#eq-two-point-bvp">Equation&nbsp;1</a> can be approximated by a second-order divided difference. The corresponding discrete scheme is:</p>
<p><span class="math display">\[
\begin{matrix}
U_0 &amp;- 2U_1 &amp;+ U_2 &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp;= h^2 f_1 \\
&amp; U_1 &amp;- 2U_2 &amp;+ U_3  &amp; &amp; &amp; &amp; &amp; &amp; &amp;= h^2 f_2 \\
&amp; &amp; U_2 &amp;- 2U_3 &amp;+ U_4 &amp; &amp; &amp; &amp; &amp; &amp;= h^2 f_3 \\
&amp; &amp;     &amp;       &amp;      &amp; \ldots &amp; &amp; &amp; &amp; &amp; \vdots \\
&amp; &amp;     &amp;       &amp;      &amp; \ldots &amp; U_{N-3} &amp;- 2U_{N-2} &amp;+ U_{N-1} &amp;  &amp;= h^2 f_{N-2}\\
&amp; &amp;     &amp;       &amp;      &amp; \ldots &amp;  &amp; U_{N-2} &amp;-2 U_{N-1} &amp;+ U_N &amp;= h^2 f_{N-1}\\
\end{matrix}
\]</span></p>
<p>Since <span class="math inline">\(U_0 = \phi\)</span> and <span class="math inline">\(U_N = \psi\)</span>, we have <span class="math inline">\(N-1\)</span> equations in <span class="math inline">\({N-1}\)</span> unknowns. These can be arranged in the matrix form as:</p>
<p><span class="math display">\[
\begin{bmatrix}
-2 &amp; 1\\
1  &amp;-2 &amp; 1  &amp;   &amp; \ldots &amp;   &amp;    &amp;  \\
   &amp; 1 &amp;-2  &amp; 1 &amp; \ldots &amp;   &amp;    &amp;  \\
   &amp;   &amp;    &amp;   &amp; \ldots &amp;   &amp;    &amp;  \\
   &amp;   &amp;    &amp;   &amp; \ldots &amp; 1 &amp; -2 &amp; 1 \\
   &amp;   &amp;    &amp;   &amp; \ldots &amp;   &amp;  1 &amp; -2
\end{bmatrix}\begin{bmatrix}
U_1 \\
U_2 \\
\vdots\\
U_{N-2} \\
U_{N-1}
\end{bmatrix} = \begin{bmatrix}
h^2 f_1 - \phi\\
h^2 f_2 \\
\vdots\\
h^2 f_{N-2} \\
h^2 f_{N-1} - \psi
\end{bmatrix}
\]</span></p>
<p>or in matrix form <span class="math inline">\(AU=F\)</span>.</p>
</section>
<section id="thomas-algorithm" class="level2">
<h2 class="anchored" data-anchor-id="thomas-algorithm">Thomas Algorithm</h2>
<p>The Thomas algorithm is an efficient way of solving tridiagonal matrix systems. It is based on <span class="math inline">\(LU\)</span>-decomposition in which the matrix system <span class="math inline">\(Ax=r\)</span> is written as <span class="math inline">\(LUx=r\)</span>, where <span class="math inline">\(L\)</span> is a lower-triangular matrix and <span class="math inline">\(U\)</span> is an upper triangular matrix. The system can be efficiently solved by setting <span class="math inline">\(Ux=\rho\)</span> and then solving first <span class="math inline">\(L\rho=r\)</span> and then <span class="math inline">\(Ux=\rho\)</span> for <span class="math inline">\(x\)</span>. The Thomas algorithm consists of two steps. In step 1, decomposing the matrix <span class="math inline">\(M = LU\)</span> and solving <span class="math inline">\(L\rho=r\)</span> are accomplished in a single downwards sweep, taking us straight from <span class="math inline">\(Ax=r\)</span> to <span class="math inline">\(Ux=\rho\)</span>. In step 2, the equation <span class="math inline">\(Ux = \rho\)</span> is solved for <span class="math inline">\(x\)</span> in an upward sweep.</p>
<section id="stage-1" class="level3">
<h3 class="anchored" data-anchor-id="stage-1">Stage 1</h3>
<p>In the first stage, the matrix equation <span class="math inline">\(Ax=r\)</span> is converted to the form <span class="math inline">\(Ux=\rho\)</span>. Initially, the matrix equation looks like this:</p>
<p><span class="math display">\[
\begin{bmatrix}
{\color{blue}b_1} &amp; {\color{blue}c_1} &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
{\color{blue}a_2} &amp; {\color{blue}b_2} &amp; {\color{blue}c_2} &amp; 0 &amp; 0 &amp; 0\\
0 &amp; {\color{blue}a_3} &amp; {\color{blue}b_3} &amp; {\color{blue}c_3} &amp; 0 &amp; 0\\
0 &amp; 0 &amp; {\color{blue}a_4} &amp; {\color{blue}b_4} &amp; {\color{blue}c_4} &amp; 0\\
0 &amp; 0 &amp; 0 &amp; {\color{blue}a_5} &amp; {\color{blue}b_5} &amp; {\color{blue}c_5}\\
0 &amp; 0 &amp; 0 &amp; 0 &amp; a_6 &amp; b_6
\end{bmatrix} \begin{bmatrix}
x_1 \\
x_2 \\
x_3 \\
x_4 \\
x_5 \\
x_6
\end{bmatrix} =
\begin{bmatrix}
{\color{blue}r_1} \\
{\color{blue}r_2} \\
{\color{blue}r_3} \\
{\color{blue}r_4} \\
{\color{blue}r_5} \\
{\color{blue}r_6}
\end{bmatrix}
\]</span></p>
<p>Row <span class="math inline">\(1\)</span>:</p>
<p><span class="math display">\[
{\color{blue}b_1} x_1 + {\color{blue}c_1} x_2 = {\color{blue}r_1}
\]</span></p>
<p>Dividing throughout by <span class="math inline">\(\color{blue}b_1\)</span>,</p>
<p><span class="math display">\[
x_1 + {\color{blue}\frac{c_1}{b_1}} x_2 = {\color{blue}\frac{r_1}{b_1}}
\]</span></p>
<p>Rewrite:</p>
<p><span class="math display">\[
x_1 + {\color{red}\gamma_1} x_2 = {\color{red}\rho_1}, \quad {\color{red}\gamma_1} = {\color{blue}\frac{c_1}{b_1}}, \quad {\color{red}\rho_1} = {\color{blue}\frac{r_1}{b_1}}
\]</span></p>
<p><span class="math display">\[
\begin{bmatrix}
{\color{red}1} &amp; {\color{red}\gamma_1} &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
{\color{blue}a_2} &amp; {\color{blue}b_2} &amp; {\color{blue}c_2} &amp; 0 &amp; 0 &amp; 0\\
0 &amp; {\color{blue}a_3} &amp; {\color{blue}b_3} &amp; {\color{blue}c_3} &amp; 0 &amp; 0\\
0 &amp; 0 &amp; {\color{blue}a_4} &amp; {\color{blue}b_4} &amp; {\color{blue}c_4} &amp; 0\\
0 &amp; 0 &amp; 0 &amp; {\color{blue}a_5} &amp; {\color{blue}b_5} &amp; {\color{blue}c_5}\\
0 &amp; 0 &amp; 0 &amp; 0 &amp; a_6 &amp; b_6
\end{bmatrix} \begin{bmatrix}
x_1 \\
x_2 \\
x_3 \\
x_4 \\
x_5 \\
x_6
\end{bmatrix} =
\begin{bmatrix}
{\color{red}\rho_1} \\
{\color{blue}r_2} \\
{\color{blue}r_3} \\
{\color{blue}r_4} \\
{\color{blue}r_5} \\
{\color{blue}r_6}
\end{bmatrix}
\]</span></p>
<p>Row <span class="math inline">\(2\)</span>:</p>
<p><span class="math display">\[
{\color{blue}a_2} x_1 + {\color{blue}b_2} x_2 + {\color{blue}c_2} x_3 = {\color{blue}r_2}
\]</span></p>
<p>Use <span class="math inline">\(a_2\)</span> times row <span class="math inline">\(1\)</span> of the matrix to eliminate the first term</p>
<p><span class="math display">\[
a_2(x_1 + {\color{red}\gamma_1}x_2 = {\color{red}\rho_1})
\]</span></p>
<p><span class="math display">\[
\begin{array}{c|cccc}
\text{Row 2} &amp; a_2 x_1 &amp;+ b_2 x_2 &amp;+ c_2 x_3 &amp;= r_2\\
a_2 \times \text{Row 1} &amp; a_2 x_1 &amp;+ a_2 \gamma_1 x_2 &amp; &amp;= a_2\rho_1\\
\hline
\text{New Row 2} &amp; &amp; (b_2 - a_2 \gamma_1) x_2 &amp;+ c_2 x_3  &amp;= r_2 - a_2 \rho_1
\end{array}
\]</span></p>
<p>Dividing throughout by <span class="math inline">\((b_2 - a_2 \gamma_1)\)</span>, we get:</p>
<p><span class="math display">\[
x_2 + \frac{c_2}{b_2 - a_2 \gamma_1}x_3 = \frac{(r_2 - a_2 \rho_1)}{(b_2 - a_2 \gamma_1)}
\]</span></p>
<p>We can rewrite this as:</p>
<p><span class="math display">\[
x_2 + \gamma_2 x_3 = \rho_2, \quad \gamma_2 = \frac{c_2}{b_2 - a_2 \gamma_1}, \quad \rho_2 = \frac{(r_2 - a_2 \rho_1)}{(b_2 - a_2 \gamma_1)}
\]</span></p>
<p><span class="math display">\[
\begin{bmatrix}
1 &amp; \gamma_1 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
0 &amp; 1 &amp; \gamma_2 &amp; 0 &amp; 0 &amp; 0\\
0 &amp; a_3 &amp; b_3 &amp; c_3 &amp; 0 &amp; 0\\
0 &amp; 0 &amp; a_4 &amp; b_4 &amp; c_4 &amp; 0\\
0 &amp; 0 &amp; 0 &amp; a_5 &amp; b_5 &amp; c_5\\
0 &amp; 0 &amp; 0 &amp; 0 &amp; a_6 &amp; b_6
\end{bmatrix} \begin{bmatrix}
x_1 \\
x_2 \\
x_3 \\
x_4 \\
x_5 \\
x_6
\end{bmatrix} =
\begin{bmatrix}
\rho_1 \\
\rho_2 \\
r_3 \\
r_4 \\
r_5 \\
r_6
\end{bmatrix}
\]</span></p>
<p>Row <span class="math inline">\(3\)</span>:</p>
<p><span class="math display">\[
a_3 x_2 + b_3 x_3 + c_3 x_4 = r_3
\]</span></p>
<p>Use <span class="math inline">\(a_3\)</span> times row <span class="math inline">\(2\)</span> of the matrix to eliminate the first term:</p>
<p><span class="math display">\[
\begin{array}{c|cccc}
\text{Row 3} &amp; a_3 x_2 &amp;+ b_3 x_3 &amp;+ c_3 x_4 &amp;= r_3\\
a_3 \times \text{Row 2} &amp; a_3 x_2 &amp;+ a_3 \gamma_2 x_3 &amp; &amp;= a_3\rho_2\\
\hline
\text{New Row 3} &amp; &amp; (b_3 - a_3 \gamma_2) x_3 &amp;+ c_3 x_4  &amp;= r_3 - a_3 \rho_2
\end{array}
\]</span></p>
<p>Dividing throughout by <span class="math inline">\((b_3 - a_3 \gamma_2)\)</span>, we have:</p>
<p><span class="math display">\[
x_3 + \frac{c_3}{b_3 - a_3 \gamma_2} x_4 = \frac{r_3 - a_3\rho_2}{b_3 - a_3 \gamma_2}
\]</span></p>
<p>We can rewrite this as:</p>
<p><span class="math display">\[
x_3 + \gamma_3 x_4 = \rho_3, \quad  \gamma_3 = \frac{c_3}{b_3 - a_3 \gamma_2}, \quad \rho_3=\frac{r_3 - a_3 \rho_2}{b_3 - a_3 \gamma_2}
\]</span></p>
<p>Continuing in this fashion, we get:</p>
<p><span class="math display">\[
\begin{bmatrix}
1 &amp; \gamma_1 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
0 &amp; 1 &amp; \gamma_2 &amp; 0 &amp; 0 &amp; 0\\
0 &amp; 1 &amp; 1 &amp; \gamma_3 &amp; 0 &amp; 0\\
0 &amp; 0 &amp; 0 &amp; 1 &amp; \gamma_4 &amp; 0\\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; \gamma_5\\
0 &amp; 0 &amp; 0 &amp; 0 &amp; a_6 &amp; b_6
\end{bmatrix} \begin{bmatrix}
x_1 \\
x_2 \\
x_3 \\
x_4 \\
x_5 \\
x_6
\end{bmatrix} =
\begin{bmatrix}
\rho_1 \\
\rho_2 \\
\rho_3 \\
\rho_4 \\
\rho_5 \\
r_6
\end{bmatrix}
\]</span></p>
<p>Row <span class="math inline">\(6\)</span>:</p>
<p><span class="math display">\[
a_6 x_5 + a_6 x_6 = r_6
\]</span></p>
<p>Use <span class="math inline">\(a_6\)</span> times row 5 of the matrix:</p>
<p><span class="math display">\[a_6(x_5 + \gamma_5 x_6 = \rho_5)\]</span></p>
<p><span class="math display">\[
\begin{array}{c|cccc}
\text{Row 6} &amp; a_6 x_5 &amp;+ b_6 x_6 &amp;= r_6\\
a_6 \times \text{Row 5} &amp; a_6 x_5 &amp;+ a_6 \gamma_5 x_6  &amp;= a_6\rho_5\\
\hline
\text{New Row 3} &amp; &amp; (b_6 - a_6 \gamma_5) x_6  &amp;= r_6 - a_6 \rho_5
\end{array}
\]</span></p>
<p>Dividing throughout by <span class="math inline">\((b_6 - a_6 \gamma_5)\)</span>, we can rewrite:</p>
<p><span class="math display">\[
x_6 = \rho_6, \quad \rho_6 = \frac{r_6 - a_6 \rho_5}{b_6 - a_6 \gamma_5}
\]</span></p>
<p><span class="math display">\[
\begin{bmatrix}
1 &amp; \gamma_1 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
0 &amp; 1 &amp; \gamma_2 &amp; 0 &amp; 0 &amp; 0\\
0 &amp; 1 &amp; 1 &amp; \gamma_3 &amp; 0 &amp; 0\\
0 &amp; 0 &amp; 0 &amp; 1 &amp; \gamma_4 &amp; 0\\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; \gamma_5\\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix} \begin{bmatrix}
x_1 \\
x_2 \\
x_3 \\
x_4 \\
x_5 \\
x_6
\end{bmatrix} =
\begin{bmatrix}
\rho_1 \\
\rho_2 \\
\rho_3 \\
\rho_4 \\
\rho_5 \\
\rho_6
\end{bmatrix}
\]</span></p>
<p>These steps may be summarized as compute the following sequences:</p>
<p><span class="math display">\[
\gamma_1 = \frac{c_1}{b_1}, \quad \rho_1 = \frac{r_1}{b_1}
\]</span></p>
<p>And <span class="math display">\[\gamma_j = \frac{c_j}{b_j - a_j \gamma_{j-1}}, \quad \rho_j = \frac{r_j - a_j \rho_{j-1}}{b_j - a_j \gamma_{j-1}}\]</span></p>
<p>for <span class="math inline">\(j=2:6\)</span>.</p>
<p>At this point, the matrix has been reduced to the upper diagonal form, so our equations are of the form <span class="math inline">\(Ux = \rho\)</span>.</p>
</section>
<section id="stage-2" class="level3">
<h3 class="anchored" data-anchor-id="stage-2">Stage 2</h3>
<p>The matrix is now in a form which is trivial to solve for <span class="math inline">\(x\)</span>. We start with the last row and work our way up. The final equation is already solved.</p>
<p><span class="math display">\[
x_6 = \rho_6
\]</span></p>
<p><span class="math display">\[
\begin{bmatrix}
1 &amp; \gamma_1 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
0 &amp; 1 &amp; \gamma_2 &amp; 0 &amp; 0 &amp; 0\\
0 &amp; 1 &amp; 1 &amp; \gamma_3 &amp; 0 &amp; 0\\
0 &amp; 0 &amp; 0 &amp; 1 &amp; \gamma_4 &amp; 0\\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; \gamma_5\\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix} \begin{bmatrix}
x_1 \\
x_2 \\
x_3 \\
x_4 \\
x_5 \\
x_6
\end{bmatrix} =
\begin{bmatrix}
\rho_1 \\
\rho_2 \\
\rho_3 \\
\rho_4 \\
\rho_5 \\
\rho_6
\end{bmatrix}
\]</span></p>
<p>Row <span class="math inline">\(5\)</span>: <span class="math display">\[
x_5 + \gamma_5 x_6 = \rho_5
\]</span></p>
<p>Rearrange to get:</p>
<p><span class="math display">\[
x_5 = \rho_5 - \gamma_5 x_6
\]</span></p>
<p>Row <span class="math inline">\(4\)</span>:</p>
<p><span class="math display">\[
x_4 + \gamma_4 x_5 = \rho_4
\]</span></p>
<p>Rearrange to get:</p>
<p><span class="math display">\[
x_4 = \rho_4 - \gamma_4 x_5
\]</span></p>
<p>Continuing in this fashion, we find that, <span class="math inline">\(x_6 = \rho_6\)</span> and</p>
<p><span class="math display">\[
x_j = \rho_j - \gamma_j x_{j+1}
\]</span></p>
<p>for all <span class="math inline">\(j=1:5\)</span>.</p>
</section>
</section>
<section id="computational-solution" class="level2">
<h2 class="anchored" data-anchor-id="computational-solution">Computational Solution</h2>
<p>Let’s quickly code up the algorithm in Julia.</p>
<div id="00559260" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">function</span> <span class="fu">thomasAlgorithm</span>(a, b, c, r)</span>
<span id="cb1-2"><a href="#cb1-2"></a>    N <span class="op">=</span> <span class="fu">size</span>(a)[<span class="fl">1</span>]</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a>    <span class="co"># Stage 1</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>    γ <span class="op">=</span> <span class="fu">Array</span><span class="dt">{Float64,1}</span>(<span class="cn">undef</span>,N)</span>
<span id="cb1-6"><a href="#cb1-6"></a>    ρ <span class="op">=</span> <span class="fu">Array</span><span class="dt">{Float64,1}</span>(<span class="cn">undef</span>,N)</span>
<span id="cb1-7"><a href="#cb1-7"></a>    u <span class="op">=</span> <span class="fu">Array</span><span class="dt">{Float64,1}</span>(<span class="cn">undef</span>,N)</span>
<span id="cb1-8"><a href="#cb1-8"></a></span>
<span id="cb1-9"><a href="#cb1-9"></a>    γ[<span class="fl">1</span>] <span class="op">=</span> c[<span class="fl">1</span>]<span class="op">/</span>b[<span class="fl">1</span>]</span>
<span id="cb1-10"><a href="#cb1-10"></a>    ρ[<span class="fl">1</span>] <span class="op">=</span> r[<span class="fl">1</span>]<span class="op">/</span>b[<span class="fl">1</span>]</span>
<span id="cb1-11"><a href="#cb1-11"></a></span>
<span id="cb1-12"><a href="#cb1-12"></a>    <span class="cf">for</span> j<span class="op">=</span><span class="fl">2</span><span class="op">:</span>N</span>
<span id="cb1-13"><a href="#cb1-13"></a>        γ[j] <span class="op">=</span> c[j]<span class="op">/</span>(b[j] <span class="op">-</span> a[j] <span class="op">*</span> γ[j<span class="op">-</span><span class="fl">1</span>])</span>
<span id="cb1-14"><a href="#cb1-14"></a>        ρ[j] <span class="op">=</span> (r[j] <span class="op">-</span> a[j] <span class="op">*</span> ρ[j<span class="op">-</span><span class="fl">1</span>])<span class="op">/</span>(b[j] <span class="op">-</span> a[j] <span class="op">*</span> γ[j<span class="op">-</span><span class="fl">1</span>])</span>
<span id="cb1-15"><a href="#cb1-15"></a>    <span class="cf">end</span></span>
<span id="cb1-16"><a href="#cb1-16"></a></span>
<span id="cb1-17"><a href="#cb1-17"></a>    <span class="co"># Stage 2</span></span>
<span id="cb1-18"><a href="#cb1-18"></a>    u[N] <span class="op">=</span>  ρ[N]</span>
<span id="cb1-19"><a href="#cb1-19"></a></span>
<span id="cb1-20"><a href="#cb1-20"></a>    <span class="cf">for</span> j<span class="op">=</span><span class="fu">reverse</span>(<span class="fl">1</span><span class="op">:</span>N<span class="op">-</span><span class="fl">1</span>)</span>
<span id="cb1-21"><a href="#cb1-21"></a>        u[j] <span class="op">=</span> ρ[j] <span class="op">-</span> γ[j] <span class="op">*</span> u[j<span class="op">+</span><span class="fl">1</span>]</span>
<span id="cb1-22"><a href="#cb1-22"></a>    <span class="cf">end</span></span>
<span id="cb1-23"><a href="#cb1-23"></a></span>
<span id="cb1-24"><a href="#cb1-24"></a>    <span class="cf">return</span> u</span>
<span id="cb1-25"><a href="#cb1-25"></a><span class="kw">end</span></span>
<span id="cb1-26"><a href="#cb1-26"></a></span>
<span id="cb1-27"><a href="#cb1-27"></a><span class="co"># Test Case</span></span>
<span id="cb1-28"><a href="#cb1-28"></a></span>
<span id="cb1-29"><a href="#cb1-29"></a>a <span class="op">=</span> <span class="fu">Array</span><span class="dt">{Float64,1}</span>([<span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>])</span>
<span id="cb1-30"><a href="#cb1-30"></a>b <span class="op">=</span> <span class="fu">Array</span><span class="dt">{Float64,1}</span>([<span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span>])</span>
<span id="cb1-31"><a href="#cb1-31"></a>c <span class="op">=</span> <span class="fu">Array</span><span class="dt">{Float64,1}</span>([<span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">0</span>])</span>
<span id="cb1-32"><a href="#cb1-32"></a>r <span class="op">=</span> <span class="fu">Array</span><span class="dt">{Float64,1}</span>([<span class="fl">12</span>, <span class="fl">17</span>, <span class="fl">14</span>, <span class="fl">7</span>])</span>
<span id="cb1-33"><a href="#cb1-33"></a>u <span class="op">=</span> <span class="fu">thomasAlgorithm</span>(a, b, c, r)</span>
<span id="cb1-34"><a href="#cb1-34"></a></span>
<span id="cb1-35"><a href="#cb1-35"></a><span class="fu">print</span>(u)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[2.0, 3.0, 1.9999999999999996, 1.0000000000000004]</code></pre>
</div>
</div>
<p>Here is an implementation in modern C++:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="pp">#include </span><span class="im">&lt;memory&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="pp">#include </span><span class="im">&lt;functional&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="pp">#include </span><span class="im">&lt;concepts&gt;</span></span>
<span id="cb3-5"><a href="#cb3-5"></a></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="kw">concept</span> Real <span class="op">=</span> <span class="bu">std::</span>integral<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="op">||</span> <span class="bu">std::</span>floating_point<span class="op">&lt;</span>T<span class="op">&gt;;</span></span>
<span id="cb3-8"><a href="#cb3-8"></a></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="kw">requires</span> Real<span class="op">&lt;</span>T<span class="op">&gt;</span></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="kw">using</span> Function <span class="op">=</span> <span class="bu">std::</span>function<span class="op">&lt;</span><span class="dt">void</span><span class="op">(</span><span class="bu">std::</span>vector<span class="op">&lt;</span>T<span class="op">&gt;,</span> <span class="bu">std::</span>vector<span class="op">&lt;</span>T<span class="op">&gt;,</span> <span class="bu">std::</span>vector<span class="op">&lt;</span>T<span class="op">&gt;,</span> <span class="bu">std::</span>vector<span class="op">&lt;</span>T<span class="op">&gt;,</span> <span class="bu">std::</span>vector<span class="op">&lt;</span>T<span class="op">&gt;&amp;)&gt;;</span></span>
<span id="cb3-12"><a href="#cb3-12"></a></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="kw">requires</span> Real<span class="op">&lt;</span>T<span class="op">&gt;</span></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="dt">void</span> thomasAlgorithm<span class="op">(</span></span>
<span id="cb3-16"><a href="#cb3-16"></a>      <span class="bu">std::</span>vector<span class="op">&lt;</span>T<span class="op">&gt;</span> a</span>
<span id="cb3-17"><a href="#cb3-17"></a>    <span class="op">,</span> <span class="bu">std::</span>vector<span class="op">&lt;</span>T<span class="op">&gt;</span> b</span>
<span id="cb3-18"><a href="#cb3-18"></a>    <span class="op">,</span> <span class="bu">std::</span>vector<span class="op">&lt;</span>T<span class="op">&gt;</span> c</span>
<span id="cb3-19"><a href="#cb3-19"></a>    <span class="op">,</span> <span class="bu">std::</span>vector<span class="op">&lt;</span>T<span class="op">&gt;</span> r</span>
<span id="cb3-20"><a href="#cb3-20"></a>    <span class="op">,</span> <span class="bu">std::</span>vector<span class="op">&lt;</span>T<span class="op">&gt;&amp;</span>x </span>
<span id="cb3-21"><a href="#cb3-21"></a>    <span class="op">){</span></span>
<span id="cb3-22"><a href="#cb3-22"></a>    <span class="co">//Stage-1</span></span>
<span id="cb3-23"><a href="#cb3-23"></a>    <span class="dt">int</span> N <span class="op">=</span> a<span class="op">.</span>size<span class="op">();</span></span>
<span id="cb3-24"><a href="#cb3-24"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span>T<span class="op">&gt;</span> gamma<span class="op">(</span>N<span class="op">);</span></span>
<span id="cb3-25"><a href="#cb3-25"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span>T<span class="op">&gt;</span> rho<span class="op">(</span>N<span class="op">);</span></span>
<span id="cb3-26"><a href="#cb3-26"></a>    x <span class="op">=</span> <span class="bu">std::</span>vector<span class="op">&lt;</span>T<span class="op">&gt;(</span>N<span class="op">);</span></span>
<span id="cb3-27"><a href="#cb3-27"></a></span>
<span id="cb3-28"><a href="#cb3-28"></a>    gamma<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> c<span class="op">[</span><span class="dv">0</span><span class="op">]/</span>b<span class="op">[</span><span class="dv">0</span><span class="op">];</span> </span>
<span id="cb3-29"><a href="#cb3-29"></a>    rho<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> r<span class="op">[</span><span class="dv">0</span><span class="op">]/</span>b<span class="op">[</span><span class="dv">0</span><span class="op">];</span></span>
<span id="cb3-30"><a href="#cb3-30"></a></span>
<span id="cb3-31"><a href="#cb3-31"></a>    <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> j<span class="op">{</span><span class="dv">1</span><span class="op">};</span> j <span class="op">&lt;</span> N<span class="op">;</span> <span class="op">++</span>j<span class="op">)</span></span>
<span id="cb3-32"><a href="#cb3-32"></a>    <span class="op">{</span></span>
<span id="cb3-33"><a href="#cb3-33"></a>        gamma<span class="op">[</span>j<span class="op">]</span> <span class="op">=</span> c<span class="op">[</span>j<span class="op">]/(</span>b<span class="op">[</span>j<span class="op">]</span> <span class="op">-</span> a<span class="op">[</span>j<span class="op">]</span> <span class="op">*</span> gamma<span class="op">[</span>j<span class="op">-</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb3-34"><a href="#cb3-34"></a>        rho<span class="op">[</span>j<span class="op">]</span> <span class="op">=</span> <span class="op">(</span>r<span class="op">[</span>j<span class="op">]</span> <span class="op">-</span> a<span class="op">[</span>j<span class="op">]</span> <span class="op">*</span> rho<span class="op">[</span>j<span class="op">-</span><span class="dv">1</span><span class="op">])/(</span>b<span class="op">[</span>j<span class="op">]</span> <span class="op">-</span> a<span class="op">[</span>j<span class="op">]</span> <span class="op">*</span> gamma<span class="op">[</span>j<span class="op">-</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb3-35"><a href="#cb3-35"></a>    <span class="op">}</span></span>
<span id="cb3-36"><a href="#cb3-36"></a></span>
<span id="cb3-37"><a href="#cb3-37"></a>    <span class="co">//Stage-2</span></span>
<span id="cb3-38"><a href="#cb3-38"></a>    x<span class="op">[</span>N<span class="op">-</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> rho<span class="op">[</span>N<span class="op">-</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb3-39"><a href="#cb3-39"></a>    <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> j<span class="op">{</span>N<span class="op">-</span><span class="dv">2</span><span class="op">};</span> j <span class="op">&gt;=</span> <span class="dv">0</span><span class="op">;</span> j<span class="op">--)</span></span>
<span id="cb3-40"><a href="#cb3-40"></a>    <span class="op">{</span></span>
<span id="cb3-41"><a href="#cb3-41"></a>        x<span class="op">[</span>j<span class="op">]</span> <span class="op">=</span> rho<span class="op">[</span>j<span class="op">]</span> <span class="op">-</span> gamma<span class="op">[</span>j<span class="op">]</span> <span class="op">*</span> x<span class="op">[</span>j<span class="op">+</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb3-42"><a href="#cb3-42"></a>    <span class="op">}</span></span>
<span id="cb3-43"><a href="#cb3-43"></a><span class="op">}</span></span>
<span id="cb3-44"><a href="#cb3-44"></a></span>
<span id="cb3-45"><a href="#cb3-45"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span>
<span id="cb3-46"><a href="#cb3-46"></a><span class="kw">requires</span> Real<span class="op">&lt;</span>T<span class="op">&gt;</span></span>
<span id="cb3-47"><a href="#cb3-47"></a><span class="kw">class</span> LUTridiagonalSolver<span class="op">{</span></span>
<span id="cb3-48"><a href="#cb3-48"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb3-49"><a href="#cb3-49"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="va">m_a</span><span class="op">;</span></span>
<span id="cb3-50"><a href="#cb3-50"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="va">m_b</span><span class="op">;</span></span>
<span id="cb3-51"><a href="#cb3-51"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="va">m_c</span><span class="op">;</span></span>
<span id="cb3-52"><a href="#cb3-52"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="va">m_r</span><span class="op">;</span></span>
<span id="cb3-53"><a href="#cb3-53"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="va">m_x</span><span class="op">;</span></span>
<span id="cb3-54"><a href="#cb3-54"></a>        Function<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="va">m_LUTridiagonalSolverStrategy</span><span class="op">;</span></span>
<span id="cb3-55"><a href="#cb3-55"></a>    </span>
<span id="cb3-56"><a href="#cb3-56"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb3-57"><a href="#cb3-57"></a>        LUTridiagonalSolver<span class="op">()</span> <span class="op">=</span> <span class="cf">default</span><span class="op">;</span></span>
<span id="cb3-58"><a href="#cb3-58"></a>        LUTridiagonalSolver<span class="op">(</span></span>
<span id="cb3-59"><a href="#cb3-59"></a>              <span class="bu">std::</span>vector<span class="op">&lt;</span>T<span class="op">&gt;</span> a</span>
<span id="cb3-60"><a href="#cb3-60"></a>            <span class="op">,</span> <span class="bu">std::</span>vector<span class="op">&lt;</span>T<span class="op">&gt;</span> b</span>
<span id="cb3-61"><a href="#cb3-61"></a>            <span class="op">,</span> <span class="bu">std::</span>vector<span class="op">&lt;</span>T<span class="op">&gt;</span> c</span>
<span id="cb3-62"><a href="#cb3-62"></a>            <span class="op">,</span> <span class="bu">std::</span>vector<span class="op">&lt;</span>T<span class="op">&gt;</span> r</span>
<span id="cb3-63"><a href="#cb3-63"></a>            <span class="op">,</span> Function<span class="op">&lt;</span>T<span class="op">&gt;</span> solver<span class="op">)</span> </span>
<span id="cb3-64"><a href="#cb3-64"></a>            <span class="op">:</span> <span class="va">m_a</span> <span class="op">{</span><span class="bu">std::</span>move<span class="op">(</span>a<span class="op">)}</span></span>
<span id="cb3-65"><a href="#cb3-65"></a>            <span class="op">,</span> <span class="va">m_b</span> <span class="op">{</span><span class="bu">std::</span>move<span class="op">(</span>b<span class="op">)}</span></span>
<span id="cb3-66"><a href="#cb3-66"></a>            <span class="op">,</span> <span class="va">m_c</span> <span class="op">{</span><span class="bu">std::</span>move<span class="op">(</span>c<span class="op">)}</span></span>
<span id="cb3-67"><a href="#cb3-67"></a>            <span class="op">,</span> <span class="va">m_r</span> <span class="op">{</span><span class="bu">std::</span>move<span class="op">(</span>r<span class="op">)}</span></span>
<span id="cb3-68"><a href="#cb3-68"></a>            <span class="op">,</span> <span class="va">m_LUTridiagonalSolverStrategy</span> <span class="op">{</span>solver<span class="op">}</span> </span>
<span id="cb3-69"><a href="#cb3-69"></a>            <span class="op">{}</span></span>
<span id="cb3-70"><a href="#cb3-70"></a></span>
<span id="cb3-71"><a href="#cb3-71"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span>T<span class="op">&gt;</span> solve<span class="op">(){</span></span>
<span id="cb3-72"><a href="#cb3-72"></a>            <span class="va">m_LUTridiagonalSolverStrategy</span><span class="op">(</span><span class="va">m_a</span><span class="op">,</span> <span class="va">m_b</span><span class="op">,</span> <span class="va">m_c</span><span class="op">,</span> <span class="va">m_r</span><span class="op">,</span> <span class="va">m_x</span><span class="op">);</span></span>
<span id="cb3-73"><a href="#cb3-73"></a>            <span class="cf">return</span> <span class="va">m_x</span><span class="op">;</span></span>
<span id="cb3-74"><a href="#cb3-74"></a>        <span class="op">}</span></span>
<span id="cb3-75"><a href="#cb3-75"></a></span>
<span id="cb3-76"><a href="#cb3-76"></a>        LUTridiagonalSolver<span class="op">(</span><span class="at">const</span> LUTridiagonalSolver<span class="op">&amp;</span> <span class="op">)</span> <span class="op">=</span> <span class="kw">delete</span><span class="op">;</span></span>
<span id="cb3-77"><a href="#cb3-77"></a>        LUTridiagonalSolver <span class="kw">operator</span><span class="op">=(</span>LUTridiagonalSolver<span class="op">&amp;</span> <span class="op">)</span> <span class="op">=</span> <span class="kw">delete</span><span class="op">;</span></span>
<span id="cb3-78"><a href="#cb3-78"></a>        <span class="op">~</span>LUTridiagonalSolver<span class="op">(){}</span></span>
<span id="cb3-79"><a href="#cb3-79"></a><span class="op">};</span></span>
<span id="cb3-80"><a href="#cb3-80"></a></span>
<span id="cb3-81"><a href="#cb3-81"></a><span class="dt">int</span> main<span class="op">()</span></span>
<span id="cb3-82"><a href="#cb3-82"></a><span class="op">{</span></span>
<span id="cb3-83"><a href="#cb3-83"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;</span> a<span class="op">{</span><span class="dv">0</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">};</span></span>
<span id="cb3-84"><a href="#cb3-84"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;</span> b<span class="op">{</span><span class="dv">3</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">3</span><span class="op">};</span></span>
<span id="cb3-85"><a href="#cb3-85"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;</span> c<span class="op">{</span><span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">0</span><span class="op">};</span></span>
<span id="cb3-86"><a href="#cb3-86"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;</span> r<span class="op">{</span><span class="dv">12</span><span class="op">,</span> <span class="dv">17</span><span class="op">,</span> <span class="dv">14</span><span class="op">,</span> <span class="dv">7</span><span class="op">};</span></span>
<span id="cb3-87"><a href="#cb3-87"></a></span>
<span id="cb3-88"><a href="#cb3-88"></a>    LUTridiagonalSolver<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;</span> solver<span class="op">(</span>a<span class="op">,</span> b<span class="op">,</span> c<span class="op">,</span> r<span class="op">,</span> thomasAlgorithm<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;);</span></span>
<span id="cb3-89"><a href="#cb3-89"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;</span> u <span class="op">=</span> solver<span class="op">.</span>solve<span class="op">();</span></span>
<span id="cb3-90"><a href="#cb3-90"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-91"><a href="#cb3-91"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><a href="https://godbolt.org/z/T7846WY8v">Compiler Explorer</a></p>
</section>
<section id="deriving-the-one-dimensional-heat-equation" class="level2">
<h2 class="anchored" data-anchor-id="deriving-the-one-dimensional-heat-equation">Deriving the one-dimensional Heat equation</h2>
<p>Consider a slender homogenous rod, lying along the <span class="math inline">\(x\)</span>-axis and insulated, so that no heat can escape across its longitudinal surface. In addition, we make the simplifying assumption that the temperature in the rod is constant on each cross-section perpendicular to the <span class="math inline">\(x\)</span>-axis, and thus that the flow of heat in the rod takes place only in the <span class="math inline">\(x\)</span>-direction.</p>
<p>Consider a small segment of the rod at position <span class="math inline">\(x\)</span> of length <span class="math inline">\(\Delta x\)</span>.</p>
<p>The thermal energy in this segment at time <span class="math inline">\(t\)</span> is:</p>
<p><span class="math display">\[
E(x,x+\Delta x, t) \approx u(x,t) s \rho \Delta x
\]</span></p>
<p>where <span class="math inline">\(s\)</span> is the constant of specific heat i.e.&nbsp;amount of heat required to raise one unit of mass by one unit of temperature, <span class="math inline">\(\rho\)</span> is the mass density.</p>
<p>Fourier’s law of heat conduction quantifies the idea that heat flows from warmer to colder regions and states that the (rightward) heat flux density <span class="math inline">\(\phi(x,t)\)</span> (the flow of heat energy per unit area per unit time, SI units <span class="math inline">\(J/s/m^2\)</span>) at any point is:</p>
<p><span class="math display">\[
\phi(x,t) = -K_0 u_x (x, t)
\]</span></p>
<p>where <span class="math inline">\(K_0\)</span> is the thermal conductivity of the rod. The negative sign shows that the heat flows from higher temperature regions to colder temperature regions.</p>
<p>Appealing to the law of conservation of energy:</p>
<p><span id="eq-heat-content"><span class="math display">\[
\begin{align*}
\underbrace{\frac{\partial}{\partial t}(u(x,t) s \rho \Delta x)}_{\text{Heat flux through segment}} = \underbrace{(-K_0 u_x(x, t))}_{\text{Flux in}} - \underbrace{(- K_0 u_x(x + \Delta x,t))}_{\text{Flux out}}
\end{align*}
\tag{2}\]</span></span></p>
<p>Dividing throughout by <span class="math inline">\(\Delta x\)</span> we have:</p>
<p><span class="math display">\[
\begin{align*}
u_t(x,t) \approx \frac{K_0}{s \rho } \frac{u_x(x+\Delta x, t) - u_x(x,t)}{\Delta x}
\end{align*}
\]</span></p>
<p>Letting <span class="math inline">\(\Delta x \to 0\)</span> improves the approximation and leads to the heat equation:</p>
<p><span class="math display">\[
u_t=c^2 u_{xx}
\]</span></p>
<p>where <span class="math inline">\(c^2 = \frac{K_0}{\rho s}\)</span> is called the <em>thermal diffusivity</em>.</p>
</section>
<section id="the-crank-nicolson-and-theta-methods" class="level2">
<h2 class="anchored" data-anchor-id="the-crank-nicolson-and-theta-methods">The Crank-Nicolson and Theta methods</h2>
<p>Consider the initial boundary value problem for the <span class="math inline">\(1\)</span>d-heat equation:</p>
<p><span class="math display">\[
\begin{align*}
u_t &amp;= a^2 u_{xx}, \quad &amp; 0 &lt; x &lt; L, t&gt;0\\
u(x,0) &amp;= f(x), \quad 0 \leq x \leq L \\
u(0,t) &amp;= A, \\
u(L,t) &amp;= B
\end{align*}
\]</span></p>
<p>In this case, we can assume without the loss of generality that <span class="math inline">\(L = 1\)</span>. Here, <span class="math inline">\(a\)</span>, <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> are constants.</p>
<p>We find a solution to this system in the case when <span class="math inline">\(A = B = 0\)</span> and <span class="math inline">\(a = 1\)</span> by the <em>method of the separation of variables</em>. In this case, the analytical solution is:</p>
<p><span class="math display">\[
u(x,t) = \frac{8}{\pi^2}\sum_{n=1}^{\infty}\frac{1}{n^2}\sin\left(\frac{n\pi}{2}\right)\sin(n\pi x)\exp(-n^2 \pi^2 t)
\]</span></p>
<p>and we are going to use this solution as a benchmark against which the numerical solutions can be compared.</p>
<p>We can discretize a parabolic PDE in the space dimension (using centered difference schemes) while keeping the time variable continuous. We examine the following initial boundary value problem for the <span class="math inline">\(1\)</span>d-heat equation on the unit interval with zero Dirichlet boundary conditions.</p>
<p>The problem is:</p>
<p><span id="eq-IBVP"><span class="math display">\[
\begin{align*}
u_t &amp;= u_{xx}, \quad &amp; 0 &lt; x &lt; 1, t&gt;0\\
u(x,0) &amp;= f(x), \quad 0 \leq x \leq 1 \\
u(0,t) &amp;= u(1,t) = 0
\end{align*}
\tag{3}\]</span></span></p>
<p>We partition the space interval <span class="math inline">\((0,1)\)</span> into <span class="math inline">\(J\)</span> subintervals and we approximate <a href="#eq-IBVP">Equation&nbsp;3</a> by the <em>semi-discrete</em> scheme:</p>
<p><span class="math display">\[
\begin{align*}
\frac{dU_j}{dt} &amp;= \frac{1}{h^2}(U_{j+1} - 2U_j + U_{j-1}), \quad 1 \leq j \leq J-1 \\
U_0(t) &amp;= U_J(t) = 0, \quad t &gt; 0 \\
U_j(0) &amp;= f(x_j)
\end{align*}
\]</span></p>
<p>where <span class="math inline">\(h = 1/J\)</span> is the constant mesh size. The <span class="math inline">\(U_j\)</span>’s are functions of time <span class="math inline">\(t\)</span>. So, we define the following vectors:</p>
<p><span class="math display">\[
\begin{align*}
U(t) &amp;= (U_1(t),U_2(t),\ldots,U_J(t))^T \\
U^0 &amp;= (f(x_1),f(x_2),\ldots,f(x_{J-1}))^T
\end{align*}
\]</span></p>
<p>Then, we can rewrite the system <a href="#eq-IBVP">Equation&nbsp;3</a> as a system of ordinary differential equations:</p>
<p><span id="eq-heat-eq-1"><span class="math display">\[
\begin{align*}
\frac{dU}{dt} &amp;= AU\\
U(0) &amp;= U^0
\end{align*}
\tag{4}\]</span></span></p>
<p>where the matrix <span class="math inline">\(A\)</span> is given by:</p>
<p><span class="math display">\[
A = \frac{1}{h^2}\begin{bmatrix}
-2 &amp; 1 &amp; 0 &amp; \ldots \\
1  &amp;-2 &amp; 1 &amp; \ldots \\
0  &amp; 1 &amp; -2 &amp; \ldots \\
   &amp;   &amp;    &amp; \ldots \\
      &amp;   &amp;    &amp; \ldots &amp; 1 &amp; -2 &amp; 1\\
      &amp;   &amp;    &amp; \ldots &amp; 0 &amp; 1  &amp; -2\\
\end{bmatrix}
\]</span></p>
<p>There are many discretization schemes. I plan to explore various finite difference schemes and their application to derivatives pricing in future posts. For now, I will concentrate on the one-step explicit and implicit methods to discretise the system of ODEs(<a href="#eq-heat-eq-1">Equation&nbsp;4</a>) as:</p>
<p><span id="eq-heat-eq-2"><span class="math display">\[
\begin{align*}
\frac{U^{n+1 - U^n}}{\Delta t} &amp;= \theta AU^{n+1} + (1-\theta)AU^{n}, \quad 0 \leq n \leq N-1, 0 \leq \theta \leq 1 \\
U^{0} &amp;= U(0)
\end{align*}
\tag{5}\]</span></span></p>
<p>In this case, <span class="math inline">\(\Delta t\)</span> is the constant mesh size in time.</p>
<p>We can rewrite <a href="#eq-heat-eq-2">Equation&nbsp;5</a> in the equivalent form:</p>
<p><span id="eq-heat-eq-3"><span class="math display">\[
\begin{align*}
U^{n+1} - U^{n} &amp;= \theta \Delta t A U^{n+1} + \Delta t (I- \theta)AU^{n} \\
[I - \Delta t A]U^{n+1} &amp;= (\Delta t (1 - \theta) + 1)AU^n
\end{align*}
\tag{6}\]</span></span></p>
<p>or formally as:</p>
<p><span id="eq-heat-eq-4"><span class="math display">\[
\begin{align*}
U^{n+1} = [1-\Delta t \theta A]^{-1} (I + \Delta t(I - \theta)) A U^n
\end{align*}
\tag{7}\]</span></span></p>
<p>where <span class="math inline">\(I\)</span> is the identity matrix.</p>
<p>Some special cases of <span class="math inline">\(\theta\)</span> are:</p>
<p><span id="eq-heat-eq-5"><span class="math display">\[
\begin{align*}
\theta &amp;= 1, \quad \text{Implicit Euler Scheme}\\
\theta &amp;= 0, \quad \text{Explicit Euler Scheme}\\
\theta &amp;= 1/2,\quad \text{Crank-Nicolson Scheme}
\end{align*}
\tag{8}\]</span></span></p>
<p>When the schemes are implicit, we can solve the system of equations (<a href="#eq-heat-eq-2">Equation&nbsp;5</a>) at each time level <span class="math inline">\(n+1\)</span> using the Thomas algorithm. No matrix inversion is needed in the case of explicit schemes. The formulation (<a href="#eq-heat-eq-1">Equation&nbsp;4</a>) is called the <em>method of lines</em> and it corresponds to semi-discretization of the PDE in the space direction while keeping the time variable continuous (I will explore MOL in future posts).</p>
<p>We can write the scheme (<a href="#eq-heat-eq-3">Equation&nbsp;6</a> - <a href="#eq-heat-eq-5">Equation&nbsp;8</a>) in the component form:</p>
<p><span id="eq-component-form"><span class="math display">\[
\begin{align*}
\frac{U^{n+1}j - U^{n}j}{\Delta t} = \theta(U^{n+1}_{j+1}-2U^{n+1}_j + U^{n+1}_{j-1})/h^2 + (1-\theta)(U^{n}_{j+1}-2U^{n}_j + U^{n}_{j-1})/h^2
\end{align*}
\tag{9}\]</span></span></p>
<p>or equivalently:</p>
<p><span class="math display">\[
\begin{align*}
{U^{n+1}j - U^{n}_j} &amp;= \lambda\theta(U^{n+1}_{j+1}-2U^{n+1}_j + U^{n+1}_{j-1})/h^2 \\&amp;+ (1-\theta)(U^{n}_{j+1}-2U^{n}_j + U^{n}_{j-1})
\end{align*}
\]</span></p>
<p>where <span class="math inline">\(\lambda = \Delta t/h^2\)</span>.</p>
<p>Finally:</p>
<p><span id="eq-finite-difference-scheme"><span class="math display">\[
\begin{align*}
-\lambda \theta U^{n+1}_{j+1} + (1+2\lambda \theta)U_j^{n+1} - \lambda \theta U^{n+1}_{j-1} \\= \lambda (1-\theta)U^{n}_{j+1}+(1-2\lambda(1-\theta))U^{n}_j + \lambda(1-\theta)U^{n}_{j-1}
\end{align*}
\tag{10}\]</span></span></p>
<p>The system (<a href="#eq-finite-difference-scheme">Equation&nbsp;10</a>) is tridiagonal and we can apply the Thomas algorithm to solve it. In the case of the explicit Euler scheme <span class="math inline">\((\theta = 0)\)</span>, these algorithms are not needed, because the solution at time level <span class="math inline">\(n+1\)</span> can be explicitly computed:</p>
<p><span id="eq-explicit-euler"><span class="math display">\[
\begin{align*}
U^{n+1}_j = \lambda U^{n}_{j+1} + (1-2\lambda)U^{n}_j +\lambda U^{n}_{j-1}
\end{align*}
\tag{11}\]</span></span></p>
<section id="computational-solution-1" class="level3">
<h3 class="anchored" data-anchor-id="computational-solution-1">Computational Solution</h3>
<p>I implemented the algorithm in <a href="#eq-finite-difference-scheme">Equation&nbsp;10</a>. This is a one-step marching scheme called BTCS(Backward in Time, Centered in Space) that computes the solution at time level <span class="math inline">\(n+1\)</span> in terms of the solution at time <span class="math inline">\(n\)</span>. Since there are three unknowns to be computed at each time level <span class="math inline">\(n+1\)</span>, we need to use the Thomas algorithm. The main steps in the algorithm are:</p>
<ul>
<li>Choose input parameters and generate meshes</li>
<li>Define the initial solution and the boundary conditions</li>
<li>Compute the solution at each time upto and including expiration.</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="quasar-chunawala/quantdev" data-repo-id="R_kgDOL2t5-A" data-category="General" data-category-id="DIC_kwDOL2t5-M4ClndQ" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->



</body></html>