<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Quasar">
<meta name="dcterms.date" content="2025-11-16">

<title>quantdev.blog - Memory Barriers</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;800&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap')
</style>
<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9993009899870547" crossorigin="anonymous"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../.././symbol.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">quantdev.blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../newsletter.html" rel="" target="">
 <span class="menu-text">Newsletter</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../sell_side_quant_critical_path.html" rel="" target="">
 <span class="menu-text">Sell-side Quant</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../roadmap.html" rel="" target="">
 <span class="menu-text">C++ Roadmap</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://patreon.com/u59411143?utm_medium=unknown&amp;utm_source=join_link&amp;utm_campaign=creatorshare_creator&amp;utm_content=copyLink" rel="" target=""><i class="bi bi-patreon" role="img">
</i> 
 <span class="menu-text">Become a patreon</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/quasar-chunawala" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="http://linkedin.com/in/quasar-chunawala" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml" rel="" target=""><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Memory Barriers</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Concurrency</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Quasar </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 16, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#c-atomics" id="toc-c-atomics" class="nav-link active" data-scroll-target="#c-atomics">C++ Atomics</a>
  <ul class="collapse">
  <li><a href="#introduction-to-atomic-operations" id="toc-introduction-to-atomic-operations" class="nav-link" data-scroll-target="#introduction-to-atomic-operations">Introduction to Atomic Operations</a></li>
  <li><a href="#generated-assembly---non-atomic" id="toc-generated-assembly---non-atomic" class="nav-link" data-scroll-target="#generated-assembly---non-atomic">Generated Assembly - Non-Atomic</a></li>
  <li><a href="#atomic-increment" id="toc-atomic-increment" class="nav-link" data-scroll-target="#atomic-increment">Atomic Increment</a></li>
  <li><a href="#operations-on-stdatomict" id="toc-operations-on-stdatomict" class="nav-link" data-scroll-target="#operations-on-stdatomict">Operations on <code>std::atomic&lt;T&gt;</code></a></li>
  <li><a href="#compare-and-swap-cas" id="toc-compare-and-swap-cas" class="nav-link" data-scroll-target="#compare-and-swap-cas">Compare-and-Swap (CAS)</a></li>
  <li><a href="#why-is-cas-so-special" id="toc-why-is-cas-so-special" class="nav-link" data-scroll-target="#why-is-cas-so-special">Why is CAS So Special?</a></li>
  <li><a href="#additional-atomic-operations" id="toc-additional-atomic-operations" class="nav-link" data-scroll-target="#additional-atomic-operations">Additional Atomic Operations</a></li>
  <li><a href="#do-atomic-operations-wait-on-each-other" id="toc-do-atomic-operations-wait-on-each-other" class="nav-link" data-scroll-target="#do-atomic-operations-wait-on-each-other">Do Atomic Operations wait on Each Other?</a>
  <ul class="collapse">
  <li><a href="#whats-really-going-on" id="toc-whats-really-going-on" class="nav-link" data-scroll-target="#whats-really-going-on">What’s really going on?</a></li>
  </ul></li>
  <li><a href="#strong-vs-weak-compare-and-swap" id="toc-strong-vs-weak-compare-and-swap" class="nav-link" data-scroll-target="#strong-vs-weak-compare-and-swap">Strong vs Weak Compare-and-Swap</a></li>
  </ul></li>
  <li><a href="#memory-barriers" id="toc-memory-barriers" class="nav-link" data-scroll-target="#memory-barriers">Memory Barriers</a>
  <ul class="collapse">
  <li><a href="#memory-barriers---introduction" id="toc-memory-barriers---introduction" class="nav-link" data-scroll-target="#memory-barriers---introduction">Memory Barriers - Introduction</a></li>
  <li><a href="#memory-barriers-in-c" id="toc-memory-barriers-in-c" class="nav-link" data-scroll-target="#memory-barriers-in-c">Memory Barriers in C++</a></li>
  <li><a href="#no-barriers---stdmemory_order_relaxed" id="toc-no-barriers---stdmemory_order_relaxed" class="nav-link" data-scroll-target="#no-barriers---stdmemory_order_relaxed">No Barriers - <code>std::memory_order_relaxed</code></a></li>
  <li><a href="#acquire-barrier" id="toc-acquire-barrier" class="nav-link" data-scroll-target="#acquire-barrier">Acquire Barrier</a></li>
  <li><a href="#release-barrier" id="toc-release-barrier" class="nav-link" data-scroll-target="#release-barrier">Release Barrier</a></li>
  <li><a href="#acquire-release-protocol" id="toc-acquire-release-protocol" class="nav-link" data-scroll-target="#acquire-release-protocol">Acquire-Release Protocol</a></li>
  <li><a href="#challenge-question" id="toc-challenge-question" class="nav-link" data-scroll-target="#challenge-question">Challenge question</a></li>
  
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="c-atomics" class="level1">
<h1>C++ Atomics</h1>
<section id="introduction-to-atomic-operations" class="level2">
<h2 class="anchored" data-anchor-id="introduction-to-atomic-operations">Introduction to Atomic Operations</h2>
<p>Atomic operations are indivisible. An atomic operation is any operation that is <strong>guaranteed to execute as a single transaction</strong>. At a low-level, atomic operations are special hardware instructions.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="op">%</span>load_ext itikz</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The itikz extension is already loaded. To reload it, use:
  %reload_ext itikz</code></pre>
</div>
</div>
<p>Consider a shared variable <code>counter</code> initialized to <code>0</code>. The assembly instructions for incrementing this counter show that it requires multiple CPU instructions: load the value from memory into a register, add 1 to the register, and store the result back to memory. This multi-step process creates opportunities for race conditions in multi-threaded code.</p>
<p>Using atomic types and operations solves this problem by using special CPU instructions like <code>lock add</code> that guarantee the entire operation completes as a single, indivisible unit.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">// Incrementing a counter        </span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="dt">int</span> counter <span class="op">{</span><span class="dv">0</span><span class="op">};</span></span>
<span id="cb3-3"><a href="#cb3-3"></a></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="dt">int</span> main<span class="op">(){</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>    counter<span class="op">++;</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="generated-assembly---non-atomic" class="level2">
<h2 class="anchored" data-anchor-id="generated-assembly---non-atomic">Generated Assembly - Non-Atomic</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource asm number-lines code-with-copy"><code class="sourceCode fasm"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">counter:</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>        .zero   <span class="dv">4</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="fu">main:</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>        <span class="bu">push</span>    <span class="kw">rbp</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>        <span class="bu">mov</span>     <span class="kw">rbp</span><span class="op">,</span> <span class="kw">rsp</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>        <span class="bu">mov</span>     <span class="kw">eax</span><span class="op">,</span> <span class="dt">DWORD</span> <span class="dt">PTR</span> counter<span class="op">[</span>rip<span class="op">]</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>        <span class="bu">add</span>     <span class="kw">eax</span><span class="op">,</span> <span class="dv">1</span></span>
<span id="cb4-8"><a href="#cb4-8"></a>        <span class="bu">mov</span>     <span class="dt">DWORD</span> <span class="dt">PTR</span> counter<span class="op">[</span>rip<span class="op">],</span> <span class="kw">eax</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>        <span class="bu">mov</span>     <span class="kw">eax</span><span class="op">,</span> <span class="dv">0</span></span>
<span id="cb4-10"><a href="#cb4-10"></a>        <span class="bu">pop</span>     <span class="kw">rbp</span></span>
<span id="cb4-11"><a href="#cb4-11"></a>        <span class="cf">ret</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="atomic-increment" class="level2">
<h2 class="anchored" data-anchor-id="atomic-increment">Atomic Increment</h2>
<p>Using atomic types and operations:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1"></a><span class="pp">#include </span><span class="im">&lt;atomic&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="bu">std::</span>atomic<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> counter <span class="op">{</span><span class="dv">0</span><span class="op">};</span></span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="dt">int</span> main<span class="op">(){</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>    counter<span class="op">++;</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Generated Assembly:</strong></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource asm number-lines code-with-copy"><code class="sourceCode fasm"><span id="cb6-1"><a href="#cb6-1"></a><span class="bu">lock</span> add <span class="dt">DWORD</span> <span class="dt">PTR</span> counter<span class="op">[</span>rip<span class="op">],</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Atomic operations allow threads to read, modify and write indivisibly and can also be used as synchronization primitives. Atomic operations must be provided by the CPU (as in the <code>lock add</code> instruction).</p>
</section>
<section id="operations-on-stdatomict" class="level2">
<h2 class="anchored" data-anchor-id="operations-on-stdatomict">Operations on <code>std::atomic&lt;T&gt;</code></h2>
<p><strong>Explicit reads and writes:</strong></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1"></a><span class="bu">std::</span>atomic<span class="op">&lt;</span>T<span class="op">&gt;</span> x<span class="op">;</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>T y <span class="op">=</span> x<span class="op">.</span>load<span class="op">();</span>     <span class="co">// Same as T y = x;</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>x<span class="op">.</span>store<span class="op">(</span>y<span class="op">);</span>         <span class="co">// Same as x = y;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Atomic exchange:</strong></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1"></a>T z <span class="op">=</span> x<span class="op">.</span>exchange<span class="op">(</span>y<span class="op">);</span>    <span class="co">// Atomically: z = x; x = y;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>exchange</code> is an atomic swap - a read-modify-write done atomically. It reads the old value, replaces it with the new value and guarantees that nobody can get in there in between.</p>
</section>
<section id="compare-and-swap-cas" class="level2">
<h2 class="anchored" data-anchor-id="compare-and-swap-cas">Compare-and-Swap (CAS)</h2>
<p><strong>Compare-and-swap (conditional exchange):</strong></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1"></a><span class="dt">bool</span> success <span class="op">=</span> x<span class="op">.</span>compare_exchange_strong<span class="op">(</span>y<span class="op">,</span>z<span class="op">);</span>  <span class="co">// T&amp; y</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="co">// var.compare_exchange_strong(expected,desired);</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="co">// If x == y, x = z and return true</span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co">// Otherwise, set y = x and return false</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="why-is-cas-so-special" class="level2">
<h2 class="anchored" data-anchor-id="why-is-cas-so-special">Why is CAS So Special?</h2>
<p>Compare-and-swap (CAS) is used in most lock-free algorithms. Consider this example of atomic increment with CAS. Pretty much every lock-free algorithm is centered around a loop like this. We want to increment <code>x</code>. First, we read the atomic value and store it in a local <code>x0</code>. We hope nobody got to <code>x</code> before us, that <code>x</code> hasn’t changed. If that’s <code>true</code>, we change it atomically to the desired value (which could be an increment, decrement, multiplication by 2, etc.). If nobody else changed <code>x</code>, we did our increment atomically. CAS returns <code>true</code> and the loop ends.</p>
<p>If somebody did change <code>x</code>, CAS fails and returns <code>false</code>. The changed value of <code>x</code> is updated in <code>x0</code>, so we don’t have to read again. We continue to the next iteration and keep trying, until our compare-and-swap beats everyone else’s and gets that increment in.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb10-1"><a href="#cb10-1"></a><span class="bu">std::</span>atomic<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> x<span class="op">{</span><span class="dv">0</span><span class="op">};</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="dt">int</span> x0 <span class="op">=</span> x<span class="op">.</span>load<span class="op">();</span>     <span class="co">// [1] </span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="cf">while</span><span class="op">(!</span>x<span class="op">.</span>compare_exchange_swap<span class="op">(</span>x0<span class="op">,</span> x0 <span class="op">+</span> <span class="dv">1</span><span class="op">)){}</span>  <span class="co">// [2]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="additional-atomic-operations" class="level2">
<h2 class="anchored" data-anchor-id="additional-atomic-operations">Additional Atomic Operations</h2>
<p><strong>For integer T:</strong></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb11-1"><a href="#cb11-1"></a><span class="bu">std::</span>atomic<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> x<span class="op">;</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>x<span class="op">.</span>fetch_add<span class="op">(</span>y<span class="op">);</span>     <span class="co">// Same as x += y;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>fetch_add()</code> doesn’t just add atomically. It increments atomically, but also returns the old value (the fetch part). So it returns the old value and adds the increment, all atomically.</p>
<p>Also available: <code>fetch_sub</code>, <code>fetch_and()</code>, <code>fetch_or()</code> and <code>fetch_xor()</code>.</p>
<p><strong>Note:</strong> If you have multiple atomic operations, their composition is not atomic.</p>
</section>
<section id="do-atomic-operations-wait-on-each-other" class="level2">
<h2 class="anchored" data-anchor-id="do-atomic-operations-wait-on-each-other">Do Atomic Operations wait on Each Other?</h2>
<p>Atomic operations are lock-free, maybe even wait-free. It doesn’t mean they don’t wait on each other. Atomic operations do wait for cache-line access.</p>
<div class="text-center">
<div class="cell" data-execution_count="2">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a><span class="op">%%</span>itikz <span class="op">--</span>temp<span class="op">-</span><span class="bu">dir</span> <span class="op">--</span>tex<span class="op">-</span>packages<span class="op">=</span>tikz <span class="op">--</span>tikz<span class="op">-</span>libraries<span class="op">=</span>arrows.meta <span class="op">--</span>implicit<span class="op">-</span>standalone</span>
<span id="cb12-2"><a href="#cb12-2"></a></span>
<span id="cb12-3"><a href="#cb12-3"></a>\tikzset{every picture<span class="op">/</span>.style<span class="op">=</span>{line width<span class="op">=</span><span class="fl">0.75</span><span class="er">pt</span>}} <span class="op">%</span><span class="bu">set</span> default line width to <span class="fl">0.75</span><span class="er">pt</span>        </span>
<span id="cb12-4"><a href="#cb12-4"></a></span>
<span id="cb12-5"><a href="#cb12-5"></a>\begin{tikzpicture}[x<span class="op">=</span><span class="fl">0.75</span><span class="er">pt</span>,y<span class="op">=</span><span class="fl">0.75</span><span class="er">pt</span>,yscale<span class="op">=-</span><span class="fl">1.5</span>,xscale<span class="op">=</span><span class="fl">1.5</span>,font<span class="op">=</span>\Large]</span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="op">%</span>uncomment <span class="cf">if</span> require: \path (<span class="dv">0</span>,<span class="dv">249</span>)<span class="op">;</span> <span class="op">%</span><span class="bu">set</span> diagram left start at <span class="dv">0</span>, <span class="kw">and</span> has height of <span class="dv">249</span></span>
<span id="cb12-7"><a href="#cb12-7"></a></span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="op">%</span>Rounded Rect [<span class="bu">id</span>:dp7226624209327404] </span>
<span id="cb12-9"><a href="#cb12-9"></a>\draw  [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">181</span><span class="op">;</span> green, <span class="dv">212</span><span class="op">;</span> blue, <span class="dv">244</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ] (<span class="dv">115</span>,<span class="fl">43.47</span>) .. controls (<span class="dv">115</span>,<span class="fl">33.82</span>) <span class="kw">and</span> (<span class="fl">122.82</span>,<span class="dv">26</span>) .. (<span class="fl">132.47</span>,<span class="dv">26</span>) <span class="op">--</span> (<span class="fl">505.03</span>,<span class="dv">26</span>) .. controls (<span class="fl">514.68</span>,<span class="dv">26</span>) <span class="kw">and</span> (<span class="fl">522.5</span>,<span class="fl">33.82</span>) .. (<span class="fl">522.5</span>,<span class="fl">43.47</span>) <span class="op">--</span> (<span class="fl">522.5</span>,<span class="fl">95.88</span>) .. controls (<span class="fl">522.5</span>,<span class="fl">105.52</span>) <span class="kw">and</span> (<span class="fl">514.68</span>,<span class="fl">113.34</span>) .. (<span class="fl">505.03</span>,<span class="fl">113.34</span>) <span class="op">--</span> (<span class="fl">132.47</span>,<span class="fl">113.34</span>) .. controls (<span class="fl">122.82</span>,<span class="fl">113.34</span>) <span class="kw">and</span> (<span class="dv">115</span>,<span class="fl">105.52</span>) .. (<span class="dv">115</span>,<span class="fl">95.88</span>) <span class="op">--</span> cycle <span class="op">;</span></span>
<span id="cb12-10"><a href="#cb12-10"></a><span class="op">%</span>Rounded Rect [<span class="bu">id</span>:dp404929071772297] </span>
<span id="cb12-11"><a href="#cb12-11"></a>\draw  [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">181</span><span class="op">;</span> green, <span class="dv">212</span><span class="op">;</span> blue, <span class="dv">244</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ] (<span class="dv">113</span>,<span class="fl">158.47</span>) .. controls (<span class="dv">113</span>,<span class="fl">148.82</span>) <span class="kw">and</span> (<span class="fl">120.82</span>,<span class="dv">141</span>) .. (<span class="fl">130.47</span>,<span class="dv">141</span>) <span class="op">--</span> (<span class="fl">503.03</span>,<span class="dv">141</span>) .. controls (<span class="fl">512.68</span>,<span class="dv">141</span>) <span class="kw">and</span> (<span class="fl">520.5</span>,<span class="fl">148.82</span>) .. (<span class="fl">520.5</span>,<span class="fl">158.47</span>) <span class="op">--</span> (<span class="fl">520.5</span>,<span class="fl">210.88</span>) .. controls (<span class="fl">520.5</span>,<span class="fl">220.52</span>) <span class="kw">and</span> (<span class="fl">512.68</span>,<span class="fl">228.34</span>) .. (<span class="fl">503.03</span>,<span class="fl">228.34</span>) <span class="op">--</span> (<span class="fl">130.47</span>,<span class="fl">228.34</span>) .. controls (<span class="fl">120.82</span>,<span class="fl">228.34</span>) <span class="kw">and</span> (<span class="dv">113</span>,<span class="fl">220.52</span>) .. (<span class="dv">113</span>,<span class="fl">210.88</span>) <span class="op">--</span> cycle <span class="op">;</span></span>
<span id="cb12-12"><a href="#cb12-12"></a><span class="op">%</span>Rounded Rect [<span class="bu">id</span>:dp8165659276958122] </span>
<span id="cb12-13"><a href="#cb12-13"></a>\draw  [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">251</span><span class="op">;</span> green, <span class="dv">247</span><span class="op">;</span> blue, <span class="dv">204</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ] (<span class="dv">151</span>,<span class="dv">62</span>) .. controls (<span class="dv">151</span>,<span class="fl">57.58</span>) <span class="kw">and</span> (<span class="fl">154.58</span>,<span class="dv">54</span>) .. (<span class="dv">159</span>,<span class="dv">54</span>) <span class="op">--</span> (<span class="fl">300.5</span>,<span class="dv">54</span>) .. controls (<span class="fl">304.92</span>,<span class="dv">54</span>) <span class="kw">and</span> (<span class="fl">308.5</span>,<span class="fl">57.58</span>) .. (<span class="fl">308.5</span>,<span class="dv">62</span>) <span class="op">--</span> (<span class="fl">308.5</span>,<span class="dv">86</span>) .. controls (<span class="fl">308.5</span>,<span class="fl">90.42</span>) <span class="kw">and</span> (<span class="fl">304.92</span>,<span class="dv">94</span>) .. (<span class="fl">300.5</span>,<span class="dv">94</span>) <span class="op">--</span> (<span class="dv">159</span>,<span class="dv">94</span>) .. controls (<span class="fl">154.58</span>,<span class="dv">94</span>) <span class="kw">and</span> (<span class="dv">151</span>,<span class="fl">90.42</span>) .. (<span class="dv">151</span>,<span class="dv">86</span>) <span class="op">--</span> cycle <span class="op">;</span></span>
<span id="cb12-14"><a href="#cb12-14"></a><span class="op">%</span>Rounded Rect [<span class="bu">id</span>:dp5545605907049965] </span>
<span id="cb12-15"><a href="#cb12-15"></a>\draw  [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">251</span><span class="op">;</span> green, <span class="dv">247</span><span class="op">;</span> blue, <span class="dv">204</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ] (<span class="dv">325</span>,<span class="dv">61</span>) .. controls (<span class="dv">325</span>,<span class="fl">56.58</span>) <span class="kw">and</span> (<span class="fl">328.58</span>,<span class="dv">53</span>) .. (<span class="dv">333</span>,<span class="dv">53</span>) <span class="op">--</span> (<span class="fl">474.5</span>,<span class="dv">53</span>) .. controls (<span class="fl">478.92</span>,<span class="dv">53</span>) <span class="kw">and</span> (<span class="fl">482.5</span>,<span class="fl">56.58</span>) .. (<span class="fl">482.5</span>,<span class="dv">61</span>) <span class="op">--</span> (<span class="fl">482.5</span>,<span class="dv">85</span>) .. controls (<span class="fl">482.5</span>,<span class="fl">89.42</span>) <span class="kw">and</span> (<span class="fl">478.92</span>,<span class="dv">93</span>) .. (<span class="fl">474.5</span>,<span class="dv">93</span>) <span class="op">--</span> (<span class="dv">333</span>,<span class="dv">93</span>) .. controls (<span class="fl">328.58</span>,<span class="dv">93</span>) <span class="kw">and</span> (<span class="dv">325</span>,<span class="fl">89.42</span>) .. (<span class="dv">325</span>,<span class="dv">85</span>) <span class="op">--</span> cycle <span class="op">;</span></span>
<span id="cb12-16"><a href="#cb12-16"></a><span class="op">%</span>Rounded Rect [<span class="bu">id</span>:dp9918614693760329] </span>
<span id="cb12-17"><a href="#cb12-17"></a>\draw  [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">251</span><span class="op">;</span> green, <span class="dv">247</span><span class="op">;</span> blue, <span class="dv">204</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ] (<span class="dv">144</span>,<span class="dv">176</span>) .. controls (<span class="dv">144</span>,<span class="fl">171.58</span>) <span class="kw">and</span> (<span class="fl">147.58</span>,<span class="dv">168</span>) .. (<span class="dv">152</span>,<span class="dv">168</span>) <span class="op">--</span> (<span class="fl">293.5</span>,<span class="dv">168</span>) .. controls (<span class="fl">297.92</span>,<span class="dv">168</span>) <span class="kw">and</span> (<span class="fl">301.5</span>,<span class="fl">171.58</span>) .. (<span class="fl">301.5</span>,<span class="dv">176</span>) <span class="op">--</span> (<span class="fl">301.5</span>,<span class="dv">200</span>) .. controls (<span class="fl">301.5</span>,<span class="fl">204.42</span>) <span class="kw">and</span> (<span class="fl">297.92</span>,<span class="dv">208</span>) .. (<span class="fl">293.5</span>,<span class="dv">208</span>) <span class="op">--</span> (<span class="dv">152</span>,<span class="dv">208</span>) .. controls (<span class="fl">147.58</span>,<span class="dv">208</span>) <span class="kw">and</span> (<span class="dv">144</span>,<span class="fl">204.42</span>) .. (<span class="dv">144</span>,<span class="dv">200</span>) <span class="op">--</span> cycle <span class="op">;</span></span>
<span id="cb12-18"><a href="#cb12-18"></a><span class="op">%</span>Rounded Rect [<span class="bu">id</span>:dp9032232500910276] </span>
<span id="cb12-19"><a href="#cb12-19"></a>\draw  [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">251</span><span class="op">;</span> green, <span class="dv">247</span><span class="op">;</span> blue, <span class="dv">204</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ] (<span class="dv">332</span>,<span class="dv">176</span>) .. controls (<span class="dv">332</span>,<span class="fl">171.58</span>) <span class="kw">and</span> (<span class="fl">335.58</span>,<span class="dv">168</span>) .. (<span class="dv">340</span>,<span class="dv">168</span>) <span class="op">--</span> (<span class="fl">481.5</span>,<span class="dv">168</span>) .. controls (<span class="fl">485.92</span>,<span class="dv">168</span>) <span class="kw">and</span> (<span class="fl">489.5</span>,<span class="fl">171.58</span>) .. (<span class="fl">489.5</span>,<span class="dv">176</span>) <span class="op">--</span> (<span class="fl">489.5</span>,<span class="dv">200</span>) .. controls (<span class="fl">489.5</span>,<span class="fl">204.42</span>) <span class="kw">and</span> (<span class="fl">485.92</span>,<span class="dv">208</span>) .. (<span class="fl">481.5</span>,<span class="dv">208</span>) <span class="op">--</span> (<span class="dv">340</span>,<span class="dv">208</span>) .. controls (<span class="fl">335.58</span>,<span class="dv">208</span>) <span class="kw">and</span> (<span class="dv">332</span>,<span class="fl">204.42</span>) .. (<span class="dv">332</span>,<span class="dv">200</span>) <span class="op">--</span> cycle <span class="op">;</span></span>
<span id="cb12-20"><a href="#cb12-20"></a></span>
<span id="cb12-21"><a href="#cb12-21"></a><span class="op">%</span> Text Node</span>
<span id="cb12-22"><a href="#cb12-22"></a>\draw (<span class="dv">263</span>,<span class="dv">31</span>) node [anchor<span class="op">=</span>north west][inner sep<span class="op">=</span><span class="fl">0.75</span><span class="er">pt</span>]   [align<span class="op">=</span>left] {\texttt{std::atomic<span class="op">&lt;</span><span class="bu">int</span><span class="op">&gt;</span> x<span class="op">;</span>}}<span class="op">;</span></span>
<span id="cb12-23"><a href="#cb12-23"></a><span class="op">%</span> Text Node</span>
<span id="cb12-24"><a href="#cb12-24"></a>\draw (<span class="dv">257</span>,<span class="dv">146</span>) node [anchor<span class="op">=</span>north west][inner sep<span class="op">=</span><span class="fl">0.75</span><span class="er">pt</span>]   [align<span class="op">=</span>left] {\texttt{std::atomic<span class="op">&lt;</span><span class="bu">int</span><span class="op">&gt;</span> x[<span class="dv">2</span>]<span class="op">;</span>}}<span class="op">;</span></span>
<span id="cb12-25"><a href="#cb12-25"></a><span class="op">%</span> Text Node</span>
<span id="cb12-26"><a href="#cb12-26"></a>\draw (<span class="fl">231.33</span>,<span class="fl">63.33</span>) node {Thread<span class="op">-</span><span class="dv">1</span>}<span class="op">;</span></span>
<span id="cb12-27"><a href="#cb12-27"></a><span class="op">%</span> Text Node</span>
<span id="cb12-28"><a href="#cb12-28"></a>\draw (<span class="dv">410</span>,<span class="dv">64</span>) node {Thread<span class="op">-</span><span class="dv">2</span>}<span class="op">;</span></span>
<span id="cb12-29"><a href="#cb12-29"></a><span class="op">%</span> Text Node</span>
<span id="cb12-30"><a href="#cb12-30"></a>\draw (<span class="fl">221.33</span>,<span class="dv">180</span>) node {Thread<span class="op">-</span><span class="dv">1</span>}<span class="op">;</span></span>
<span id="cb12-31"><a href="#cb12-31"></a><span class="op">%</span> Text Node</span>
<span id="cb12-32"><a href="#cb12-32"></a>\draw (<span class="dv">414</span>,<span class="dv">180</span>) node {Thread<span class="op">-</span><span class="dv">2</span>}<span class="op">;</span></span>
<span id="cb12-33"><a href="#cb12-33"></a><span class="op">%</span> Text Node</span>
<span id="cb12-34"><a href="#cb12-34"></a>\draw (<span class="fl">231.71</span>,<span class="dv">82</span>) node {<span class="op">++</span>x<span class="op">;</span>}<span class="op">;</span></span>
<span id="cb12-35"><a href="#cb12-35"></a><span class="op">%</span> Text Node</span>
<span id="cb12-36"><a href="#cb12-36"></a>\draw (<span class="fl">410.38</span>,<span class="fl">80.67</span>) node {<span class="op">++</span>x<span class="op">;</span>}<span class="op">;</span></span>
<span id="cb12-37"><a href="#cb12-37"></a><span class="op">%</span> Text Node</span>
<span id="cb12-38"><a href="#cb12-38"></a>\draw (<span class="fl">228.08</span>,<span class="dv">198</span>) node {<span class="op">++</span>x[<span class="dv">0</span>]<span class="op">;</span>}<span class="op">;</span></span>
<span id="cb12-39"><a href="#cb12-39"></a><span class="op">%</span> Text Node</span>
<span id="cb12-40"><a href="#cb12-40"></a>\draw (<span class="fl">419.58</span>,<span class="fl">196.67</span>) node {<span class="op">++</span>x[<span class="dv">1</span>]<span class="op">;</span>}<span class="op">;</span></span>
<span id="cb12-41"><a href="#cb12-41"></a><span class="op">%</span> Text Node</span>
<span id="cb12-42"><a href="#cb12-42"></a>\draw (<span class="fl">214.67</span>,<span class="fl">13.33</span>) node {Accessing shared variable}<span class="op">;</span></span>
<span id="cb12-43"><a href="#cb12-43"></a><span class="op">%</span> Text Node</span>
<span id="cb12-44"><a href="#cb12-44"></a>\draw (<span class="fl">212.67</span>,<span class="fl">127.33</span>) node {Accessing Non<span class="op">-</span>shared variable}<span class="op">;</span></span>
<span id="cb12-45"><a href="#cb12-45"></a></span>
<span id="cb12-46"><a href="#cb12-46"></a></span>
<span id="cb12-47"><a href="#cb12-47"></a>\end{tikzpicture}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="5">
<p><img src="index_files/figure-html/cell-3-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>Fig. Functions - control flow</p>
</div>
<p>Let’s compare atomic increment of an atomic variable versus increment two atomic variables that are different. That is, the worker thread <span class="math inline">\(t0\)</span> works on an atomic variable <code>x[0]</code> and the worker thread <span class="math inline">\(t1\)</span> works on the atomic variable <code>x[1]</code>. That way, they don’t have to wait on each other. Let’s run a benchmark for different number of threads. Let’s run the benchmark for different number of threads. It’s basically the same thing - we see no difference between the two. Can we conclude that atomic operations don’t wait on each other from this?</p>
<div class="text-center">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="memory_barriers_01.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Two threads incrementing a shared variable atomically vs two threads work on different atomic variables</figcaption>
</figure>
</div>
</div>
<pre><code>Benchmark                                        Time         CPU
------------------------------------------------------------------------
BM_SharedAtomicIncrement/1/real_time         0.558 ms    0.015 ms
BM_SharedAtomicIncrement/2/real_time          2.56 ms    0.044 ms
BM_SharedAtomicIncrement/4/real_time          5.40 ms    0.096 ms
BM_SharedAtomicIncrement/8/real_time          10.6 ms    0.218 ms
BM_SharedAtomicIncrement/16/real_time         22.9 ms    0.401 ms
BM_SharedAtomicIncrement/32/real_time         48.4 ms     1.14 ms
BM_SeparateAtomicIncrement/1/real_time       0.556 ms    0.016 ms
BM_SeparateAtomicIncrement/2/real_time        2.74 ms    0.033 ms
BM_SeparateAtomicIncrement/4/real_time        5.74 ms    0.081 ms
BM_SeparateAtomicIncrement/8/real_time        11.2 ms    0.244 ms
BM_SeparateAtomicIncrement/16/real_time       23.9 ms    0.403 ms
BM_SeparateAtomicIncrement/32/real_time       26.6 ms     1.23 ms</code></pre>
<section id="whats-really-going-on" class="level3">
<h3 class="anchored" data-anchor-id="whats-really-going-on">What’s really going on?</h3>
<p>Can we conclude that atomic operations don’t wait on each other? Not necessarily!</p>
<p>It is highly likely, that data elements in relatively close memory locations are accessed over a short period of time. This is typical, for example, when traversing an array, or performing matrix multiplication. To optimize performance, a chunk of data called the cache line trickles up and down through the cache from the main memory to the CPU and back, instead of just the request data-item. On x86, the cache line size is <span class="math inline">\(64\)</span>-bytes.</p>
<p>What’s actually happening is that the two atomic operations are in the same cache-line. On x86, the whole cache line trickles up and down from main memory to the on-board CPU cache and back. Even if you want one variable from the cache line, the entire 64-byte chunk will go up and down. If two different CPUs want two different variables within the same cache-line, they need to wait, as if it was the same variable. You don’t get lower granularity than 64-bytes on x86.</p>
<div class="text-center">
<div class="cell" data-execution_count="3">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a><span class="op">%%</span>itikz <span class="op">--</span>temp<span class="op">-</span><span class="bu">dir</span> <span class="op">--</span>tex<span class="op">-</span>packages<span class="op">=</span>tikz <span class="op">--</span>tikz<span class="op">-</span>libraries<span class="op">=</span>arrows.meta <span class="op">--</span>implicit<span class="op">-</span>standalone</span>
<span id="cb14-2"><a href="#cb14-2"></a>\tikzset{every picture<span class="op">/</span>.style<span class="op">=</span>{line width<span class="op">=</span><span class="fl">0.75</span><span class="er">pt</span>}} <span class="op">%</span><span class="bu">set</span> default line width to <span class="fl">0.75</span><span class="er">pt</span>        </span>
<span id="cb14-3"><a href="#cb14-3"></a></span>
<span id="cb14-4"><a href="#cb14-4"></a>\begin{tikzpicture}[x<span class="op">=</span><span class="fl">0.75</span><span class="er">pt</span>,y<span class="op">=</span><span class="fl">0.75</span><span class="er">pt</span>,yscale<span class="op">=-</span><span class="fl">2.1</span>,xscale<span class="op">=</span><span class="fl">2.1</span>,font<span class="op">=</span>\Large]</span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="op">%</span>uncomment <span class="cf">if</span> require: \path (<span class="dv">0</span>,<span class="dv">379</span>)<span class="op">;</span> <span class="op">%</span><span class="bu">set</span> diagram left start at <span class="dv">0</span>, <span class="kw">and</span> has height of <span class="dv">379</span></span>
<span id="cb14-6"><a href="#cb14-6"></a></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="op">%</span>Rounded Rect [<span class="bu">id</span>:dp27460933128570264] </span>
<span id="cb14-8"><a href="#cb14-8"></a>\draw  [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">181</span><span class="op">;</span> green, <span class="dv">212</span><span class="op">;</span> blue, <span class="dv">244</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ] (<span class="fl">38.5</span>,<span class="fl">45.45</span>) .. controls (<span class="fl">38.5</span>,<span class="fl">39.13</span>) <span class="kw">and</span> (<span class="fl">43.63</span>,<span class="dv">34</span>) .. (<span class="fl">49.95</span>,<span class="dv">34</span>) <span class="op">--</span> (<span class="fl">296.05</span>,<span class="dv">34</span>) .. controls (<span class="fl">302.37</span>,<span class="dv">34</span>) <span class="kw">and</span> (<span class="fl">307.5</span>,<span class="fl">39.13</span>) .. (<span class="fl">307.5</span>,<span class="fl">45.45</span>) <span class="op">--</span> (<span class="fl">307.5</span>,<span class="fl">79.8</span>) .. controls (<span class="fl">307.5</span>,<span class="fl">86.12</span>) <span class="kw">and</span> (<span class="fl">302.37</span>,<span class="fl">91.25</span>) .. (<span class="fl">296.05</span>,<span class="fl">91.25</span>) <span class="op">--</span> (<span class="fl">49.95</span>,<span class="fl">91.25</span>) .. controls (<span class="fl">43.63</span>,<span class="fl">91.25</span>) <span class="kw">and</span> (<span class="fl">38.5</span>,<span class="fl">86.12</span>) .. (<span class="fl">38.5</span>,<span class="fl">79.8</span>) <span class="op">--</span> cycle <span class="op">;</span></span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="op">%</span>Rounded Rect [<span class="bu">id</span>:dp6820620708533545] </span>
<span id="cb14-10"><a href="#cb14-10"></a>\draw  [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">181</span><span class="op">;</span> green, <span class="dv">212</span><span class="op">;</span> blue, <span class="dv">244</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ] (<span class="dv">335</span>,<span class="fl">127.87</span>) .. controls (<span class="dv">335</span>,<span class="fl">124.63</span>) <span class="kw">and</span> (<span class="fl">337.63</span>,<span class="dv">122</span>) .. (<span class="fl">340.87</span>,<span class="dv">122</span>) <span class="op">--</span> (<span class="fl">586.63</span>,<span class="dv">122</span>) .. controls (<span class="fl">589.87</span>,<span class="dv">122</span>) <span class="kw">and</span> (<span class="fl">592.5</span>,<span class="fl">124.63</span>) .. (<span class="fl">592.5</span>,<span class="fl">127.87</span>) <span class="op">--</span> (<span class="fl">592.5</span>,<span class="fl">145.48</span>) .. controls (<span class="fl">592.5</span>,<span class="fl">148.72</span>) <span class="kw">and</span> (<span class="fl">589.87</span>,<span class="fl">151.34</span>) .. (<span class="fl">586.63</span>,<span class="fl">151.34</span>) <span class="op">--</span> (<span class="fl">340.87</span>,<span class="fl">151.34</span>) .. controls (<span class="fl">337.63</span>,<span class="fl">151.34</span>) <span class="kw">and</span> (<span class="dv">335</span>,<span class="fl">148.72</span>) .. (<span class="dv">335</span>,<span class="fl">145.48</span>) <span class="op">--</span> cycle <span class="op">;</span></span>
<span id="cb14-11"><a href="#cb14-11"></a><span class="op">%</span>Rounded Rect [<span class="bu">id</span>:dp9973874025957986] </span>
<span id="cb14-12"><a href="#cb14-12"></a>\draw  [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">181</span><span class="op">;</span> green, <span class="dv">212</span><span class="op">;</span> blue, <span class="dv">244</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ] (<span class="dv">44</span>,<span class="fl">127.87</span>) .. controls (<span class="dv">44</span>,<span class="fl">124.63</span>) <span class="kw">and</span> (<span class="fl">46.63</span>,<span class="dv">122</span>) .. (<span class="fl">49.87</span>,<span class="dv">122</span>) <span class="op">--</span> (<span class="fl">295.63</span>,<span class="dv">122</span>) .. controls (<span class="fl">298.87</span>,<span class="dv">122</span>) <span class="kw">and</span> (<span class="fl">301.5</span>,<span class="fl">124.63</span>) .. (<span class="fl">301.5</span>,<span class="fl">127.87</span>) <span class="op">--</span> (<span class="fl">301.5</span>,<span class="fl">145.48</span>) .. controls (<span class="fl">301.5</span>,<span class="fl">148.72</span>) <span class="kw">and</span> (<span class="fl">298.87</span>,<span class="fl">151.34</span>) .. (<span class="fl">295.63</span>,<span class="fl">151.34</span>) <span class="op">--</span> (<span class="fl">49.87</span>,<span class="fl">151.34</span>) .. controls (<span class="fl">46.63</span>,<span class="fl">151.34</span>) <span class="kw">and</span> (<span class="dv">44</span>,<span class="fl">148.72</span>) .. (<span class="dv">44</span>,<span class="fl">145.48</span>) <span class="op">--</span> cycle <span class="op">;</span></span>
<span id="cb14-13"><a href="#cb14-13"></a><span class="op">%</span>Rounded Rect [<span class="bu">id</span>:dp9732688461749553] </span>
<span id="cb14-14"><a href="#cb14-14"></a>\draw  [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">252</span><span class="op">;</span> green, <span class="dv">246</span><span class="op">;</span> blue, <span class="dv">153</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ] (<span class="fl">46.33</span>,<span class="fl">309.12</span>) .. controls (<span class="fl">46.33</span>,<span class="fl">303.9</span>) <span class="kw">and</span> (<span class="fl">50.56</span>,<span class="fl">299.67</span>) .. (<span class="fl">55.78</span>,<span class="fl">299.67</span>) <span class="op">--</span> (<span class="fl">586.38</span>,<span class="fl">299.67</span>) .. controls (<span class="fl">591.6</span>,<span class="fl">299.67</span>) <span class="kw">and</span> (<span class="fl">595.83</span>,<span class="fl">303.9</span>) .. (<span class="fl">595.83</span>,<span class="fl">309.12</span>) <span class="op">--</span> (<span class="fl">595.83</span>,<span class="fl">337.47</span>) .. controls (<span class="fl">595.83</span>,<span class="fl">342.69</span>) <span class="kw">and</span> (<span class="fl">591.6</span>,<span class="fl">346.92</span>) .. (<span class="fl">586.38</span>,<span class="fl">346.92</span>) <span class="op">--</span> (<span class="fl">55.78</span>,<span class="fl">346.92</span>) .. controls (<span class="fl">50.56</span>,<span class="fl">346.92</span>) <span class="kw">and</span> (<span class="fl">46.33</span>,<span class="fl">342.69</span>) .. (<span class="fl">46.33</span>,<span class="fl">337.47</span>) <span class="op">--</span> cycle <span class="op">;</span></span>
<span id="cb14-15"><a href="#cb14-15"></a><span class="op">%</span>Straight Lines [<span class="bu">id</span>:da9504358299662848] </span>
<span id="cb14-16"><a href="#cb14-16"></a>\draw    (<span class="fl">276.08</span>,<span class="fl">339.92</span>) <span class="op">--</span> (<span class="fl">383.58</span>,<span class="fl">339.92</span>) <span class="op">;</span></span>
<span id="cb14-17"><a href="#cb14-17"></a>\draw [shift<span class="op">=</span>{(<span class="fl">386.58</span>,<span class="fl">339.92</span>)}, rotate <span class="op">=</span> <span class="dv">180</span>] [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">0</span><span class="op">;</span> green, <span class="dv">0</span><span class="op">;</span> blue, <span class="dv">0</span> }  ][line width<span class="op">=</span><span class="fl">0.08</span>]  [draw opacity<span class="op">=</span><span class="dv">0</span>] (<span class="fl">8.93</span>,<span class="op">-</span><span class="fl">4.29</span>) <span class="op">--</span> (<span class="dv">0</span>,<span class="dv">0</span>) <span class="op">--</span> (<span class="fl">8.93</span>,<span class="fl">4.29</span>) <span class="op">--</span> cycle    <span class="op">;</span></span>
<span id="cb14-18"><a href="#cb14-18"></a>\draw [shift<span class="op">=</span>{(<span class="fl">273.08</span>,<span class="fl">339.92</span>)}, rotate <span class="op">=</span> <span class="dv">0</span>] [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">0</span><span class="op">;</span> green, <span class="dv">0</span><span class="op">;</span> blue, <span class="dv">0</span> }  ][line width<span class="op">=</span><span class="fl">0.08</span>]  [draw opacity<span class="op">=</span><span class="dv">0</span>] (<span class="fl">8.93</span>,<span class="op">-</span><span class="fl">4.29</span>) <span class="op">--</span> (<span class="dv">0</span>,<span class="dv">0</span>) <span class="op">--</span> (<span class="fl">8.93</span>,<span class="fl">4.29</span>) <span class="op">--</span> cycle    <span class="op">;</span></span>
<span id="cb14-19"><a href="#cb14-19"></a><span class="op">%</span>Rounded Rect [<span class="bu">id</span>:dp1128018396464796] </span>
<span id="cb14-20"><a href="#cb14-20"></a>\draw  [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">181</span><span class="op">;</span> green, <span class="dv">212</span><span class="op">;</span> blue, <span class="dv">244</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ] (<span class="fl">329.5</span>,<span class="fl">45.45</span>) .. controls (<span class="fl">329.5</span>,<span class="fl">39.13</span>) <span class="kw">and</span> (<span class="fl">334.63</span>,<span class="dv">34</span>) .. (<span class="fl">340.95</span>,<span class="dv">34</span>) <span class="op">--</span> (<span class="fl">587.05</span>,<span class="dv">34</span>) .. controls (<span class="fl">593.37</span>,<span class="dv">34</span>) <span class="kw">and</span> (<span class="fl">598.5</span>,<span class="fl">39.13</span>) .. (<span class="fl">598.5</span>,<span class="fl">45.45</span>) <span class="op">--</span> (<span class="fl">598.5</span>,<span class="fl">79.8</span>) .. controls (<span class="fl">598.5</span>,<span class="fl">86.12</span>) <span class="kw">and</span> (<span class="fl">593.37</span>,<span class="fl">91.25</span>) .. (<span class="fl">587.05</span>,<span class="fl">91.25</span>) <span class="op">--</span> (<span class="fl">340.95</span>,<span class="fl">91.25</span>) .. controls (<span class="fl">334.63</span>,<span class="fl">91.25</span>) <span class="kw">and</span> (<span class="fl">329.5</span>,<span class="fl">86.12</span>) .. (<span class="fl">329.5</span>,<span class="fl">79.8</span>) <span class="op">--</span> cycle <span class="op">;</span></span>
<span id="cb14-21"><a href="#cb14-21"></a><span class="op">%</span>Straight Lines [<span class="bu">id</span>:da8059041144370804] </span>
<span id="cb14-22"><a href="#cb14-22"></a>\draw [color<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">74</span><span class="op">;</span> green, <span class="dv">83</span><span class="op">;</span> blue, <span class="dv">226</span> }  ,draw opacity<span class="op">=</span><span class="dv">1</span> ]   (<span class="fl">378.92</span>,<span class="fl">154.25</span>) <span class="op">--</span> (<span class="fl">378.92</span>,<span class="fl">182.25</span>) <span class="op">;</span></span>
<span id="cb14-23"><a href="#cb14-23"></a>\draw [shift<span class="op">=</span>{(<span class="fl">378.92</span>,<span class="fl">151.25</span>)}, rotate <span class="op">=</span> <span class="dv">90</span>] [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">74</span><span class="op">;</span> green, <span class="dv">83</span><span class="op">;</span> blue, <span class="dv">226</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ][line width<span class="op">=</span><span class="fl">0.08</span>]  [draw opacity<span class="op">=</span><span class="dv">0</span>] (<span class="fl">8.93</span>,<span class="op">-</span><span class="fl">4.29</span>) <span class="op">--</span> (<span class="dv">0</span>,<span class="dv">0</span>) <span class="op">--</span> (<span class="fl">8.93</span>,<span class="fl">4.29</span>) <span class="op">--</span> cycle    <span class="op">;</span></span>
<span id="cb14-24"><a href="#cb14-24"></a><span class="op">%</span>Rounded Rect [<span class="bu">id</span>:dp591399533303866] </span>
<span id="cb14-25"><a href="#cb14-25"></a>\draw  [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">181</span><span class="op">;</span> green, <span class="dv">212</span><span class="op">;</span> blue, <span class="dv">244</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ] (<span class="fl">335.67</span>,<span class="fl">189.2</span>) .. controls (<span class="fl">335.67</span>,<span class="fl">185.96</span>) <span class="kw">and</span> (<span class="fl">338.29</span>,<span class="fl">183.33</span>) .. (<span class="fl">341.54</span>,<span class="fl">183.33</span>) <span class="op">--</span> (<span class="fl">587.3</span>,<span class="fl">183.33</span>) .. controls (<span class="fl">590.54</span>,<span class="fl">183.33</span>) <span class="kw">and</span> (<span class="fl">593.17</span>,<span class="fl">185.96</span>) .. (<span class="fl">593.17</span>,<span class="fl">189.2</span>) <span class="op">--</span> (<span class="fl">593.17</span>,<span class="fl">206.81</span>) .. controls (<span class="fl">593.17</span>,<span class="fl">210.05</span>) <span class="kw">and</span> (<span class="fl">590.54</span>,<span class="fl">212.68</span>) .. (<span class="fl">587.3</span>,<span class="fl">212.68</span>) <span class="op">--</span> (<span class="fl">341.54</span>,<span class="fl">212.68</span>) .. controls (<span class="fl">338.29</span>,<span class="fl">212.68</span>) <span class="kw">and</span> (<span class="fl">335.67</span>,<span class="fl">210.05</span>) .. (<span class="fl">335.67</span>,<span class="fl">206.81</span>) <span class="op">--</span> cycle <span class="op">;</span></span>
<span id="cb14-26"><a href="#cb14-26"></a><span class="op">%</span>Rounded Rect [<span class="bu">id</span>:dp5591689579874568] </span>
<span id="cb14-27"><a href="#cb14-27"></a>\draw  [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">181</span><span class="op">;</span> green, <span class="dv">212</span><span class="op">;</span> blue, <span class="dv">244</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ] (<span class="fl">44.67</span>,<span class="fl">189.2</span>) .. controls (<span class="fl">44.67</span>,<span class="fl">185.96</span>) <span class="kw">and</span> (<span class="fl">47.29</span>,<span class="fl">183.33</span>) .. (<span class="fl">50.54</span>,<span class="fl">183.33</span>) <span class="op">--</span> (<span class="fl">296.3</span>,<span class="fl">183.33</span>) .. controls (<span class="fl">299.54</span>,<span class="fl">183.33</span>) <span class="kw">and</span> (<span class="fl">302.17</span>,<span class="fl">185.96</span>) .. (<span class="fl">302.17</span>,<span class="fl">189.2</span>) <span class="op">--</span> (<span class="fl">302.17</span>,<span class="fl">206.81</span>) .. controls (<span class="fl">302.17</span>,<span class="fl">210.05</span>) <span class="kw">and</span> (<span class="fl">299.54</span>,<span class="fl">212.68</span>) .. (<span class="fl">296.3</span>,<span class="fl">212.68</span>) <span class="op">--</span> (<span class="fl">50.54</span>,<span class="fl">212.68</span>) .. controls (<span class="fl">47.29</span>,<span class="fl">212.68</span>) <span class="kw">and</span> (<span class="fl">44.67</span>,<span class="fl">210.05</span>) .. (<span class="fl">44.67</span>,<span class="fl">206.81</span>) <span class="op">--</span> cycle <span class="op">;</span></span>
<span id="cb14-28"><a href="#cb14-28"></a><span class="op">%</span>Rounded Rect [<span class="bu">id</span>:dp4165838369572783] </span>
<span id="cb14-29"><a href="#cb14-29"></a>\draw  [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">181</span><span class="op">;</span> green, <span class="dv">212</span><span class="op">;</span> blue, <span class="dv">244</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ] (<span class="fl">44.67</span>,<span class="fl">245.87</span>) .. controls (<span class="fl">44.67</span>,<span class="fl">242.63</span>) <span class="kw">and</span> (<span class="fl">47.29</span>,<span class="dv">240</span>) .. (<span class="fl">50.54</span>,<span class="dv">240</span>) <span class="op">--</span> (<span class="fl">586.46</span>,<span class="dv">240</span>) .. controls (<span class="fl">589.71</span>,<span class="dv">240</span>) <span class="kw">and</span> (<span class="fl">592.33</span>,<span class="fl">242.63</span>) .. (<span class="fl">592.33</span>,<span class="fl">245.87</span>) <span class="op">--</span> (<span class="fl">592.33</span>,<span class="fl">263.48</span>) .. controls (<span class="fl">592.33</span>,<span class="fl">266.72</span>) <span class="kw">and</span> (<span class="fl">589.71</span>,<span class="fl">269.34</span>) .. (<span class="fl">586.46</span>,<span class="fl">269.34</span>) <span class="op">--</span> (<span class="fl">50.54</span>,<span class="fl">269.34</span>) .. controls (<span class="fl">47.29</span>,<span class="fl">269.34</span>) <span class="kw">and</span> (<span class="fl">44.67</span>,<span class="fl">266.72</span>) .. (<span class="fl">44.67</span>,<span class="fl">263.48</span>) <span class="op">--</span> cycle <span class="op">;</span></span>
<span id="cb14-30"><a href="#cb14-30"></a><span class="op">%</span>Straight Lines [<span class="bu">id</span>:da7083107764900278] </span>
<span id="cb14-31"><a href="#cb14-31"></a>\draw [color<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">74</span><span class="op">;</span> green, <span class="dv">83</span><span class="op">;</span> blue, <span class="dv">226</span> }  ,draw opacity<span class="op">=</span><span class="dv">1</span> ]   (<span class="fl">92.99</span>,<span class="fl">215.67</span>) <span class="op">--</span> (<span class="fl">92.92</span>,<span class="fl">240.92</span>) <span class="op">;</span></span>
<span id="cb14-32"><a href="#cb14-32"></a>\draw [shift<span class="op">=</span>{(<span class="dv">93</span>,<span class="fl">212.67</span>)}, rotate <span class="op">=</span> <span class="fl">90.17</span>] [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">74</span><span class="op">;</span> green, <span class="dv">83</span><span class="op">;</span> blue, <span class="dv">226</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ][line width<span class="op">=</span><span class="fl">0.08</span>]  [draw opacity<span class="op">=</span><span class="dv">0</span>] (<span class="fl">8.93</span>,<span class="op">-</span><span class="fl">4.29</span>) <span class="op">--</span> (<span class="dv">0</span>,<span class="dv">0</span>) <span class="op">--</span> (<span class="fl">8.93</span>,<span class="fl">4.29</span>) <span class="op">--</span> cycle    <span class="op">;</span></span>
<span id="cb14-33"><a href="#cb14-33"></a><span class="op">%</span>Straight Lines [<span class="bu">id</span>:da028317245941649194] </span>
<span id="cb14-34"><a href="#cb14-34"></a>\draw [color<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">74</span><span class="op">;</span> green, <span class="dv">83</span><span class="op">;</span> blue, <span class="dv">226</span> }  ,draw opacity<span class="op">=</span><span class="dv">1</span> ]   (<span class="fl">93.66</span>,<span class="fl">153.67</span>) <span class="op">--</span> (<span class="fl">93.58</span>,<span class="fl">182.25</span>) <span class="op">;</span></span>
<span id="cb14-35"><a href="#cb14-35"></a>\draw [shift<span class="op">=</span>{(<span class="fl">93.67</span>,<span class="fl">150.67</span>)}, rotate <span class="op">=</span> <span class="fl">90.15</span>] [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">74</span><span class="op">;</span> green, <span class="dv">83</span><span class="op">;</span> blue, <span class="dv">226</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ][line width<span class="op">=</span><span class="fl">0.08</span>]  [draw opacity<span class="op">=</span><span class="dv">0</span>] (<span class="fl">8.93</span>,<span class="op">-</span><span class="fl">4.29</span>) <span class="op">--</span> (<span class="dv">0</span>,<span class="dv">0</span>) <span class="op">--</span> (<span class="fl">8.93</span>,<span class="fl">4.29</span>) <span class="op">--</span> cycle    <span class="op">;</span></span>
<span id="cb14-36"><a href="#cb14-36"></a><span class="op">%</span>Straight Lines [<span class="bu">id</span>:da8360791510647615] </span>
<span id="cb14-37"><a href="#cb14-37"></a>\draw [color<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">74</span><span class="op">;</span> green, <span class="dv">83</span><span class="op">;</span> blue, <span class="dv">226</span> }  ,draw opacity<span class="op">=</span><span class="dv">1</span> ]   (<span class="fl">92.33</span>,<span class="fl">93.67</span>) <span class="op">--</span> (<span class="fl">92.25</span>,<span class="fl">122.25</span>) <span class="op">;</span></span>
<span id="cb14-38"><a href="#cb14-38"></a>\draw [shift<span class="op">=</span>{(<span class="fl">92.33</span>,<span class="fl">90.67</span>)}, rotate <span class="op">=</span> <span class="fl">90.15</span>] [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">74</span><span class="op">;</span> green, <span class="dv">83</span><span class="op">;</span> blue, <span class="dv">226</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ][line width<span class="op">=</span><span class="fl">0.08</span>]  [draw opacity<span class="op">=</span><span class="dv">0</span>] (<span class="fl">8.93</span>,<span class="op">-</span><span class="fl">4.29</span>) <span class="op">--</span> (<span class="dv">0</span>,<span class="dv">0</span>) <span class="op">--</span> (<span class="fl">8.93</span>,<span class="fl">4.29</span>) <span class="op">--</span> cycle    <span class="op">;</span></span>
<span id="cb14-39"><a href="#cb14-39"></a><span class="op">%</span>Straight Lines [<span class="bu">id</span>:da620625708639835] </span>
<span id="cb14-40"><a href="#cb14-40"></a>\draw [color<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">74</span><span class="op">;</span> green, <span class="dv">83</span><span class="op">;</span> blue, <span class="dv">226</span> }  ,draw opacity<span class="op">=</span><span class="dv">1</span> ]   (<span class="fl">378.25</span>,<span class="fl">213.58</span>) <span class="op">--</span> (<span class="fl">378.25</span>,<span class="fl">241.58</span>) <span class="op">;</span></span>
<span id="cb14-41"><a href="#cb14-41"></a>\draw [shift<span class="op">=</span>{(<span class="fl">378.25</span>,<span class="fl">210.58</span>)}, rotate <span class="op">=</span> <span class="dv">90</span>] [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">74</span><span class="op">;</span> green, <span class="dv">83</span><span class="op">;</span> blue, <span class="dv">226</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ][line width<span class="op">=</span><span class="fl">0.08</span>]  [draw opacity<span class="op">=</span><span class="dv">0</span>] (<span class="fl">8.93</span>,<span class="op">-</span><span class="fl">4.29</span>) <span class="op">--</span> (<span class="dv">0</span>,<span class="dv">0</span>) <span class="op">--</span> (<span class="fl">8.93</span>,<span class="fl">4.29</span>) <span class="op">--</span> cycle    <span class="op">;</span></span>
<span id="cb14-42"><a href="#cb14-42"></a><span class="op">%</span>Straight Lines [<span class="bu">id</span>:da911476849461266] </span>
<span id="cb14-43"><a href="#cb14-43"></a>\draw [color<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">74</span><span class="op">;</span> green, <span class="dv">83</span><span class="op">;</span> blue, <span class="dv">226</span> }  ,draw opacity<span class="op">=</span><span class="dv">1</span> ]   (<span class="fl">305.58</span>,<span class="fl">270.92</span>) <span class="op">--</span> (<span class="fl">305.58</span>,<span class="fl">298.92</span>) <span class="op">;</span></span>
<span id="cb14-44"><a href="#cb14-44"></a>\draw [shift<span class="op">=</span>{(<span class="fl">305.58</span>,<span class="fl">267.92</span>)}, rotate <span class="op">=</span> <span class="dv">90</span>] [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">74</span><span class="op">;</span> green, <span class="dv">83</span><span class="op">;</span> blue, <span class="dv">226</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ][line width<span class="op">=</span><span class="fl">0.08</span>]  [draw opacity<span class="op">=</span><span class="dv">0</span>] (<span class="fl">8.93</span>,<span class="op">-</span><span class="fl">4.29</span>) <span class="op">--</span> (<span class="dv">0</span>,<span class="dv">0</span>) <span class="op">--</span> (<span class="fl">8.93</span>,<span class="fl">4.29</span>) <span class="op">--</span> cycle    <span class="op">;</span></span>
<span id="cb14-45"><a href="#cb14-45"></a><span class="op">%</span>Straight Lines [<span class="bu">id</span>:da6168210047920039] </span>
<span id="cb14-46"><a href="#cb14-46"></a>\draw [color<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">74</span><span class="op">;</span> green, <span class="dv">83</span><span class="op">;</span> blue, <span class="dv">226</span> }  ,draw opacity<span class="op">=</span><span class="dv">1</span> ]   (<span class="fl">377.58</span>,<span class="fl">94.25</span>) <span class="op">--</span> (<span class="fl">377.58</span>,<span class="fl">122.25</span>) <span class="op">;</span></span>
<span id="cb14-47"><a href="#cb14-47"></a>\draw [shift<span class="op">=</span>{(<span class="fl">377.58</span>,<span class="fl">91.25</span>)}, rotate <span class="op">=</span> <span class="dv">90</span>] [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">74</span><span class="op">;</span> green, <span class="dv">83</span><span class="op">;</span> blue, <span class="dv">226</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ][line width<span class="op">=</span><span class="fl">0.08</span>]  [draw opacity<span class="op">=</span><span class="dv">0</span>] (<span class="fl">8.93</span>,<span class="op">-</span><span class="fl">4.29</span>) <span class="op">--</span> (<span class="dv">0</span>,<span class="dv">0</span>) <span class="op">--</span> (<span class="fl">8.93</span>,<span class="fl">4.29</span>) <span class="op">--</span> cycle    <span class="op">;</span></span>
<span id="cb14-48"><a href="#cb14-48"></a><span class="op">%</span>Straight Lines [<span class="bu">id</span>:da45709411556658486] </span>
<span id="cb14-49"><a href="#cb14-49"></a>\draw [color<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">144</span><span class="op">;</span> green, <span class="dv">19</span><span class="op">;</span> blue, <span class="dv">254</span> }  ,draw opacity<span class="op">=</span><span class="dv">1</span> ]   (<span class="fl">243.58</span>,<span class="fl">91.25</span>) <span class="op">--</span> (<span class="fl">243.58</span>,<span class="fl">119.25</span>) <span class="op">;</span></span>
<span id="cb14-50"><a href="#cb14-50"></a>\draw [shift<span class="op">=</span>{(<span class="fl">243.58</span>,<span class="fl">122.25</span>)}, rotate <span class="op">=</span> <span class="dv">270</span>] [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">144</span><span class="op">;</span> green, <span class="dv">19</span><span class="op">;</span> blue, <span class="dv">254</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ][line width<span class="op">=</span><span class="fl">0.08</span>]  [draw opacity<span class="op">=</span><span class="dv">0</span>] (<span class="fl">8.93</span>,<span class="op">-</span><span class="fl">4.29</span>) <span class="op">--</span> (<span class="dv">0</span>,<span class="dv">0</span>) <span class="op">--</span> (<span class="fl">8.93</span>,<span class="fl">4.29</span>) <span class="op">--</span> cycle    <span class="op">;</span></span>
<span id="cb14-51"><a href="#cb14-51"></a><span class="op">%</span>Straight Lines [<span class="bu">id</span>:da1624871748247504] </span>
<span id="cb14-52"><a href="#cb14-52"></a>\draw [color<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">144</span><span class="op">;</span> green, <span class="dv">19</span><span class="op">;</span> blue, <span class="dv">254</span> }  ,draw opacity<span class="op">=</span><span class="dv">1</span> ]   (<span class="fl">244.25</span>,<span class="fl">152.58</span>) <span class="op">--</span> (<span class="fl">244.25</span>,<span class="fl">180.58</span>) <span class="op">;</span></span>
<span id="cb14-53"><a href="#cb14-53"></a>\draw [shift<span class="op">=</span>{(<span class="fl">244.25</span>,<span class="fl">183.58</span>)}, rotate <span class="op">=</span> <span class="dv">270</span>] [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">144</span><span class="op">;</span> green, <span class="dv">19</span><span class="op">;</span> blue, <span class="dv">254</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ][line width<span class="op">=</span><span class="fl">0.08</span>]  [draw opacity<span class="op">=</span><span class="dv">0</span>] (<span class="fl">8.93</span>,<span class="op">-</span><span class="fl">4.29</span>) <span class="op">--</span> (<span class="dv">0</span>,<span class="dv">0</span>) <span class="op">--</span> (<span class="fl">8.93</span>,<span class="fl">4.29</span>) <span class="op">--</span> cycle    <span class="op">;</span></span>
<span id="cb14-54"><a href="#cb14-54"></a><span class="op">%</span>Straight Lines [<span class="bu">id</span>:da951312301312835] </span>
<span id="cb14-55"><a href="#cb14-55"></a>\draw [color<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">144</span><span class="op">;</span> green, <span class="dv">19</span><span class="op">;</span> blue, <span class="dv">254</span> }  ,draw opacity<span class="op">=</span><span class="dv">1</span> ]   (<span class="fl">245.67</span>,<span class="fl">211.33</span>) <span class="op">--</span> (<span class="fl">244.99</span>,<span class="fl">237.25</span>) <span class="op">;</span></span>
<span id="cb14-56"><a href="#cb14-56"></a>\draw [shift<span class="op">=</span>{(<span class="fl">244.92</span>,<span class="fl">240.25</span>)}, rotate <span class="op">=</span> <span class="fl">271.49</span>] [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">144</span><span class="op">;</span> green, <span class="dv">19</span><span class="op">;</span> blue, <span class="dv">254</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ][line width<span class="op">=</span><span class="fl">0.08</span>]  [draw opacity<span class="op">=</span><span class="dv">0</span>] (<span class="fl">8.93</span>,<span class="op">-</span><span class="fl">4.29</span>) <span class="op">--</span> (<span class="dv">0</span>,<span class="dv">0</span>) <span class="op">--</span> (<span class="fl">8.93</span>,<span class="fl">4.29</span>) <span class="op">--</span> cycle    <span class="op">;</span></span>
<span id="cb14-57"><a href="#cb14-57"></a><span class="op">%</span>Straight Lines [<span class="bu">id</span>:da5598487398669117] </span>
<span id="cb14-58"><a href="#cb14-58"></a>\draw [color<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">144</span><span class="op">;</span> green, <span class="dv">19</span><span class="op">;</span> blue, <span class="dv">254</span> }  ,draw opacity<span class="op">=</span><span class="dv">1</span> ]   (<span class="dv">351</span>,<span class="fl">270.67</span>) <span class="op">--</span> (<span class="fl">350.93</span>,<span class="fl">295.92</span>) <span class="op">;</span></span>
<span id="cb14-59"><a href="#cb14-59"></a>\draw [shift<span class="op">=</span>{(<span class="fl">350.92</span>,<span class="fl">298.92</span>)}, rotate <span class="op">=</span> <span class="fl">270.17</span>] [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">144</span><span class="op">;</span> green, <span class="dv">19</span><span class="op">;</span> blue, <span class="dv">254</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ][line width<span class="op">=</span><span class="fl">0.08</span>]  [draw opacity<span class="op">=</span><span class="dv">0</span>] (<span class="fl">8.93</span>,<span class="op">-</span><span class="fl">4.29</span>) <span class="op">--</span> (<span class="dv">0</span>,<span class="dv">0</span>) <span class="op">--</span> (<span class="fl">8.93</span>,<span class="fl">4.29</span>) <span class="op">--</span> cycle    <span class="op">;</span></span>
<span id="cb14-60"><a href="#cb14-60"></a><span class="op">%</span>Straight Lines [<span class="bu">id</span>:da18143538236339274] </span>
<span id="cb14-61"><a href="#cb14-61"></a>\draw [color<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">144</span><span class="op">;</span> green, <span class="dv">19</span><span class="op">;</span> blue, <span class="dv">254</span> }  ,draw opacity<span class="op">=</span><span class="dv">1</span> ]   (<span class="fl">547.58</span>,<span class="fl">91.25</span>) <span class="op">--</span> (<span class="fl">547.58</span>,<span class="fl">119.25</span>) <span class="op">;</span></span>
<span id="cb14-62"><a href="#cb14-62"></a>\draw [shift<span class="op">=</span>{(<span class="fl">547.58</span>,<span class="fl">122.25</span>)}, rotate <span class="op">=</span> <span class="dv">270</span>] [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">144</span><span class="op">;</span> green, <span class="dv">19</span><span class="op">;</span> blue, <span class="dv">254</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ][line width<span class="op">=</span><span class="fl">0.08</span>]  [draw opacity<span class="op">=</span><span class="dv">0</span>] (<span class="fl">8.93</span>,<span class="op">-</span><span class="fl">4.29</span>) <span class="op">--</span> (<span class="dv">0</span>,<span class="dv">0</span>) <span class="op">--</span> (<span class="fl">8.93</span>,<span class="fl">4.29</span>) <span class="op">--</span> cycle    <span class="op">;</span></span>
<span id="cb14-63"><a href="#cb14-63"></a><span class="op">%</span>Straight Lines [<span class="bu">id</span>:da11843933303452991] </span>
<span id="cb14-64"><a href="#cb14-64"></a>\draw [color<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">144</span><span class="op">;</span> green, <span class="dv">19</span><span class="op">;</span> blue, <span class="dv">254</span> }  ,draw opacity<span class="op">=</span><span class="dv">1</span> ]   (<span class="fl">547.58</span>,<span class="fl">151.25</span>) <span class="op">--</span> (<span class="fl">547.58</span>,<span class="fl">179.25</span>) <span class="op">;</span></span>
<span id="cb14-65"><a href="#cb14-65"></a>\draw [shift<span class="op">=</span>{(<span class="fl">547.58</span>,<span class="fl">182.25</span>)}, rotate <span class="op">=</span> <span class="dv">270</span>] [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">144</span><span class="op">;</span> green, <span class="dv">19</span><span class="op">;</span> blue, <span class="dv">254</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ][line width<span class="op">=</span><span class="fl">0.08</span>]  [draw opacity<span class="op">=</span><span class="dv">0</span>] (<span class="fl">8.93</span>,<span class="op">-</span><span class="fl">4.29</span>) <span class="op">--</span> (<span class="dv">0</span>,<span class="dv">0</span>) <span class="op">--</span> (<span class="fl">8.93</span>,<span class="fl">4.29</span>) <span class="op">--</span> cycle    <span class="op">;</span></span>
<span id="cb14-66"><a href="#cb14-66"></a><span class="op">%</span>Straight Lines [<span class="bu">id</span>:da21016027697626216] </span>
<span id="cb14-67"><a href="#cb14-67"></a>\draw [color<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">144</span><span class="op">;</span> green, <span class="dv">19</span><span class="op">;</span> blue, <span class="dv">254</span> }  ,draw opacity<span class="op">=</span><span class="dv">1</span> ]   (<span class="fl">546.92</span>,<span class="fl">211.25</span>) <span class="op">--</span> (<span class="fl">546.92</span>,<span class="fl">239.25</span>) <span class="op">;</span></span>
<span id="cb14-68"><a href="#cb14-68"></a>\draw [shift<span class="op">=</span>{(<span class="fl">546.92</span>,<span class="fl">242.25</span>)}, rotate <span class="op">=</span> <span class="dv">270</span>] [fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">144</span><span class="op">;</span> green, <span class="dv">19</span><span class="op">;</span> blue, <span class="dv">254</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ][line width<span class="op">=</span><span class="fl">0.08</span>]  [draw opacity<span class="op">=</span><span class="dv">0</span>] (<span class="fl">8.93</span>,<span class="op">-</span><span class="fl">4.29</span>) <span class="op">--</span> (<span class="dv">0</span>,<span class="dv">0</span>) <span class="op">--</span> (<span class="fl">8.93</span>,<span class="fl">4.29</span>) <span class="op">--</span> cycle    <span class="op">;</span></span>
<span id="cb14-69"><a href="#cb14-69"></a></span>
<span id="cb14-70"><a href="#cb14-70"></a><span class="op">%</span> Text Node</span>
<span id="cb14-71"><a href="#cb14-71"></a>\draw (<span class="dv">52</span>,<span class="dv">42</span>) node [anchor<span class="op">=</span>north west][inner sep<span class="op">=</span><span class="fl">0.75</span><span class="er">pt</span>]  [xscale<span class="op">=</span><span class="dv">2</span>,yscale<span class="op">=</span><span class="dv">2</span>] [align<span class="op">=</span>left] {\textit{CPU Core<span class="op">-</span><span class="dv">1</span>}}<span class="op">;</span></span>
<span id="cb14-72"><a href="#cb14-72"></a><span class="op">%</span> Text Node</span>
<span id="cb14-73"><a href="#cb14-73"></a>\draw (<span class="dv">342</span>,<span class="dv">40</span>) node [anchor<span class="op">=</span>north west][inner sep<span class="op">=</span><span class="fl">0.75</span><span class="er">pt</span>]  [xscale<span class="op">=</span><span class="dv">2</span>,yscale<span class="op">=</span><span class="dv">2</span>] [align<span class="op">=</span>left] {\textit{CPU Core<span class="op">-</span><span class="dv">2</span>}}<span class="op">;</span></span>
<span id="cb14-74"><a href="#cb14-74"></a><span class="op">%</span> Text Node</span>
<span id="cb14-75"><a href="#cb14-75"></a>\draw  [color<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">184</span><span class="op">;</span> green, <span class="dv">233</span><span class="op">;</span> blue, <span class="dv">134</span> }  ,draw opacity<span class="op">=</span><span class="dv">1</span> ][fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">233</span><span class="op">;</span> green, <span class="dv">229</span><span class="op">;</span> blue, <span class="dv">229</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ][line width<span class="op">=</span><span class="fl">2.25</span>]   (<span class="fl">58.13</span>,<span class="fl">124.25</span>) <span class="op">--</span> (<span class="fl">169.13</span>,<span class="fl">124.25</span>) <span class="op">--</span> (<span class="fl">169.13</span>,<span class="fl">149.25</span>) <span class="op">--</span> (<span class="fl">58.13</span>,<span class="fl">149.25</span>) <span class="op">--</span> cycle  <span class="op">;</span></span>
<span id="cb14-76"><a href="#cb14-76"></a>\draw (<span class="fl">113.63</span>,<span class="fl">136.75</span>) node  [xscale<span class="op">=</span><span class="dv">2</span>,yscale<span class="op">=</span><span class="dv">2</span>] [align<span class="op">=</span>left] {\begin{minipage}[lt]{<span class="fl">72.93</span><span class="er">pt</span>}\setlength\topsep{<span class="dv">0</span><span class="er">pt</span>}</span>
<span id="cb14-77"><a href="#cb14-77"></a>x[<span class="dv">0</span>],x[<span class="dv">1</span>],...</span>
<span id="cb14-78"><a href="#cb14-78"></a>\end{minipage}}<span class="op">;</span></span>
<span id="cb14-79"><a href="#cb14-79"></a><span class="op">%</span> Text Node</span>
<span id="cb14-80"><a href="#cb14-80"></a>\draw (<span class="dv">210</span>,<span class="dv">128</span>) node [anchor<span class="op">=</span>north west][inner sep<span class="op">=</span><span class="fl">0.75</span><span class="er">pt</span>]  [xscale<span class="op">=</span><span class="dv">2</span>,yscale<span class="op">=</span><span class="dv">2</span>] [align<span class="op">=</span>left] {\textit{L1 Cache}}<span class="op">;</span></span>
<span id="cb14-81"><a href="#cb14-81"></a><span class="op">%</span> Text Node</span>
<span id="cb14-82"><a href="#cb14-82"></a>\draw (<span class="dv">500</span>,<span class="fl">127.5</span>) node [anchor<span class="op">=</span>north west][inner sep<span class="op">=</span><span class="fl">0.75</span><span class="er">pt</span>]  [xscale<span class="op">=</span><span class="dv">2</span>,yscale<span class="op">=</span><span class="dv">2</span>] [align<span class="op">=</span>left] {\textit{L1 Cache}}<span class="op">;</span></span>
<span id="cb14-83"><a href="#cb14-83"></a><span class="op">%</span> Text Node</span>
<span id="cb14-84"><a href="#cb14-84"></a>\draw (<span class="fl">470.33</span>,<span class="fl">302.67</span>) node [anchor<span class="op">=</span>north west][inner sep<span class="op">=</span><span class="fl">0.75</span><span class="er">pt</span>]  [xscale<span class="op">=</span><span class="dv">2</span>,yscale<span class="op">=</span><span class="dv">2</span>] [align<span class="op">=</span>left] {\textit{Main Memory}}<span class="op">;</span></span>
<span id="cb14-85"><a href="#cb14-85"></a><span class="op">%</span> Text Node</span>
<span id="cb14-86"><a href="#cb14-86"></a>\draw (<span class="fl">298.33</span>,<span class="fl">344.17</span>) node [anchor<span class="op">=</span>north west][inner sep<span class="op">=</span><span class="fl">0.75</span><span class="er">pt</span>]  [xscale<span class="op">=</span><span class="dv">2</span>,yscale<span class="op">=</span><span class="dv">2</span>] [align<span class="op">=</span>left] {\textit{<span class="dv">64</span><span class="op">-</span><span class="bu">bytes</span>}}<span class="op">;</span></span>
<span id="cb14-87"><a href="#cb14-87"></a><span class="op">%</span> Text Node</span>
<span id="cb14-88"><a href="#cb14-88"></a>\draw (<span class="fl">170.83</span>,<span class="fl">312.17</span>) node [anchor<span class="op">=</span>north west][inner sep<span class="op">=</span><span class="fl">0.75</span><span class="er">pt</span>]  [xscale<span class="op">=</span><span class="dv">2</span>,yscale<span class="op">=</span><span class="dv">2</span>] [align<span class="op">=</span>left] {\textit{Cache line}}<span class="op">;</span></span>
<span id="cb14-89"><a href="#cb14-89"></a><span class="op">%</span> Text Node</span>
<span id="cb14-90"><a href="#cb14-90"></a>\draw (<span class="fl">179.83</span>,<span class="fl">68.63</span>) node  [xscale<span class="op">=</span><span class="dv">2</span>,yscale<span class="op">=</span><span class="dv">2</span>] [align<span class="op">=</span>left] {\begin{minipage}[lt]{<span class="fl">48.73</span><span class="er">pt</span>}\setlength\topsep{<span class="dv">0</span><span class="er">pt</span>}</span>
<span id="cb14-91"><a href="#cb14-91"></a><span class="op">++</span>x[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb14-92"><a href="#cb14-92"></a>\end{minipage}}<span class="op">;</span></span>
<span id="cb14-93"><a href="#cb14-93"></a><span class="op">%</span> Text Node</span>
<span id="cb14-94"><a href="#cb14-94"></a>\draw (<span class="fl">467.67</span>,<span class="fl">68.13</span>) node  [xscale<span class="op">=</span><span class="dv">2</span>,yscale<span class="op">=</span><span class="dv">2</span>] [align<span class="op">=</span>left] {\begin{minipage}[lt]{<span class="fl">41.71</span><span class="er">pt</span>}\setlength\topsep{<span class="dv">0</span><span class="er">pt</span>}</span>
<span id="cb14-95"><a href="#cb14-95"></a><span class="op">++</span>x[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb14-96"><a href="#cb14-96"></a>\end{minipage}}<span class="op">;</span></span>
<span id="cb14-97"><a href="#cb14-97"></a><span class="op">%</span> Text Node</span>
<span id="cb14-98"><a href="#cb14-98"></a>\draw  [color<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">184</span><span class="op">;</span> green, <span class="dv">233</span><span class="op">;</span> blue, <span class="dv">134</span> }  ,draw opacity<span class="op">=</span><span class="dv">1</span> ][fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">233</span><span class="op">;</span> green, <span class="dv">229</span><span class="op">;</span> blue, <span class="dv">229</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ][line width<span class="op">=</span><span class="fl">2.25</span>]   (<span class="fl">349.63</span>,<span class="fl">123.75</span>) <span class="op">--</span> (<span class="fl">460.63</span>,<span class="fl">123.75</span>) <span class="op">--</span> (<span class="fl">460.63</span>,<span class="fl">148.75</span>) <span class="op">--</span> (<span class="fl">349.63</span>,<span class="fl">148.75</span>) <span class="op">--</span> cycle  <span class="op">;</span></span>
<span id="cb14-99"><a href="#cb14-99"></a>\draw (<span class="fl">405.13</span>,<span class="fl">136.25</span>) node  [xscale<span class="op">=</span><span class="dv">2</span>,yscale<span class="op">=</span><span class="dv">2</span>] [align<span class="op">=</span>left] {\begin{minipage}[lt]{<span class="fl">72.93</span><span class="er">pt</span>}\setlength\topsep{<span class="dv">0</span><span class="er">pt</span>}</span>
<span id="cb14-100"><a href="#cb14-100"></a>x[<span class="dv">0</span>],x[<span class="dv">1</span>],...</span>
<span id="cb14-101"><a href="#cb14-101"></a>\end{minipage}}<span class="op">;</span></span>
<span id="cb14-102"><a href="#cb14-102"></a><span class="op">%</span> Text Node</span>
<span id="cb14-103"><a href="#cb14-103"></a>\draw  [color<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">184</span><span class="op">;</span> green, <span class="dv">233</span><span class="op">;</span> blue, <span class="dv">134</span> }  ,draw opacity<span class="op">=</span><span class="dv">1</span> ][fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">233</span><span class="op">;</span> green, <span class="dv">229</span><span class="op">;</span> blue, <span class="dv">229</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ][line width<span class="op">=</span><span class="fl">2.25</span>]   (<span class="fl">278.63</span>,<span class="fl">305.92</span>) <span class="op">--</span> (<span class="fl">389.63</span>,<span class="fl">305.92</span>) <span class="op">--</span> (<span class="fl">389.63</span>,<span class="fl">330.92</span>) <span class="op">--</span> (<span class="fl">278.63</span>,<span class="fl">330.92</span>) <span class="op">--</span> cycle  <span class="op">;</span></span>
<span id="cb14-104"><a href="#cb14-104"></a>\draw (<span class="fl">334.13</span>,<span class="fl">318.42</span>) node  [xscale<span class="op">=</span><span class="dv">2</span>,yscale<span class="op">=</span><span class="dv">2</span>] [align<span class="op">=</span>left] {\begin{minipage}[lt]{<span class="fl">72.93</span><span class="er">pt</span>}\setlength\topsep{<span class="dv">0</span><span class="er">pt</span>}</span>
<span id="cb14-105"><a href="#cb14-105"></a>x[<span class="dv">0</span>],x[<span class="dv">1</span>],...</span>
<span id="cb14-106"><a href="#cb14-106"></a>\end{minipage}}<span class="op">;</span></span>
<span id="cb14-107"><a href="#cb14-107"></a><span class="op">%</span> Text Node</span>
<span id="cb14-108"><a href="#cb14-108"></a>\draw  [color<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">184</span><span class="op">;</span> green, <span class="dv">233</span><span class="op">;</span> blue, <span class="dv">134</span> }  ,draw opacity<span class="op">=</span><span class="dv">1</span> ][fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">233</span><span class="op">;</span> green, <span class="dv">229</span><span class="op">;</span> blue, <span class="dv">229</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ][line width<span class="op">=</span><span class="fl">2.25</span>]   (<span class="fl">58.79</span>,<span class="fl">185.58</span>) <span class="op">--</span> (<span class="fl">169.79</span>,<span class="fl">185.58</span>) <span class="op">--</span> (<span class="fl">169.79</span>,<span class="fl">210.58</span>) <span class="op">--</span> (<span class="fl">58.79</span>,<span class="fl">210.58</span>) <span class="op">--</span> cycle  <span class="op">;</span></span>
<span id="cb14-109"><a href="#cb14-109"></a>\draw (<span class="fl">114.29</span>,<span class="fl">198.08</span>) node  [xscale<span class="op">=</span><span class="dv">2</span>,yscale<span class="op">=</span><span class="dv">2</span>] [align<span class="op">=</span>left] {\begin{minipage}[lt]{<span class="fl">72.93</span><span class="er">pt</span>}\setlength\topsep{<span class="dv">0</span><span class="er">pt</span>}</span>
<span id="cb14-110"><a href="#cb14-110"></a>x[<span class="dv">0</span>],x[<span class="dv">1</span>],...</span>
<span id="cb14-111"><a href="#cb14-111"></a>\end{minipage}}<span class="op">;</span></span>
<span id="cb14-112"><a href="#cb14-112"></a><span class="op">%</span> Text Node</span>
<span id="cb14-113"><a href="#cb14-113"></a>\draw (<span class="fl">210.67</span>,<span class="fl">189.33</span>) node [anchor<span class="op">=</span>north west][inner sep<span class="op">=</span><span class="fl">0.75</span><span class="er">pt</span>]  [xscale<span class="op">=</span><span class="dv">2</span>,yscale<span class="op">=</span><span class="dv">2</span>] [align<span class="op">=</span>left] {\textit{L2 Cache}}<span class="op">;</span></span>
<span id="cb14-114"><a href="#cb14-114"></a><span class="op">%</span> Text Node</span>
<span id="cb14-115"><a href="#cb14-115"></a>\draw (<span class="fl">500.83</span>,<span class="fl">189.5</span>) node [anchor<span class="op">=</span>north west][inner sep<span class="op">=</span><span class="fl">0.75</span><span class="er">pt</span>]  [xscale<span class="op">=</span><span class="dv">2</span>,yscale<span class="op">=</span><span class="dv">2</span>] [align<span class="op">=</span>left] {\textit{L2 Cache}}<span class="op">;</span></span>
<span id="cb14-116"><a href="#cb14-116"></a><span class="op">%</span> Text Node</span>
<span id="cb14-117"><a href="#cb14-117"></a>\draw  [color<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">184</span><span class="op">;</span> green, <span class="dv">233</span><span class="op">;</span> blue, <span class="dv">134</span> }  ,draw opacity<span class="op">=</span><span class="dv">1</span> ][fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">233</span><span class="op">;</span> green, <span class="dv">229</span><span class="op">;</span> blue, <span class="dv">229</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ][line width<span class="op">=</span><span class="fl">2.25</span>]   (<span class="fl">350.29</span>,<span class="fl">185.08</span>) <span class="op">--</span> (<span class="fl">461.29</span>,<span class="fl">185.08</span>) <span class="op">--</span> (<span class="fl">461.29</span>,<span class="fl">210.08</span>) <span class="op">--</span> (<span class="fl">350.29</span>,<span class="fl">210.08</span>) <span class="op">--</span> cycle  <span class="op">;</span></span>
<span id="cb14-118"><a href="#cb14-118"></a>\draw (<span class="fl">405.79</span>,<span class="fl">197.58</span>) node  [xscale<span class="op">=</span><span class="dv">2</span>,yscale<span class="op">=</span><span class="dv">2</span>] [align<span class="op">=</span>left] {\begin{minipage}[lt]{<span class="fl">72.93</span><span class="er">pt</span>}\setlength\topsep{<span class="dv">0</span><span class="er">pt</span>}</span>
<span id="cb14-119"><a href="#cb14-119"></a>x[<span class="dv">0</span>],x[<span class="dv">1</span>],...</span>
<span id="cb14-120"><a href="#cb14-120"></a>\end{minipage}}<span class="op">;</span></span>
<span id="cb14-121"><a href="#cb14-121"></a><span class="op">%</span> Text Node</span>
<span id="cb14-122"><a href="#cb14-122"></a>\draw  [color<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">184</span><span class="op">;</span> green, <span class="dv">233</span><span class="op">;</span> blue, <span class="dv">134</span> }  ,draw opacity<span class="op">=</span><span class="dv">1</span> ][fill<span class="op">=</span>{rgb, <span class="dv">255</span>:red, <span class="dv">233</span><span class="op">;</span> green, <span class="dv">229</span><span class="op">;</span> blue, <span class="dv">229</span> }  ,fill opacity<span class="op">=</span><span class="dv">1</span> ][line width<span class="op">=</span><span class="fl">2.25</span>]   (<span class="fl">276.13</span>,<span class="fl">241.58</span>) <span class="op">--</span> (<span class="fl">387.13</span>,<span class="fl">241.58</span>) <span class="op">--</span> (<span class="fl">387.13</span>,<span class="fl">266.58</span>) <span class="op">--</span> (<span class="fl">276.13</span>,<span class="fl">266.58</span>) <span class="op">--</span> cycle  <span class="op">;</span></span>
<span id="cb14-123"><a href="#cb14-123"></a>\draw (<span class="fl">331.63</span>,<span class="fl">254.08</span>) node  [xscale<span class="op">=</span><span class="dv">2</span>,yscale<span class="op">=</span><span class="dv">2</span>] [align<span class="op">=</span>left] {\begin{minipage}[lt]{<span class="fl">72.93</span><span class="er">pt</span>}\setlength\topsep{<span class="dv">0</span><span class="er">pt</span>}</span>
<span id="cb14-124"><a href="#cb14-124"></a>x[<span class="dv">0</span>],x[<span class="dv">1</span>],...</span>
<span id="cb14-125"><a href="#cb14-125"></a>\end{minipage}}<span class="op">;</span></span>
<span id="cb14-126"><a href="#cb14-126"></a><span class="op">%</span> Text Node</span>
<span id="cb14-127"><a href="#cb14-127"></a>\draw (<span class="fl">500.33</span>,<span class="fl">246.67</span>) node [anchor<span class="op">=</span>north west][inner sep<span class="op">=</span><span class="fl">0.75</span><span class="er">pt</span>]  [xscale<span class="op">=</span><span class="dv">2</span>,yscale<span class="op">=</span><span class="dv">2</span>] [align<span class="op">=</span>left] {\textit{L3 Cache}}<span class="op">;</span></span>
<span id="cb14-128"><a href="#cb14-128"></a></span>
<span id="cb14-129"><a href="#cb14-129"></a></span>
<span id="cb14-130"><a href="#cb14-130"></a>\end{tikzpicture}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="6">
<p><img src="index_files/figure-html/cell-4-output-1.svg" class="img-fluid"></p>
</div>
</div>
</div>
<p>Atomic operations do wait on each other! In particular, write-operations do. Read operations scale near-perfectly.</p>
<p>If I put the variables on separate cache-lines, then there is no problem and the CPUs don’t have to wait on anything. We can prove it with a benchmark.</p>
<pre><code>Benchmark                            Time         CPU
------------------------------------------------------------------------
BM_Shared/1/real_time            0.561 ms    0.015 ms
BM_Shared/2/real_time             3.25 ms    0.054 ms
BM_Shared/4/real_time             6.07 ms    0.061 ms
BM_Shared/8/real_time             10.6 ms    0.240 ms
BM_Shared/16/real_time            22.9 ms    0.384 ms
BM_Shared/32/real_time            51.4 ms    0.944 ms
BM_Shared/64/real_time             103 ms     2.67 ms
BM_FalseShared/1/real_time       0.578 ms    0.016 ms
BM_FalseShared/2/real_time        2.98 ms    0.037 ms
BM_FalseShared/4/real_time        6.18 ms    0.065 ms
BM_FalseShared/8/real_time        10.6 ms    0.234 ms
BM_FalseShared/16/real_time       13.5 ms    0.386 ms
BM_FalseShared/32/real_time       26.7 ms     1.21 ms
BM_FalseShared/64/real_time       37.0 ms     2.36 ms
BM_NonShared/1/real_time         0.576 ms    0.015 ms
BM_NonShared/2/real_time         0.591 ms    0.028 ms
BM_NonShared/4/real_time         0.632 ms    0.051 ms
BM_NonShared/8/real_time         0.598 ms    0.102 ms
BM_NonShared/16/real_time         1.05 ms    0.225 ms
BM_NonShared/32/real_time         1.81 ms    0.701 ms
BM_NonShared/64/real_time         3.21 ms     1.28 ms</code></pre>
<p>Atomic operations have to wait for cache line access. This is the <strong>price of data sharing</strong> without race conditions. Modifying different locations on the same cache line still incurs a run-time penalty, a phenomenon known as false sharing. To avoid false sharing, we should align per-thread data to separate cache lines. Atomic operations do wait on each other, particularly write operations. However, read-only operations can scale near-perfectly when properly designed.</p>
</section>
</section>
<section id="strong-vs-weak-compare-and-swap" class="level2">
<h2 class="anchored" data-anchor-id="strong-vs-weak-compare-and-swap">Strong vs Weak Compare-and-Swap</h2>
<p>C++ provides two versions of CAS - weak and strong.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb16-1"><a href="#cb16-1"></a><span class="co">// Strong CAS</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>x<span class="op">.</span>compare_exchange_strong<span class="op">(</span>old_x<span class="op">,</span> new_x<span class="op">);</span></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="co">/* </span></span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="co">if (x == old_x)</span></span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="co">{</span></span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="co">    x = new_x;</span></span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="co">    return true;</span></span>
<span id="cb16-8"><a href="#cb16-8"></a><span class="co">}else{</span></span>
<span id="cb16-9"><a href="#cb16-9"></a><span class="co">    old_x = x;</span></span>
<span id="cb16-10"><a href="#cb16-10"></a><span class="co">    return false;</span></span>
<span id="cb16-11"><a href="#cb16-11"></a><span class="co">}</span></span>
<span id="cb16-12"><a href="#cb16-12"></a><span class="co">*/</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>x.compare_exchange_weak(old_x, new_x)</code> is essentially the same thing, but can <strong>spuriously fail</strong> and return <code>false</code>, even if <code>x == old_x</code>.</p>
</section>
</section>
<section id="memory-barriers" class="level1">
<h1>Memory Barriers</h1>
<section id="memory-barriers---introduction" class="level2">
<h2 class="anchored" data-anchor-id="memory-barriers---introduction">Memory Barriers - Introduction</h2>
<p>It’s good to understand about atomic variables, but its not enough by a mile. Memory barriers go hand-in-hand with C++ atomics. Memory barriers control how changes to memory made by one CPU core become visible to other CPU cores. Without memory barriers, there is no guarantee of visibility whatsoever. Imagine you have two CPUs, both modifying a variable <code>x</code> in their on-chip caches. The main memory doesn’t have to change at all! There is no guarantee that anybody can see anything.</p>
<p>For example, CPU-1 cache might have <code>x = 42</code>, CPU-2 cache might have <code>x = 17</code>, while Main Memory still shows <code>x = 0</code> (stale/unchanged). The problem is that each CPU sees its own value. Memory is unchanged, and there is no coherence between the cores.</p>
</section>
<section id="memory-barriers-in-c" class="level2">
<h2 class="anchored" data-anchor-id="memory-barriers-in-c">Memory Barriers in C++</h2>
<p>C++ memory barriers are modifiers on atomic operations.</p>
<p><strong>Example:</strong></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb17-1"><a href="#cb17-1"></a><span class="bu">std::</span>atomic<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> x<span class="op">;</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>x<span class="op">.</span>store<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="bu">std::</span>memory_order_release<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This implies that we have put a release memory barrier on that store.</p>
</section>
<section id="no-barriers---stdmemory_order_relaxed" class="level2">
<h2 class="anchored" data-anchor-id="no-barriers---stdmemory_order_relaxed">No Barriers - <code>std::memory_order_relaxed</code></h2>
<p>No memory barrier means that we can reorder reads and writes any way we want. We have an atomic <code>x</code> variable and <code>a</code>, <code>b</code> and <code>c</code> are non-atomic variables. No memory order means I can reorder reads and writes anywhere I want.</p>
<p>We have an atomic store to <code>x</code> in the middle. In the program order, I write to <code>a</code>, then I write to <code>b</code>, then I write to <code>c</code> and then I write to <code>x</code>. In the actual order, anything is possible. There are no restrictions whatsoever. This in C++ stamdard is called <code>std::memory_order_relaxed</code>. There are no guarantees here.</p>
<div class="text-center">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="memory_order_relaxed.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Reads and writes can be reordered arbitrarily. No guarantees.</figcaption>
</figure>
</div>
</div>
</section>
<section id="acquire-barrier" class="level2">
<h2 class="anchored" data-anchor-id="acquire-barrier">Acquire Barrier</h2>
<p>An acquire barrier is a half-barrier that acts as a one-way gate. Nothing that was after the <code>load</code> can move in front of it, but anything that was before can move after. Acquire barrier guarantees that all memory operations scheduled after the barrier in the program order become visible after the barrier. This applies to <strong>all operations</strong> - not just all reads or all writes, but both reads and writes. Furthermore, this applies to <strong>all operations</strong>, not just operations on the atomic variable, but literally all memory operations. Reads and writes cannot be reordered from after to before the barrier.</p>
<div class="text-center">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="memory_order_acquire.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Anything that was after cannot be moved to before the load.</figcaption>
</figure>
</div>
</div>
</section>
<section id="release-barrier" class="level2">
<h2 class="anchored" data-anchor-id="release-barrier">Release Barrier</h2>
<p>A release barrier is the reverse of an acquire barrier. Nothing that was before the barrier can move after, but anything that is after can move in front of the <code>store</code>.</p>
<div class="text-center">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="memory_order_release.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Anything that was before cannot be moved to after the store.</figcaption>
</figure>
</div>
</div>
</section>
<section id="acquire-release-protocol" class="level2">
<h2 class="anchored" data-anchor-id="acquire-release-protocol">Acquire-Release Protocol</h2>
<p>Acquire and release barriers are often used together. Thread t1 writes atomic variable <code>x</code> with a <code>release</code> barrier. Thread t2 reads atomic variable <code>x</code> with an <code>acquire</code> barrier. On the acquire side, all memory reads done after the <code>acquire</code> barrier in t2 in program order have to be done after the barrier in actual execution order. On the release side, all memory writes done before the <code>release</code> barrier in t1 in program order have to be done before the barrier in actual execution order.</p>
<p>The result is that all memory writes that happen in t1 before the barrier become visible in thread t2 after the barrier. Thread 1 prepares data (does some writes) then <strong>releases</strong> (publishes) it by updating atomic variable <code>x</code>. Thread 2 <strong>acquires</strong> atomic variable <code>x</code> and the data is guaranteed to be visible. It’s important to note that it has to be the same atomic variable <code>x</code> for this synchronization to work.</p>
</section>
<section id="challenge-question" class="level2">
<h2 class="anchored" data-anchor-id="challenge-question">Challenge question</h2>
<p>Observe the following code snippet. What is the output of lines (q) and (s)?</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb18-1"><a href="#cb18-1"></a><span class="co">// Thread-1</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>x<span class="op">.</span>store<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="bu">std::</span>memory_order_relaxed<span class="op">);</span></span>
<span id="cb18-3"><a href="#cb18-3"></a>y<span class="op">.</span>store<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="bu">std::</span>memory_order_release<span class="op">);</span></span>
<span id="cb18-4"><a href="#cb18-4"></a>x<span class="op">.</span>store<span class="op">(</span><span class="dv">3</span><span class="op">,</span> <span class="bu">std::</span>memory_order_relaxed<span class="op">);</span></span>
<span id="cb18-5"><a href="#cb18-5"></a>z<span class="op">.</span>store<span class="op">(</span><span class="dv">4</span><span class="op">,</span> <span class="bu">std::</span>memory_order_release<span class="op">);</span></span>
<span id="cb18-6"><a href="#cb18-6"></a>x<span class="op">.</span>store<span class="op">(</span><span class="dv">5</span><span class="op">,</span> <span class="bu">std::</span>memory_order_relaxed<span class="op">);</span></span>
<span id="cb18-7"><a href="#cb18-7"></a></span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="co">//Thread-2</span></span>
<span id="cb18-9"><a href="#cb18-9"></a><span class="cf">while</span><span class="op">(</span>y<span class="op">.</span>load<span class="op">(</span><span class="bu">std::</span>memory_order_acquire<span class="op">)!=</span><span class="dv">2</span><span class="op">){}</span>   <span class="co">// p</span></span>
<span id="cb18-10"><a href="#cb18-10"></a><span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> x<span class="op">.</span>load<span class="op">(</span><span class="bu">std::</span>memory_order_relaxed<span class="op">);</span> <span class="co">// q</span></span>
<span id="cb18-11"><a href="#cb18-11"></a><span class="cf">while</span><span class="op">(</span>z<span class="op">.</span>load<span class="op">(</span><span class="bu">std::</span>memory_order_acquire<span class="op">)!=</span><span class="dv">4</span><span class="op">){}</span>   <span class="co">// r</span></span>
<span id="cb18-12"><a href="#cb18-12"></a><span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> x<span class="op">.</span>load<span class="op">(</span><span class="bu">std::</span>memory_order_relaxed<span class="op">);</span> <span class="co">// s</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For more such questions, visit <a href="https://getcracked.io">getcracked.io</a></p>
</section>

</section>

<div id="quarto-appendix" class="default"><section id="references" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">References</h2><div class="quarto-appendix-contents">

<ul>
<li><a href="https://www.youtube.com/watch?v=ZQFzMfHIxng">C++ atomics, from basic to advanced</a> by Fedor Pikus (CppCon 2017)</li>
<li>“C++ Concurrency in Action” by Anthony Williams</li>
<li>“The Art of Multiprocessor Programming” by Herlihy and Shavit</li>
</ul>


</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="quasar-chunawala/quantdev" data-repo-id="R_kgDOL2t5-A" data-category="General" data-category-id="DIC_kwDOL2t5-M4ClndQ" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->



</body></html>