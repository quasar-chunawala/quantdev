<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Quasar">
<meta name="dcterms.date" content="2024-11-28">

<title>quantdev.blog - Fun with numeraires!</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;800&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap')
</style>
<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9993009899870547" crossorigin="anonymous"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">quantdev.blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../sell_side_quant_critical_path.html" rel="" target="">
 <span class="menu-text">Sell-side Quant</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../roadmap.html" rel="" target="">
 <span class="menu-text">C++ Roadmap</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/quasar-chunawala" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml" rel="" target=""><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Fun with numeraires!</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Stochastic Calculus</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Quasar </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 28, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  
  <li><a href="#girsanov-theorem" id="toc-girsanov-theorem" class="nav-link" data-scroll-target="#girsanov-theorem">Girsanov Theorem</a></li>
  <li><a href="#what-is-a-numeraire" id="toc-what-is-a-numeraire" class="nav-link" data-scroll-target="#what-is-a-numeraire">What is a numeraire?</a></li>
  <li><a href="#abstract-bayes-formula" id="toc-abstract-bayes-formula" class="nav-link" data-scroll-target="#abstract-bayes-formula">Abstract Bayes Formula</a></li>
  <li><a href="#martingale-property" id="toc-martingale-property" class="nav-link" data-scroll-target="#martingale-property">Martingale property</a></li>
  <li><a href="#drift-transformation-under-change-of-numeraire" id="toc-drift-transformation-under-change-of-numeraire" class="nav-link" data-scroll-target="#drift-transformation-under-change-of-numeraire">Drift transformation under change of numeraire</a></li>
  <li><a href="#examples-of-numeraires" id="toc-examples-of-numeraires" class="nav-link" data-scroll-target="#examples-of-numeraires">Examples of numeraires</a>
  <ul class="collapse">
  <li><a href="#bank-account-numeraire" id="toc-bank-account-numeraire" class="nav-link" data-scroll-target="#bank-account-numeraire">Bank-account numeraire</a></li>
  <li><a href="#forward-numeraire" id="toc-forward-numeraire" class="nav-link" data-scroll-target="#forward-numeraire">Forward numeraire</a></li>
  <li><a href="#pricing-an-irs" id="toc-pricing-an-irs" class="nav-link" data-scroll-target="#pricing-an-irs">Pricing an IRS</a></li>
  <li><a href="#the-annuity-measure" id="toc-the-annuity-measure" class="nav-link" data-scroll-target="#the-annuity-measure">The Annuity Measure</a></li>
  </ul></li>
  <li><a href="#pricing-the-payoff-vt-s_ts_t---k" id="toc-pricing-the-payoff-vt-s_ts_t---k" class="nav-link" data-scroll-target="#pricing-the-payoff-vt-s_ts_t---k">Pricing the payoff <span class="math inline">\(V(T) = [S_T(S_T - K)]^{+}\)</span></a></li>
  <li><a href="#pricing-the-payoff-vt-s_1t1_s_2t-k" id="toc-pricing-the-payoff-vt-s_1t1_s_2t-k" class="nav-link" data-scroll-target="#pricing-the-payoff-vt-s_1t1_s_2t-k">Pricing the payoff <span class="math inline">\(V(T) = S_1(T)1_{S_2(T) &gt; K}\)</span></a></li>
  <li><a href="#pricing-an-assymetric-power-option-v_t-frac1k2k3---s_t3" id="toc-pricing-an-assymetric-power-option-v_t-frac1k2k3---s_t3" class="nav-link" data-scroll-target="#pricing-an-assymetric-power-option-v_t-frac1k2k3---s_t3">Pricing an assymetric power option <span class="math inline">\(V_T = \frac{1}{K^2}(K^3 - S_T^3)^{+}\)</span></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>A proficiency in the change-of-measure technique is useful to the working quant. An excellent summary of the important results is the note <a href="https://www.researchgate.net/publication/361692645_Girsanov_Numeraires_and_All_That">Girsanov, Numeraires and all that</a>, by Andrew Lesniewski. In this post, I would like to derive relevant results and then we can enjoy pricing some payoffs together!</p>
</section>

<section id="girsanov-theorem" class="level2">
<h2 class="anchored" data-anchor-id="girsanov-theorem">Girsanov Theorem</h2>
<div id="thm-Girsanov-theorem" class="theorem">
<p><span class="theorem-title"><strong>Theorem 1 (Girsanov Theorem) </strong></span>Let <span class="math inline">\((W^{\mathbb{P}},t\geq 0)\)</span> be a <span class="math inline">\(\mathbb{P}\)</span> standard brownian motion on <span class="math inline">\((\Omega,\mathcal{F},\mathbb{P})\)</span> and let <span class="math inline">\(\phi\)</span> be any adapted process. Choose fixed <span class="math inline">\(T\)</span> and defined the process <span class="math inline">\(L\)</span> on <span class="math inline">\([0,T]\)</span> by:</p>
<p><span id="eq-dynamics-of-Lt"><span class="math display">\[
\begin{align*}
dL_t = \phi_t L_t dW^{\mathbb{P}}_t
\end{align*}
\tag{1}\]</span></span></p>
<p><span id="eq-initial-condition"><span class="math display">\[
\begin{align*}
L_0 = 1
\end{align*}
\tag{2}\]</span></span></p>
<p>that is:</p>
<p><span id="eq-likelihood-process"><span class="math display">\[
\begin{align*}
L_t = \exp\left(\int_0^t \phi_s dW^{\mathbb{P}}_s - \int_0^t \phi^2_s ds\right)
\end{align*}
\tag{3}\]</span></span></p>
<p>Assume that:</p>
<p><span id="eq-expectation-of-likelihood-process"><span class="math display">\[
\begin{align*}
\mathbb{E}^{\mathbb{P}}[L_T] = 1
\end{align*}
\tag{4}\]</span></span></p>
<p>and define the new probability measure <span class="math inline">\(\mathbb{Q}\)</span> on <span class="math inline">\(\mathcal{F}_t\)</span> by:</p>
<p><span id="eq-radon-nikodym-derivative"><span class="math display">\[
L_T = \frac{d\mathbb{Q}}{d\mathbb{P}}
\tag{5}\]</span></span></p>
<p>Then,</p>
<p><span id="eq-girsanov-transformation"><span class="math display">\[
dW^{\mathbb{P}}_t = dW^{\mathbb{Q}}_t + \phi_t dt
\tag{6}\]</span></span></p>
<p>where <span class="math inline">\(dW^{\mathbb{Q}}_t\)</span> is a <span class="math inline">\(\mathbb{Q}\)</span>-standard brownian motion.</p>
</div>
<p><em>Proof.</em></p>
<p>Our claim is that, under the <span class="math inline">\(\mathbb{Q}\)</span> measure, the increments <span class="math inline">\((W^{\mathbb{Q}}_t - W^{\mathbb{Q}}_s)\)</span> are normally distributed with mean <span class="math inline">\(0\)</span> and variance <span class="math inline">\((t-s)\)</span>. We start with the special case <span class="math inline">\(s=0\)</span>. Using moment generating functions, it is enough to show that:</p>
<p>It is straightforward to derive <a href="#eq-likelihood-process">Equation&nbsp;3</a> using Ito’s lemma. Let <span class="math inline">\(f(x) = \ln x\)</span>. Then, <span class="math inline">\(f_x = \frac{1}{x}\)</span>, <span class="math inline">\(f_{xx} = -\frac{1}{x^2}\)</span>.</p>
<p><span class="math display">\[
\begin{align*}
d(\ln L_t) &amp;= \frac{1}{L_t}dL_t -\frac{1}{2} \frac{1}{L_t^2}(dL_t)^2 \\
&amp;= \frac{1}{L_t}{\phi_t L_t dW^{\mathbb{P}}_t} - \frac{1}{2L_t^2}\phi_t^2 L_t^2 dt\\
&amp;= \phi_t dW^{\mathbb{P}}_t -\frac{1}{2} \phi_t^2 dt \\
L_t &amp;= \exp\left(\int_0^t \phi_s dW^{\mathbb{P}}_s - \frac{1}{2}\int_0^t \phi_s^2 ds \right)
\end{align*}
\]</span></p>
<p>To prove our main result, we will now use the MGF of the increments. For <span class="math inline">\(n \in \mathbb{N}\)</span> and <span class="math inline">\((t_j,j\leq n)\)</span> a partition of <span class="math inline">\([0,T]\)</span>, with <span class="math inline">\(t_n = T\)</span>, I will show that :</p>
<p><span id="eq-MGF-of-gaussian"><span class="math display">\[
\begin{align*}
\mathbb{E}^{\mathbb{Q}}\left[\exp\left(\sum_{j=0}^{n-1}\lambda_j (W^{\mathbb{Q}}_{t_{j+1}} - W^{\mathbb{Q}}_{t_{j}})\right)\right] = \exp\left[\sum_{j=0}^{n-1}\lambda_j^2(t_{j+1}-t_j)\right]
\end{align*}
\tag{7}\]</span></span></p>
<p>This proves that the increments are the ones of standard brownian motion.</p>
<p>Let <span class="math inline">\((\mathcal{F}_{t_j},j\leq n)\)</span> be the filtrations of the Brownian motion at the time of the partition. The proof is by successively conditioning from <span class="math inline">\(t_{n-1}\)</span> to <span class="math inline">\(t_1\)</span>. We have:</p>
<p><span class="math display">\[
\begin{aligned}
\mathbb{E}^{\mathbb{Q}}\left[\exp\left(\sum _{j=0}^{n-1} \lambda _{j} (W_{t_{j+1}}^{\mathbb{Q}} -W_{t_{j}}^{\mathbb{Q}} )\right)\right] &amp; =\mathbb{E}^{\mathbb{P}}\left[\mathbb{E}^{\mathbb{P}}\left[ L_{t_{n}}\exp\left(\sum _{j=0}^{n-1} \lambda _{j} (W_{t_{j+1}}^{\mathbb{Q}} -W_{t_{j}}^{\mathbb{Q}} )\right) |\mathcal{F}_{t_{n-1}}\right]\right]\\
&amp; =\mathbb{E}^{\mathbb{P}}\left[\sum _{j=0}^{n-2} \lambda _{j} (W_{t_{j+1}}^{\mathbb{Q}} -W_{t_{j}}^{\mathbb{Q}} )\mathbb{E}^{\mathbb{P}}\left[ L_{t_{n}}\exp\left( \lambda _{n-1} (W_{t_{n}}^{\mathbb{Q}} -W_{t_{n-1}}^{\mathbb{Q}} )\right) |\mathcal{F}_{t_{n-1}}\right]\right]\\
&amp; =\mathbb{E}^{\mathbb{P}}\left[\sum _{j=0}^{n-2} \lambda _{j} (W_{t_{j+1}}^{\mathbb{Q}} -W_{t_{j}}^{\mathbb{Q}} )\mathbb{E}^{\mathbb{P}}\left[\exp\left(\int _{t_{n-1}}^{t_{n}} \phi _{s} dW_{s}^{\mathbb{Q}} +\frac{1}{2}\int _{t_{n-1}}^{t_{n}} \phi _{s}^{2} ds\right)\exp\left( \lambda _{n-1}\int _{t_{n-1}}^{t_{n}} dW_{s}^{\mathbb{Q}}\right) |\mathcal{F}_{t_{n-1}}\right]\right]\\
&amp; =\mathbb{E}^{\mathbb{P}}\left[\sum _{j=0}^{n-2} \lambda _{j} (W_{t_{j+1}}^{\mathbb{Q}} -W_{t_{j}}^{\mathbb{Q}} )\mathbb{E}^{\mathbb{P}}\left[\exp\left(\int _{t_{n-1}}^{t_{n}}( \phi _{s} +\lambda _{n-1}) dW_{s}^{\mathbb{Q}} +\frac{1}{2}\int _{t_{n-1}}^{t_{n}} \phi _{s}^{2} ds\right) |\mathcal{F}_{t_{n-1}}\right]\right]\\
&amp; =\mathbb{E}^{\mathbb{P}}\left[\sum _{j=0}^{n-2} \lambda _{j} (W_{t_{j+1}}^{\mathbb{Q}} -W_{t_{j}}^{\mathbb{Q}} )\mathbb{E}^{\mathbb{P}}\left[\exp\left(\int _{t_{n-1}}^{t_{n}}( \phi _{s} +\lambda _{n-1})\left( dW_{s}^{\mathbb{P}} -\theta ds\right) +\frac{1}{2}\int _{t_{n-1}}^{t_{n}} \phi _{s}^{2} ds\right) |\mathcal{F}_{t_{n-1}}\right]\right]\\
&amp; =\mathbb{E}^{\mathbb{P}}\left[\sum _{j=0}^{n-2} \lambda _{j} (W_{t_{j+1}}^{\mathbb{Q}} -W_{t_{j}}^{\mathbb{Q}} )\exp\left(\frac{1}{2}\int _{t_{n-1}}^{t_{n}} \phi _{s}^{2} +\int _{t_{n-1}}^{t_{n}} -\phi _{s}( \phi _{s} +\lambda _{n-1}) ds\right) \ \exp\left(\frac{1}{2}\int _{t_{n-1}}^{t_{n}}( \phi _{s} +\lambda _{n-1})^{2} ds\right)\right]\\
&amp; \left\{\ \int XdW_{s}^{\mathbb{P}} \ \text{ is a }\mathcal{N}^{\mathbb{P}}\left( 0,\int \mathbb{E}\left[ X^{2}\right] ds\right) \ \text{gaussian random variable.}\right\} \ \\
&amp; =\mathbb{E}^{\mathbb{P}}\left[\sum _{j=0}^{n-2} \lambda _{j} (W_{t_{j+1}}^{\mathbb{Q}} -W_{t_{j}}^{\mathbb{Q}} )\exp\left(\int _{t_{n-1}}^{t_{n}}\left( -\frac{1}{2} \phi _{s}^{2} -\lambda _{n-1} \phi _{s} +\frac{1}{2} \phi _{s}^{2} +\lambda _{n-1} \phi _{s} +\lambda _{n-1}^{2}\right) ds\right)\right]\\
&amp; =\mathbb{E}^{\mathbb{P}}\left[\sum _{j=0}^{n-2} \lambda _{j} (W_{t_{j+1}}^{\mathbb{Q}} -W_{t_{j}}^{\mathbb{Q}} )\exp\left( \lambda _{n-1}\int _{t_{n-1}}^{t_{n}} ds\right)\right]\\
&amp; =\exp( \lambda _{n-1}( t_{n} -t_{n-1}) \cdot \mathbb{E}^{\mathbb{P}}\left[\sum _{j=0}^{n-2} \lambda _{j} (W_{t_{j+1}}^{\mathbb{Q}} -W_{t_{j}}^{\mathbb{Q}} )\right]
\end{aligned}
\]</span></p>
<p>Here, I used the fact that <span class="math inline">\(L_{t_{n-1}}\)</span> is <span class="math inline">\(\mathcal{F}_{t_{n-1}}\)</span> measurable. I can now condition on <span class="math inline">\(\mathcal{F}_{t_{n-2}}\)</span> down to <span class="math inline">\(\mathcal{F}_{t_1}\)</span> and proceed as above to obtain the desired result.</p>
<p>The process <span class="math inline">\(\phi_t\)</span> is called the <em>Girsanov kernel</em>.</p>
</section>
<section id="what-is-a-numeraire" class="level2">
<h2 class="anchored" data-anchor-id="what-is-a-numeraire">What is a numeraire?</h2>
<p>As Shreve puts it, <em>a numeraire is the unit of account in which other assets are denominated</em>. In practice, we tend to choose numeraires that simply the payoff expression.</p>
<p>Any strictly positive (<em>non-dividend paying</em>) price process can be chosen as a numeraire. A numeraire must be a tradable asset.</p>
<p>Consider a unit of stock worth <span class="math inline">\(S_t\)</span>. It can be used as numeraire, because the price process <span class="math inline">\(e^{-rt}S_t\)</span> (assume a constant short rate) is a martingale under risk-neutral measure <span class="math inline">\(\mathbb{Q}^M\)</span>. Powers of the stock price <span class="math inline">\(S_t^\alpha\)</span> cannot be used as numeraires, because their discounted values are not martingales under the risk-neutral measure. Clearly, set the short rate <span class="math inline">\(r = 0\)</span>, then <span class="math inline">\(\mathbb{E}^{\mathbb{Q}^M}[S_T^2] \geq (\mathbb{E}^{\mathbb{Q}^M}[S_T])^2 =S_0^2\)</span> by the Jensen’s inequality.</p>
<p>The price-process <span class="math inline">\(V_t\)</span> of a derivative contract that pays <span class="math inline">\(V_T=S_T^2\)</span> is a martingale under <span class="math inline">\(\mathbb{Q}\)</span> and can be used as a numeraire.</p>
<p>Consider the price of a contract that pays a unit sum <span class="math inline">\(1\)</span> at maturity <span class="math inline">\(T\)</span>. This instrument is the zero-coupon bond. Its an observable and tradable asset. Its price process <span class="math inline">\(P(t,T) = \mathbb{E}^{\mathbb{Q}^M}[1/M_T]\)</span> can be used as a numeraire. <span class="math inline">\(\mathbb{Q}^T\)</span> is called the <span class="math inline">\(T\)</span>-forward measure.</p>
</section>
<section id="abstract-bayes-formula" class="level2">
<h2 class="anchored" data-anchor-id="abstract-bayes-formula">Abstract Bayes Formula</h2>
<div id="thm-abstract-bayes-formula" class="theorem">
<p><span class="theorem-title"><strong>Theorem 2 (Abstract Bayes Formula) </strong></span>Let <span class="math inline">\((\Omega,\mathcal{F},\mathbb{P})\)</span> be a probability space and let <span class="math inline">\(\mathbb{Q}\)</span> be any other probability measure on it. By the Radon-Nikodym theorem, <span class="math inline">\(\exists L = \frac{d\mathbb{Q}}{d\mathbb{P}}\)</span>, <span class="math inline">\(L \geq 0\)</span> with <span class="math inline">\(\mathbb{E}^{\mathbb{P}}[L]=1\)</span>. Then we have:</p>
<p><span id="eq-abstract-bayes-formula"><span class="math display">\[
\begin{align*}
\mathbb{E}^{\mathbb{Q}}[X|\mathcal{G}] = \frac{\mathbb{E}^{\mathbb{P}}[LX|\mathcal{G}]}{\mathbb{E}^{\mathbb{P}}[L|\mathcal{G}]}
\end{align*}
\tag{8}\]</span></span></p>
</div>
<p><em>Proof.</em></p>
<p>By the definition of conditional expectations, recall that if <span class="math inline">\(W\)</span> is any <span class="math inline">\(\mathcal{G}\)</span>-measurable random variable, then the conditional expectation must satisfy the relationship:</p>
<p><span class="math display">\[
\mathbb{E}[WX] = \mathbb{E}[W\mathbb{E}[X|\mathcal{G}]]
\]</span></p>
<p>It is sufficient to prove that:</p>
<p><span class="math display">\[
\mathbb{E}^{\mathbb{P}}[X|\mathcal{G}]\mathbb{E}^{\mathbb{Q}}[L|\mathcal{G}] = \mathbb{E}^{\mathbb{P}}[LX|\mathcal{G}]
\]</span></p>
<p>Let <span class="math inline">\(G\)</span> be an arbitrary set in <span class="math inline">\(\mathcal{G}\)</span>. We have:</p>
<p><span class="math display">\[
\begin{align*}
&amp; \int_G \mathbb{E}^{\mathbb{Q}}[X|\mathcal{G}]\mathbb{E}^{\mathbb{P}}[L|\mathcal{G}] d\mathbb{P} \\
&amp;= \int_G \mathbb{E}^{\mathbb{P}}[L\cdot \mathbb{E}^{\mathbb{Q}}[X|\mathcal{G}]|\mathcal{G}] d\mathbb{P} \\
&amp; \quad \{ \mathbb{E}^{\mathbb{Q}}[X|\mathcal{G}] \text{ is }\mathcal{G}\text{-measurable } \}\\
&amp;= \int_G  L\cdot \mathbb{E}^{\mathbb{Q}}[X|\mathcal{G}] d\mathbb{P}\\
&amp;= \int_G  \frac{d\mathbb{Q}}{d\mathbb{P}}\cdot \mathbb{E}^{\mathbb{Q}}[X|\mathcal{G}] d\mathbb{P}\\
&amp;= \int_G \mathbb{E}^{\mathbb{Q}}[X|\mathcal{G}] d\mathbb{Q}\\
&amp;= \int_G X d\mathbb{Q}
\end{align*}
\]</span></p>
<p>Also, we have:</p>
<p><span class="math display">\[
\begin{align*}
\int_{G} \mathbb{E}^{\mathbb{P}}[LX|\mathcal{G}]d\mathbb{P} &amp;= \int_G LX d\mathbb{P}\\
&amp;= \int_G \frac{d\mathbb{Q}}{d\mathbb{P}} X d\mathbb{P}\\
&amp;= \int_G X d\mathbb{Q}
\end{align*}
\]</span></p>
<p>Hence, proved.</p>
<p>Note that, the filtration <span class="math inline">\(\mathcal{G}\)</span> is the same irrespective of what probability measure we construct on <span class="math inline">\(\Omega\)</span>.</p>
</section>
<section id="martingale-property" class="level2">
<h2 class="anchored" data-anchor-id="martingale-property">Martingale property</h2>
<div id="prp-martingale-property" class="theorem proposition">
<p><span class="theorem-title"><strong>Proposition 1 </strong></span>Assume that there exists a numeraire <span class="math inline">\(M\)</span> and a probability measure <span class="math inline">\(\mathbb{Q}^M\)</span>, such that the price of any traded asset <span class="math inline">\(X\)</span> (without intermediate payments) relative to <span class="math inline">\(M\)</span> is a martingale under <span class="math inline">\(\mathbb{Q}^M\)</span>.That is:</p>
<p><span class="math display">\[
\frac{X_t}{M_t} = \mathbb{E}^{\mathbb{Q}^M} \left\{\frac{X_T}{M_T}|\mathcal{F}_t\right\}
\]</span></p>
<p>Let <span class="math inline">\(N_t\)</span> be an arbitrary numeraire. Then, there exists a probability measure <span class="math inline">\(\mathbb{Q}^N\)</span> such that the price of <span class="math inline">\(X\)</span> normalized by <span class="math inline">\(N\)</span> is a martingale under <span class="math inline">\(\mathbb{Q}^N\)</span>.</p>
<p><span class="math display">\[
\frac{X_t}{N_t} = \mathbb{E}^{\mathbb{Q}^N} \left\{\frac{X_T}{N_T}|\mathcal{F}_t\right\}
\]</span></p>
<p>Moreover, the Radon-Nikodym derivative defining the measure <span class="math inline">\(\mathbb{Q}^N\)</span> is given by:</p>
<p><span class="math display">\[
\frac{d\mathbb{Q}^N}{d\mathbb{Q}^M} = \frac{N_T/N_0}{M_T/M_0}
\]</span></p>
</div>
<p><em>Proof.</em></p>
<p>We have:</p>
<p><span class="math display">\[
X_0 = M_0 \mathbb{E}^{\mathbb{Q}^M}\left[\frac{X_T}{M_T}\right]
\]</span></p>
<p>Imposing the simple fact that, the price of the derivative contract should be the same, even if we switch numeraires from <span class="math inline">\(M\)</span> to <span class="math inline">\(N\)</span>, we should have:</p>
<p><span class="math display">\[
X_0 = N_0 \mathbb{E}^{\mathbb{Q}^N}\left[\frac{X_T}{N_T}\right]
\]</span></p>
<p>Thus,</p>
<p><span class="math display">\[
\begin{aligned}
N_{0}\mathbb{E}^{\mathbb{Q}^{N}}\left[\frac{X_{T}}{N_{T}}\right] &amp; =M_{0}\mathbb{E}^{\mathbb{Q}^{M}}\left[\frac{X_{T}}{M_{T}}\right]\\
\frac{N_{T}}{N_{0}} \times N_{0}\mathbb{E}^{\mathbb{Q}^{N}}\left[\frac{X_{T}}{N_{T}}\right] &amp; =\frac{N_{T}}{N_{0}} \times M_{0} \ \mathbb{E}^{\mathbb{Q}^{M}}\left[\frac{X_{T}}{M_{T}}\right] \quad \left\{\text{Multiplying both sides by }\frac{N_{T}}{N_{0}}\right\}\\
\Longrightarrow \mathbb{E}^{\mathbb{Q}^{N}}[ X_{T}] &amp; =\mathbb{E}^{\mathbb{Q}^{M}}\left[\frac{N_{T} /N_{0}}{M_{T} /M_{0}} X_{T}\right]
\end{aligned}
\]</span></p>
<p>But, we know that:</p>
<p><span class="math display">\[
\mathbb{E}^{\mathbb{Q}^N}[X_T] = \mathbb{E}^{\mathbb{Q}^M}\left[\frac{d\mathbb{Q}^N}{d\mathbb{Q}^M}X_T\right]
\]</span></p>
<p>Consequently, our candidate for the Radon-Nikodym derivative should be:</p>
<p><span class="math display">\[
L_T = \frac{d\mathbb{Q}^N}{d\mathbb{Q}^M} = \frac{N_T/N_0}{M_T/M_0}
\]</span></p>
<p>Further <span class="math inline">\((X_t/N_t)\)</span> is a martingale under <span class="math inline">\(\mathbb{Q}^N\)</span>. Its easy to see that:</p>
<p><span class="math display">\[
\begin{aligned}
\mathbb{E}^{\mathbb{Q}^{N}}\left[\frac{X_{T}}{N_{T}} |\mathcal{F}_{t}\right] &amp; =\frac{\mathbb{E}^{\mathbb{Q}^{M}}\left[ L_{T} \cdot \frac{X_{T}}{N_{T}} |\mathcal{F}_{t}\right]}{\mathbb{E}^{\mathbb{Q}^{M}}[ L_{T} |\mathcal{F}_{t}]} \quad \left\{\text{ Abstract bayes formula }\right\}\\
&amp; =\frac{\mathbb{E}^{\mathbb{Q}^{M}}\left[ L_{T} \cdot \frac{X_{T}}{N_{T}} |\mathcal{F}_{t}\right]}{L_{t}}\\
&amp; =\frac{\mathbb{E}^{\mathbb{Q}^{M}}\left[\frac{N_{T}}{N_{0}} \cdot \frac{M_{0}}{M_{T}} \cdot \frac{X_{T}}{N_{T}} |\mathcal{F}_{t}\right]}{\frac{N_{t}}{N_{0}} \cdot \frac{M_{0}}{M_{t}}}\\
&amp; =\frac{\mathbb{E}^{\mathbb{Q}^{M}}\left[\frac{N_{T}}{N_{0}} \cdot \frac{M_{0}}{M_{T}} \cdot \frac{X_{T}}{N_{T}} |\mathcal{F}_{t}\right]}{\frac{N_{t}}{N_{0}} \cdot \frac{M_{0}}{M_{t}}}\\
&amp; =\frac{M_{t}}{N_{t}} \cdot \mathbb{E}^{\mathbb{Q}^{M}}\left[\frac{X_{T}}{M_{T}}\right]\\
&amp; =\frac{M_{t}}{N_{t}} \cdot \frac{X_{t}}{M_{t}}\\
&amp; =\frac{X_{t}}{N_{t}}
\end{aligned}
\]</span></p>
<p>Since we determined the relevant likelihood process, it is easy to find the Girsanov Kernel.</p>
</section>
<section id="drift-transformation-under-change-of-numeraire" class="level2">
<h2 class="anchored" data-anchor-id="drift-transformation-under-change-of-numeraire">Drift transformation under change of numeraire</h2>
<p>Suppose we are interested in the dynamics of the stochastic process <span class="math inline">\((X_t,t\geq 0)\)</span>. Under <span class="math inline">\(\mathbb{Q}^M\)</span> measure, its dynamics reads:</p>
<p><span id="eq-p-dynamics-of-x"><span class="math display">\[
\begin{aligned}
dX(t) = \mu_X^{\mathbb{Q}^M}(t) dt + c_X(t)dW^{\mathbb{Q}^M}_t
\end{aligned}
\tag{9}\]</span></span></p>
<p>I supressed <span class="math inline">\(\mu_X^{\mathbb{Q}^M}(t,X_t)\)</span> as <span class="math inline">\(\mu_X^{\mathbb{Q}^M}(t)\)</span> for brevity.</p>
<p>Under the <span class="math inline">\(\mathbb{Q}^N\)</span> measure, its dynamics reads:</p>
<p><span id="eq-q-dynamics-of-x"><span class="math display">\[
\begin{aligned}
dX(t) = \mu_X^{\mathbb{Q}^N}(t) dt + c_X(t)dW^{\mathbb{Q}^N}_t
\end{aligned}
\tag{10}\]</span></span></p>
<p>Remember that the diffusion coefficients in these equations are unaffected by the change of measure! We assume that <span class="math inline">\(\mathbb{Q}^M\)</span> is associated with the numeraire <span class="math inline">\(M(t)\)</span> whose dynamics is given by:</p>
<p><span class="math display">\[
dM(t) = \mu_M(t)dt + c_M(t)dW^{\mathbb{Q}^M}
\]</span></p>
<p>and that the numeraire <span class="math inline">\(N\)</span> has <span class="math inline">\(\mathbb{Q}^M\)</span> dynamics:</p>
<p><span class="math display">\[
dN(t) = \mu_N(t)dt + c_N(t)dW^{\mathbb{Q}^N}
\]</span></p>
<p>According to the Girsanov theorem, the likelihood process <span class="math inline">\(L(t)\)</span> accompanying this change of measure is a martingale under the measure <span class="math inline">\(\mathbb{Q}^M\)</span> measure and satisfies the stochastic differential equation:</p>
<p><span class="math display">\[
dL_t = L(t)\theta(t)dW^{\mathbb{Q}^M}_t
\]</span></p>
<p>Explicitly, the likelihood process <span class="math inline">\(L(t)\)</span> is given by the stochastic exponential of the martingale <span class="math inline">\(\int_0^t \theta_s dW^{\mathbb{Q}^M}_s\)</span>:</p>
<p><span class="math display">\[
L(t) = \exp\left(\int_0^t \theta_s dW^{\mathbb{Q}^M}_s - \frac{1}{2}\int_0^t \theta^2_s ds \right)
\]</span></p>
<p>On the other hand, from <a href="#prp-martingale-property">Proposition&nbsp;1</a>, we have:</p>
<p><span class="math display">\[
L_t = \frac{N_t / N_0}{M_t / M_0}
\]</span></p>
<p>Differentiating using Ito’s lemma, we have:</p>
<p><span class="math display">\[
\begin{aligned}
dL_{t} &amp; =\frac{M_{0}}{N_{0}} d\left(\frac{N_{t}}{M_{t}}\right)\\
&amp; =\frac{M_{0}}{N_{0}}\left( -\frac{N_{t}}{M_{t}^{2}} dM_{t} +\frac{1}{M_{t}} dN_{t} +\frac{1}{2} \cdot \frac{2N_{t}}{M_{t}^{3}}( dM_{t})^{2} -\frac{1}{M_{t}^{2}}( dM_{t} \cdot dN_{t})\right)\\
&amp;  \begin{array}{l}
=\frac{M_{0}}{N_{0}}( -\frac{N_{t}}{M_{t}^{2}}\left( \mu _{M}( t) dt+c_{M}( t) dW_{t}^{\mathbb{Q}^{M}}\right) +\frac{1}{M_{t}}\left( \mu _{N}( t) dt+c_{N}( t) dW_{t}^{\mathbb{Q}^{M}}\right)\\
+\frac{N_{t}}{M_{t}^{3}} c_{M}^{2}( t) dt-\frac{1}{M_{t}^{2}} c_{M}( t) c_{N}( t) dt
\end{array}
\end{aligned}
\]</span></p>
<p>But since <span class="math inline">\(L_t\)</span> is driftless, we can ignore the <span class="math inline">\(dt\)</span> terms (whatever they are, they are bound to cancel out) and only look at the diffusion coefficient. So, we can write:</p>
<p><span class="math display">\[
\begin{aligned}
dL_{t} &amp; =\frac{M_{0}}{N_{0}}\left( -\frac{N_{t}}{M_{t}^{2}} c_{M}( t) +\frac{1}{M_{t}} c_{N}( t)\right) dW{_{t}^{\mathbb{Q}}}^{M}\\
&amp; =\frac{N_{t} /N_{0}}{M_{t} /M_{0}}\left(\frac{c_{N}( t)}{N_{t}} -\frac{c_{M}( t)}{M_{t}}\right) dW{_{t}^{\mathbb{Q}}}^{M}\\
&amp; =L_{t}\left(\frac{c_{N}( t)}{N_{t}} -\frac{c_{M}( t)}{M_{t}}\right) dW{_{t}^{\mathbb{Q}}}^{M}
\end{aligned}
\]</span></p>
<p>Comparing this, we can infer that:</p>
<p><span class="math display">\[
\theta_t = \frac{c_N(t)}{N_t} - \frac{c_M(t)}{M_t}
\]</span></p>
<p>Since we can write:</p>
<p><span id="eq-p-and-q-dynamics"><span class="math display">\[
\begin{align*}
dX_t = \mu^{\mathbb{P}}_X(t) dt + c_X(t)dW^{\mathbb{P}}(t) &amp;= \mu^{\mathbb{Q}}_X(t) + c_X(t)dW^{\mathbb{Q}}(t)\\
dW^{\mathbb{P}}(t) &amp;= \frac{\mu^{\mathbb{Q}}_X(t) - \mu^{\mathbb{P}}_X(t)}{c_X(t)} + dW^{\mathbb{Q}}(t)
\end{align*}
\tag{11}\]</span></span></p>
<p>Using <a href="#eq-p-and-q-dynamics">Equation&nbsp;11</a>, we conclude that the change of drift accompanying a change of numeraire is given by:</p>
<p><span id="eq-change-of-drift-accompanying-change-of-numeraire"><span class="math display">\[
\begin{align*}
\mu_X^{\mathbb{Q}}(t) - \mu_X^{\mathbb{P}}(t) = c_X(t)\left(\frac{c_M(t)}{M(t)} - \frac{c_N(t)}{N(t)}\right)
\end{align*}
\tag{12}\]</span></span></p>
</section>
<section id="examples-of-numeraires" class="level2">
<h2 class="anchored" data-anchor-id="examples-of-numeraires">Examples of numeraires</h2>
<p>The basic component of an interest rate model is an instantaneous forward rate process <span class="math inline">\(f(t,s)\)</span>. Its value is the future instantaneous interest rate at a future time <span class="math inline">\(s\)</span>, that is the rate for the infinitesimally short term <span class="math inline">\([s,s+ds]\)</span> observed at time <span class="math inline">\(t \leq s\)</span>.</p>
<p>A <em>zero-coupon bond</em> settling at time <span class="math inline">\(T_0\)</span> and maturing at time <span class="math inline">\(T &gt; T_0\)</span> is the process:</p>
<p><span class="math display">\[
P(t,T_0,T) = \exp\left(-\int_{T_0}^Tf(t,s)ds\right)
\]</span></p>
<p>for <span class="math inline">\(t \leq T_0\)</span>. In other words, it is the time <span class="math inline">\(T_0\)</span> value of 1<span class="math inline">\(\$\)</span> (without the risk of default) at <span class="math inline">\(T\)</span>, as observed at time <span class="math inline">\(t \leq T_0\)</span>. Its current value is given by:</p>
<section id="bank-account-numeraire" class="level3">
<h3 class="anchored" data-anchor-id="bank-account-numeraire">Bank-account numeraire</h3>
<p>The bank-account(money-market account) numeraire is simply the value of <span class="math inline">\(1\$\)</span> deposited in a bank and accruing the (credit-riskless) instantaneous interest rate. In reality, the bank credits interest to the account daily, but this can very well be approximated to a continous process. The associated stochastic price process <span class="math inline">\(M(t)\)</span> is given by:</p>
<p><span class="math display">\[
\begin{align*}
M(t) = \exp(\int_0^t r(s)ds)
\end{align*}
\]</span></p>
<p>Here, the spot rate <span class="math inline">\(r(t)\)</span> is the instantaneous forward observed at the time it settles. That is,</p>
<p><span class="math display">\[
r(t) = f(t,t)
\]</span></p>
</section>
<section id="forward-numeraire" class="level3">
<h3 class="anchored" data-anchor-id="forward-numeraire">Forward numeraire</h3>
<p>A zero-coupon bond(ZCB) is a simple contract with unit payoff <span class="math inline">\(1\$\)</span> at maturity <span class="math inline">\(T\)</span>. By the risk-neutral valuation formula:</p>
<p><span class="math display">\[
P(t,t,T) = V(t) = M(t) \mathbb{E}^{\mathbb{Q}^M}\left[\frac{1}{M(T)}\right]
\]</span></p>
<p>So, a <span class="math inline">\(T\)</span>-maturity ZCB is a tradable asset and its price <span class="math inline">\(P(t,T)\)</span> can be used as a numeraire. The associated measure is called the <span class="math inline">\(T\)</span>-foward measure <span class="math inline">\(\mathbb{Q}^T\)</span>.</p>
<p>The term(e.g.&nbsp;3 months) forward rates for settlement at <span class="math inline">\(T_0\)</span> and maturity at <span class="math inline">\(T\)</span> are defined by the equation:</p>
<p><span class="math display">\[
\begin{align*}
P(t,T_0,T) = \frac{1}{1 + \delta F(t,T_0,T)}
\end{align*}
\]</span></p>
<p>where <span class="math inline">\(\delta\)</span> is the day-count fraction for the period <span class="math inline">\([T_0,T]\)</span>. Re-arranging, we have:</p>
<p><span class="math display">\[
\begin{align*}
F(t,T_0,T) &amp;= \frac{1}{\delta}\frac{P(t,T,T) - P(t,T_0, T)}{P(t,T_0,T)}
F(t,T_0,T)P(t,T_0,T) &amp;= \frac{1}{\delta}(P(t,T,T) - P(t,T_0,T))
\end{align*}
\]</span></p>
<p>Clearly, it is a multiple of a difference <span class="math inline">\(P(t,T,T)\)</span> and <span class="math inline">\(P(t,T_0,T)\)</span> normalized by <span class="math inline">\(T\)</span>-maturity zero coupon bond price <span class="math inline">\(P(t,T_0,T)\)</span>. So, the forward iBOR-rate must be a martingale under the <span class="math inline">\(T\)</span>-forward measure <span class="math inline">\(Q^T\)</span>.</p>
<div id="prp-forward-rates-are-martingales-under-forward-measure" class="theorem proposition">
<p><span class="theorem-title"><strong>Proposition 2 (Forward rates are <span class="math inline">\(\mathbb{Q}^T\)</span> expectations of future spot rates.) </strong></span>Any simply compounded forward rate spanning a time interval ending in <span class="math inline">\(T\)</span> is a martingale under the <span class="math inline">\(T\)</span>-forward measure.</p>
<p><span class="math display">\[
\mathbb{E}^{\mathbb{Q}^T}[F(t;S,T)|\mathcal{F}_u] = F(u;S,T)
\]</span></p>
<p>for each <span class="math inline">\(0 \leq u \leq t \leq S &lt; T\)</span>. In particular, the forward rate spanning the interval <span class="math inline">\([S,T]\)</span> is the <span class="math inline">\(\mathbb{Q}^T\)</span> expectation of the future simply-compounded spot rate at time <span class="math inline">\(S\)</span> for the maturity T.</p>
<p><span id="eq-forward-rate-is-the-QT-expectation-of-future-spot-rate"><span class="math display">\[
\mathbb{E}^{\mathbb{Q}^T}[L(S,T)|\mathcal{F}_t] = F(t;S,T)
\tag{13}\]</span></span></p>
</div>
<div id="expected-value-of-any-future-instantaneous-rates">
<p>The expected value of any future instantaneous spot interest rate, under the corresponding forward measure, is equal to the related instantaneuous forward rate. That is, <span class="math display">\[
\begin{align*}
\mathbb{E}^T{r_T|\mathcal{F}_t} = f(t,T)
\end{align*}
\]</span></p>
<p>for each <span class="math inline">\(0 \leq t \leq T\)</span>.</p>
</div>
<p><em>Proof.</em></p>
<p>We have:</p>
<p><span class="math display">\[
\begin{align*}
\mathbb{E}^{\mathbb{Q}^T} [r_T|\mathcal{F}_t] &amp;= \frac{1}{P(t,T)}\mathbb{E}\left[r_TP(t,T)|\mathcal{F}_t\right]\\
&amp;= - \frac{1}{P(t,T)}\mathbb{E}\left[r_Te^{-\int_t^T r(s)ds}|\mathcal{F}_t\right]\\
&amp;= - \frac{1}{P(t,T)}\mathbb{E}\left[\frac{\partial}{\partial T}e^{-\int_t^T r(s)ds}|\mathcal{F}_t\right]\\
&amp;= - \frac{1}{P(t,T)}\frac{\partial}{\partial T}\mathbb{E}\left[e^{-\int_t^T r(s)ds}|\mathcal{F}_t\right]\\
&amp;= - \frac{1}{P(t,T)}\frac{\partial}{\partial T}P(t,T)\\
&amp;= f(t,T)
\end{align*}
\]</span></p>
</section>
<section id="pricing-an-irs" class="level3">
<h3 class="anchored" data-anchor-id="pricing-an-irs">Pricing an IRS</h3>
<p>Consider a forward starting interest rate swap(IRS) which settles in <span class="math inline">\(T_0\)</span> and matures in <span class="math inline">\(T_N\)</span> years from now. An IRS is a transaction between two counterparties who exchange interest rate payments on an agreed notional principal.</p>
<p>On a vanilla swap, a fixed-coupon interest payments are exchanged for floating rate payments. For the sake of simplicity, we assume that the payment dates on the fixed and floating leg of the swap are the same, and that the floating rate is the same as the discounting rate. The former of these assumptions is a minor simplification, made to lighten up the notation only. The latter is an important simplification, as the basis between the floating rate and the discounting rate may exhibit a complex dynamics.</p>
<p>Let <span class="math inline">\(S\)</span> be the fixed-rate on the swap. By the risk-neutral valuation formula, the fixed leg value at time <span class="math inline">\(t\)</span> can be expressed as:</p>
<p><span class="math display">\[
\begin{align*}
V_{fixed}(t) &amp;=   N \cdot \sum_{i=1}^N \mathbb{E}^{\mathbb{Q^M}}[e^{-r(T_i-t)}S \tau(T_{i-1},T_i)|\mathcal{F}_t]\\
&amp;=S \cdot N \cdot \sum_{i=1}^N \mathbb{E}^{\mathbb{Q}}[e^{-r(T_i-t)}\tau(T_{i-1},T_i)|\mathcal{F}_t]\\
&amp;=S \cdot N \cdot \left(\sum_{i=1}^N P(t,T_i)\tau(T_{i-1},T_i)\right)
\end{align*}
\]</span></p>
<p>The floating leg can be written as:</p>
<p><span class="math display">\[
\begin{align*}
V_{float}(t) &amp; = N \cdot \sum_{i=1}^N P(t,T_i)\mathbb{E}^{T_i}\left[L(T,T_{i-1}, T_i)|\mathcal{F}_t\right]\tau(T_{i-1},T_i)\\
&amp;=  N \cdot \sum_{i=1}^N P(t,T_i)L(t,T_{i-1}, T_i)\tau(T_{i-1},T_i)\\
&amp;= N \cdot \sum_{i=1}^N P(t,T_i)\frac{1}{\tau(T_{i-1},T_i)}\cdot\left(\frac{P(t,T_{i-1})}{P(t,T_{i})}-1\right)\tau(T_{i-1},T_i)\\
&amp;= N \cdot \sum_{i=1}^N (P(t,T_i) - P(t,T_{i-1}))\\
&amp;= -N P(t,T_0) + NP(t,T_N)
\end{align*}
\]</span></p>
<p>where the expectations are under the <span class="math inline">\(T_i\)</span>-forward measure. Note that, I used the fact that the iBOR-rates are martingales under the forward measure.</p>
<p>The par-swap rate <span class="math inline">\(S\)</span> is the fixed-rate which renders the value of the swap zero at the contract start date <span class="math inline">\(t\)</span>.</p>
<p><span class="math display">\[
\begin{align*}
-V_{fix} + V_{floating} &amp;= 0\\
S \cdot N \cdot \left(\sum_{i=1}^N P(t,T_i)\tau(T_{i-1},T_i)\right) &amp;= -N P(t,T_0) + NP(t,T_N) \\
S(t,T_{0:N}) &amp;= \frac{- P(t,T_0) + P(t,T_N)}{\left(\sum_{i=1}^N P(t,T_i)\tau(T_{i-1},T_i)\right)}
\end{align*}
\]</span></p>
</section>
<section id="the-annuity-measure" class="level3">
<h3 class="anchored" data-anchor-id="the-annuity-measure">The Annuity Measure</h3>
<p>The annuity is an asset that pays <span class="math inline">\(1\$\)</span> on each coupon payment day of the swap, accrued according to the swap’s day count convention.</p>
<p><span class="math display">\[
A(t,T_{0:N}) = \left( \sum_{i=1}^N P(t,T_i)\tau(T_{i-1},T_i) \right)
\]</span></p>
<p>Since, it is a portfolio of zero coupon bonds, it is a tradable asset and its price <span class="math inline">\(A(t,T_{0:N})\)</span> can be used as numeraire. This is called the <em>Annuity numeraire</em> and the measure <span class="math inline">\(\mathbb{Q}^{T_{0:N}}\)</span> associated with this numeraire is called the (forward) swap measure. The annuity numeraire arises as the natural numeraire when valuing swaptions. It is the mechanism that allows us to link the swaption as an option on a swap to the option on the corresponding swap rate.</p>
<p>The forward swap rate <span class="math inline">\(S(t,T_{0:N})\)</span> is a martingale in the annuity measure <span class="math inline">\(\mathbb{Q}^{T_{0:N}}\)</span>.</p>
</section>
</section>
<section id="pricing-the-payoff-vt-s_ts_t---k" class="level2">
<h2 class="anchored" data-anchor-id="pricing-the-payoff-vt-s_ts_t---k">Pricing the payoff <span class="math inline">\(V(T) = [S_T(S_T - K)]^{+}\)</span></h2>
<p>Sell-side quant interviews are known to ask puzzles to price tricky payoffs like the power option <span class="math inline">\(V_T=(S_T^2 - K)1_{S_T &gt; K}\)</span>, exchange options <span class="math inline">\(V_T = (S_2(T) - S_1(T))^{+}\)</span> and quantos.</p>
<p>Change of numeraire and measure transformation provide an elegant way to price these payoffs quickly.</p>
<p>Suppose, we want to price the following payoff:</p>
<p><span class="math display">\[
V(T) = \max( S(T)(S(T) - K), 0 )
\]</span></p>
<p>By the risk-neutral pricing formula,</p>
<p><span class="math display">\[
V(t) = M(t) \mathbf{E}^{Q}\left[\frac{S(T)}{M(T)}(S(T) - K)1_{S_T &gt; K}|\mathcal{F}_t\right]
\]</span></p>
<p>The Radon-Nikodym derivative <span class="math inline">\(\frac{dQ}{dQ^S}\)</span> is given by:</p>
<p><span class="math display">\[
L(t) = \frac{dQ}{dQ^S} = \frac{M(T)/M(t)}{S(T)/S(t)} = \frac{M(T)}{S(T)}\cdot \frac{S(t)}{M(t)}
\]</span></p>
<p>Consequently, we can write:</p>
<p><span id="eq-expectation-under-stock-measure"><span class="math display">\[
\begin{align*}
V(t) &amp;= M(t) \mathbf{E}^{Q^S}\left[\frac{dQ}{dQ^S}\cdot\frac{S(T)}{M(T)}(S(T) - K)1_{S_T &gt; K}|\mathcal{F}_t\right]\\
&amp;= M(t) \mathbf{E}^{Q^S}\left[\frac{M(T)}{S(T)}\cdot \frac{S(t)}{M(t)}\cdot\frac{S(T)}{M(T)}(S(T) - K)1_{S_T &gt; K}|\mathcal{F}_t\right]\\
&amp;= \mathbf{E}^{Q^S}\left[S(t)(S(T) - K)1_{S_T &gt; K}|\mathcal{F}_t\right]\\
&amp;= S(t)\mathbf{E}^{Q^S}\left[(S(T) - K)1_{S_T &gt; K}|\mathcal{F}_t\right]
\end{align*}
\tag{14}\]</span></span></p>
<p>This looks much like the familiar European vanilla call option payoff, except that, the conditional expectation needs to be taken under the probability measure induced by the stock numeraire <span class="math inline">\((S,Q^S)\)</span>.</p>
<p>To find the dynamics of the stock price <span class="math inline">\(S(t)\)</span> under the probability measure <span class="math inline">\(Q^S\)</span>, we use the intuitive fact, that, all normalized asset prices - the asset price <span class="math inline">\(X(t)\)</span> deflated by the numeraire price <span class="math inline">\(S(t)\)</span>, <span class="math inline">\(\frac{X(t)}{S(t)}\)</span> must be martingales under <span class="math inline">\(Q^S\)</span>. Thus, the price process <span class="math inline">\(M(t)/S(t)\)</span> must be a martingale.</p>
<p>Let’s find the dynamics of the process <span class="math inline">\(\left(\frac{M(t)}{S(t)}\right)\)</span>.</p>
<p>Consider <span class="math inline">\(f(x,y) = \frac{x}{y}\)</span>. We have:</p>
<p><span class="math display">\[
\begin{align*}
f_x = \frac{1}{y}, \quad f_y = -\frac{x}{y^2}\\
f_{xx} = 0, \quad f_{xy} = -\frac{1}{y^2}, f_{yy} = \frac{2x}{y^3}
\end{align*}
\]</span></p>
<p>We have:</p>
<p><span class="math display">\[
\begin{aligned}
d\left(\frac{M_{t}}{S_{t}}\right) &amp; =\frac{1}{S_{t}} dM( t) -\frac{M_{t}}{S_{t}^{2}} dS( t)\\
&amp; -\frac{1}{S_{t}^{2}} dM( t) \cdotp dS( t) +\frac{1}{2} \cdot \frac{2M_{t}}{S_{t}^{3}}( dS_{t})^{2}\\
&amp; =\frac{1}{S_{t}} rM( t) dt-\frac{M_{t}}{S_{t}^{2}}\left( rdt+\sigma dW^{\boxed{Q}}( t)\right)\\
&amp; +\frac{M_{t}}{S_{t}^{3}} \sigma ^{2} S_{t}^{2} dt\\
&amp; =\left(\frac{M_{t}}{S_{t}}\right)\left( rdt-rdt-\sigma dW^{\boxed{Q}}( t) +\sigma ^{2} dt\right)\\
&amp; =-\sigma \left(\frac{M_{t}}{S_{t}}\right)\left( -\sigma dt+dW^{\boxed{Q}}( t)\right)
\end{aligned}
\]</span></p>
<p>But, we know that the process <span class="math inline">\((M_t/S_t)\)</span> is a <span class="math inline">\(Q^S\)</span>-martingale and should be driftless. Thus, we should have:</p>
<p><span class="math display">\[
d\left(\frac{M_t}{S_t}\right) = -\sigma \left(\frac{M_{t}}{S_{t}}\right)(0 \cdot dt + dW^{\boxed{Q^S}}( t))
\]</span></p>
<p>So, we perform the measure transformation:</p>
<p><span id="eq-measure-transformation"><span class="math display">\[
dW^{\boxed{Q^S}}(t) = -\sigma dt+dW^{\boxed{Q}}(t)
\tag{15}\]</span></span></p>
<p>Consequently, <span class="math inline">\(Q^S\)</span>-dynamics of the asset <span class="math inline">\(S(t)\)</span> can be expressed as:</p>
<p><span class="math display">\[
\begin{align*}
dS(t) &amp;= rSdt + \sigma S dW^{\boxed{Q}}(t)\\
&amp;=rSdt + \sigma S (dW^{\boxed{Q^S}}(t) + \sigma dt)\\
&amp;=(r+\sigma^2)Sdt + \sigma S dW^{\boxed{Q^S}}(t)
\end{align*}
\]</span></p>
<p>So, <span class="math inline">\(S(t)\)</span> is still a lognormal random variable and evolves according to:</p>
<p><span id="eq-dynamics-of-the-asset-under-stock-measure"><span class="math display">\[
S(T) = S(t)\exp\left[\left(r+\frac{\sigma^2}{2}\right)(T-t) + \sigma (W^{\boxed{Q^S}}(T) - W^{\boxed{Q^S}}(t))\right]
\tag{16}\]</span></span></p>
<p>The price of the option would be given by:</p>
<p><span class="math display">\[
V(t) = S(t)[S(t)\Phi(d_{+}) - K\Phi(d_{-})]
\]</span></p>
<p>where</p>
<p><span class="math display">\[
\begin{align*}
d_{+} &amp;= \frac{\ln\left(\frac{S(t)}{K}\right) + (r + \frac{3\sigma^2}{2})(T-t)}{\sigma\sqrt{T - t}}\\
d_{-} &amp;= \frac{\ln\left(\frac{S(t)}{K}\right) + (r + \frac{\sigma^2}{2})(T-t)}{\sigma\sqrt{T - t}}
\end{align*}
\]</span></p>
</section>
<section id="pricing-the-payoff-vt-s_1t1_s_2t-k" class="level2">
<h2 class="anchored" data-anchor-id="pricing-the-payoff-vt-s_1t1_s_2t-k">Pricing the payoff <span class="math inline">\(V(T) = S_1(T)1_{S_2(T) &gt; K}\)</span></h2>
<p>Suppose the dynamics of two assets <span class="math inline">\(S_1(t)\)</span> and <span class="math inline">\(S_2(t)\)</span> are given by:</p>
<p><span class="math display">\[
\begin{align*}
dS_1(t) &amp;= rS_1(t)dt + \sigma_1 S_1 W_1^{Q}(t) \\
dS_2(t) &amp;= rS_2(t)dt + \sigma_2 S_2 W_2^{Q}(t)
\end{align*}
\]</span></p>
<p>Assume that the two driving brownian motions are correlated and their instantaneous correlation is given by:</p>
<p><span class="math display">\[
dW_1^{Q}(t) dW_2^{Q}(t) = \rho dt
\]</span></p>
<p>By the risk-neutral pricing formula, we have:</p>
<p><span class="math display">\[
V(t) = M(t)\mathbb{E}^{\boxed{Q}}\left[\frac{S_1(T)}{M(T)}1_{S_2(T) &gt; K}\right]
\]</span></p>
<p>By change of numeraire, we have:</p>
<p><span class="math display">\[
\begin{align*}
V(t) &amp;= M(t)\mathbb{E}^{\boxed{Q}}\left[\frac{S_1(T)}{M(T)}1_{S_2(T) &gt; K}\right]\\
&amp;= M(t) \mathbb{E}^{\boxed{Q^{S_1}}}\left[\frac{dQ}{dQ^{S_1}}\cdot \frac{S_1(T)}{M(T)}1_{S_2(T) &gt; K}\right]\\
&amp;= M(t) \mathbb{E}^{\boxed{Q^{S_1}}}\left[\frac{M(T)}{S_1(T)}\cdot \frac{S_1(t)}{M(t)}\cdot \frac{S_1(T)}{M(T)}1_{S_2(T) &gt; K}\right]\\
&amp;= M(t) \mathbb{E}^{\boxed{Q^{S_1}}}\left[\frac{M(T)}{S_1(T)}\cdot \frac{S_1(t)}{M(t)}\cdot \frac{S_1(T)}{M(T)}1_{S_2(T) &gt; K}\right]\\
&amp;=S_1(t)\mathbb{E}^{\boxed{Q^{S_1}}}[1_{S_2(T) &gt; K}]\\
&amp;=S_1(t)Q^{S_1}(S_2(T) &gt; K)
\end{align*}
\]</span></p>
<p>Thus, we need to derive the <span class="math inline">\(Q^{S_1}\)</span>-dynamics of the asset <span class="math inline">\(S_2\)</span>. Under the <span class="math inline">\(Q^{S_1}\)</span>-measure, <span class="math inline">\(\left(\frac{S_2(t)}{S_1(t)}\right)\)</span> must be a martingale.</p>
<p>Let <span class="math inline">\(f(x,y) = \frac{y}{x}\)</span>. We have:</p>
<p><span class="math display">\[
\begin{align*}
f_x = -\frac{y}{x^2}, \quad f_y = \frac{1}{x} \\
f_{xx} = \frac{2y}{x^3}, \quad f_{xy} = -\frac{1}{x^2}, \quad f_{yy} = 0
\end{align*}
\]</span></p>
<p>We have:</p>
<p><span class="math display">\[
\begin{aligned}
d\left(\frac{S_{2}( t)}{S_{1}( t)}\right) &amp; =-\frac{S_{2}}{S_{1}^{2}} dS_{1}( t) +\frac{1}{S_{1}} dS_{2}( t) +\frac{1}{2}\left(\frac{2S_{2}}{S_{1}^{3}}\right)( dS_{1}( t))^{2} -\frac{1}{S_{1}^{2}} dS_{1}( t) \cdot dS_{2}( t)\\
&amp; =-\frac{S_{2}}{S_{1}^{2}}\left( rS_{1}( t) dt+\sigma _{1} S_{1} dW_{1}^{\boxed{Q}}( t)\right) +\frac{1}{S_{1}}\left( rS_{2}( t) dt+\sigma _{2} S_{2} dW_{2}^{\boxed{Q}}( t)\right)\\
&amp; +\frac{S_{2}}{S_{1}^{3}} \sigma _{1}^{2} S_{1}^{2} dt-\frac{1}{S_{1}^{2}} S_{1} S_{2} \sigma _{1} \sigma _{2} \rho dt\\
&amp; =\left(\frac{S_{2}}{S_{1}}\right)\left( -rdt-\sigma _{1} dW_{1}^{\boxed{Q}}( t) +rdt+\sigma _{2} dW_{2}^{\boxed{Q}}( t) +\sigma _{1}^{2} dt-\rho \sigma _{1} \sigma _{2} dt\right)\\
&amp; =\left(\frac{S_{2}}{S_{1}}\right)\left( \sigma _{1}^{2} dt-\rho \sigma _{1} \sigma _{2} dt-\sigma _{1} dW_{1}^{\boxed{Q}}( t) +\sigma _{2} dW_{2}^{\boxed{Q}}( t)\right)\\
&amp; \quad \left\{\text{ Applying the measure transformation } dW_{1}^{\boxed{Q}}( t) =dW_{1}^{\boxed{Q^{S_{1}}}}( t) +\sigma _{1} dt\right\}\\
&amp; =\left(\frac{S_{2}}{S_{1}}\right)\left( \sigma _{1}^{2} dt-\rho \sigma _{1} \sigma _{2} dt-\sigma _{1}\left( dW_{1}^{\boxed{Q^{S_{1}}}}( t) +\sigma _{1} dt\right) +\sigma _{2} dW_{2}^{\boxed{Q}}( t)\right)\\
&amp; =\left(\frac{S_{2}}{S_{1}}\right)\left( -\rho \sigma _{1} \sigma _{2} dt-\sigma _{1} dW_{1}^{\boxed{Q^{S_{1}}}}( t) +\sigma _{2} dW_{2}^{\boxed{Q}}( t)\right)\\
&amp; =\left(\frac{S_{2}}{S_{1}}\right)\left[\left( -\rho \sigma _{1} \sigma _{2} dt+\sigma _{2} dW_{2}^{\boxed{Q}}( t)\right) -\sigma _{1} dW_{1}^{\boxed{Q^{S_{1}}}}( t)\right]\\
&amp; =\sigma _{2}\left(\frac{S_{2}}{S_{1}}\right)\left[\left( -\rho \sigma _{1} dt+dW_{2}^{\boxed{Q}}( t)\right) -\frac{\sigma _{1}}{\sigma _{2}} dW_{1}^{\boxed{Q^{S_{1}}}}( t)\right]
\end{aligned}
\]</span></p>
<p>But, we must have:</p>
<p><span class="math display">\[
d\left(\frac{S_2}{S_1}\right) = \sigma_2 \left(\frac{S_2}{S_1}\right) \left[0 \cdot dt  + dW_{2}^{\boxed{Q^{S_1}}}(t) -\frac{\sigma_{1}}{\sigma _{2}} dW_{1}^{\boxed{Q^{S_{1}}}}( t)\right]
\]</span></p>
<p>This suggests the measure transformation:</p>
<p><span class="math display">\[
dW_2^{\boxed{Q^{S_1}}}(t) =  -\rho \sigma _{1} dt + dW_{2}^{\boxed{Q}}( t)
\]</span></p>
<p>So, finally, the model under the stock measure <span class="math inline">\(Q^{S_1}\)</span> is given by:</p>
<p><span class="math display">\[
\begin{aligned}
dS_1(t) &amp;= (r + \sigma_1^2) S_1 dt + \sigma_1 S_1 dW_1^{\boxed{Q^{S_1}}}(t)\\
dS_2(t) &amp;= (r +\rho \sigma_1) S_2 dt + \sigma_2 S_2 dW_2^{\boxed{Q^{S_1}}}(t)\\
dM(t) &amp;= r M(t) dt
\end{aligned}
\]</span></p>
<p>The evolution of the second asset can be expressed as:</p>
<p><span class="math display">\[
\begin{aligned}
S_2(T) &amp;= S_2(t) \exp\left[\left(r + \rho \sigma_1 - \frac{\sigma_2^2}{2}\right)(T-t) + \sigma_2 (W_2^{\boxed{Q^{S_1}}}(T) - W_2^{\boxed{Q^{S_1}}}(t))\right]
\end{aligned}
\]</span></p>
<p>The option payoff can be simplified as:</p>
<p><span class="math display">\[
\begin{aligned}
V( t) &amp; =S_{1}( t) Q^{\boxed{S_{1}}}[ S_{2}( T)  &gt;K]\\
&amp; =S_{1}( t) Q^{\boxed{S_{1}}}\left[ S_{2}( t)\exp\left\{\left( r+\rho \sigma _{1} -\frac{\sigma _{2}^{2}}{2}\right)( T-t) +\sigma _{2}( W_{2}( T) -W_{2}( t))\right\}  &gt;K\right]\\
&amp; =S_{1}( t) Q^{\boxed{S_{1}}}\left[ S_{2}( t)\exp\left\{\left( r+\rho \sigma _{1} -\frac{\sigma _{2}^{2}}{2}\right)( T-t) -\sigma _{2}\sqrt{T-t} \cdot Z\right\}  &gt;K\right]\\
&amp; =S_{1}( t) Q^{\boxed{S_{1}}}\left[\ln\frac{S_{2}( t)}{K} +\left( r+\rho \sigma _{1} -\frac{\sigma _{2}^{2}}{2}\right)( T-t)  &gt;\sigma _{2}\sqrt{T-t} \cdot Z\right]\\
&amp; =S_{1}( t) Q^{\boxed{S_{1}}}\left[ Z&lt; \frac{\ln\frac{S_{2}( t)}{K} +\left( r+\rho \sigma _{1} -\frac{\sigma _{2}^{2}}{2}\right)( T-t)}{\sigma _{2}\sqrt{T-t}}\right]\\
&amp; =S_{1}( t) \Phi \left[\frac{\ln\frac{S_{2}( t)}{K} +\left( r+\rho \sigma _{1} -\frac{\sigma _{2}^{2}}{2}\right)( T-t)}{\sigma _{2}\sqrt{T-t}}\right]
\end{aligned}
\]</span></p>
</section>
<section id="pricing-an-assymetric-power-option-v_t-frac1k2k3---s_t3" class="level2">
<h2 class="anchored" data-anchor-id="pricing-an-assymetric-power-option-v_t-frac1k2k3---s_t3">Pricing an assymetric power option <span class="math inline">\(V_T = \frac{1}{K^2}(K^3 - S_T^3)^{+}\)</span></h2>


</section>

<div id="quarto-appendix" class="default"><section id="references" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">References</h2><div class="quarto-appendix-contents">

<ul>
<li><em><a href="https://www.researchgate.net/publication/361692645_Girsanov_Numeraires_and_All_That">Girsanov, Numeraires and all that</a>, Andrew Lesniewski.</em></li>
<li><em><a href="https://www.amazon.co.uk/Interest-Rate-Models-Practice-Inflation/dp/3662517434/ref=sr_1_1?crid=1SKFOQ7E4MVVT&amp;dib=eyJ2IjoiMSJ9.sIa_RDjVspfj1fp3RjniAVMu8d7q5jc-2tCJwGcfH95dH0e8LajwYlsYKeqFmBNBrNuluzfxqoDYd0R81JqWowKq0TW4WLFIA3DIhDNVaV4.60e9Igmtf-h5uPKHAhEAv-NX9S1e5zfOFoq3JaOGQQo&amp;dib_tag=se&amp;keywords=brigo+mercurio&amp;qid=1738095976&amp;sprefix=Brigo+and+Mercurio%2Caps%2C62&amp;sr=8-1">Interest-rate Models - Theory and Practice</a>, Damiano Brigo and Fabio Mercurio.</em></li>
</ul>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="quasar-chunawala/quantdev" data-repo-id="R_kgDOL2t5-A" data-category="General" data-category-id="DIC_kwDOL2t5-M4ClndQ" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->



</body></html>