<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Quasar">
<meta name="dcterms.date" content="2025-10-23">

<title>quantdev.blog - AAD(Adjoint Algorithmic Differentiation)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;800&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap')
</style>
<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9993009899870547" crossorigin="anonymous"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">quantdev.blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../sell_side_quant_critical_path.html" rel="" target="">
 <span class="menu-text">Sell-side Quant</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../roadmap.html" rel="" target="">
 <span class="menu-text">C++ Roadmap</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/quasar-chunawala" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="http://linkedin.com/in/quasar-chunawala" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml" rel="" target=""><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">AAD(Adjoint Algorithmic Differentiation)</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">xVA</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Quasar </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 23, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#forward-mode-ad" id="toc-forward-mode-ad" class="nav-link" data-scroll-target="#forward-mode-ad">Forward-mode AD</a></li>
  <li><a href="#naive-implementation-of-forward-ad" id="toc-naive-implementation-of-forward-ad" class="nav-link" data-scroll-target="#naive-implementation-of-forward-ad">Naive implementation of forward-AD</a></li>
  <li><a href="#adjoint-algorithmic-differentiation" id="toc-adjoint-algorithmic-differentiation" class="nav-link" data-scroll-target="#adjoint-algorithmic-differentiation">Adjoint Algorithmic Differentiation</a></li>
  <li><a href="#algorithmic-differentiation-tools" id="toc-algorithmic-differentiation-tools" class="nav-link" data-scroll-target="#algorithmic-differentiation-tools">Algorithmic Differentiation Tools</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>I was skimming through <a href="http://luca-capriotti.net/">Luca Capriotti</a> and Mike Giles’ paper <a href="https://people.maths.ox.ac.uk/~gilesm/files/AAD_Review.pdf">15 Years of Adjoint Algorithmic Differentiation in Finance</a> and wanted to write a toy implementation in Julia. Algorithmic differentiation (AD) is a set of techniques to accurately and efficiently compute derivatives of a function in the form of a computer program. Many of my toy examples are borrowed from the excellent <a href="https://www.amazon.co.uk/Algorithmic-Differentiation-Explained-Financial-Engineering/dp/3319539787/ref=sr_1_1?crid=3ICBI9FQDER6B&amp;dib=eyJ2IjoiMSJ9.OBdGni8_VOEiK_wWQ1g2PA.ChQjNVwVvAHPnbWhiXJDTSw2G9dyuIX9-hsH6BP_ZT4&amp;dib_tag=se&amp;keywords=Algorithmic+Differentiation+in+Finance+Explained&amp;qid=1761218601&amp;sprefix=algorithmic+differentiation+in+finance+explained%2Caps%2C91&amp;sr=8-1">Algorithmic Differentiation in Finance Explained</a>, by Marc Henrard.</p>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>As a quick example, suppose we have the scalar-valued function <span class="math inline">\(f:\mathbb{R}^{p_a} \to \mathbb{R}\)</span>:</p>
<p><span class="math display">\[
y = \cos(x_1 + e^{x_2})(\sin x_3 + \cos x_4) + x_2^{3/2} + x_4
\]</span></p>
<p>The function inputs are a vector <code>a[1...p_a]</code> of dimension <span class="math inline">\(p_a\)</span>. All intermediate values in the program will be denoted by <code>b</code>s. The output of the function is denoted by the variable <code>z</code> of dimension <span class="math inline">\(1\)</span>. So, the algorithm starts with the inputs <code>a</code>, goes to <code>z</code> through a lot of <code>b</code>s. The new variables are denoted by <code>b[j]</code> with <code>j</code> starting with <code>1</code> and going upto <span class="math inline">\(p_b\)</span>. There are <span class="math inline">\(p_b\)</span> intermediate variables <span class="math inline">\(b\)</span> in the program.</p>
</section>
<section id="forward-mode-ad" class="level2">
<h2 class="anchored" data-anchor-id="forward-mode-ad">Forward-mode AD</h2>
<p>Standard algorithmic differentiation also called forward algorithmic differentiation or tangent algorithmic differentiation. Our goal is to compute <span class="math inline">\(\partial z/\partial a_i\)</span>. We achieve this by computing for each <span class="math inline">\(j\)</span>(<span class="math inline">\(p_a + 1 \leq j \leq p_b\)</span>) the value:</p>
<p><span class="math display">\[
\dot{b}[j,i] = \frac{\partial b[j]}{\partial a[i]}
\]</span></p>
<p>We first initialize the variables <span class="math inline">\(b[j]\)</span> from <span class="math inline">\(1 \leq j \leq p_a\)</span> with the inputs values <span class="math inline">\(a[j]\)</span>. Note that the derivative is denoted by dot on the variable and <span class="math inline">\(\dot{b}[j,i]\)</span> is the derivative of <span class="math inline">\(b[j]\)</span> with respect to some other variable <span class="math inline">\(a[i]\)</span>. For <span class="math inline">\(j=1:p_a\)</span>, then, the derivative of <span class="math inline">\(b[j]\)</span> with respect to <span class="math inline">\(a[i]\)</span> is simply <span class="math inline">\(1\)</span>, if <span class="math inline">\(j=i\)</span> and <span class="math inline">\(0\)</span> if <span class="math inline">\(j \neq i\)</span>. This is the starting point of a recursive algorithm. The starting part is the identity matrix :</p>
<p><span class="math display">\[
\dot{b}[j,i] = \delta_{i,j}
\]</span></p>
<p>where <span class="math inline">\(\delta_{i,j}\)</span> represents Kronecker’s delta.</p>
<p>The successive derivatives <span class="math inline">\(\dot{b}[j,i]\)</span> are given by the chain rule:</p>
<p><span class="math display">\[
\begin{align*}
\dot{b}[j,i] = \frac{\partial b[j]}{\partial a[i]} &amp;= \sum_{k=p_a + 1}^{k=j-1}\frac{\partial b[j]}{\partial b[k]} \cdot \frac{\partial b[k]}{\partial a[i]}\\
&amp;= \sum_{k=p_a + 1}^{j-1} \frac{\partial}{\partial b[k]} (b[j]) \cdot \dot{b}[k,i]\\
&amp;= \sum_{k=p_a + 1}^{j-1} \frac{\partial}{\partial b[k]} g_j(b[p_a + 1 : j - 1]) \cdot \dot{b}[k,i]\\
\end{align*}
\]</span></p>
<p>The numbers <span class="math inline">\(\dot{b}[p_b,i]\)</span> are equal to the derivatives of <span class="math inline">\(z=b[p_b]\)</span> with respect to <span class="math inline">\(a_i\)</span>, <span class="math inline">\(1 \leq i \leq p_a\)</span>. This concludes the algorithm for the computation of <span class="math inline">\(\partial z/\partial a_i\)</span>.</p>
<p>The requirements for such an implementation is that all the intermediary functions <span class="math inline">\(g_j\)</span> have a derivative version. The algorithmic differentiation approach is a bottom-up approach : it can be implemented for an algorithm only if all the components below it, all the components entering into the composition have already been implemented.</p>
<div id="fig:forward_ad" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="forward_ad.jpg" class="img-fluid figure-img" data-scale="70%"></p>
<figcaption class="figure-caption">Forward AD</figcaption>
</figure>
</div>
</section>
<section id="naive-implementation-of-forward-ad" class="level2">
<h2 class="anchored" data-anchor-id="naive-implementation-of-forward-ad">Naive implementation of forward-AD</h2>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">function</span> <span class="fu">f</span>(a<span class="op">::</span><span class="dt">Array{Real}</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a>    b <span class="op">=</span> <span class="fu">zeros</span>(<span class="fl">4</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a>    b[<span class="fl">1</span>] <span class="op">=</span> a[<span class="fl">1</span>] <span class="op">+</span> <span class="fu">exp</span>(a[<span class="fl">2</span>])</span>
<span id="cb1-4"><a href="#cb1-4"></a>    b[<span class="fl">2</span>] <span class="op">=</span> <span class="fu">sin</span>(a[<span class="fl">3</span>]) <span class="op">+</span> <span class="fu">cos</span>(a[<span class="fl">4</span>])</span>
<span id="cb1-5"><a href="#cb1-5"></a>    b[<span class="fl">3</span>] <span class="op">=</span> a[<span class="fl">2</span>] <span class="op">^</span> (<span class="fl">3</span><span class="op">/</span><span class="fl">2</span>) <span class="op">+</span> a[<span class="fl">4</span>]</span>
<span id="cb1-6"><a href="#cb1-6"></a>    b[<span class="fl">4</span>] <span class="op">=</span> <span class="fu">cos</span>(b[<span class="fl">1</span>]) <span class="op">*</span> b[<span class="fl">2</span>] <span class="op">+</span> b[<span class="fl">3</span>]</span>
<span id="cb1-7"><a href="#cb1-7"></a>    b[<span class="fl">4</span>]</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>f (generic function with 1 method)</code></pre>
</div>
</div>
<p>We create an AD version of the starter function as follows:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">function</span> <span class="fu">f_AD</span>(x<span class="op">::</span><span class="dt">Array{Real}</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a>    b <span class="op">=</span> <span class="fu">zeros</span>(<span class="fl">4</span>)</span>
<span id="cb3-3"><a href="#cb3-3"></a>    b[<span class="fl">1</span>] <span class="op">=</span> a[<span class="fl">1</span>] <span class="op">+</span> <span class="fu">exp</span>(a[<span class="fl">2</span>])</span>
<span id="cb3-4"><a href="#cb3-4"></a>    b[<span class="fl">2</span>] <span class="op">=</span> <span class="fu">sin</span>(a[<span class="fl">3</span>]) <span class="op">+</span> <span class="fu">cos</span>(a[<span class="fl">4</span>])</span>
<span id="cb3-5"><a href="#cb3-5"></a>    b[<span class="fl">3</span>] <span class="op">=</span> a[<span class="fl">2</span>] <span class="op">^</span> (<span class="fl">3</span><span class="op">/</span><span class="fl">2</span>) <span class="op">+</span> a[<span class="fl">4</span>]</span>
<span id="cb3-6"><a href="#cb3-6"></a>    b[<span class="fl">4</span>] <span class="op">=</span> <span class="fu">cos</span>(b[<span class="fl">1</span>]) <span class="op">*</span> b[<span class="fl">2</span>] <span class="op">+</span> b[<span class="fl">3</span>]</span>
<span id="cb3-7"><a href="#cb3-7"></a>    </span>
<span id="cb3-8"><a href="#cb3-8"></a>    <span class="co"># Forward sweep - derivatives</span></span>
<span id="cb3-9"><a href="#cb3-9"></a>    n <span class="op">=</span> <span class="fu">length</span>(x)</span>
<span id="cb3-10"><a href="#cb3-10"></a></span>
<span id="cb3-11"><a href="#cb3-11"></a>    b1dot <span class="op">=</span> <span class="fu">zeros</span>(n)</span>
<span id="cb3-12"><a href="#cb3-12"></a>    b1dot[<span class="fl">1</span>] <span class="op">=</span> <span class="fl">1</span></span>
<span id="cb3-13"><a href="#cb3-13"></a>    b1dot[<span class="fl">2</span>] <span class="op">=</span> <span class="fu">exp</span>(b[<span class="fl">2</span>])</span>
<span id="cb3-14"><a href="#cb3-14"></a></span>
<span id="cb3-15"><a href="#cb3-15"></a>    b2dot <span class="op">=</span> <span class="fu">zeros</span>(n)</span>
<span id="cb3-16"><a href="#cb3-16"></a>    b2dot[<span class="fl">3</span>] <span class="op">=</span> <span class="fu">cos</span>(b[<span class="fl">3</span>])</span>
<span id="cb3-17"><a href="#cb3-17"></a>    b2dot[<span class="fl">4</span>] <span class="op">=</span> <span class="fu">-sin</span>(b[<span class="fl">4</span>])</span>
<span id="cb3-18"><a href="#cb3-18"></a></span>
<span id="cb3-19"><a href="#cb3-19"></a>    b3dot <span class="op">=</span> <span class="fu">zeros</span>(n)</span>
<span id="cb3-20"><a href="#cb3-20"></a>    b3dot[<span class="fl">2</span>] <span class="op">=</span> (<span class="fl">3</span><span class="op">/</span><span class="fl">2</span>)<span class="fu">*</span>(b[<span class="fl">2</span>] <span class="op">^</span> (<span class="fl">1</span><span class="op">/</span><span class="fl">2</span>))</span>
<span id="cb3-21"><a href="#cb3-21"></a>    b3dot[<span class="fl">4</span>] <span class="op">=</span> <span class="fl">1</span></span>
<span id="cb3-22"><a href="#cb3-22"></a></span>
<span id="cb3-23"><a href="#cb3-23"></a>    b4dot <span class="op">=</span> b[<span class="fl">2</span>] <span class="op">*</span> <span class="fu">-sin</span>(b[<span class="fl">1</span>]) <span class="op">*</span> b1dot <span class="op">+</span> <span class="fu">cos</span>(b[<span class="fl">1</span>]) <span class="op">*</span> b2dot <span class="op">+</span> b3dot</span>
<span id="cb3-24"><a href="#cb3-24"></a>    (b[<span class="fl">4</span>],b4dot)</span>
<span id="cb3-25"><a href="#cb3-25"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>f_AD (generic function with 1 method)</code></pre>
</div>
</div>
<p>Note that, the output of the original function <code>f</code> is the function value - a <code>double</code>, whilst the output <code>f_ad</code> is a 2-tuple : the function value and the value of the jacobian(gradient).</p>
</section>
<section id="adjoint-algorithmic-differentiation" class="level2">
<h2 class="anchored" data-anchor-id="adjoint-algorithmic-differentiation">Adjoint Algorithmic Differentiation</h2>
<p>Our goal is to compute <span class="math inline">\(\frac{\partial z}{\partial a_i}\)</span>. We achieve this by computing for each intermediate variable <span class="math inline">\(j\)</span> (<span class="math inline">\(p_a + 1 \leq j \leq p_b\)</span>) the value:</p>
<p><span class="math display">\[
\overline{b}[j] = \frac{\partial z}{\partial b[j]}
\]</span></p>
<p>Note that, <span class="math inline">\(\overline{b}[j]\)</span> is the derivative of the output with respect to <code>b[j]</code>. It is important to switch the perception between the forward mode and the reverse mode. What is fixed in the reverse approach is the output, we always compute the derivative of the same variable, the output.</p>
<p>The starting point of the algorithm is easy. For <span class="math inline">\(j = p_b\)</span>, the derivative of <span class="math inline">\(z\)</span> with respect to <span class="math inline">\(b[j]\)</span> is simply the derivative of <span class="math inline">\(z\)</span> with respect to itself, which is <span class="math inline">\(1\)</span>. This is the starting point of a recursive algorithm.</p>
<p>From there, we read the code in reverse order and just apply the chain rule. Each intermediary variable <span class="math inline">\(b[j]\)</span> is used only in the lines of code that follow in the computation. The derivative <span class="math inline">\(\overline{b}[j]\)</span> is given by:</p>
<p><span class="math display">\[
\overline{b}[j] = \frac{\partial z}{\partial b_j} = \sum_{k=j+1}^{p_b} \frac{\partial z}{\partial b_k} \cdot \frac{\partial b_k}{\partial b_j} = \sum_{k=j+1}^{p_b} \overline{b}[k] \cdot \frac{\partial g_k}{\partial b_j}
\]</span></p>
<p>I think it’s easy to visualize this in a computational graph:</p>
<div id="fig:reverse_ad" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="reverse_ad.jpg" class="img-fluid figure-img" data-scale="70%"></p>
<figcaption class="figure-caption">Reverse AD</figcaption>
</figure>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">function</span> <span class="fu">f_AAD</span>(a<span class="op">::</span><span class="dt">Array{Real}</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a>    b <span class="op">=</span> <span class="fu">zeros</span>(<span class="fl">4</span>)</span>
<span id="cb5-3"><a href="#cb5-3"></a>    b[<span class="fl">1</span>] <span class="op">=</span> a[<span class="fl">1</span>] <span class="op">+</span> <span class="fu">exp</span>(a[<span class="fl">2</span>])</span>
<span id="cb5-4"><a href="#cb5-4"></a>    b[<span class="fl">2</span>] <span class="op">=</span> <span class="fu">sin</span>(a[<span class="fl">3</span>]) <span class="op">+</span> <span class="fu">cos</span>(a[<span class="fl">4</span>])</span>
<span id="cb5-5"><a href="#cb5-5"></a>    b[<span class="fl">3</span>] <span class="op">=</span> a[<span class="fl">2</span>] <span class="op">^</span> (<span class="fl">3</span><span class="op">/</span><span class="fl">2</span>) <span class="op">+</span> a[<span class="fl">4</span>]</span>
<span id="cb5-6"><a href="#cb5-6"></a>    b[<span class="fl">4</span>] <span class="op">=</span> <span class="fu">cos</span>(b[<span class="fl">1</span>]) <span class="op">*</span> b[<span class="fl">2</span>] <span class="op">+</span> b[<span class="fl">3</span>]</span>
<span id="cb5-7"><a href="#cb5-7"></a></span>
<span id="cb5-8"><a href="#cb5-8"></a>    <span class="co"># Backward sweep - derivatives</span></span>
<span id="cb5-9"><a href="#cb5-9"></a>    n <span class="op">=</span> <span class="fu">length</span>(a)</span>
<span id="cb5-10"><a href="#cb5-10"></a>    abar <span class="op">=</span> <span class="fu">zeros</span>(n)</span>
<span id="cb5-11"><a href="#cb5-11"></a>    b4bar <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb5-12"><a href="#cb5-12"></a>    b3bar <span class="op">=</span> <span class="fl">1.0</span> <span class="op">*</span> b4bar</span>
<span id="cb5-13"><a href="#cb5-13"></a>    b2bar <span class="op">=</span> <span class="fu">cos</span>(b[<span class="fl">1</span>]) <span class="op">*</span> b4bar</span>
<span id="cb5-14"><a href="#cb5-14"></a>    b1bar <span class="op">=</span> b[<span class="fl">2</span>] <span class="op">*</span> (<span class="fu">-sin</span>(b[<span class="fl">1</span>])) <span class="op">*</span> b4bar</span>
<span id="cb5-15"><a href="#cb5-15"></a></span>
<span id="cb5-16"><a href="#cb5-16"></a>    abar[<span class="fl">4</span>] <span class="op">=</span> <span class="fu">-sin</span>(a[<span class="fl">4</span>]) <span class="op">*</span> b2bar <span class="op">+</span> <span class="fl">1.0</span> <span class="op">*</span> b3bar</span>
<span id="cb5-17"><a href="#cb5-17"></a>    abar[<span class="fl">3</span>] <span class="op">=</span> <span class="fu">cos</span>(a[<span class="fl">3</span>]) <span class="op">*</span> b2bar</span>
<span id="cb5-18"><a href="#cb5-18"></a>    abar[<span class="fl">2</span>] <span class="op">=</span> <span class="fu">exp</span>(a[<span class="fl">2</span>]) <span class="op">*</span> b1bar <span class="op">+</span> (<span class="fl">1.5</span>) <span class="op">*</span> (a[<span class="fl">2</span>] <span class="op">^</span> (<span class="fl">0.5</span>)) <span class="op">*</span> b3bar</span>
<span id="cb5-19"><a href="#cb5-19"></a>    abar[<span class="fl">1</span>] <span class="op">=</span> <span class="fl">1.0</span> <span class="op">*</span> b1bar</span>
<span id="cb5-20"><a href="#cb5-20"></a></span>
<span id="cb5-21"><a href="#cb5-21"></a>    (b[<span class="fl">4</span>], abar)</span>
<span id="cb5-22"><a href="#cb5-22"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>f_AAD (generic function with 1 method)</code></pre>
</div>
</div>
</section>
<section id="algorithmic-differentiation-tools" class="level2">
<h2 class="anchored" data-anchor-id="algorithmic-differentiation-tools">Algorithmic Differentiation Tools</h2>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="quasar-chunawala/quantdev" data-repo-id="R_kgDOL2t5-A" data-category="General" data-category-id="DIC_kwDOL2t5-M4ClndQ" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->



</body></html>