<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Quasar">
<meta name="dcterms.date" content="2024-07-04">

<title>Multivariate Ito Calculus â€“ quantdev.blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-f2a1071e85750ec973bbb8a8f120da0f.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-b0693a1090cce3f71fbb13c85da23e1f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;800&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap');
</style>
<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9993009899870547" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">quantdev.blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Multivariate Ito Calculus</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                                <div class="quarto-categories">
                <div class="quarto-category">Stochastic Calculus</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Quasar </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 4, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#multivariate-ito-calculus." id="toc-multivariate-ito-calculus." class="nav-link active" data-scroll-target="#multivariate-ito-calculus.">Multivariate Ito Calculus.</a>
  <ul class="collapse">
  <li><a href="#multidimensional-brownian-motion." id="toc-multidimensional-brownian-motion." class="nav-link" data-scroll-target="#multidimensional-brownian-motion.">Multidimensional Brownian motion.</a>
  <ul class="collapse">
  <li><a href="#d-brownian-motion" id="toc-d-brownian-motion" class="nav-link" data-scroll-target="#d-brownian-motion">2D Brownian Motion</a></li>
  <li><a href="#brownian-motion-with-correlated-coordinates" id="toc-brownian-motion-with-correlated-coordinates" class="nav-link" data-scroll-target="#brownian-motion-with-correlated-coordinates">Brownian motion with correlated coordinates</a></li>
  </ul></li>
  <li><a href="#itos-formula." id="toc-itos-formula." class="nav-link" data-scroll-target="#itos-formula.">Itoâ€™s Formula.</a>
  <ul class="collapse">
  <li><a href="#brownian-martingales" id="toc-brownian-martingales" class="nav-link" data-scroll-target="#brownian-martingales">Brownian Martingales</a></li>
  </ul></li>
  <li><a href="#multidimensional-ito-formula---functions-of-space-and-time" id="toc-multidimensional-ito-formula---functions-of-space-and-time" class="nav-link" data-scroll-target="#multidimensional-ito-formula---functions-of-space-and-time">Multidimensional Ito formula - Functions of space and time</a></li>
  <li><a href="#polyas-random-walk-theorem" id="toc-polyas-random-walk-theorem" class="nav-link" data-scroll-target="#polyas-random-walk-theorem">Polyaâ€™s Random Walk Theorem</a>
  <ul class="collapse">
  <li><a href="#mathbbz1-case" id="toc-mathbbz1-case" class="nav-link" data-scroll-target="#mathbbz1-case"><span class="math inline">\(\mathbb{Z}^1\)</span> case</a></li>
  <li><a href="#mathbbz2-case" id="toc-mathbbz2-case" class="nav-link" data-scroll-target="#mathbbz2-case"><span class="math inline">\(\mathbb{Z}^2\)</span> case</a></li>
  <li><a href="#mathbbz3-case" id="toc-mathbbz3-case" class="nav-link" data-scroll-target="#mathbbz3-case"><span class="math inline">\(\mathbb{Z}^3\)</span> case</a></li>
  </ul></li>
  <li><a href="#recurrence-and-transience-of-brownian-motion" id="toc-recurrence-and-transience-of-brownian-motion" class="nav-link" data-scroll-target="#recurrence-and-transience-of-brownian-motion">Recurrence and Transience of Brownian Motion</a></li>
  <li><a href="#dynkins-formula-and-the-dirichlet-problem" id="toc-dynkins-formula-and-the-dirichlet-problem" class="nav-link" data-scroll-target="#dynkins-formula-and-the-dirichlet-problem">Dynkinâ€™s Formula and the Dirichlet Problem</a></li>
  <li><a href="#numerical-projects" id="toc-numerical-projects" class="nav-link" data-scroll-target="#numerical-projects">Numerical Projects</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="multivariate-ito-calculus." class="level1">
<h1>Multivariate Ito Calculus.</h1>
<p>We can generalize the theory to functions of several brownian motions. This unleashes the full power of Ito calculus.</p>
<section id="multidimensional-brownian-motion." class="level2">
<h2 class="anchored" data-anchor-id="multidimensional-brownian-motion.">Multidimensional Brownian motion.</h2>
<div id="def-brownian-motion-in-Rd" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 1 (Brownian motion in <span class="math inline">\(\mathbf{R}^{d}\)</span>.)</strong></span> Take <span class="math inline">\(d\in\mathbf{N}\)</span>. Let <span class="math inline">\(B^{(1)},\ldots,B^{(d)}\)</span> be independent standard Brownian motions in <span class="math inline">\((\Omega,\mathcal{F},\mathbb{P})\)</span>. The process <span class="math inline">\((B_{t}:t\geq0)\)</span> taking values in <span class="math inline">\(\mathbf{R}^{d}\)</span> defined by :</p>
<span class="math display">\[\begin{aligned}
B_{t} &amp; =(B_{t}^{(1)},\ldots,B_{t}^{(d)}),\quad t\geq0
\end{aligned}\]</span>
<p>is called a <span class="math inline">\(d-\)</span>dimensional Brownian motion or a Brownian motion in <span class="math inline">\(\mathbf{R}^{d}\)</span>.</p>
</div>
<p>The Brownian filtration <span class="math inline">\((\mathcal{F}_{t}:t\geq0)\)</span> is now composed of the information of all Brownian motions. In other words, it is given by the sigma-fields:</p>
<span class="math display">\[\begin{aligned}
\mathcal{F}_{t} &amp; =\sigma(B_{s}^{(i)},1\leq i\leq d,s\leq t)
\end{aligned}\]</span>
<p>For every outcome <span class="math inline">\(\omega\)</span>, the path of trajectory of a <span class="math inline">\(d-\)</span>dimensional Brownian motion is a curve in space parametrized by the time <span class="math inline">\(t\)</span>:</p>
<span class="math display">\[\begin{aligned}
t\mapsto B_{t}(\omega) &amp; =(B_{t}^{(1)}(\omega),B_{t}^{(2)}(\omega),\ldots,B_{t}^{(d)}(\omega))
\end{aligned}\]</span>
<p>Of course, this curve is continuous, since each coordinate is. The below numerical project gives an example of one path of a two-dimensional brownian motion. This is a very rugged and intertwined curve! We might wonder, what it does as <span class="math inline">\(t\to\infty\)</span>. Does it wander around <span class="math inline">\((0,0)\)</span> ad infinitum or does it eventually escape to infinity? We will answer this question in a later section. For doing so, we shall need a version of Itoâ€™s formula for multi-dimensional Brownian motion. We finish this section by noticing that it is also easy to construct Brownian motions in higher dimensions for which the coordinates are correlated.</p>
<section id="d-brownian-motion" class="level3">
<h3 class="anchored" data-anchor-id="d-brownian-motion">2D Brownian Motion</h3>
<p>Consider a two-dimensional Brownian motion <span class="math inline">\((B_{t}^{(1)},B_{2}^{(2)})\)</span> starting at <span class="math inline">\((0,0)\)</span>.</p>
<p>Letâ€™s plot one path of this Brownian motion on the plane <span class="math inline">\(\mathbf{R}^{2}\)</span> on the plane in <span class="math inline">\(\mathbf{R}^{2}\)</span> on the time interval <span class="math inline">\([0,5]\)</span> using a discretization of <span class="math inline">\(0.001\)</span>.</p>
<p>We define <code>BrownianMotion2D</code> class.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"whitegrid"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> BrownianMotion2D:</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Generate sample paths for a 2d-brownian motion</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        endpoint : <span class="bu">float</span> <span class="op">=</span> <span class="fl">1.0</span>,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        discretization : <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.01</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    ):</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.endpoint <span class="op">=</span> endpoint</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.discretization <span class="op">=</span> discretization</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> generate_paths(<span class="va">self</span>, num_paths : <span class="bu">int</span>):</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        steps <span class="op">=</span> <span class="bu">int</span>(<span class="va">self</span>.endpoint<span class="op">/</span><span class="va">self</span>.discretization)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        delta_z <span class="op">=</span> np.sqrt(<span class="va">self</span>.discretization) <span class="op">*</span> np.random.randn(num_paths,<span class="dv">2</span>,steps)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># paths has shape [num_paths,2,num_steps]</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        paths <span class="op">=</span> np.cumsum(delta_z,axis<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Brownian motion has position (0,0) at time t=0</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Append initial position </span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        init_position <span class="op">=</span> np.zeros((num_paths,<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        paths <span class="op">=</span> np.append(init_position,paths,axis<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> paths</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can then configure and use <code>BrownianMotion2D</code> objects as we please.</p>
<div class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>bm <span class="op">=</span> BrownianMotion2D(endpoint<span class="op">=</span><span class="fl">5.0</span>,discretization<span class="op">=</span><span class="fl">0.001</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>paths <span class="op">=</span> bm.generate_paths(num_paths<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> paths[<span class="dv">0</span>]</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r'$x$'</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="vs">r'$y$'</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="vs">r'2D-Brownian motion'</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>plt.plot(path[<span class="dv">0</span>],path[<span class="dv">1</span>],linewidth<span class="op">=</span><span class="dv">1</span>,color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-3-output-1.png" width="594" height="447" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="brownian-motion-with-correlated-coordinates" class="level3">
<h3 class="anchored" data-anchor-id="brownian-motion-with-correlated-coordinates">Brownian motion with correlated coordinates</h3>
<div id="exm-brownian-motion-with-correlated-coordinates" class="theorem example">
<p><span class="theorem-title"><strong>Example 1 (Brownian motion with correlated coordinates)</strong></span> Let <span class="math inline">\((B_{t}:t\geq0)\)</span> be a two dimensional brownian motion. Let <span class="math inline">\(-1&lt;\rho&lt;1\)</span>. We construct the two dimensional process as follows: <span class="math inline">\(W_{t}=(W_{t}^{(1)},W_{t}^{(2)})\)</span> where:</p>
<span class="math display">\[\begin{aligned}
W_{t}^{(1)} &amp; =B_{t}^{(1)}\\
W_{t}^{(2)} &amp; =\rho B_{t}^{(1)}+\sqrt{1-\rho^{2}}B_{t}^{(2)}
\end{aligned}\]</span>
<p><span class="math inline">\(W_{t}^{(1)}=B_{t}^{(1)}\)</span> is Gaussian with mean <span class="math inline">\(0\)</span> and variance <span class="math inline">\(t\)</span>. Since, <span class="math inline">\(B_{t}^{(1)}\)</span> and <span class="math inline">\(B_{t}^{(2)}\)</span>are independent gaussian random variables and the sum of IID Gaussians is Gaussian, <span class="math inline">\(W_{t}^{(2)}\)</span> is Gaussian with mean <span class="math inline">\(0\)</span> and variance <span class="math inline">\(t\)</span>. The covariance between <span class="math inline">\(W_{t}^{(1)}\)</span> and <span class="math inline">\(W_{t}^{(2)}\)</span> is:</p>
<span class="math display">\[\begin{aligned}
\mathbf{E}[W_{t}^{(1)}W_{t}^{(2)}] &amp; =\mathbf{E}[B_{t}^{(1)}(\rho B_{t}^{(1)}+\sqrt{1-\rho^{2}}B_{t}^{(2)})]\\
&amp; =\mathbf{E}[\rho(B_{t}^{(1)})^{2}+\sqrt{1-\rho^{2}}B_{t}^{(1)}B_{t}^{(2)}]\\
&amp; =\rho t
\end{aligned}\]</span>
<p>Hence, the coordinates at time <span class="math inline">\(t\)</span> are not independent.</p>
</div>
<p>Consider now the process <span class="math inline">\((W_{t}:t\geq0)\)</span> for <span class="math inline">\(\rho=1/2\)</span> as in example 2. Letâ€™s plot one path of this process on the plane <span class="math inline">\(\mathbf{R}^{2}\)</span> on the time-interval <span class="math inline">\([0,5]\)</span> using a discretization of <span class="math inline">\(0.001\)</span>.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> BrownianMotion2DWithCorrelatedCoords(BrownianMotion2D):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Generate sample paths for a 2d-brownian motion</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">    have correlated coordiantes</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>, </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        endpoint: <span class="bu">float</span> <span class="op">=</span> <span class="fl">1.0</span>, </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        discretization: <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.01</span>, </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        rho: <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    ):</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.endpoint <span class="op">=</span> endpoint</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.discretization <span class="op">=</span> discretization</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.rho <span class="op">=</span> rho</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> generate_paths(<span class="va">self</span>, num_paths: <span class="bu">int</span>):</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Call the base class generate_paths() method to generate a pair of</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># independent brownian motion paths. It returns a tensor of</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># shape (num_paths, 2, num_steps)</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>        paths <span class="op">=</span> <span class="bu">super</span>().generate_paths(num_paths<span class="op">=</span>num_paths)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract the brownian motions B1(t) and B2(t)</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># B1(t) and B2(t) have dimensions [num_paths,num_steps]</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        x_coord <span class="op">=</span> paths[:, <span class="dv">0</span>, :]</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>        y_coord <span class="op">=</span> paths[:, <span class="dv">1</span>, :]</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Apply the transformation</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># W1(t) = B1(t)</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># W2(t) = rho * B1(t) + sqrt(1 - rho**2) B2(t)</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>        x_coord <span class="op">=</span> x_coord</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>        y_coord <span class="op">=</span> <span class="va">self</span>.rho <span class="op">*</span> x_coord <span class="op">+</span> np.sqrt(<span class="dv">1</span> <span class="op">-</span> <span class="va">self</span>.rho<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> y_coord</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Assemble back the x- and y- coordinates</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>        x_coord <span class="op">=</span> np.expand_dims(x_coord, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>        y_coord <span class="op">=</span> np.expand_dims(y_coord, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Return a tensor of shape [num_paths,d=2,num_steps]</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.concatenate([x_coord, y_coord], axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Letâ€™s configure the <code>BrownianMotion2DWithCorrelatedCoords</code> engine with the settings <code>endpoint=5.0</code>, <code>discretization=0.001</code> and <code>rho=0.5</code> and generate a sample path.</p>
<div class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>bm <span class="op">=</span> BrownianMotion2DWithCorrelatedCoords(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    endpoint<span class="op">=</span><span class="fl">5.0</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    discretization<span class="op">=</span><span class="fl">0.001</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    rho<span class="op">=</span><span class="fl">0.50</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>paths <span class="op">=</span> bm.generate_paths(num_paths<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> paths[<span class="dv">0</span>]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r'$x$'</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="vs">r'$y$'</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="vs">r'Correlated Brownian motion $W(t)=(W^{(1)}(t),W^{(2)}(t))$'</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>plt.plot(path[<span class="dv">0</span>],path[<span class="dv">1</span>],linewidth<span class="op">=</span><span class="dv">1</span>,color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-5-output-1.png" width="598" height="452" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r'$t$'</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="vs">r'$W_t$'</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="vs">r'Correlated Brownian motion paths'</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> np.linspace(<span class="fl">0.0</span>,stop<span class="op">=</span><span class="fl">5.0</span>,num<span class="op">=</span><span class="dv">5001</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>plt.plot(t,path[<span class="dv">0</span>],linewidth<span class="op">=</span><span class="fl">0.75</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>plt.plot(t,path[<span class="dv">1</span>],linewidth<span class="op">=</span><span class="fl">0.75</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-6-output-1.png" width="584" height="447" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="itos-formula." class="level2">
<h2 class="anchored" data-anchor-id="itos-formula.">Itoâ€™s Formula.</h2>
<div id="thm-ito-formula-function-of-d-brownian-motions" class="theorem">
<p><span class="theorem-title"><strong>Theorem 1 (Itoâ€™s Formula.)</strong></span> Let <span class="math inline">\((B_{t}:t\geq0)\)</span> be a <span class="math inline">\(d-\)</span>dimensional brownian motion. Consider <span class="math inline">\(f\in\mathcal{C}^{2}(\mathbf{R}^{d})\)</span>. Then, we have with probability one that for all <span class="math inline">\(t\geq0\)</span>:</p>
<span class="math display">\[\begin{aligned}
f(B_{t})-f(B_{0}) &amp; =\sum_{i=1}^{d}\int_{0}^{t}\partial_{x_{i}}f(B_{s})dB_{s}^{(i)}+\frac{1}{2}\int_{0}^{t}\sum_{i=1}^{d}\partial_{x_{i}}^{2}f(B_{s})ds\label{eq:multidimensional-ito-formula}
\end{aligned}\]</span>
</div>
<div id="rem-equality-of-processes" class="proof remark">
<p><span class="proof-title"><em>Remark 1</em>. </span>I stress that, as in the one-dimensional case, Itoâ€™s formula is an equality of processes (and not an equality in distribution). Thus, the processes on both sides must agree for each path.</p>
</div>
<p>Interestingly, the mixed partials <span class="math inline">\(\partial_{x_{i}x_{j}}f(B_{s})\)</span>, <span class="math inline">\(i\neq j\)</span> do not appear in the formula! We see from Itoâ€™s formula that the process <span class="math inline">\(f(B_{t})\)</span> can be represented as a sum of <span class="math inline">\(d+1\)</span> processes: <span class="math inline">\(d\)</span> Ito integrals and one Riemann integral (which is a process of finite variation). In vector notation, the formula takes the form:</p>
<span class="math display">\[\begin{aligned}
f(B_{t})-f(B_{0}) &amp; =\int_{0}^{t}\nabla f(B_{s})^{T}dB_{s}+\frac{1}{2}\int_{0}^{t}\nabla^{2}f(B_{s})ds
\end{aligned}\]</span>
<p>where it is understood that the first term is the sum of the <span class="math inline">\(d\)</span> Ito integrals in the equation. The symbol <span class="math inline">\(\nabla^{2}\)</span> is the Laplacian of <span class="math inline">\(f\)</span>:</p>
<p><span class="math inline">\(\sum_{i=1}^{d}\frac{\partial^{2}}{\partial x_{i}^{2}}f(B_{s}^{(1)},\ldots,B_{s}^{(d)})ds\)</span></p>
<p>In differential form, Itoâ€™s formula becomes very neat:</p>
<span class="math display">\[\begin{aligned}
df(B_{t}) &amp; =\sum_{i=1}^{d}\partial_{x_{i}}f(B_{s})dB_{t}^{(i)}+\frac{1}{2}\sum_{i=1}^{d}\partial_{x_{i}}^{2}f(B_{s})dt=\nabla f(B_{t})^{T}dB_{s}+\frac{1}{2}\nabla^{2}f(B_{t})dt
\end{aligned}\]</span>
<div id="exm-ito-formula-1" class="theorem example">
<p><span class="theorem-title"><strong>Example 2</strong></span> Consider the functions (1) <span class="math inline">\(f(x_{1},x_{2})=x_{1}^{2}+x_{2}^{2}\)</span> (2) <span class="math inline">\(f(x_{1},x_{2})=e^{x_{1}}\cos x_{2}\)</span> and the processes <span class="math inline">\((X_{t}:t\geq0)\)</span> and <span class="math inline">\((Y_{t}:t\geq0)\)</span>. If we apply Itoâ€™s formula to the first process, we have:</p>
<span class="math display">\[\begin{aligned}
X_{t} &amp; =\int_{0}^{t}2B_{s}^{(1)}dB_{s}^{(1)}+\int_{0}^{t}2B_{s}^{(2)}dB_{s}^{(2)}+\frac{1}{2}\int_{0}^{t}(4dt)\\
&amp; =\int_{0}^{t}2B_{s}^{(1)}dB_{s}^{(1)}+\int_{0}^{t}2B_{s}^{(2)}dB_{s}^{(2)}+2t
\end{aligned}\]</span>
<p>The second process gives:</p>
<span class="math display">\[\begin{aligned}
Y_{t} &amp; =\cos B_{s}^{(2)}\int_{0}^{t}e^{B_{s}^{(1)}}dB_{s}^{(1)}-e^{B_{s}^{(1)}}\int\sin B_{s}^{(2)}dB_{s}^{(2)}+\frac{1}{2}\int_{0}^{t}\left(e^{B_{s}^{(1)}}\cos B_{s}^{(2)}-e^{B_{s}^{(1)}}\cos B_{s}^{(2)}\right)dt\\
&amp; =1+\cos B_{s}^{(2)}\int_{0}^{t}e^{B_{s}^{(1)}}dB_{s}^{(1)}-e^{B_{s}^{(1)}}\int\sin B_{s}^{(2)}dB_{s}^{(2)}
\end{aligned}\]</span>
</div>
<div id="exm-cross-variation-of-b1-and-b2" class="theorem example">
<p><span class="theorem-title"><strong>Example 3</strong></span> (Cross-Variation of <span class="math inline">\(B_{t}^{(1)}\)</span> and <span class="math inline">\(B_{t}^{(2)}\)</span>). Let <span class="math inline">\((t_{j}:j\leq n)\)</span> be a sequence of partitions of <span class="math inline">\([0,t]\)</span> such that <span class="math inline">\(\max_{j}|t_{j+1}-t_{j}|\to0\)</span> as <span class="math inline">\(n\to\infty\)</span>. Prove that:</p>
<span class="math display">\[\begin{aligned}
\lim_{n\to\infty}\sum_{j=0}^{n-1}(B_{t_{j+1}}^{(1)}-B_{t_{j}}^{(1)})(B_{t_{j+1}}^{(2)}-B_{t_{j}}^{(2)}) &amp; =0\quad\text{in } L^{2}
\end{aligned}\]</span>
<p>This justifies the rule <span class="math inline">\(dB_{t}^{(1)}\cdot dB_{t}^{(2)}=0\)</span>.</p>
<p><em>Hint</em>: Just compute the second moment of the sum.</p>
</div>
<div id="sol-solution-1" class="proof solution">
<p><span class="proof-title"><em>Solution 1</em>. </span>We have:</p>
<span class="math display">\[\begin{aligned}
&amp; \mathbf{E}\left[\left(\sum_{j=0}^{n-1}(B_{t_{j+1}}^{(1)}-B_{t_{j}}^{(1)})(B_{t_{j+1}}^{(2)}-B_{t_{j}}^{(2)})\right)^{2}\right]\\
= &amp; \sum_{j=0}^{n-1}\mathbf{E}[(B_{t_{j+1}}^{(1)}-B_{t_{j}}^{(1)})^{2}(B_{t_{j+1}}^{(2)}-B_{t_{j}}^{(2)})^{2}]\\
+ &amp; 2\sum_{j&lt;k}\mathbf{E}\left[(B_{t_{j+1}}^{(1)}-B_{t_{j}}^{(1)})(B_{t_{k+1}}^{(1)}-B_{t_{k}}^{(1)})(B_{t_{j+1}}^{(2)}-B_{t_{j}}^{(2)})(B_{t_{k+1}}^{(2)}-B_{t_{k}}^{(2)})\right]
\end{aligned}\]</span>
<p>Both these expectations are zero, since the brownian motions are independent and non-overlapping increments are independent.</p>
<p>Consequently, <span class="math inline">\(\sum_{j=0}^{n-1}(B_{t_{j+1}}^{(1)}-B_{t_{j}}^{(1)})(B_{t_{j+1}}^{(2)}-B_{t_{j}}^{(2)})\to0\)</span> in the <span class="math inline">\(L^{2}\)</span> sense.</p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>The proof of the formula follows the usual recipe: Taylorâ€™s theorem together with the quadratic variation and the cross-variation. In this case, we do get a cross-variation between the different Brownian motions. More precisely, consider a partition <span class="math inline">\((t_{j}:j\leq n)\)</span> of <span class="math inline">\([0,t]\)</span>. Then we can write:</p>
<span class="math display">\[\begin{aligned}
f(B_{t})-f(B_{0}) &amp; =\sum_{j=0}^{n-1}(f(B_{t_{j+1}})-f(B_{t_{j}}))
\end{aligned}\]</span>
<p>We can apply the Taylorâ€™s series expansion for each <span class="math inline">\(j\)</span> to get:</p>
<span class="math display">\[\begin{aligned}
f(B_{t})-f(B_{0}) &amp; =\sum_{j=0}^{n-1}\nabla f(B_{t_{j}})(B_{t_{j+1}}-B_{t_{j}})\\
&amp; +\frac{1}{2}\sum_{j=0}^{n-1}(B_{t_{j+1}}-B_{t_{j}})^{T}Hf(B_{t_{j}})(B_{t_{j+1}}-B_{t_{j}})+\mathcal{E}
\end{aligned}\]</span>
<p>where <span class="math inline">\(Hf\)</span> is the Hessian matrix of <span class="math inline">\(f\)</span>. We wrote the expansion using the vector notation to be economical. Letâ€™s keep in mind that each term is a sum over the derivatives. The first term will converge to <span class="math inline">\(d\)</span> Ito integrals as in the one-dimensional case. Now, the summand in the second term is:</p>
<p><span class="math display">\[(B_{t_{j+1}}^{(1)}-B_{t_{j}}^{(1)},\ldots,B_{t_{j+1}}^{(d)}-B_{t_{j}}^{(d)})\left[\begin{array}{ccc}
\partial_{x_{1}}^{2}f(B_{t_{j}}) &amp; \ldots &amp; \partial_{x_{1}x_{d}}^{2}f(B_{t_{j}})\\
\vdots &amp; \ddots\\
\partial_{x_{d}x_{1}}^{2}f(B_{t_{j}}) &amp;  &amp; \partial_{x_{d}}^{2}f(B_{t_{j}})
\end{array}\right]\left[\begin{array}{c}
B_{t_{j+1}}^{(1)}-B_{t_{j}}^{(1)}\\
\vdots\\
B_{t_{j+1}}^{(d)}-B_{t_{j}}^{(d)}
\end{array}\right]\]</span></p>
<p>So, <span class="math inline">\((B_{t_{j+1}}^{(i)}-B_{t_{j}}^{(i)})\)</span> is pre-multiplied with the term <span class="math inline">\(\partial_{x_{i}x_{k}}^{2}f(B_{t_{j}})\)</span> and it is post-multiplied <span class="math inline">\((B_{t_{j+1}}^{(k)}-B_{t_{j}}^{(k)})\)</span>. Consequently, the second term in the Taylorâ€™s series expansion can be re-written as:</p>
<p><span class="math display">\[\sum_{j=0}^{n-1}\left(\sum_{i=1}^{d}\partial_{x_{i}}^{2}f(B_{t_{j}})(B_{t_{j+1}}^{(i)}-B_{t_{j}}^{(i)})^{2}+\sum_{1\leq i&lt;k\leq d}\partial_{x_{i}x_{k}}^{2}f(B_{t_{j}})(B_{t_{j+1}}^{(i)}-B_{t_{j}}^{(i)})(B_{t_{j+1}}^{(k)}-B_{t_{j}}^{(k)})\right)\]</span></p>
<p>The second term on the right converges to <span class="math inline">\(0\)</span> in the <span class="math inline">\(L^{2}\)</span> sense when <span class="math inline">\(i\neq k\)</span>, from exercise. This explains why the mixed derivatives disappear in the multi-dimensional Itoâ€™s formula. As for the case <span class="math inline">\(i=k\)</span>, it reduces to the quadratic variation as in the one-dimensional case. This is where the Riemann integral arises, after suitable conditioning on <span class="math inline">\(\mathcal{F}_{t_{j}}\)</span>, the sigma-field generated by <span class="math inline">\(B_{s}\)</span>, <span class="math inline">\(s\leq t_{j}\)</span>.</p>
</div>
<p>As in the one-dimensional case,it is not necessary to learn Itoâ€™s formula by heart. It suffices to write the differential of the function <span class="math inline">\(f\)</span> to second order. We can then apply the rules of multivariate Ito calculus:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;"><span class="math inline">\(\cdot\)</span></th>
<th style="text-align: center;"><span class="math inline">\(dt\)</span></th>
<th style="text-align: center;"><span class="math inline">\(dB_{t}^{(1)}\)</span></th>
<th style="text-align: center;"><span class="math inline">\(dB_{t}^{(2)}\)</span></th>
<th style="text-align: center;"><span class="math inline">\(\ldots\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(dt\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(dB_{t}^{(1)}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0\)</span></td>
<td style="text-align: center;"><span class="math inline">\(dt\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(dB_{t}^{(2)}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0\)</span></td>
<td style="text-align: center;"><span class="math inline">\(dt\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(\ldots\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0\)</span></td>
<td style="text-align: center;"><span class="math inline">\(dt\)</span></td>
</tr>
</tbody>
</table>
<p>Note that the rule <span class="math inline">\(dB_{t}^{(i)}dB_{t}^{(j)}=0\)</span> for <span class="math inline">\(i\neq j\)</span> is being motivated by the cross-variation result.</p>
<p>How can we construct martingales using the Itoâ€™s formula? Recall that an Ito integral <span class="math inline">\((\int_{0}^{t}X_{s}dB_{s},t\leq T)\)</span> is a martingale whenever the integrand is in <span class="math inline">\(\mathcal{L}_{c}^{2}(T)\)</span>, the space of adapted processes with continuous paths and for which:</p>
<span class="math display">\[\begin{aligned}
\int_{0}^{T}\mathbf{E}[X_{s}^{2}]ds &amp; &lt;\infty
\end{aligned}\]</span>
<p>The only difference here is that the integrand is a function of many Brownian motions. However, the integrands involved in the Ito integrals of the multidimensional Itoâ€™s formula are clearly adapted to the filtration <span class="math inline">\((\mathcal{F}_{t}:t\geq0)\)</span> of <span class="math inline">\((B_{t}:t\geq0)\)</span> as they are functions of the Brownian motion at the time. The arguments of Ito integral in and apply verbatim, if we take the definition of <span class="math inline">\(\mathcal{L}_{c}^{2}(t)\)</span> with the filtration <span class="math inline">\((\mathcal{F}_{t}:t\geq0)\)</span> of <span class="math inline">\((B_{t}:t\geq0)\)</span>. With this in mind, we have the following corollary.</p>
<section id="brownian-martingales" class="level3">
<h3 class="anchored" data-anchor-id="brownian-martingales">Brownian Martingales</h3>
<div id="cor-brownian-martingales" class="theorem corollary">
<p><span class="theorem-title"><strong>Corollary 1 (Brownian Martingales.)</strong></span> Let <span class="math inline">\((B_{t}:t\geq0)\)</span> be a Brownian motion in <span class="math inline">\(\mathbf{R}^{d}\)</span>. Consider <span class="math inline">\(f\in\mathcal{C}^{2}(\mathbf{R}^{d})\)</span> such that processes <span class="math inline">\((\partial_{x {i}}f(B_{t}),t\leq T)\in\mathcal{L}_{c}^{2}(T)\)</span> for every <span class="math inline">\(i\leq d\)</span>. Then, the process :</p>
<p><span class="math display">\[f(B_{t})-\frac{1}{2}\int_{0}^{t}\nabla^{2}f(B_{s})ds,\quad t\leq T\]</span></p>
<p>where <span class="math inline">\(\nabla^{2}=\sum_{i=1}^{d}\partial_{x_{i}}^{2}\)</span> is the Laplacian, is a martingale for the Brownian filtration.</p>
</div>
<p>For example, consider the processes <span class="math inline">\(X_{t}=(B_{t}^{(1)})^{2}+(B_{t}^{(2)})^{2}\)</span> and <span class="math inline">\(Y_{t}=\exp(B_{t}^{(1)})\cos(B_{t}^{(2)})\)</span>. Then, we have :</p>
<p><span class="math display">\[\frac{1}{2}\int_{0}^{t}\nabla^{2}X_{s}ds=\frac{1}{2}\int_{0}^{t}4ds=2t\]</span></p>
<p>and</p>
<span class="math display">\[\begin{aligned}
\frac{1}{2}\int_{0}^{t}\nabla^{2}Y_{s}ds &amp; =\frac{1}{2}\int_{0}^{t}0\cdot ds=0
\end{aligned}\]</span>
<p>Thus, the processes <span class="math inline">\(X_{t}-2t\)</span> and <span class="math inline">\(Y_{t}\)</span> are martingales for the Brownian filtration. In one dimension, there are no interesting martingales constructed with functions of <em>space</em> only. Indeed, <span class="math inline">\((f(B_{t}):t\geq0)\)</span> is a martingale if and only if <span class="math inline">\(f''(x)=0\)</span> for all <span class="math inline">\(x\)</span>. But, such functions are of the form <span class="math inline">\(f(x)=ax+b\)</span>, <span class="math inline">\(a,b\in\mathbf{R}\)</span>. In other words, in one dimension, Brownian martingales of the form <span class="math inline">\(f(B_{t})\)</span> are simply <span class="math inline">\(aB_{t}+b\)</span>. Not very surprising! The situation is very different in higher dimensions. Indeed, corollary implies that <span class="math inline">\(f(B_{t})\)</span> is a martingale whenever <span class="math inline">\(f\)</span> is a harmonic function:</p>
<div id="def-harmonic-function" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 2 (Harmonic function.)</strong></span> A function <span class="math inline">\(f:\mathbf{R}^{d}\to\mathbf{R}\)</span> is harmonic in <span class="math inline">\(\mathbf{R}^{d}\)</span> if and only if <span class="math inline">\(\nabla^{2}f(x)\equiv0\)</span> for all <span class="math inline">\(x\in\mathbf{R}^{d}\)</span>. More generally, a function <span class="math inline">\(f:\mathbf{R}^{d}\to\mathbf{R}\)</span> is harmonic in the region <span class="math inline">\(\mathcal{O}\subset\mathbf{R}^{d}\)</span> if and only if <span class="math inline">\(\nabla^{2}f(x)\equiv0\)</span> for all <span class="math inline">\(x\in\mathcal{O}\)</span>.</p>
</div>
<p>Note that the function <span class="math inline">\(f(x)=e^{x_{1}}\cos x_{2}\)</span> is harmonic in <span class="math inline">\(\mathbf{R}^{d}\)</span>. This is why the process <span class="math inline">\(Y_{t}=\exp(B_{t}^{(1)})\cos(B_{t}^{(2)})\)</span> is a martingale. The distinction to a subset of <span class="math inline">\(\mathbf{R}^{d}\)</span> in the above definition is important since it may happen that the function is harmonic only in a subset of the space; see for example equation. It is possible to define a Brownian martingale in such cases by considering the process until it exits the region. This will turn out to be important as we move ahead.</p>
<p>The multidimensional Itoâ€™s formula generalizes to functions of time and space as in proposition:</p>
<div id="def-function-in-C12" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3</strong></span> A function <span class="math inline">\(f:[0,\infty)\times\mathbf{R}^{d}\to\mathbf{R}\)</span> is in <span class="math inline">\(\mathcal{C}^{1,2}([0,T]\times\mathbf{R}^{d})\)</span> if the partial derivative in <em>time</em> :</p>
<p><span class="math display">\[\frac{\partial}{\partial t}f(t,\mathbf{x})\]</span></p>
<p>exists and is continuous and the second order partial derivatives in space:</p>
<p><span class="math display">\[\frac{\partial^{2}}{\partial x_{i}^{2}}f(t,x_{1},x_{2},\ldots,x_{i},\ldots,x_{d}),\quad1\leq i\leq d\]</span></p>
<p>exist and are continuous.</p>
</div>
</section>
</section>
<section id="multidimensional-ito-formula---functions-of-space-and-time" class="level2">
<h2 class="anchored" data-anchor-id="multidimensional-ito-formula---functions-of-space-and-time">Multidimensional Ito formula - Functions of space and time</h2>
<div id="thm-Multidimensional-Ito-formula-functions-of-space-and-time" class="theorem">
<p><span class="theorem-title"><strong>Theorem 2 (Multidimensional Itoâ€™s formula for functions of space and time)</strong></span> Let <span class="math inline">\((B_{t}:t\leq T)\)</span> be a <span class="math inline">\(d\)</span>-dimensional Brownian motion. Consider a function <span class="math inline">\(f\in\mathcal{C}^{1,2}([0,T]\times\mathbf{R}^{d})\)</span>. Then, we have with probability one for all <span class="math inline">\(t\leq T\)</span>:</p>
<span class="math display">\[\begin{aligned}
f(t,B_{t})-f(0,B_{0}) &amp; =\sum_{i=1}^{d}\int_{0}^{t}\partial_{x_{i}}f(s,B_{s})dB_{s}^{(i)}+\int_{0}^{t}\left(\partial_{t}f(s,B_{s})+\sum_{i=1}^{d}\partial_{x_{i}}^{2}f(s,B_{s})\right)ds
\end{aligned}\]</span>
</div>
<p>The martingale condition is then similar to the ones in corollary (<a href="#cor:brownian-martingales-in-Rd" data-reference-type="ref" data-reference="cor:brownian-martingales-in-Rd">[cor:brownian-martingales-in-Rd]</a>): if the processes <span class="math inline">\((\partial_{x_{i}}f(s,B_{s}),t\leq T)\in\mathcal{L}_{c}^{2}(T)\)</span> for every <span class="math inline">\(1\leq i\leq d\)</span>, then the process</p>
<p><span id="eq-martingale-process"><span class="math display">\[f(t,B_{t})-\int_{0}^{t}\left\{ \partial_{t}f(s,B_{s})++\sum_{i=1}^{d}\partial_{x_{i}}^{2}f(s,B_{s})\right\} ds,\quad t\leq T \tag{1}\]</span></span></p>
<p>is a martingale for the Brownian filtration. In particular, if <span class="math inline">\(f\)</span> satisfies the partial differential equation:</p>
<p><span id="eq-martingale-condition-for-f"><span class="math display">\[
\begin{aligned}
\frac{\partial f}{\partial t}+\frac{1}{2}\nabla^{2}f &amp; =0
\end{aligned}
\tag{2}\]</span></span></p>
<p>then the process <span class="math inline">\((f(t,B_{t}):t\leq T)\)</span> itself is a martingale.</p>
</section>
<section id="polyas-random-walk-theorem" class="level2">
<h2 class="anchored" data-anchor-id="polyas-random-walk-theorem">Polyaâ€™s Random Walk Theorem</h2>
<p>Consider a <em>simple random walk</em> on the integer lattice <span class="math inline">\(\mathbb{Z}^d\)</span>. At each time step, a random walker makes a random move of length one in one of the lattice directions.</p>
<p>We say that, if the random walk returns to the origin with probability one infinitely many times, it is <em>recurrent</em>, if it does not we will call it <em>transient</em>.</p>
<p>Itâ€™s worth to spend a moment visiting Polyaâ€™s Random Walk Theorem, a fascinating, but not so intuitive result.</p>
<p>Assuming all random walks start at the origin, we define <span class="math inline">\(u\)</span> to be the probability that a random walker returns to the origin. The probability that the random walker returns to the origin exactly <span class="math inline">\(m\)</span> times is:</p>
<p><span class="math display">\[\begin{align*}
{m \choose m-1} u^{m-1} (1 - u)^{m - (m - 1)} = u^{m-1}(1-u)
\end{align*}\]</span></p>
<p>The expected number of times the particle returns to the origin for an infinite random walk is:</p>
<p><span class="math display">\[\begin{align*}
E &amp;= \sum_{m = 1}^{\infty} m (u^{m-1}(1-u))\\
&amp;= (1-u)\sum_{m=1}^{\infty}mu^{m-1}\\
&amp;= (1-u)\sum_{m=1}^{\infty}\frac{d}{du}u^{m}\\
\end{align*}\]</span></p>
<p>We note that limit exchanging is acceptable since the power series <span class="math inline">\(\sum_{n=1}^{\infty}x^n\)</span> converges uniformly for <span class="math inline">\(u &lt; 1\)</span> and we can apply the differentiable limit theorem.</p>
<p>So we obtain:</p>
<p><span class="math display">\[\begin{align*}
E &amp;= (1-u)\frac{d}{du}\sum_{m = 1}^{\infty} u^m \\
&amp;= (1-u)\cdot \frac{1}{(1-u)^2}\\
&amp;= \frac{1}{1-u}
\end{align*}\]</span></p>
<p>So, we see that if <span class="math inline">\(E\)</span> is finite, <span class="math inline">\(u &lt; 1\)</span>, then the walk is transient and if <span class="math inline">\(E = +\infty\)</span>, <span class="math inline">\(u=1\)</span>, then the walk is recurrent.</p>
<p>We then define <span class="math inline">\(u_n\)</span> to be the probability that a given walk is at the origin on the <span class="math inline">\(n\)</span>th step, defining the value <span class="math inline">\(u_0=1\)</span> for the trivial loop. We also introduce an indicator random variable <span class="math inline">\(x_n\)</span>, which takes the value <span class="math inline">\(1\)</span>, if the particle is at the origin on the <span class="math inline">\(n\)</span>th step and zero otherwise.</p>
<p>Then</p>
<p><span class="math display">\[\begin{align*}
T = \sum_{n=1}^{\infty}x_n
\end{align*}\]</span></p>
<p>is the total number of times, the particle is at the origin, so <span class="math inline">\(E\)</span> is equal to the expectation of <span class="math inline">\(T\)</span>, <span class="math inline">\(\mathbb{E}(T)\)</span>, which is equal to:</p>
<p><span class="math display">\[\begin{align*}
\mathbb{E}[T] &amp;= \sum_{n=1}^{\infty}\mathbb{E}[x_n]\\
&amp;= \sum_{n=1}^{\infty} u_n
\end{align*}\]</span></p>
<p>But, we showed previously that if <span class="math inline">\(E\)</span> is finite, then the walk is transient and if <span class="math inline">\(E = \infty\)</span>, then the walk is recurrent, so we have established that if:</p>
<p><span class="math display">\[\begin{align*}
\sum_{n=1}^{\infty}u_n
\end{align*}\]</span></p>
<p>converges then the walk is transient and if the sum diverges, then the walk is recurrent.</p>
<section id="mathbbz1-case" class="level3">
<h3 class="anchored" data-anchor-id="mathbbz1-case"><span class="math inline">\(\mathbb{Z}^1\)</span> case</h3>
<p>Now that we have built up the necessary tools, we will consider the cases. We start by considering a simple random walk on <span class="math inline">\(\mathbb{Z}^1\)</span>. Since, as mentioned previously, a walk must have an even number of steps to be a loop, we only look at <span class="math inline">\(u_{2n},n \in \mathbb{Z}^+\)</span>. A path of length <span class="math inline">\(2n\)</span> returning to the origin must have <span class="math inline">\(n\)</span> up-moves and <span class="math inline">\(n\)</span> down-moves. The number of such paths are <span class="math inline">\({2n \choose n}\)</span>. Each such path has a probability of occurrence <span class="math inline">\(\frac{1}{2^{2n}}\)</span>. Thus,</p>
<p><span class="math display">\[\begin{align*}
u_{2n} = \frac{1}{2^{2n}}{2n \choose n}
\end{align*}\]</span></p>
<p>Using Stirlingâ€™s approximation <span class="math inline">\(n! \sim \sqrt{2\pi n} e^{-n} n^{n}\)</span>, we obtain:</p>
<p><span class="math display">\[\begin{align*}
u_{2n} &amp;= \frac{1}{2^{2n}} \frac{(2n)!}{n! n!}\\
&amp;\approx \frac{1}{2^{2n}} \cdot \frac{\sqrt{2\pi(2n)} e^{-2n}(2n)^{2n}}{\left(\sqrt{2\pi n} e^{-n} n^n\right)^2}\\
&amp;=\frac{1}{\sqrt{\pi n}}
\end{align*}\]</span></p>
<p>So, we see that:</p>
<p><span class="math display">\[\begin{align*}
\sum_{n=0}^{\infty} u_{2n} \approx \sum_{n=0}^{\infty} \frac{1}{\sqrt{n\pi}}
\end{align*}\]</span></p>
<p>And the series on the right certainly diverges so, we see that a simple random walk in <span class="math inline">\(\mathbb{Z}^1\)</span> is recurrent since <span class="math inline">\(E\)</span> diverges.</p>
</section>
<section id="mathbbz2-case" class="level3">
<h3 class="anchored" data-anchor-id="mathbbz2-case"><span class="math inline">\(\mathbb{Z}^2\)</span> case</h3>
<p>A particle has an equal probability <span class="math inline">\(1/4\)</span> of moving left, right, up or down randomly in the <span class="math inline">\(d=2\)</span> dimensional lattice. Each path of <span class="math inline">\(2n\)</span> steps has a probability <span class="math inline">\(\frac{1}{4^{2n}}\)</span> of occurring. We then consider the number of paths with equal steps left and right (say <span class="math inline">\(L\)</span> steps in each horizontal direction) and equal steps up and down (then <span class="math inline">\(n-L\)</span>) is:</p>
<p><span class="math display">\[\begin{align*}
{2n \choose L}{2n - L \choose L}{2n - 2L \choose n - L}{n-L \choose n - L} = \frac{(2n)!}{L! L! (n-L)! (n-L)!}
\end{align*}\]</span></p>
<p>So we get:</p>
<p><span class="math display">\[\begin{align*}
u_{2n} &amp;= \frac{1}{4^{2n}} \sum_{L=0}^n \frac{(2n)!}{L! L! (n-L)! (n-L)!} \\
&amp;= \frac{1}{4^{2n}} \sum_{L=0}^n \frac{(2n)!}{n! n!} \cdot \left(\frac{n!}{L! (n-L)!}\right)^2 \\
&amp;=\frac{1}{4^{2n}} {2n \choose n}\sum_{L=0}^n {n \choose L}^2
\end{align*}\]</span></p>
<p>Suppose, we are to form a team of <span class="math inline">\(n\)</span> players from a population of <span class="math inline">\(2n\)</span> participants. There <span class="math inline">\({2n \choose n}\)</span> distinguishable teams of size <span class="math inline">\(n\)</span>. Alternatively, we could divide the population into two halves of <span class="math inline">\(n\)</span> participants each, choose <span class="math inline">\(L\)</span> participants from the first sub-population, and the remaining <span class="math inline">\(n-L\)</span> participants from the second sub-population. So, the number of distinguishable teams is:</p>
<p><span class="math display">\[\begin{align*}
\sum_{L=0}^{n}{n \choose L}{n \choose n - L} = \sum_{L=0}^{n} {n \choose L}^2
\end{align*}\]</span></p>
<p>So, we have the combinatorial identity:</p>
<p><span class="math display">\[\begin{align*}
\sum_{L=0}^{n} {n \choose L}^2 = {2n \choose n}
\end{align*}\]</span></p>
<p>Thus,</p>
<p><span class="math display">\[\begin{align*}
u_{2n} &amp;=\frac{1}{4^{2n}} {2n \choose n}\sum_{L=0}^n {n \choose L}^2\\
&amp;= \left(\frac{1}{2^{2n}} {2n \choose n}\right)^2
\end{align*}\]</span></p>
<p>So, we have that, it is just the square of the result from <span class="math inline">\(\mathbb{Z}^1\)</span>, so we see in this case that:</p>
<p><span class="math display">\[\begin{align*}
u_{2n} &amp;\approx \sum_{n=0}^{\infty} \frac{1}{\pi n}
\end{align*}\]</span></p>
<p>And the series on the right certainly diverges, so we see that a simple random walk in <span class="math inline">\(\mathbb{Z}^2\)</span> is recurrent as <span class="math inline">\(E\)</span> diverges.</p>
</section>
<section id="mathbbz3-case" class="level3">
<h3 class="anchored" data-anchor-id="mathbbz3-case"><span class="math inline">\(\mathbb{Z}^3\)</span> case</h3>
<p>As before, in order to have a walk return to the origin we must have equal steps in the positive and negative directions for each direction and each path of <span class="math inline">\(2n\)</span> has a probability of occurring of <span class="math inline">\(\frac{1}{6^{2n}}\)</span>. Then, extending the idea from the previous subsection, the number of paths (of total length <span class="math inline">\(2n\)</span>) with <span class="math inline">\(L\)</span> steps left and right, <span class="math inline">\(U\)</span> steps up and down and <span class="math inline">\(n - L - U\)</span> steps forward and backward is:</p>
<p><span class="math display">\[\begin{align*}
\frac{(2n)!}{L! L! U! U! (n - L - U)! (n - L - U)!}
\end{align*}\]</span></p>
<p>So, we get:</p>
<p><span id="eq-probability-of-return-to-origin-at-nth-step-in-3d"><span class="math display">\[
\begin{align*}
u_{2n} &amp;= \frac{1}{6^{2n}} \sum_{L,U,L+U \leq n} \frac{(2n)!}{L! L! U! U! (n - L - U)! (n - L - U)!} \\
&amp;= \frac{1}{2^{2n}} {2n \choose n} \sum_{L,U,L+U \leq n} \left(\frac{1}{3^n}\frac{n!}{L! U! (n - U - L)!}\right)^2
\end{align*}
\tag{3}\]</span></span></p>
<p>Consider a <span class="math inline">\(3\)</span>-sided fair coin, with <span class="math inline">\(\mathbb{P}\{\text{Heads}\} = \mathbb{P}\{\text{Tails}\} = \mathbb{P}\{\text{Edge}\} = \frac{1}{3}\)</span>. Suppose that the coin is tossed <span class="math inline">\(n=3^2 = 9\)</span> times. The probability of landing <span class="math inline">\(L\)</span> heads, <span class="math inline">\(U\)</span> tails and <span class="math inline">\(n - L - U\)</span> edges is <span class="math inline">\(\frac{n!}{L!U!(n-L-U)!} \frac{1}{3^n}\)</span>. This is precisely the term seen in the above expression. The number of heads, tails and edges in <span class="math inline">\(n\)</span> coin tosses follows a multinomial distribution. It can be easily demonstrated, that in, <span class="math inline">\(n/3 = 3\)</span> heads, <span class="math inline">\(n/3\)</span> tails and <span class="math inline">\(n/3\)</span> edges are most likely to occur in <span class="math inline">\(n\)</span> coin tosses. So, we can find an upper bound on the summand in <a href="#eq-probability-of-return-to-origin-at-nth-step-in-3d" class="quarto-xref">Equation&nbsp;3</a> as:</p>
<p><span class="math display">\[\begin{align*}
\frac{n!}{3^n L! U! (n- L - U)!} \leq \frac{n!}{3^n \lfloor\frac{n}{3}\rfloor! \lfloor\frac{n}{3}\rfloor! \lfloor\frac{n}{3}\rfloor!}
\end{align*}\]</span></p>
<p>Also, from the multinomial expansion theorem:</p>
<p><span class="math display">\[\begin{align*}
(1 + a + b)^n = \sum_{L,U,L+U\leq n} \frac{n!}{L! U! (n-L-U)!} a^L b^U
\end{align*}\]</span></p>
<p>Setting <span class="math inline">\(a = b = 1\)</span>, we get:</p>
<p><span class="math display">\[\begin{align*}
\sum_{L,U,L+U\leq n} \frac{n!}{3^n L! U! (n-L-U)!} a^L b^U = 1
\end{align*}\]</span></p>
<p>We then see that:</p>
<p><span class="math display">\[\begin{align*}
u_{2n} \leq \frac{1}{2^{2n}} {2n \choose n} \frac{n!}{3^n \lfloor\frac{n}{3}\rfloor! \lfloor\frac{n}{3}\rfloor! \lfloor\frac{n}{3}\rfloor!}
\end{align*}\]</span></p>
<p>We can simplify this as:</p>
<p><span class="math display">\[\begin{align*}
u_{2n} &amp;= \frac{1}{2^{2n}}{2n \choose n} \frac{n!}{3^n \left(\lfloor\frac{n}{3}\rfloor!\right)^3} \\
&amp;\approx \frac{1}{\sqrt{\pi n}} \times \frac{\sqrt{2\pi n} e^{-n} n^n}{3^n \left\{\sqrt{2\pi \frac{n}{3}}e^{-n/3} \left(\frac{n}{3}\right)^{n/3}\right\}^3}\\
&amp;= \frac{1}{\sqrt{\pi n}} \frac{\sqrt{2\pi n} e^{-n} n^n}{3^n \frac{(2\pi n)^{3/2}}{3^{3/2}} e^{-n} \frac{n^n}{3^n}}\\
&amp;= \frac{1}{\sqrt{\pi n}} \frac{\sqrt{2\pi n} \cancel{e^{-n}} \cancel{n^n}}{\cancel{3^n} \frac{(2\pi n)^{3/2}}{3^{3/2}} \cancel{e^{-n}} \frac{ \cancel{n^n}}{\cancel{3^n}}}\\
&amp;\approx \frac{M}{(\pi n)^{3/2}}
\end{align*}\]</span></p>
<p>where <span class="math inline">\(M\)</span> is a positive constant. We then see:</p>
<p><span class="math display">\[\begin{align*}
\sum_n u_{2n} &amp;= M \sum_n \frac{1}{n^{\frac{3}{2}}}
\end{align*}\]</span></p>
<p>The sum on the right hand side converges, so we have that a simple random walk in three dimensions is transient. The proof of Polyaâ€™s Random Walk Theorem is complete.</p>
</section>
</section>
<section id="recurrence-and-transience-of-brownian-motion" class="level2">
<h2 class="anchored" data-anchor-id="recurrence-and-transience-of-brownian-motion">Recurrence and Transience of Brownian Motion</h2>
<p>In one dimension, we established that every path of a Brownian motion reaches any level <span class="math inline">\(a \in \mathbf{R}\)</span>. More precisely, for <span class="math inline">\(a &gt; 0\)</span>, if we define the stopping time :</p>
<p><span class="math display">\[\begin{align*}
\tau = \min \{ t \geq 0 : B_t \geq a\}
\end{align*}\]</span></p>
<p>we have <span class="math inline">\(\mathbb{P}\{\tau_a &lt; \infty \} = 1\)</span>. This implies in particular that every path will come back to <span class="math inline">\(0\)</span> and will do infinitely many times. This is because <span class="math inline">\(B(t+\tau) - B(t)\)</span> is a standard brownian motion. This property of Brownian motion is called <em>recurrence</em>. This is to be compared with Brownian motion with a drift. In our analysis, we found that, if the drift is negative, then there are paths that will not reach a given level <span class="math inline">\(a &gt; 0\)</span> with positive probability. Such paths go to infinity without ever going back to <span class="math inline">\(0\)</span>. This property of the process is called <em>transience</em>.</p>
<p>We can derive similar properties for the multidimensional Brownian motion. We will rely heavily on <a href="#cor-brownian-martingales" class="quarto-xref">Corollary&nbsp;1</a> and on some knowledge of harmonic functions. Harmonic functions play a very important role in mathematics, physics and in nature in general. As we mentioned earlier, if <span class="math inline">\(d = 1\)</span>, the only harmonic functions are the linear functions, since the equation <span class="math inline">\(f''(x) = 0\)</span> has the solutions <span class="math inline">\(f(x)=ax+b\)</span>. However, in higher dimensions, the collection of harmonic functions is very rich. This gives access to a plethora of Brownian martingales. For example, the following functions are harmonic in the whole space minus the origin, <span class="math inline">\(\mathbf{R}^d \setminus \{0\}\)</span>.</p>
<p><span id="eq-example-of-harmonic-function"><span class="math display">\[
h(x) = \begin{cases}
\log ||x||, &amp; d = 2 \\
||x||^{2 - d}, &amp; d \geq 3
\end{cases}
\tag{4}\]</span></span></p>
<p>where <span class="math inline">\(x\in\mathbf{R}^d\)</span>.</p>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>Consider</p>
<p><span class="math display">\[\begin{align*}
f(x_1,x_2) = \log \sqrt {x_1^2 + x_2^2}
\end{align*}\]</span></p>
<p>We have:</p>
<p><span class="math display">\[\begin{align*}
\frac{\partial f}{\partial x_1} &amp;= \frac{1}{\sqrt{x_1^2 + x_2^2}} \cdot \frac{\partial }{\partial x_1} (\sqrt{x_1^2 + x_2^2})\\
&amp;=\frac{1}{\sqrt{x_1^2 + x_2^2}} \cdot \frac{x_1}{\sqrt{x_1^2 + x_2^2}}\\
&amp;= \frac{x_1}{x_1^2 + x_2^2}
\end{align*}\]</span></p>
<p>Further,</p>
<p><span class="math display">\[\begin{align*}
\frac{\partial^2 f}{\partial x_1^2} &amp;= \frac{(x_1^2 + x_2^2)(1) - x_1(2x_1)}{(x_1^2 + x_2^2)^2} \\
&amp;= \frac{x_1^2 - x_2^2}{(x_1^2 + x_2^2)}
\end{align*}\]</span></p>
<p>By symmetry,</p>
<p><span class="math display">\[\begin{align*}
\frac{\partial^2 f}{\partial x_2^2}
&amp;= \frac{x_2^2 - x_1^2}{(x_1^2 + x_2^2)}
\end{align*}\]</span></p>
<p>So,</p>
<p><span class="math display">\[\begin{align*}
\frac{\partial^2 f}{\partial x_1^2} &amp;= - \frac{\partial^2 f}{\partial x_2^2}\\
\frac{\partial^2 f}{\partial x_1^2} + \frac{\partial^2 f}{\partial x_2^2}&amp;=0
\end{align*}\]</span></p>
<p>We conclude that <span class="math inline">\(f\)</span> is harmonic.</p>
<p>Next, consider</p>
<p><span class="math display">\[\begin{align*}
g(x_1,x_2,\ldots,x_d) = \frac{1}{\left(\sqrt{x_1^2 + x_2^2 + \ldots + x_d^2}\right)^{d-2}}
\end{align*}\]</span></p>
<p>Now,</p>
<p><span class="math display">\[\begin{align*}
\frac{\partial g}{\partial x_i} &amp;= \frac{(2-d)}{\left(\sqrt{x_1^2 + x_2^2 + \ldots + x_d^2}\right)^{d-1}} \cdot \frac{\partial }{\partial x_i}\left(\sqrt{x_1^2 + x_2^2 + \ldots + x_d^2}\right)\\
&amp;= \frac{(2-d)}{\left(\sqrt{x_1^2 + x_2^2 + \ldots + x_d^2}\right)^{d-1}}\cdot \frac{2x_i}{2\left(\sqrt{x_1^2 + x_2^2 + \ldots + x_d^2}\right)}\\
&amp;= \frac{(2-d)x_i}{\left(\sqrt{x_1^2 + x_2^2 + \ldots + x_d^2}\right)^d}
\end{align*}\]</span></p>
<p>Further, we have:</p>
<p><span class="math display">\[\begin{align*}
\frac{\partial^2 g}{\partial x_i^2} &amp;= (2-d)\frac{\left(\sqrt{x_1^2 + x_2^2 + \ldots + x_d^2}\right)^d (1) - (x_i)\cdot d \cdot\left(\sqrt{x_1^2 + x_2^2 + \ldots + x_d^2}\right)^{d-1}\cdot \frac{x_i}{\left(\sqrt{x_1^2 + x_2^2 + \ldots + x_d^2}\right)}}{\left(\sqrt{x_1^2 + x_2^2 + \ldots + x_d^2}\right)^{2d}}\\
&amp;=(2-d)\left(\sqrt{x_1^2 + x_2^2 + \ldots + x_d^2}\right)^{d-2} \frac{\left(\sqrt{x_1^2 + x_2^2 + \ldots + x_d^2}\right)^2  - d x_i^2}{\left(\sqrt{x_1^2 + x_2^2 + \ldots + x_d^2}\right)^{2d}}\\
&amp;=(2-d) \frac{\left(\sum_{i=1}^d x_i^2\right) - dx_i^2 }{||x||^{d+2}}
\end{align*}\]</span></p>
<p>We conclude that:</p>
<p><span class="math display">\[\begin{align*}
\sum_{i=1}^{d} \frac{\partial^2 g}{\partial x_i^2} = 0
\end{align*}\]</span></p>
<p>and hence <span class="math inline">\(g\)</span> is harmonic.</p>
</div>
<p>Interestingly enough, the answer to the recurrence versus transience puzzle depends on the dimension. We will show that Brownian motion is recurrent in dimension <span class="math inline">\(d=2\)</span> in the sense that every Brownian motion path starting from <span class="math inline">\(x\)</span> will eventually enter a disc around the origin, no matter how small the disc is. The Brownian path will then enter this disc infinitely many times, as <span class="math inline">\(t \to \infty\)</span>. Note that, we did not say that the path actually hits <span class="math inline">\(0\)</span>, but that <em>it enters a disc around the <span class="math inline">\(0\)</span></em>. This nuance is important, as we will in fact show that a Brownian path actually never hits a given point. In dimension <span class="math inline">\(d=3\)</span> or higher, it is proved that there are some paths starting from a given <span class="math inline">\(x\)</span> that will never enter a given ball around the origin with positive probability. This is the transience property.</p>
<p>The strategy of the proof is similar to the approach for Brownian motion with a drift. We will find a good function <span class="math inline">\(h : \mathbf{R}^d \to \mathbf{R}\)</span> for which <span class="math inline">\(h(B_t)\)</span> is a martingale. In light of <a href="#cor-brownian-martingales" class="quarto-xref">Corollary&nbsp;1</a>, this function needs to be harmonic in a suitable region. The desired probability is then obtained by considering the right boundary values.</p>
<div id="thm-recurrence-and-transience-of-brownian-motion" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3 (Recurrence and transience of a brownian motion in <span class="math inline">\(\mathbf{R}^d\)</span>)</strong></span> Let <span class="math inline">\((B_t,t\geq 0)\)</span> be a Brownian motion in <span class="math inline">\(\mathbf{R}^d\)</span> starting at <span class="math inline">\(B_0 = x\)</span>. Consider for <span class="math inline">\(r &lt; ||x||\)</span>, the stopping time</p>
<p><span class="math display">\[\begin{align*}
\tau_r = \min \{t \geq 0 : ||B_t|| &lt; r\}
\end{align*}\]</span></p>
<p>the first hitting time of the paths in a ball of radius <span class="math inline">\(r\)</span> around the origin. We have:</p>
<p><span class="math display">\[\begin{align*}
\mathbb{P}(\tau_r &lt; \infty) =
\begin{cases}
1 &amp; \text{ if }d \leq 2 \\
\left(\frac{r}{||x||}\right)^{d-2} &amp; \text{ if }d \geq 3
\end{cases}
\end{align*}\]</span></p>
<p>In particular, for <span class="math inline">\(d \leq 2\)</span>, the paths are recurrent; that is, they come back infinitely many times in a neighbourhood of the origin. For <span class="math inline">\(d \geq 3\)</span>, each path will eventually never come back to a neighbourhood of the origin.</p>
</div>
<p>Note that we made sure that the starting point of the Brownian motion <span class="math inline">\(x\)</span> is outside the ball of radius <span class="math inline">\(r\)</span>.</p>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>Consider another hitting time of a ball with a radius larger than <span class="math inline">\(||x||\)</span>:</p>
<p><span class="math display">\[\begin{align*}
\tau_R' = \min \{t \geq 0 : ||B_t|| \geq R\}, \quad r &lt; ||x|| &lt; R
\end{align*}\]</span></p>
<p>Note that <span class="math inline">\(\tau_R'\)</span> must increase with <span class="math inline">\(R\)</span> and that it must go to <span class="math inline">\(+\infty\)</span> as <span class="math inline">\(R \to \infty\)</span>. Moreover, the sequence of events <span class="math inline">\(\{\tau_r &lt; \tau_R'\}_{R &gt; ||x||}\)</span> is increasing. In particular, by continuity of probability measure, we have:</p>
<p><span class="math display">\[\begin{align*}
\lim_{R \to \infty} \mathbb{P}(\tau_r &lt; \tau_R') &amp;= \mathbb{P}(\lim_{R \to \infty} \tau_r &lt; \tau_R')\\
&amp;= \mathbb{P}(\tau_r &lt; \infty)
\end{align*}\]</span></p>
<p>If we set <span class="math inline">\(\tau = \tau_r \land \tau_R'\)</span>, then the event <span class="math inline">\(\{\tau_r &lt; \tau_R'\}\)</span> is the same as the event <span class="math inline">\(\{||B_\tau||=r\}\)</span>. So, <span class="math inline">\(\lim_{R \to \infty} \mathbb{P}(\tau_r &lt; \tau_R') = \lim_{R \to \infty} \mathbb{P}(||B_\tau||=r)\)</span>.</p>
<p>Now, consider the event <span class="math inline">\(\{\tau &lt; \infty\}\)</span>. Let <span class="math inline">\(E_n\)</span> be the event that the <span class="math inline">\(n\)</span>th increment <span class="math inline">\(||B_n - B_{n-1}||\)</span> exceeds <span class="math inline">\(R\)</span>. If <span class="math inline">\(E_n\)</span> occurs, then we must have the Brownian motion exits the spherical shell of thickness <span class="math inline">\(R-r\)</span>. Moreover, we have <span class="math inline">\(\mathbb{P}(E_1) = \ldots = \mathbb{P}(E_n)\)</span>, for all <span class="math inline">\(n\)</span>. Call this probability <span class="math inline">\(p\)</span>. Clearly, <span class="math inline">\(0 &lt; p &lt; 1\)</span>. Since the events <span class="math inline">\(E_n\)</span> are independent, we have:</p>
<p><span class="math display">\[\begin{align*}
\mathbb{P}(E_1^C \cap \ldots \cap E_n^C) = (1 - p)^n
\end{align*}\]</span></p>
<p>As <span class="math inline">\(n \to \infty\)</span>, we have <span class="math inline">\(\lim_{n \to \infty} \mathbb{P}(\bigcap_{k=1}^{n}E_k^C) = 0\)</span>. Now, let <span class="math inline">\(F_k\)</span> be the event that there are no excursions upto <span class="math inline">\(k\)</span>. That is, <span class="math inline">\(F_k = \bigcap_{i=1}^{k}E_i^C\)</span>. Now, the event <span class="math inline">\(F_{k+1}\)</span> implies <span class="math inline">\(F_k\)</span>, or equivalently, <span class="math inline">\(F_{k+1} \subseteq F_k\)</span>. So, <span class="math inline">\(\{F_k\}_{k=1}^{\infty}\)</span> is a decreasing sequence of events. Moreover, <span class="math inline">\(\bigcap_{k=1}^n F_k = \bigcap_{k=1}^n E_k^C\)</span>. So, by continuity of probability measure,</p>
<p><span class="math display">\[\begin{align*}
\lim_{n \to \infty} \mathbb{P}(\bigcap_{k=1}^{n}E_k^C)
&amp;= \lim_{n \to \infty} \mathbb{P}(\bigcap_{k=1}^{n}F_k) \\
&amp;= \mathbb{P}(\lim_{n \to \infty} \bigcap_{k=1}^{n}F_k) \\
&amp;= \mathbb{P}(\bigcap_{k=1}^{\infty}F_k) \\
&amp;= \mathbb{P}(\bigcap_{k=1}^{\infty}E_k^C)
\end{align*}\]</span></p>
<p>So, <span class="math inline">\(\mathbb{P}(\bigcup_{k=1}^{\infty}E_k) = 1\)</span>. There exists an <span class="math inline">\(n_0 \in \mathbf{N}\)</span>, such that the event <span class="math inline">\(E_{n_0}\)</span>, an excursion at <span class="math inline">\(n_0\)</span> occurs with probability <span class="math inline">\(1\)</span>. So, the event <span class="math inline">\(\{\tau &lt; \infty\}\)</span> occurs almost surely.</p>
<p>To compute <span class="math inline">\(\mathbb{P}(||B_\tau||=r)\)</span>, the idea is to find a good function <span class="math inline">\(h\)</span> with the following properties:</p>
<ul>
<li><strong>Martingale</strong>: <span class="math inline">\((h(B_t),t\leq \tau)\)</span> is a bounded martingale, so that the optional stopping theorem implies:</li>
</ul>
<p><span class="math display">\[\begin{align*}
\mathbb{E}[h(B_\tau)] = h(B_0) = h(x)
\end{align*}\]</span></p>
<ul>
<li><strong>Boundary values</strong>: Since <span class="math inline">\(B_\tau\)</span> is a point at <span class="math inline">\(||x||=r\)</span> or at <span class="math inline">\(||x||=R\)</span>, we pick boundary conditions for <span class="math inline">\(h\)</span>, so that <span class="math inline">\(\mathbb{E}[h(B_{\tau})]=\mathbb{P}(||B_\tau||=r)\)</span>.</li>
</ul>
<p>The second point is easy; it suffices to take the <em>boundary conditions</em> <span class="math inline">\(h(x)=0\)</span> at <span class="math inline">\(||x||=R\)</span> and <span class="math inline">\(h(x)=1\)</span> at <span class="math inline">\(||x||=r\)</span>. For the first point, by Itoâ€™s formula, we pick <span class="math inline">\(h\)</span> to be harmonic in the annulus <span class="math inline">\(\{x \in \mathbf{R}^d : r &lt; ||x||&lt;R \}\)</span>. Thus, we can use the function in <a href="#eq-example-of-harmonic-function" class="quarto-xref">Equation&nbsp;4</a>. Of course, the functions <span class="math inline">\(ah(x) + b\)</span> remain harmonic. To satisfy the boundary conditions, we pick <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> suitably:</p>
<section id="mathbbr1-case" class="level3">
<h3 class="anchored" data-anchor-id="mathbbr1-case"><span class="math inline">\(\mathbb{R}^1\)</span> case</h3>
<p>Let <span class="math inline">\(h(x) = ax + b\)</span>. Then, at <span class="math inline">\(x=r\)</span>, we have:</p>
<p><span id="eq-boundary-condition-5"><span class="math display">\[
\begin{align*}
ar + b = 1
\end{align*}
\tag{5}\]</span></span></p>
<p>and at <span class="math inline">\(x = R\)</span>, we have:</p>
<p><span id="eq-boundary-condition-6"><span class="math display">\[
\begin{align*}
aR + b = 0
\end{align*}
\tag{6}\]</span></span></p>
<p>So, <span class="math inline">\(b = -aR\)</span>. Substituting in <a href="#eq-boundary-condition-5" class="quarto-xref">Equation&nbsp;5</a>, we get:</p>
<p><span class="math display">\[\begin{align*}
a &amp;= \frac{1}{r - R}
b &amp;= -\frac{R}{r - R}
\end{align*}\]</span></p>
<p>Consequently,</p>
<p><span id="eq-h(x)-R1-case"><span class="math display">\[
\begin{align*}
h(x) &amp;= \frac{R - x}{R - r}
\end{align*}
\tag{7}\]</span></span></p>
</section>
<section id="mathbbr2-case" class="level3">
<h3 class="anchored" data-anchor-id="mathbbr2-case"><span class="math inline">\(\mathbb{R}^2\)</span> case</h3>
<p>Let <span class="math inline">\(h(x) = \log ||x||\)</span>. Then, at <span class="math inline">\(||x||=r\)</span>, we have:</p>
<p><span id="eq-boundary-condition-1"><span class="math display">\[
\begin{align*}
a \log ||x|| + b &amp;= 1
a \log r + b &amp;= 1
\end{align*}
\tag{8}\]</span></span></p>
<p>At <span class="math inline">\(||x||=R\)</span>, we have:</p>
<p><span id="eq-boundary-condition-2"><span class="math display">\[
\begin{align*}
a \log ||x|| + b &amp;= 0
a \log R + b &amp;= 0
\end{align*}
\tag{9}\]</span></span></p>
<p>Thus, from <a href="#eq-boundary-condition-2" class="quarto-xref">Equation&nbsp;9</a>, <span class="math inline">\(b = -a \log R\)</span>. Substituting the value for <span class="math inline">\(b\)</span> in <a href="#eq-boundary-condition-1" class="quarto-xref">Equation&nbsp;8</a>, we have:</p>
<p><span class="math display">\[
\begin{align*}
a \log r - a \log R &amp;= 1\\
a &amp;= \frac{1}{\log r - \log R}
\end{align*}
\]</span></p>
<p>Consequently,</p>
<p><span id="eq-h(x)-R2-case"><span class="math display">\[
\begin{align*}
h(x) &amp;= \frac{\log ||x||}{\log r - \log R} -  \frac{1}{\log r - \log R} \log R\\
&amp;= \frac{\log R - \log ||x||}{\log R - \log r}
\end{align*}
\tag{10}\]</span></span></p>
</section>
<section id="mathbbrd-d-geq-3-case" class="level3">
<h3 class="anchored" data-anchor-id="mathbbrd-d-geq-3-case"><span class="math inline">\(\mathbb{R}^d\)</span>, <span class="math inline">\(d \geq 3\)</span> case</h3>
<p>Let <span class="math inline">\(h(x)=||x||^{2-d}\)</span>. At <span class="math inline">\(||x||=r\)</span>, <span class="math inline">\(a h(x) + b = 1\)</span>. So, we have:</p>
<p><span id="eq-boundary-condition-3"><span class="math display">\[
\begin{align*}
a r^{2-d} + b = 1
\end{align*}
\tag{11}\]</span></span></p>
<p>At <span class="math inline">\(||x||=R\)</span>, <span class="math inline">\(ah(x) + b = 0\)</span>. So, we have:</p>
<p><span id="eq-boundary-condition-4"><span class="math display">\[
\begin{align*}
a ||R||^{2-d} + b &amp;= 0
\end{align*}
\tag{12}\]</span></span></p>
<p>From <a href="#eq-boundary-condition-4" class="quarto-xref">Equation&nbsp;12</a>, we get <span class="math inline">\(b = -a R^{2-d}\)</span>. Substituting this value in <a href="#eq-boundary-condition-3" class="quarto-xref">Equation&nbsp;11</a>, we get:</p>
<p><span class="math display">\[\begin{align*}
a r^{2-d} - aR^{2-d}  &amp;= 1\\
a &amp;= \frac{1}{r^{2-d} - R^{2-d}}
\end{align*}\]</span></p>
<p>And</p>
<p><span class="math display">\[
\begin{align*}
b = - \frac{R^{2-d}}{r^{2-d} - R^{2-d}}
\end{align*}
\]</span></p>
<p>Thus,</p>
<p><span id="eq-h(x)-R3-case"><span class="math display">\[
\begin{align*}
h(x) &amp;= \frac{||x||^{2-d}}{r^{2-d} - R^{2-d}} - \frac{R^{2-d}}{r^{2-d} - R^{2-d}}\\
&amp;= \frac{R^{2-d} - ||x||}{R^{2-d} - r^{2-d}}
\end{align*}
\tag{13}\]</span></span></p>
<p>Collecting all the results together, we get:</p>
<p><span id="eq-hx-in-Rd-case"><span class="math display">\[
h(x) = \begin{cases}
\frac{R - x}{R - r}, &amp; d=1 \\
\frac{\log R - \log ||x||}{\log R - \log r}, &amp; d=2 \\
\frac{R^{2-d} - ||x||^{2-d}}{R^{2-d} - r^{2-d}}, &amp; d \geq 3
\end{cases}
\tag{14}\]</span></span></p>
<p>Passing to the limit as <span class="math inline">\(R \to \infty\)</span>, for <span class="math inline">\(d=1\)</span>, we have:</p>
<p><span class="math display">\[\begin{align*}
\lim_{R \to \infty} h(x) &amp;= \lim_{R \to \infty} \frac{R - x}{R - r} \\
&amp;= \lim_{R \to \infty} \frac{1 - \frac{x}{R}}{1 - \frac{r}{R}}\\
&amp;= 1
\end{align*}\]</span></p>
<p>For <span class="math inline">\(d = 2\)</span>, we get:</p>
<p><span class="math display">\[\begin{align*}
\lim_{R \to \infty} h(x) &amp;= \lim_{R \to \infty} \frac{1 - \frac{\log x}{\log R}}{1 - \frac{\log r}{\log R}} \\
&amp;= 1
\end{align*}\]</span></p>
<p>For <span class="math inline">\(d = 3\)</span>, we get:</p>
<p><span class="math display">\[\begin{align*}
\lim_{R \to \infty}  h(x) &amp;= \lim_{R \to \infty} \frac{R^{2-d} - ||x||^{2-d}}{R^{2-d} - r^{2-d}}\\
&amp;= \left(\frac{||x||}{r}\right)^{2-d}
\end{align*}\]</span></p>
<p>This concludes the proof. <span class="math inline">\(\blacksquare\)</span></p>
</section>
</div>
<div id="exm-brownian-path-in-Rd-never-hits-a-given-point" class="theorem example">
<p><span class="theorem-title"><strong>Example 4</strong></span> We get more from the above proof. Indeed, in dimension <span class="math inline">\(d \geq 2\)</span>, it implies that the probability that a Brownian motion starting at <span class="math inline">\(B_0 = x\)</span> eventually hits any other point <span class="math inline">\(y\)</span> is <span class="math inline">\(0\)</span>. Indeed, if we take <span class="math inline">\(y = 0\)</span> and <span class="math inline">\(x \neq 0\)</span>, we have:</p>
<p><span class="math display">\[
\begin{align*}
\mathbb{P}(\exists t &gt; 0: B_t = 0) &amp;= \lim_{R \to \infty} \lim_{r \to \infty} \mathbb{P}(\tau_r &lt; \tau_R')\\
&amp;= \lim_{R \to \infty} \lim_{r \to \infty} \frac{R^{2-d} - ||x||^{2-d}}{R^{2-d} - r^{2-d}}\\
&amp;=\lim_{R \to \infty}  \lim_{r \to \infty} \frac{(R/r)^{2-d} - (||x||/r)^{2-d}}{(R/r)^{2-d} - 1}\\
&amp;= \lim_{R \to \infty} 0\\
&amp;= 0
\end{align*}
\]</span></p>
<p>Here, we shrink the inner radius to <span class="math inline">\(0\)</span> first and then we let the outer radius go to infinity after. It remains to take the limits of the expression obtained in equation <a href="#eq-hx-in-Rd-case" class="quarto-xref">Equation&nbsp;14</a>. The first limit <span class="math inline">\(r \to 0\)</span> gives <span class="math inline">\(0\)</span> right away.</p>
</div>
</section>
<section id="dynkins-formula-and-the-dirichlet-problem" class="level2">
<h2 class="anchored" data-anchor-id="dynkins-formula-and-the-dirichlet-problem">Dynkinâ€™s Formula and the Dirichlet Problem</h2>
<p>In the last section, we translated the problem of recurrence and transience of Brownian motion in terms of a <em>boundary value problem</em>: we needed to find a particular function <span class="math inline">\(h\)</span> that solves a PDE (that is, <span class="math inline">\(\nabla^2 h=0\)</span>) in a certain region of space(the annulus) and that satisfies given boundary conditions (the function is <span class="math inline">\(1\)</span> on the inner circle and <span class="math inline">\(0\)</span> on the outer circle). This is a particular case of the <em>Dirichlet problem</em> in PDE.</p>
<p>Consider a region <span class="math inline">\(\mathcal{O} \subset \mathbb{R}^d\)</span>. <span class="math inline">\(\mathcal{O}\)</span> is an open ball. That is, for all <span class="math inline">\(x \in \mathcal{O}\)</span>, there exists <span class="math inline">\(\epsilon&gt;0\)</span>, such that <span class="math inline">\(V_\epsilon(x) = \{y : ||y - x|| &lt; \epsilon\}\)</span> is contained in <span class="math inline">\(\mathcal{O}\)</span>. <span class="math inline">\(\mathcal{O}\)</span> doesnâ€™t contain boundary points <span class="math inline">\(\partial \mathcal{O}\)</span>. In the proof of <a href="#thm-recurrence-and-transience-of-brownian-motion" class="quarto-xref">Theorem&nbsp;3</a>, the region was the annulus <span class="math inline">\(\{x: r &lt; ||x|| &lt; R\}\)</span> and the boundary was given by the spheres <span class="math inline">\(\{x :||x|| = r\}\)</span> and <span class="math inline">\(\{x: ||x||=R\}\)</span>. The Dirichlet problem in <span class="math inline">\(\mathcal{O}\)</span> can be stated as follows:</p>
<p>Let <span class="math inline">\(f:\partial\mathcal{O} \to \mathbb{R}\)</span> be a function on the boundary of <span class="math inline">\(\mathcal{O}\)</span>. Can we extend the function <span class="math inline">\(f\)</span> to <span class="math inline">\(O\)</span> in such a way that the extension is harmonic on <span class="math inline">\(\mathcal{O}\)</span> and coincides with <span class="math inline">\(f\)</span> on the boundary?</p>
<p>In the instance of the proof of the <a href="#thm-recurrence-and-transience-of-brownian-motion" class="quarto-xref">Theorem&nbsp;3</a>, we knew the solution of the problem, thanks to <a href="#eq-example-of-harmonic-function" class="quarto-xref">Equation&nbsp;4</a>. The only job left to do was to adjust some parameters to fit the boundary conditions. It turns out that the formalism of stochastic calculus allows us to express the solution of the Dirichlet problem as an average over Brownian paths for general regions of space and boundary conditions. To do so, we look at a twist on the Itoâ€™s formula called the <em>Dynkinâ€™s formula</em>.</p>
<p>Let <span class="math inline">\(x\)</span> be a point in <span class="math inline">\(\mathcal{O}\)</span>. Consider a Brownian motion <span class="math inline">\((B_t,t\geq 0)\)</span> starting at <span class="math inline">\(x\)</span>, <span class="math inline">\(B_0 = x\)</span>. To emphasize the dependence on <span class="math inline">\(x\)</span>, we write <span class="math inline">\(\mathbb{P}_x\)</span> and <span class="math inline">\(\mathbb{E}_x\)</span> for the probability and the expectation for the Brownian motion. Dykinâ€™s formula is obtained by merging <a href="#cor-brownian-martingales" class="quarto-xref">Corollary&nbsp;1</a> for the Brownian martingales together with the optional stopping theorem. More precisely, consider <span class="math inline">\(f \in C^2(\mathbb{R}^d)\)</span> that satisfies the assumption of the <a href="#cor-brownian-martingales" class="quarto-xref">Corollary&nbsp;1</a>. We then have that the process:</p>
<p><span class="math display">\[\begin{align*}
M_t &amp;= f(B_t) - \frac{1}{2}\int_{0}^t \nabla^2 f(B_s) ds, \quad t \geq 0
\end{align*}\]</span></p>
<p>is a Brownian martingale.</p>
<p>Consider also the stopping time <span class="math inline">\(\tau = \min \{t \geq 0 : B_t \in \mathcal{O}^C\}\)</span>. This is the first exit time of <span class="math inline">\(\mathcal{O}\)</span> of the Brownian motion path. Then, if the assumptions of the optional stopping theorem are fulfilled, we get <em>Dynkinâ€™s formula</em>:</p>
<p><span id="eq-dynkins-formula"><span class="math display">\[
\begin{align*}
\mathbb{E}[M_\tau] = \mathbb{E}[f(B_\tau)] - \frac{1}{2} \mathbb{E}\left[\int_0^\tau \nabla^2 f(B_s)ds\right] = f(B_0) = M_0
\end{align*}
\tag{15}\]</span></span></p>
<p>As an application of Dynkinâ€™s formula, letâ€™s express the solution of the Dirichlet problem as an average over Brownian motion. If <span class="math inline">\(f\)</span> is harmonic in <span class="math inline">\(\mathcal{O}\)</span>, then <span class="math inline">\(\nabla^2 f = 0\)</span> in <span class="math inline">\(\mathcal{O}\)</span>, so the process <span class="math inline">\((f(B_t),t\leq \tau)\)</span> is itself a martingale. Note that since <span class="math inline">\(\mathcal{O}\)</span> is bounded, this is a bounded martingale! Moreover, the integrands <span class="math inline">\(\partial_i f(B_s)\)</span>, <span class="math inline">\(1 \leq i \leq d\)</span>, are bounded. We conclude that the solution to the Dirichlet problem can be represented as follows:</p>
<p><span id="eq-dynkins-formula-applied-to-dirichlet-problem"><span class="math display">\[
\begin{align*}
f(x) = \mathbb{E}_x[f(B_\tau)], \quad x \in \mathcal{O}
\end{align*}
\tag{16}\]</span></span></p>
<p>In other words, the value of the harmonic function of <span class="math inline">\(f\)</span> at <span class="math inline">\(x\)</span> is given by the average over the Brownian paths of the value of the function at the exit point of the path on the boundary of <span class="math inline">\(\mathcal{O}\)</span>. Equation <a href="#eq-dynkins-formula-applied-to-dirichlet-problem" class="quarto-xref">Equation&nbsp;16</a> does not prove the existence of the solution to the Dirichlet problem, as we assume that such a function exists. Existence of the solution to the Dirichlet problem can be shown this way, assuming the region <span class="math inline">\(\mathcal{O}\)</span> and the function on the boundary are nice enough. However, note that the averaging on the right-hand side of the formula makes sense even in the case where <span class="math inline">\(f\)</span> is simply defined on the boundary <span class="math inline">\(\partial \mathcal{O}\)</span>. We then define a posteriori the <em>harmonic extension</em> of <span class="math inline">\(f\)</span> inside <span class="math inline">\(\mathcal{O}\)</span> by defining its value at <span class="math inline">\(x\)</span> as <span class="math inline">\(\mathbb{E}_x[f(B_\tau)]\)</span>.</p>
</section>
<section id="numerical-projects" class="level2">
<h2 class="anchored" data-anchor-id="numerical-projects">Numerical Projects</h2>
</section>
<section id="exercises" class="level2">
<h2 class="anchored" data-anchor-id="exercises">Exercises</h2>
<div id="exr-gaussian-integration-by-parts" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 1</strong></span> <strong>Gaussian Integration by parts.</strong></p>
<ol type="a">
<li>Let <span class="math inline">\(Z\)</span> be a standard Gaussian random variable. Show using integration by parts that for a differentiable function <span class="math inline">\(g\)</span>:</li>
</ol>
<p><span id="eq-gaussian-integration-by-parts"><span class="math display">\[
\begin{align*}
\mathbb{E}[Z g(Z)] = \mathbb{E}[g'(Z)]
\end{align*}
\tag{17}\]</span></span></p>
<p>where we assume that both expectations are well-defined.</p>
<ol start="2" type="a">
<li>Use this to recover the expression for the moments for <span class="math inline">\(\mathbb{E}[Z^{2j}],j \in \mathbb{N}\)</span>.</li>
</ol>
</div>
<p><em>Solution</em>.</p>
<p>We have:</p>
<p><span class="math display">\[
\begin{align*}
\mathbb{E}[g'(Z)] &amp;= \int_{-\infty}^{\infty}\phi(z) \cdot g'(z) dz \\
&amp;= \left[\frac{e^{-z^2/2}}{\sqrt{2\pi}}\cdot g(z)\right]_{-\infty}^{\infty} - \int_{-\infty}^{\infty} g(z) \frac{-ze^{-z^2/2}}{\sqrt{2\pi}}dz \\
&amp;= 0 + \int_{-\infty}^{\infty} z g(z) \phi(z)dz\\
&amp;= \mathbb{E}[Zg(Z)]
\end{align*}
\]</span></p>
<p>Moreover, we can write:</p>
<p><span class="math display">\[
\begin{align*}
\mathbb{E}[Z^{2n}] &amp;= \mathbb{E}[Z \cdot Z^{2n-1}] \\
&amp;= \mathbb{E}[Z \cdot g(Z)], \quad \{ \text{ where }g(x)=x^{2n - 1}\} \\
&amp;= \mathbb{E}[g'(Z)] \\
&amp;= (2n - 1) \mathbb{E}[Z^{(2n - 2)}] \\
&amp; \vdots \\
&amp;= (2n - 1)\cdots 5 \cdot 3 \cdot \mathbb{E}[Z^2] \\
&amp;= (2n - 1)\cdots 5 \cdot 3 \cdot 1
\end{align*}
\]</span></p>
<div id="exr-the-heat-equation" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 2</strong></span> <strong>The Heat Equation</strong>.</p>
<p>Use the Gaussian integration by parts identity to check that the solution <span class="math inline">\(f(t,x)\)</span> to the <em>heat equation</em> is:</p>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="quasar-chunawala/quantdev" data-repo-id="R_kgDOL2t5-A" data-category="General" data-category-id="DIC_kwDOL2t5-M4ClndQ" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark"><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb6" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Multivariate Ito Calculus"</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Quasar"</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2024-07-04"</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> [Stochastic Calculus]      </span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> "image.jpg"</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="an">toc-depth:</span><span class="co"> 3</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="fu"># Multivariate Ito Calculus.</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>We can generalize the theory to functions of several brownian motions. This unleashes the full power of Ito calculus.</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="fu">## Multidimensional Brownian motion.</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>::: {#def-brownian-motion-in-Rd}</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="fu">### Brownian motion in $\mathbf{R}^{d}$. </span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>Take $d\in\mathbf{N}$. Let $B^{(1)},\ldots,B^{(d)}$ be independent standard Brownian motions in $(\Omega,\mathcal{F},\mathbb{P})$. The process $(B_{t}:t\geq0)$ taking values in $\mathbf{R}^{d}$ defined by :</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>B_{t} &amp; =(B_{t}^{(1)},\ldots,B_{t}^{(d)}),\quad t\geq0</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>is called a $d-$dimensional Brownian motion or a Brownian motion in $\mathbf{R}^{d}$.</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>The Brownian filtration $(\mathcal{F}_{t}:t\geq0)$ is now composed of the information of all Brownian motions. In other words, it is given by the sigma-fields:</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>\mathcal{F}_{t} &amp; =\sigma(B_{s}^{(i)},1\leq i\leq d,s\leq t)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>For every outcome $\omega$, the path of trajectory of a $d-$dimensional Brownian motion is a curve in space parametrized by the time $t$:</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>t\mapsto B_{t}(\omega) &amp; =(B_{t}^{(1)}(\omega),B_{t}^{(2)}(\omega),\ldots,B_{t}^{(d)}(\omega))</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>Of course, this curve is continuous, since each coordinate is. The below numerical project gives an example of one path of a two-dimensional brownian motion. This is a very rugged and intertwined curve! We might wonder, what it does as $t\to\infty$. Does it wander around $(0,0)$ ad infinitum or does it eventually escape to infinity? We will answer this question in a later section. For doing so, we shall need a version of Ito's formula for multi-dimensional Brownian motion. We finish this section by noticing that it is also easy to construct Brownian motions in higher dimensions for which the coordinates are correlated.</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2D Brownian Motion </span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>Consider a two-dimensional Brownian motion $(B_{t}^{(1)},B_{2}^{(2)})$ starting at $(0,0)$.</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>Let's plot one path of this Brownian motion on the plane $\mathbf{R}^{2}$ on the plane in $\mathbf{R}^{2}$ on the time interval $<span class="co">[</span><span class="ot">0,5</span><span class="co">]</span>$ using a discretization of $0.001$.</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>We define <span class="in">`BrownianMotion2D`</span> class.</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"whitegrid"</span>)</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> BrownianMotion2D:</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a><span class="co">    Generate sample paths for a 2d-brownian motion</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>,</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>        endpoint : <span class="bu">float</span> <span class="op">=</span> <span class="fl">1.0</span>,</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>        discretization : <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.01</span></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>    ):</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.endpoint <span class="op">=</span> endpoint</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.discretization <span class="op">=</span> discretization</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> generate_paths(<span class="va">self</span>, num_paths : <span class="bu">int</span>):</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>        steps <span class="op">=</span> <span class="bu">int</span>(<span class="va">self</span>.endpoint<span class="op">/</span><span class="va">self</span>.discretization)</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>        delta_z <span class="op">=</span> np.sqrt(<span class="va">self</span>.discretization) <span class="op">*</span> np.random.randn(num_paths,<span class="dv">2</span>,steps)</span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>        <span class="co"># paths has shape [num_paths,2,num_steps]</span></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>        paths <span class="op">=</span> np.cumsum(delta_z,axis<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Brownian motion has position (0,0) at time t=0</span></span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Append initial position </span></span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>        init_position <span class="op">=</span> np.zeros((num_paths,<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>        paths <span class="op">=</span> np.append(init_position,paths,axis<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> paths</span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>We can then configure and use <span class="in">`BrownianMotion2D`</span> objects as we please.</span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a><span class="co"># | code-fold: true</span></span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a><span class="co"># | code-summary: "Show the code"</span></span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a>bm <span class="op">=</span> BrownianMotion2D(endpoint<span class="op">=</span><span class="fl">5.0</span>,discretization<span class="op">=</span><span class="fl">0.001</span>)</span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>paths <span class="op">=</span> bm.generate_paths(num_paths<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> paths[<span class="dv">0</span>]</span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r'$x$'</span>)</span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="vs">r'$y$'</span>)</span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="vs">r'2D-Brownian motion'</span>)</span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a>plt.plot(path[<span class="dv">0</span>],path[<span class="dv">1</span>],linewidth<span class="op">=</span><span class="dv">1</span>,color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a><span class="fu">### Brownian motion with correlated coordinates</span></span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a>::: {#exm-brownian-motion-with-correlated-coordinates}</span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a><span class="fu">### Brownian motion with correlated coordinates</span></span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a>Let $(B_{t}:t\geq0)$ be a two dimensional brownian motion. Let $-1&lt;\rho&lt;1$. We construct the two dimensional process as follows: $W_{t}=(W_{t}^{(1)},W_{t}^{(2)})$ where:</span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a>                                                           </span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a>W_{t}^{(1)} &amp; =B_{t}^{(1)}<span class="sc">\\</span></span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a>W_{t}^{(2)} &amp; =\rho B_{t}^{(1)}+\sqrt{1-\rho^{2}}B_{t}^{(2)}</span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-119"><a href="#cb6-119" aria-hidden="true" tabindex="-1"></a>$W_{t}^{(1)}=B_{t}^{(1)}$ is Gaussian with mean $0$ and variance $t$. Since, $B_{t}^{(1)}$ and $B_{t}^{(2)}$are independent gaussian random variables and the sum of IID Gaussians is Gaussian, $W_{t}^{(2)}$ is Gaussian with mean $0$ and variance $t$. The covariance between</span>
<span id="cb6-120"><a href="#cb6-120" aria-hidden="true" tabindex="-1"></a>$W_{t}^{(1)}$ and $W_{t}^{(2)}$ is:</span>
<span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a>\mathbf{E}<span class="co">[</span><span class="ot">W_{t}^{(1)}W_{t}^{(2)}</span><span class="co">]</span> &amp; =\mathbf{E}<span class="co">[</span><span class="ot">B_{t}^{(1)}(\rho B_{t}^{(1)}+\sqrt{1-\rho^{2}}B_{t}^{(2)})</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb6-124"><a href="#cb6-124" aria-hidden="true" tabindex="-1"></a> &amp; =\mathbf{E}<span class="co">[</span><span class="ot">\rho(B_{t}^{(1)})^{2}+\sqrt{1-\rho^{2}}B_{t}^{(1)}B_{t}^{(2)}</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb6-125"><a href="#cb6-125" aria-hidden="true" tabindex="-1"></a> &amp; =\rho t</span>
<span id="cb6-126"><a href="#cb6-126" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb6-127"><a href="#cb6-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-128"><a href="#cb6-128" aria-hidden="true" tabindex="-1"></a>Hence, the coordinates at time $t$ are not independent.</span>
<span id="cb6-129"><a href="#cb6-129" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb6-130"><a href="#cb6-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-131"><a href="#cb6-131" aria-hidden="true" tabindex="-1"></a>Consider now the process $(W_{t}:t\geq0)$ for $\rho=1/2$ as in example 2. Let's plot one path of this process on the plane $\mathbf{R}^{2}$ on the time-interval $<span class="co">[</span><span class="ot">0,5</span><span class="co">]</span>$ using a discretization of $0.001$.</span>
<span id="cb6-132"><a href="#cb6-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-135"><a href="#cb6-135" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb6-136"><a href="#cb6-136" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> BrownianMotion2DWithCorrelatedCoords(BrownianMotion2D):</span>
<span id="cb6-137"><a href="#cb6-137" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb6-138"><a href="#cb6-138" aria-hidden="true" tabindex="-1"></a><span class="co">    Generate sample paths for a 2d-brownian motion</span></span>
<span id="cb6-139"><a href="#cb6-139" aria-hidden="true" tabindex="-1"></a><span class="co">    have correlated coordiantes</span></span>
<span id="cb6-140"><a href="#cb6-140" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb6-141"><a href="#cb6-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-142"><a href="#cb6-142" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(</span>
<span id="cb6-143"><a href="#cb6-143" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>, </span>
<span id="cb6-144"><a href="#cb6-144" aria-hidden="true" tabindex="-1"></a>        endpoint: <span class="bu">float</span> <span class="op">=</span> <span class="fl">1.0</span>, </span>
<span id="cb6-145"><a href="#cb6-145" aria-hidden="true" tabindex="-1"></a>        discretization: <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.01</span>, </span>
<span id="cb6-146"><a href="#cb6-146" aria-hidden="true" tabindex="-1"></a>        rho: <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb6-147"><a href="#cb6-147" aria-hidden="true" tabindex="-1"></a>    ):</span>
<span id="cb6-148"><a href="#cb6-148" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.endpoint <span class="op">=</span> endpoint</span>
<span id="cb6-149"><a href="#cb6-149" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.discretization <span class="op">=</span> discretization</span>
<span id="cb6-150"><a href="#cb6-150" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.rho <span class="op">=</span> rho</span>
<span id="cb6-151"><a href="#cb6-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-152"><a href="#cb6-152" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> generate_paths(<span class="va">self</span>, num_paths: <span class="bu">int</span>):</span>
<span id="cb6-153"><a href="#cb6-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-154"><a href="#cb6-154" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Call the base class generate_paths() method to generate a pair of</span></span>
<span id="cb6-155"><a href="#cb6-155" aria-hidden="true" tabindex="-1"></a>        <span class="co"># independent brownian motion paths. It returns a tensor of</span></span>
<span id="cb6-156"><a href="#cb6-156" aria-hidden="true" tabindex="-1"></a>        <span class="co"># shape (num_paths, 2, num_steps)</span></span>
<span id="cb6-157"><a href="#cb6-157" aria-hidden="true" tabindex="-1"></a>        paths <span class="op">=</span> <span class="bu">super</span>().generate_paths(num_paths<span class="op">=</span>num_paths)</span>
<span id="cb6-158"><a href="#cb6-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-159"><a href="#cb6-159" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract the brownian motions B1(t) and B2(t)</span></span>
<span id="cb6-160"><a href="#cb6-160" aria-hidden="true" tabindex="-1"></a>        <span class="co"># B1(t) and B2(t) have dimensions [num_paths,num_steps]</span></span>
<span id="cb6-161"><a href="#cb6-161" aria-hidden="true" tabindex="-1"></a>        x_coord <span class="op">=</span> paths[:, <span class="dv">0</span>, :]</span>
<span id="cb6-162"><a href="#cb6-162" aria-hidden="true" tabindex="-1"></a>        y_coord <span class="op">=</span> paths[:, <span class="dv">1</span>, :]</span>
<span id="cb6-163"><a href="#cb6-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-164"><a href="#cb6-164" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Apply the transformation</span></span>
<span id="cb6-165"><a href="#cb6-165" aria-hidden="true" tabindex="-1"></a>        <span class="co"># W1(t) = B1(t)</span></span>
<span id="cb6-166"><a href="#cb6-166" aria-hidden="true" tabindex="-1"></a>        <span class="co"># W2(t) = rho * B1(t) + sqrt(1 - rho**2) B2(t)</span></span>
<span id="cb6-167"><a href="#cb6-167" aria-hidden="true" tabindex="-1"></a>        x_coord <span class="op">=</span> x_coord</span>
<span id="cb6-168"><a href="#cb6-168" aria-hidden="true" tabindex="-1"></a>        y_coord <span class="op">=</span> <span class="va">self</span>.rho <span class="op">*</span> x_coord <span class="op">+</span> np.sqrt(<span class="dv">1</span> <span class="op">-</span> <span class="va">self</span>.rho<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> y_coord</span>
<span id="cb6-169"><a href="#cb6-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-170"><a href="#cb6-170" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Assemble back the x- and y- coordinates</span></span>
<span id="cb6-171"><a href="#cb6-171" aria-hidden="true" tabindex="-1"></a>        x_coord <span class="op">=</span> np.expand_dims(x_coord, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb6-172"><a href="#cb6-172" aria-hidden="true" tabindex="-1"></a>        y_coord <span class="op">=</span> np.expand_dims(y_coord, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb6-173"><a href="#cb6-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-174"><a href="#cb6-174" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Return a tensor of shape [num_paths,d=2,num_steps]</span></span>
<span id="cb6-175"><a href="#cb6-175" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.concatenate([x_coord, y_coord], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb6-176"><a href="#cb6-176" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-177"><a href="#cb6-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-178"><a href="#cb6-178" aria-hidden="true" tabindex="-1"></a>Let's configure the <span class="in">`BrownianMotion2DWithCorrelatedCoords`</span> engine with the settings <span class="in">`endpoint=5.0`</span>, <span class="in">`discretization=0.001`</span> and <span class="in">`rho=0.5`</span> and generate a sample path.</span>
<span id="cb6-179"><a href="#cb6-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-182"><a href="#cb6-182" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb6-183"><a href="#cb6-183" aria-hidden="true" tabindex="-1"></a><span class="co"># | code-fold: true</span></span>
<span id="cb6-184"><a href="#cb6-184" aria-hidden="true" tabindex="-1"></a><span class="co"># | code-summary: "Show the code"</span></span>
<span id="cb6-185"><a href="#cb6-185" aria-hidden="true" tabindex="-1"></a>bm <span class="op">=</span> BrownianMotion2DWithCorrelatedCoords(</span>
<span id="cb6-186"><a href="#cb6-186" aria-hidden="true" tabindex="-1"></a>    endpoint<span class="op">=</span><span class="fl">5.0</span>,</span>
<span id="cb6-187"><a href="#cb6-187" aria-hidden="true" tabindex="-1"></a>    discretization<span class="op">=</span><span class="fl">0.001</span>,</span>
<span id="cb6-188"><a href="#cb6-188" aria-hidden="true" tabindex="-1"></a>    rho<span class="op">=</span><span class="fl">0.50</span></span>
<span id="cb6-189"><a href="#cb6-189" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-190"><a href="#cb6-190" aria-hidden="true" tabindex="-1"></a>paths <span class="op">=</span> bm.generate_paths(num_paths<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb6-191"><a href="#cb6-191" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> paths[<span class="dv">0</span>]</span>
<span id="cb6-192"><a href="#cb6-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-193"><a href="#cb6-193" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r'$x$'</span>)</span>
<span id="cb6-194"><a href="#cb6-194" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="vs">r'$y$'</span>)</span>
<span id="cb6-195"><a href="#cb6-195" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="vs">r'Correlated Brownian motion $W(t)=(W^{(1)}(t),W^{(2)}(t))$'</span>)</span>
<span id="cb6-196"><a href="#cb6-196" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb6-197"><a href="#cb6-197" aria-hidden="true" tabindex="-1"></a>plt.plot(path[<span class="dv">0</span>],path[<span class="dv">1</span>],linewidth<span class="op">=</span><span class="dv">1</span>,color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb6-198"><a href="#cb6-198" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb6-199"><a href="#cb6-199" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-200"><a href="#cb6-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-203"><a href="#cb6-203" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb6-204"><a href="#cb6-204" aria-hidden="true" tabindex="-1"></a><span class="co"># | code-fold: true</span></span>
<span id="cb6-205"><a href="#cb6-205" aria-hidden="true" tabindex="-1"></a><span class="co"># | code-summary: "Show the code"</span></span>
<span id="cb6-206"><a href="#cb6-206" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r'$t$'</span>)</span>
<span id="cb6-207"><a href="#cb6-207" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="vs">r'$W_t$'</span>)</span>
<span id="cb6-208"><a href="#cb6-208" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="vs">r'Correlated Brownian motion paths'</span>)</span>
<span id="cb6-209"><a href="#cb6-209" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb6-210"><a href="#cb6-210" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> np.linspace(<span class="fl">0.0</span>,stop<span class="op">=</span><span class="fl">5.0</span>,num<span class="op">=</span><span class="dv">5001</span>)</span>
<span id="cb6-211"><a href="#cb6-211" aria-hidden="true" tabindex="-1"></a>plt.plot(t,path[<span class="dv">0</span>],linewidth<span class="op">=</span><span class="fl">0.75</span>)</span>
<span id="cb6-212"><a href="#cb6-212" aria-hidden="true" tabindex="-1"></a>plt.plot(t,path[<span class="dv">1</span>],linewidth<span class="op">=</span><span class="fl">0.75</span>)</span>
<span id="cb6-213"><a href="#cb6-213" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb6-214"><a href="#cb6-214" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-215"><a href="#cb6-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-216"><a href="#cb6-216" aria-hidden="true" tabindex="-1"></a><span class="fu">## Ito's Formula.</span></span>
<span id="cb6-217"><a href="#cb6-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-218"><a href="#cb6-218" aria-hidden="true" tabindex="-1"></a>::: {#thm-ito-formula-function-of-d-brownian-motions}</span>
<span id="cb6-219"><a href="#cb6-219" aria-hidden="true" tabindex="-1"></a><span class="fu">### Ito's Formula. </span></span>
<span id="cb6-220"><a href="#cb6-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-221"><a href="#cb6-221" aria-hidden="true" tabindex="-1"></a>Let $(B_{t}:t\geq0)$ be a $d-$dimensional brownian motion. Consider $f\in\mathcal{C}^{2}(\mathbf{R}^{d})$. Then, we have with probability one that for all $t\geq0$:</span>
<span id="cb6-222"><a href="#cb6-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-223"><a href="#cb6-223" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb6-224"><a href="#cb6-224" aria-hidden="true" tabindex="-1"></a>f(B_{t})-f(B_{0}) &amp; =\sum_{i=1}^{d}\int_{0}^{t}\partial_{x_{i}}f(B_{s})dB_{s}^{(i)}+\frac{1}{2}\int_{0}^{t}\sum_{i=1}^{d}\partial_{x_{i}}^{2}f(B_{s})ds\label{eq:multidimensional-ito-formula}</span>
<span id="cb6-225"><a href="#cb6-225" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb6-226"><a href="#cb6-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-227"><a href="#cb6-227" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb6-228"><a href="#cb6-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-229"><a href="#cb6-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-230"><a href="#cb6-230" aria-hidden="true" tabindex="-1"></a>::: {#rem-equality-of-processes} </span>
<span id="cb6-231"><a href="#cb6-231" aria-hidden="true" tabindex="-1"></a>I stress that, as in the one-dimensional case, Ito's formula is an equality of processes (and not an equality in distribution). Thus, the processes on both sides must agree for each path. </span>
<span id="cb6-232"><a href="#cb6-232" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb6-233"><a href="#cb6-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-234"><a href="#cb6-234" aria-hidden="true" tabindex="-1"></a>Interestingly, the mixed partials $\partial_{x_{i}x_{j}}f(B_{s})$, $i\neq j$ do not appear in the formula! We see from Ito's formula that the process $f(B_{t})$ can be represented as a sum of $d+1$ processes: $d$ Ito integrals and one Riemann integral (which is a process of finite variation). In vector notation, the formula takes the form:</span>
<span id="cb6-235"><a href="#cb6-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-236"><a href="#cb6-236" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb6-237"><a href="#cb6-237" aria-hidden="true" tabindex="-1"></a>f(B_{t})-f(B_{0}) &amp; =\int_{0}^{t}\nabla f(B_{s})^{T}dB_{s}+\frac{1}{2}\int_{0}^{t}\nabla^{2}f(B_{s})ds</span>
<span id="cb6-238"><a href="#cb6-238" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb6-239"><a href="#cb6-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-240"><a href="#cb6-240" aria-hidden="true" tabindex="-1"></a>where it is understood that the first term is the sum of the $d$ Ito integrals in the equation. The symbol $\nabla^{2}$ is the Laplacian of $f$:</span>
<span id="cb6-241"><a href="#cb6-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-242"><a href="#cb6-242" aria-hidden="true" tabindex="-1"></a>$\sum_{i=1}^{d}\frac{\partial^{2}}{\partial x_{i}^{2}}f(B_{s}^{(1)},\ldots,B_{s}^{(d)})ds$</span>
<span id="cb6-243"><a href="#cb6-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-244"><a href="#cb6-244" aria-hidden="true" tabindex="-1"></a>In differential form, Ito's formula becomes very neat:</span>
<span id="cb6-245"><a href="#cb6-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-246"><a href="#cb6-246" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb6-247"><a href="#cb6-247" aria-hidden="true" tabindex="-1"></a>df(B_{t}) &amp; =\sum_{i=1}^{d}\partial_{x_{i}}f(B_{s})dB_{t}^{(i)}+\frac{1}{2}\sum_{i=1}^{d}\partial_{x_{i}}^{2}f(B_{s})dt=\nabla f(B_{t})^{T}dB_{s}+\frac{1}{2}\nabla^{2}f(B_{t})dt</span>
<span id="cb6-248"><a href="#cb6-248" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb6-249"><a href="#cb6-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-250"><a href="#cb6-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-251"><a href="#cb6-251" aria-hidden="true" tabindex="-1"></a>::: {#exm-ito-formula-1}</span>
<span id="cb6-252"><a href="#cb6-252" aria-hidden="true" tabindex="-1"></a>Consider the functions (1) $f(x_{1},x_{2})=x_{1}^{2}+x_{2}^{2}$ (2) $f(x_{1},x_{2})=e^{x_{1}}\cos x_{2}$ and the processes $(X_{t}:t\geq0)$ and $(Y_{t}:t\geq0)$. If we apply Ito's formula to the first process, we have:</span>
<span id="cb6-253"><a href="#cb6-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-254"><a href="#cb6-254" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb6-255"><a href="#cb6-255" aria-hidden="true" tabindex="-1"></a>X_{t} &amp; =\int_{0}^{t}2B_{s}^{(1)}dB_{s}^{(1)}+\int_{0}^{t}2B_{s}^{(2)}dB_{s}^{(2)}+\frac{1}{2}\int_{0}^{t}(4dt)<span class="sc">\\</span></span>
<span id="cb6-256"><a href="#cb6-256" aria-hidden="true" tabindex="-1"></a> &amp; =\int_{0}^{t}2B_{s}^{(1)}dB_{s}^{(1)}+\int_{0}^{t}2B_{s}^{(2)}dB_{s}^{(2)}+2t</span>
<span id="cb6-257"><a href="#cb6-257" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb6-258"><a href="#cb6-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-259"><a href="#cb6-259" aria-hidden="true" tabindex="-1"></a>The second process gives:</span>
<span id="cb6-260"><a href="#cb6-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-261"><a href="#cb6-261" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb6-262"><a href="#cb6-262" aria-hidden="true" tabindex="-1"></a>Y_{t} &amp; =\cos B_{s}^{(2)}\int_{0}^{t}e^{B_{s}^{(1)}}dB_{s}^{(1)}-e^{B_{s}^{(1)}}\int\sin B_{s}^{(2)}dB_{s}^{(2)}+\frac{1}{2}\int_{0}^{t}\left(e^{B_{s}^{(1)}}\cos B_{s}^{(2)}-e^{B_{s}^{(1)}}\cos B_{s}^{(2)}\right)dt<span class="sc">\\</span></span>
<span id="cb6-263"><a href="#cb6-263" aria-hidden="true" tabindex="-1"></a> &amp; =1+\cos B_{s}^{(2)}\int_{0}^{t}e^{B_{s}^{(1)}}dB_{s}^{(1)}-e^{B_{s}^{(1)}}\int\sin B_{s}^{(2)}dB_{s}^{(2)}</span>
<span id="cb6-264"><a href="#cb6-264" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb6-265"><a href="#cb6-265" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb6-266"><a href="#cb6-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-267"><a href="#cb6-267" aria-hidden="true" tabindex="-1"></a>::: {#exm-cross-variation-of-b1-and-b2}</span>
<span id="cb6-268"><a href="#cb6-268" aria-hidden="true" tabindex="-1"></a> (Cross-Variation of $B_{t}^{(1)}$ and $B_{t}^{(2)}$). Let $(t_{j}:j\leq n)$ be a sequence of partitions of $<span class="co">[</span><span class="ot">0,t</span><span class="co">]</span>$ such that $\max_{j}|t_{j+1}-t_{j}|\to0$ as $n\to\infty$. Prove that:</span>
<span id="cb6-269"><a href="#cb6-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-270"><a href="#cb6-270" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb6-271"><a href="#cb6-271" aria-hidden="true" tabindex="-1"></a>\lim_{n\to\infty}\sum_{j=0}^{n-1}(B_{t_{j+1}}^{(1)}-B_{t_{j}}^{(1)})(B_{t_{j+1}}^{(2)}-B_{t_{j}}^{(2)}) &amp; =0\quad\text{in } L^{2}</span>
<span id="cb6-272"><a href="#cb6-272" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb6-273"><a href="#cb6-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-274"><a href="#cb6-274" aria-hidden="true" tabindex="-1"></a>This justifies the rule $dB_{t}^{(1)}\cdot dB_{t}^{(2)}=0$.</span>
<span id="cb6-275"><a href="#cb6-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-276"><a href="#cb6-276" aria-hidden="true" tabindex="-1"></a>*Hint*: Just compute the second moment of the sum.</span>
<span id="cb6-277"><a href="#cb6-277" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb6-278"><a href="#cb6-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-279"><a href="#cb6-279" aria-hidden="true" tabindex="-1"></a>::: {#sol-solution-1}</span>
<span id="cb6-280"><a href="#cb6-280" aria-hidden="true" tabindex="-1"></a>We have:</span>
<span id="cb6-281"><a href="#cb6-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-282"><a href="#cb6-282" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb6-283"><a href="#cb6-283" aria-hidden="true" tabindex="-1"></a> &amp; \mathbf{E}\left<span class="co">[</span><span class="ot">\left(\sum_{j=0}^{n-1}(B_{t_{j+1}}^{(1)}-B_{t_{j}}^{(1)})(B_{t_{j+1}}^{(2)}-B_{t_{j}}^{(2)})\right)^{2}\right</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb6-284"><a href="#cb6-284" aria-hidden="true" tabindex="-1"></a>= &amp; \sum_{j=0}^{n-1}\mathbf{E}<span class="co">[</span><span class="ot">(B_{t_{j+1}}^{(1)}-B_{t_{j}}^{(1)})^{2}(B_{t_{j+1}}^{(2)}-B_{t_{j}}^{(2)})^{2}</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb6-285"><a href="#cb6-285" aria-hidden="true" tabindex="-1"></a><span class="ss">+ </span>&amp; 2\sum_{j&lt;k}\mathbf{E}\left[(B_{t_{j+1}}^{(1)}-B_{t_{j}}^{(1)})(B_{t_{k+1}}^{(1)}-B_{t_{k}}^{(1)})(B_{t_{j+1}}^{(2)}-B_{t_{j}}^{(2)})(B_{t_{k+1}}^{(2)}-B_{t_{k}}^{(2)})\right]</span>
<span id="cb6-286"><a href="#cb6-286" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb6-287"><a href="#cb6-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-288"><a href="#cb6-288" aria-hidden="true" tabindex="-1"></a>Both these expectations are zero, since the brownian motions are independent and non-overlapping increments are independent.</span>
<span id="cb6-289"><a href="#cb6-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-290"><a href="#cb6-290" aria-hidden="true" tabindex="-1"></a>Consequently,</span>
<span id="cb6-291"><a href="#cb6-291" aria-hidden="true" tabindex="-1"></a>$\sum_{j=0}^{n-1}(B_{t_{j+1}}^{(1)}-B_{t_{j}}^{(1)})(B_{t_{j+1}}^{(2)}-B_{t_{j}}^{(2)})\to0$ in the $L^{2}$ sense.</span>
<span id="cb6-292"><a href="#cb6-292" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb6-293"><a href="#cb6-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-294"><a href="#cb6-294" aria-hidden="true" tabindex="-1"></a>::: {.proof}</span>
<span id="cb6-295"><a href="#cb6-295" aria-hidden="true" tabindex="-1"></a>The proof of the formula follows the usual recipe: Taylor's theorem together with the quadratic variation and the cross-variation. In this case, we do get a cross-variation between the different Brownian motions. More precisely, consider a partition $(t_{j}:j\leq n)$ of $<span class="co">[</span><span class="ot">0,t</span><span class="co">]</span>$. Then we can write:</span>
<span id="cb6-296"><a href="#cb6-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-297"><a href="#cb6-297" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb6-298"><a href="#cb6-298" aria-hidden="true" tabindex="-1"></a>f(B_{t})-f(B_{0}) &amp; =\sum_{j=0}^{n-1}(f(B_{t_{j+1}})-f(B_{t_{j}}))</span>
<span id="cb6-299"><a href="#cb6-299" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb6-300"><a href="#cb6-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-301"><a href="#cb6-301" aria-hidden="true" tabindex="-1"></a>We can apply the Taylor's series expansion for each $j$ to get:</span>
<span id="cb6-302"><a href="#cb6-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-303"><a href="#cb6-303" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb6-304"><a href="#cb6-304" aria-hidden="true" tabindex="-1"></a>f(B_{t})-f(B_{0}) &amp; =\sum_{j=0}^{n-1}\nabla f(B_{t_{j}})(B_{t_{j+1}}-B_{t_{j}})<span class="sc">\\</span></span>
<span id="cb6-305"><a href="#cb6-305" aria-hidden="true" tabindex="-1"></a> &amp; +\frac{1}{2}\sum_{j=0}^{n-1}(B_{t_{j+1}}-B_{t_{j}})^{T}Hf(B_{t_{j}})(B_{t_{j+1}}-B_{t_{j}})+\mathcal{E}</span>
<span id="cb6-306"><a href="#cb6-306" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb6-307"><a href="#cb6-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-308"><a href="#cb6-308" aria-hidden="true" tabindex="-1"></a>where $Hf$ is the Hessian matrix of $f$. We wrote the expansion using the vector notation to be economical. Let's keep in mind that each term is a sum over the derivatives. The first term will converge to $d$ Ito integrals as in the one-dimensional case. Now, the summand in the second</span>
<span id="cb6-309"><a href="#cb6-309" aria-hidden="true" tabindex="-1"></a>term is:</span>
<span id="cb6-310"><a href="#cb6-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-311"><a href="#cb6-311" aria-hidden="true" tabindex="-1"></a>$$(B_{t_{j+1}}^{(1)}-B_{t_{j}}^{(1)},\ldots,B_{t_{j+1}}^{(d)}-B_{t_{j}}^{(d)})\left[\begin{array}{ccc}</span>
<span id="cb6-312"><a href="#cb6-312" aria-hidden="true" tabindex="-1"></a>\partial_{x_{1}}^{2}f(B_{t_{j}}) &amp; \ldots &amp; \partial_{x_{1}x_{d}}^{2}f(B_{t_{j}})<span class="sc">\\</span></span>
<span id="cb6-313"><a href="#cb6-313" aria-hidden="true" tabindex="-1"></a>\vdots &amp; \ddots<span class="sc">\\</span></span>
<span id="cb6-314"><a href="#cb6-314" aria-hidden="true" tabindex="-1"></a>\partial_{x_{d}x_{1}}^{2}f(B_{t_{j}}) &amp;  &amp; \partial_{x_{d}}^{2}f(B_{t_{j}})</span>
<span id="cb6-315"><a href="#cb6-315" aria-hidden="true" tabindex="-1"></a>\end{array}\right]\left[\begin{array}{c}</span>
<span id="cb6-316"><a href="#cb6-316" aria-hidden="true" tabindex="-1"></a>B_{t_{j+1}}^{(1)}-B_{t_{j}}^{(1)}<span class="sc">\\</span></span>
<span id="cb6-317"><a href="#cb6-317" aria-hidden="true" tabindex="-1"></a>\vdots<span class="sc">\\</span></span>
<span id="cb6-318"><a href="#cb6-318" aria-hidden="true" tabindex="-1"></a>B_{t_{j+1}}^{(d)}-B_{t_{j}}^{(d)}</span>
<span id="cb6-319"><a href="#cb6-319" aria-hidden="true" tabindex="-1"></a>\end{array}\right]$$</span>
<span id="cb6-320"><a href="#cb6-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-321"><a href="#cb6-321" aria-hidden="true" tabindex="-1"></a>So, $(B_{t_{j+1}}^{(i)}-B_{t_{j}}^{(i)})$ is pre-multiplied with the term $\partial_{x_{i}x_{k}}^{2}f(B_{t_{j}})$ and it is post-multiplied $(B_{t_{j+1}}^{(k)}-B_{t_{j}}^{(k)})$. Consequently, the second term in the Taylor's series expansion can be re-written as:</span>
<span id="cb6-322"><a href="#cb6-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-323"><a href="#cb6-323" aria-hidden="true" tabindex="-1"></a>$$\sum_{j=0}^{n-1}\left(\sum_{i=1}^{d}\partial_{x_{i}}^{2}f(B_{t_{j}})(B_{t_{j+1}}^{(i)}-B_{t_{j}}^{(i)})^{2}+\sum_{1\leq i&lt;k\leq d}\partial_{x_{i}x_{k}}^{2}f(B_{t_{j}})(B_{t_{j+1}}^{(i)}-B_{t_{j}}^{(i)})(B_{t_{j+1}}^{(k)}-B_{t_{j}}^{(k)})\right)$$</span>
<span id="cb6-324"><a href="#cb6-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-325"><a href="#cb6-325" aria-hidden="true" tabindex="-1"></a>The second term on the right converges to $0$ in the $L^{2}$ sense when</span>
<span id="cb6-326"><a href="#cb6-326" aria-hidden="true" tabindex="-1"></a>$i\neq k$, from exercise. This explains why the mixed derivatives disappear in the multi-dimensional Ito's formula. As for the case $i=k$, it reduces to the quadratic variation as in the one-dimensional case. This is where the Riemann integral arises, after suitable conditioning on $\mathcal{F}_{t_{j}}$, the sigma-field generated by $B_{s}$, $s\leq t_{j}$. </span>
<span id="cb6-327"><a href="#cb6-327" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb6-328"><a href="#cb6-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-329"><a href="#cb6-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-330"><a href="#cb6-330" aria-hidden="true" tabindex="-1"></a>As in the one-dimensional case,it is not necessary to learn Ito's formula by heart. It suffices to write the differential of the function $f$ to second order. We can then apply the rules of multivariate Ito calculus:</span>
<span id="cb6-331"><a href="#cb6-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-332"><a href="#cb6-332" aria-hidden="true" tabindex="-1"></a><span class="in">      $\cdot$       $dt$   $dB_{t}^{(1)}$   $dB_{t}^{(2)}$   $\ldots$</span></span>
<span id="cb6-333"><a href="#cb6-333" aria-hidden="true" tabindex="-1"></a>  ---------------- ------ ---------------- ---------------- ----------</span>
<span id="cb6-334"><a href="#cb6-334" aria-hidden="true" tabindex="-1"></a><span class="in">        $dt$        $0$         $0$              $0$           $0$</span></span>
<span id="cb6-335"><a href="#cb6-335" aria-hidden="true" tabindex="-1"></a>   $dB_{t}^{(1)}$   $0$         $dt$             $0$           $0$</span>
<span id="cb6-336"><a href="#cb6-336" aria-hidden="true" tabindex="-1"></a>   $dB_{t}^{(2)}$   $0$         $0$              $dt$          $0$</span>
<span id="cb6-337"><a href="#cb6-337" aria-hidden="true" tabindex="-1"></a>      $\ldots$      $0$         $0$              $0$           $dt$</span>
<span id="cb6-338"><a href="#cb6-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-339"><a href="#cb6-339" aria-hidden="true" tabindex="-1"></a>Note that the rule $dB_{t}^{(i)}dB_{t}^{(j)}=0$ for $i\neq j$ is being</span>
<span id="cb6-340"><a href="#cb6-340" aria-hidden="true" tabindex="-1"></a>motivated by the cross-variation result.</span>
<span id="cb6-341"><a href="#cb6-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-342"><a href="#cb6-342" aria-hidden="true" tabindex="-1"></a>How can we construct martingales using the Ito's formula? Recall that an Ito integral $(\int_{0}^{t}X_{s}dB_{s},t\leq T)$ is a martingale whenever the integrand is in $\mathcal{L}_{c}^{2}(T)$, the space of adapted processes with continuous paths and for which:</span>
<span id="cb6-343"><a href="#cb6-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-344"><a href="#cb6-344" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb6-345"><a href="#cb6-345" aria-hidden="true" tabindex="-1"></a>\int_{0}^{T}\mathbf{E}<span class="co">[</span><span class="ot">X_{s}^{2}</span><span class="co">]</span>ds &amp; &lt;\infty</span>
<span id="cb6-346"><a href="#cb6-346" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb6-347"><a href="#cb6-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-348"><a href="#cb6-348" aria-hidden="true" tabindex="-1"></a>The only difference here is that the integrand is a function of many Brownian motions. However, the integrands involved in the Ito integrals of the multidimensional Ito's formula are clearly adapted to the filtration $(\mathcal{F}_{t}:t\geq0)$ of $(B_{t}:t\geq0)$ as they are functions of the Brownian motion at the time. The arguments of Ito</span>
<span id="cb6-349"><a href="#cb6-349" aria-hidden="true" tabindex="-1"></a>integral in and apply verbatim, if we take the definition of $\mathcal{L}_{c}^{2}(t)$ with the filtration $(\mathcal{F}_{t}:t\geq0)$ of $(B_{t}:t\geq0)$. With this in mind, we have the following corollary.</span>
<span id="cb6-350"><a href="#cb6-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-351"><a href="#cb6-351" aria-hidden="true" tabindex="-1"></a><span class="fu">### Brownian Martingales</span></span>
<span id="cb6-352"><a href="#cb6-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-353"><a href="#cb6-353" aria-hidden="true" tabindex="-1"></a>::: {#cor-brownian-martingales}</span>
<span id="cb6-354"><a href="#cb6-354" aria-hidden="true" tabindex="-1"></a><span class="fu">### Brownian Martingales. </span></span>
<span id="cb6-355"><a href="#cb6-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-356"><a href="#cb6-356" aria-hidden="true" tabindex="-1"></a>Let $(B_{t}:t\geq0)$ be a Brownian motion in $\mathbf{R}^{d}$. Consider $f\in\mathcal{C}^{2}(\mathbf{R}^{d})$ such that processes $(\partial_{x {i}}f(B_{t}),t\leq T)\in\mathcal{L}_{c}^{2}(T)$ for every $i\leq d$. Then, the process :</span>
<span id="cb6-357"><a href="#cb6-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-358"><a href="#cb6-358" aria-hidden="true" tabindex="-1"></a>$$f(B_{t})-\frac{1}{2}\int_{0}^{t}\nabla^{2}f(B_{s})ds,\quad t\leq T$$</span>
<span id="cb6-359"><a href="#cb6-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-360"><a href="#cb6-360" aria-hidden="true" tabindex="-1"></a>where $\nabla^{2}=\sum_{i=1}^{d}\partial_{x_{i}}^{2}$ is the Laplacian, is a martingale for the Brownian filtration.</span>
<span id="cb6-361"><a href="#cb6-361" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb6-362"><a href="#cb6-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-363"><a href="#cb6-363" aria-hidden="true" tabindex="-1"></a>For example, consider the processes $X_{t}=(B_{t}^{(1)})^{2}+(B_{t}^{(2)})^{2}$ and $Y_{t}=\exp(B_{t}^{(1)})\cos(B_{t}^{(2)})$. Then, we have :</span>
<span id="cb6-364"><a href="#cb6-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-365"><a href="#cb6-365" aria-hidden="true" tabindex="-1"></a>$$\frac{1}{2}\int_{0}^{t}\nabla^{2}X_{s}ds=\frac{1}{2}\int_{0}^{t}4ds=2t$$</span>
<span id="cb6-366"><a href="#cb6-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-367"><a href="#cb6-367" aria-hidden="true" tabindex="-1"></a>and</span>
<span id="cb6-368"><a href="#cb6-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-369"><a href="#cb6-369" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb6-370"><a href="#cb6-370" aria-hidden="true" tabindex="-1"></a>\frac{1}{2}\int_{0}^{t}\nabla^{2}Y_{s}ds &amp; =\frac{1}{2}\int_{0}^{t}0\cdot ds=0</span>
<span id="cb6-371"><a href="#cb6-371" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb6-372"><a href="#cb6-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-373"><a href="#cb6-373" aria-hidden="true" tabindex="-1"></a>Thus, the processes $X_{t}-2t$ and $Y_{t}$ are martingales for the Brownian filtration. In one dimension, there are no interesting martingales constructed with functions of *space* only. Indeed, $(f(B_{t}):t\geq0)$ is a martingale if and only if $f''(x)=0$ for all $x$. But, such functions are of the form $f(x)=ax+b$, $a,b\in\mathbf{R}$. In other words, in one dimension, Brownian martingales of the form $f(B_{t})$ are simply $aB_{t}+b$. Not very surprising! The situation is very different in higher dimensions. Indeed, corollary implies that $f(B_{t})$ is a martingale whenever $f$ is a harmonic function:</span>
<span id="cb6-374"><a href="#cb6-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-375"><a href="#cb6-375" aria-hidden="true" tabindex="-1"></a>::: {#def-harmonic-function}</span>
<span id="cb6-376"><a href="#cb6-376" aria-hidden="true" tabindex="-1"></a><span class="fu">### Harmonic function.</span></span>
<span id="cb6-377"><a href="#cb6-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-378"><a href="#cb6-378" aria-hidden="true" tabindex="-1"></a>A function $f:\mathbf{R}^{d}\to\mathbf{R}$ is harmonic in $\mathbf{R}^{d}$ if and only if $\nabla^{2}f(x)\equiv0$ for all $x\in\mathbf{R}^{d}$. More generally, a function $f:\mathbf{R}^{d}\to\mathbf{R}$ is harmonic in the region $\mathcal{O}\subset\mathbf{R}^{d}$ if and only if $\nabla^{2}f(x)\equiv0$ for all $x\in\mathcal{O}$.</span>
<span id="cb6-379"><a href="#cb6-379" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb6-380"><a href="#cb6-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-381"><a href="#cb6-381" aria-hidden="true" tabindex="-1"></a>Note that the function $f(x)=e^{x_{1}}\cos x_{2}$ is harmonic in $\mathbf{R}^{d}$. This is why the process $Y_{t}=\exp(B_{t}^{(1)})\cos(B_{t}^{(2)})$ is a martingale. The distinction to a subset of $\mathbf{R}^{d}$ in the above definition is important since it may happen that the function is harmonic only in a subset of the space; see for example equation. It is possible to define a Brownian martingale in such cases by considering the process until it exits the region. This will turn out to be important as we move ahead.</span>
<span id="cb6-382"><a href="#cb6-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-383"><a href="#cb6-383" aria-hidden="true" tabindex="-1"></a>The multidimensional Ito's formula generalizes to functions of time and space as in proposition:</span>
<span id="cb6-384"><a href="#cb6-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-385"><a href="#cb6-385" aria-hidden="true" tabindex="-1"></a>::: {#def-function-in-C12} </span>
<span id="cb6-386"><a href="#cb6-386" aria-hidden="true" tabindex="-1"></a>A function $f:<span class="co">[</span><span class="ot">0,\infty)\times\mathbf{R}^{d}\to\mathbf{R}$ is in $\mathcal{C}^{1,2}([0,T</span><span class="co">]</span>\times\mathbf{R}^{d})$ if the partial derivative in *time* :</span>
<span id="cb6-387"><a href="#cb6-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-388"><a href="#cb6-388" aria-hidden="true" tabindex="-1"></a>$$\frac{\partial}{\partial t}f(t,\mathbf{x})$$</span>
<span id="cb6-389"><a href="#cb6-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-390"><a href="#cb6-390" aria-hidden="true" tabindex="-1"></a>exists and is continuous and the second order partial derivatives in space:</span>
<span id="cb6-391"><a href="#cb6-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-392"><a href="#cb6-392" aria-hidden="true" tabindex="-1"></a>$$\frac{\partial^{2}}{\partial x_{i}^{2}}f(t,x_{1},x_{2},\ldots,x_{i},\ldots,x_{d}),\quad1\leq i\leq d$$</span>
<span id="cb6-393"><a href="#cb6-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-394"><a href="#cb6-394" aria-hidden="true" tabindex="-1"></a>exist and are continuous.</span>
<span id="cb6-395"><a href="#cb6-395" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb6-396"><a href="#cb6-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-397"><a href="#cb6-397" aria-hidden="true" tabindex="-1"></a><span class="fu">## Multidimensional Ito formula - Functions of space and time</span></span>
<span id="cb6-398"><a href="#cb6-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-399"><a href="#cb6-399" aria-hidden="true" tabindex="-1"></a>::: {#thm-Multidimensional-Ito-formula-functions-of-space-and-time} </span>
<span id="cb6-400"><a href="#cb6-400" aria-hidden="true" tabindex="-1"></a><span class="fu">### Multidimensional Ito's formula for functions of space and time</span></span>
<span id="cb6-401"><a href="#cb6-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-402"><a href="#cb6-402" aria-hidden="true" tabindex="-1"></a>Let $(B_{t}:t\leq T)$ be a $d$-dimensional Brownian motion. Consider a function $f\in\mathcal{C}^{1,2}(<span class="co">[</span><span class="ot">0,T</span><span class="co">]</span>\times\mathbf{R}^{d})$. Then, we have with</span>
<span id="cb6-403"><a href="#cb6-403" aria-hidden="true" tabindex="-1"></a>probability one for all $t\leq T$:</span>
<span id="cb6-404"><a href="#cb6-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-405"><a href="#cb6-405" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb6-406"><a href="#cb6-406" aria-hidden="true" tabindex="-1"></a>f(t,B_{t})-f(0,B_{0}) &amp; =\sum_{i=1}^{d}\int_{0}^{t}\partial_{x_{i}}f(s,B_{s})dB_{s}^{(i)}+\int_{0}^{t}\left(\partial_{t}f(s,B_{s})+\sum_{i=1}^{d}\partial_{x_{i}}^{2}f(s,B_{s})\right)ds</span>
<span id="cb6-407"><a href="#cb6-407" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb6-408"><a href="#cb6-408" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb6-409"><a href="#cb6-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-410"><a href="#cb6-410" aria-hidden="true" tabindex="-1"></a>The martingale condition is then similar to the ones in corollary (<span class="co">[</span><span class="ot">\[cor:brownian-martingales-in-Rd\]</span><span class="co">](#cor:brownian-martingales-in-Rd)</span>{reference-type="ref" reference="cor:brownian-martingales-in-Rd"}): if the processes $(\partial_{x_{i}}f(s,B_{s}),t\leq T)\in\mathcal{L}_{c}^{2}(T)$ for every $1\leq i\leq d$, then the process</span>
<span id="cb6-411"><a href="#cb6-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-412"><a href="#cb6-412" aria-hidden="true" tabindex="-1"></a>$$f(t,B_{t})-\int_{0}^{t}\left<span class="sc">\{</span> \partial_{t}f(s,B_{s})++\sum_{i=1}^{d}\partial_{x_{i}}^{2}f(s,B_{s})\right<span class="sc">\}</span> ds,\quad t\leq T$$ {#eq-martingale-process}</span>
<span id="cb6-413"><a href="#cb6-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-414"><a href="#cb6-414" aria-hidden="true" tabindex="-1"></a>is a martingale for the Brownian filtration. In particular, if $f$ satisfies the partial differential equation:</span>
<span id="cb6-415"><a href="#cb6-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-416"><a href="#cb6-416" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-417"><a href="#cb6-417" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb6-418"><a href="#cb6-418" aria-hidden="true" tabindex="-1"></a>\frac{\partial f}{\partial t}+\frac{1}{2}\nabla^{2}f &amp; =0</span>
<span id="cb6-419"><a href="#cb6-419" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb6-420"><a href="#cb6-420" aria-hidden="true" tabindex="-1"></a>$$ {#eq-martingale-condition-for-f}</span>
<span id="cb6-421"><a href="#cb6-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-422"><a href="#cb6-422" aria-hidden="true" tabindex="-1"></a>then the process $(f(t,B_{t}):t\leq T)$ itself is a martingale.</span>
<span id="cb6-423"><a href="#cb6-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-424"><a href="#cb6-424" aria-hidden="true" tabindex="-1"></a><span class="fu">## Polya's Random Walk Theorem</span></span>
<span id="cb6-425"><a href="#cb6-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-426"><a href="#cb6-426" aria-hidden="true" tabindex="-1"></a>Consider a *simple random walk* on the integer lattice $\mathbb{Z}^d$. At each time step, a random walker makes a random move of length one in one of the lattice directions.</span>
<span id="cb6-427"><a href="#cb6-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-428"><a href="#cb6-428" aria-hidden="true" tabindex="-1"></a>We say that, if the random walk returns to the origin with probability one infinitely many times, it is *recurrent*, if it does not we will call it *transient*. </span>
<span id="cb6-429"><a href="#cb6-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-430"><a href="#cb6-430" aria-hidden="true" tabindex="-1"></a>It's worth to spend a moment visiting Polya's Random Walk Theorem, a fascinating, but not so intuitive result.</span>
<span id="cb6-431"><a href="#cb6-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-432"><a href="#cb6-432" aria-hidden="true" tabindex="-1"></a>Assuming all random walks start at the origin, we define $u$ to be the probability that a random walker returns to the origin. The probability that the random walker returns to the origin exactly $m$ times is:</span>
<span id="cb6-433"><a href="#cb6-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-434"><a href="#cb6-434" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-435"><a href="#cb6-435" aria-hidden="true" tabindex="-1"></a>{m \choose m-1} u^{m-1} (1 - u)^{m - (m - 1)} = u^{m-1}(1-u)</span>
<span id="cb6-436"><a href="#cb6-436" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-437"><a href="#cb6-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-438"><a href="#cb6-438" aria-hidden="true" tabindex="-1"></a>The expected number of times the particle returns to the origin for an infinite random walk is:</span>
<span id="cb6-439"><a href="#cb6-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-440"><a href="#cb6-440" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-441"><a href="#cb6-441" aria-hidden="true" tabindex="-1"></a>E &amp;= \sum_{m = 1}^{\infty} m (u^{m-1}(1-u))<span class="sc">\\</span></span>
<span id="cb6-442"><a href="#cb6-442" aria-hidden="true" tabindex="-1"></a>&amp;= (1-u)\sum_{m=1}^{\infty}mu^{m-1}<span class="sc">\\</span></span>
<span id="cb6-443"><a href="#cb6-443" aria-hidden="true" tabindex="-1"></a>&amp;= (1-u)\sum_{m=1}^{\infty}\frac{d}{du}u^{m}<span class="sc">\\</span></span>
<span id="cb6-444"><a href="#cb6-444" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-445"><a href="#cb6-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-446"><a href="#cb6-446" aria-hidden="true" tabindex="-1"></a>We note that limit exchanging is acceptable since the power series $\sum_{n=1}^{\infty}x^n$ converges uniformly for $u &lt; 1$ and we can apply the differentiable limit theorem.</span>
<span id="cb6-447"><a href="#cb6-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-448"><a href="#cb6-448" aria-hidden="true" tabindex="-1"></a>So we obtain:</span>
<span id="cb6-449"><a href="#cb6-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-450"><a href="#cb6-450" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-451"><a href="#cb6-451" aria-hidden="true" tabindex="-1"></a>E &amp;= (1-u)\frac{d}{du}\sum_{m = 1}^{\infty} u^m <span class="sc">\\</span></span>
<span id="cb6-452"><a href="#cb6-452" aria-hidden="true" tabindex="-1"></a>&amp;= (1-u)\cdot \frac{1}{(1-u)^2}<span class="sc">\\</span></span>
<span id="cb6-453"><a href="#cb6-453" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{1}{1-u}</span>
<span id="cb6-454"><a href="#cb6-454" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-455"><a href="#cb6-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-456"><a href="#cb6-456" aria-hidden="true" tabindex="-1"></a>So, we see that if $E$ is finite, $u &lt; 1$, then the walk is transient and if $E = +\infty$, $u=1$, then the walk is recurrent.</span>
<span id="cb6-457"><a href="#cb6-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-458"><a href="#cb6-458" aria-hidden="true" tabindex="-1"></a>We then define $u_n$ to be the probability that a given walk is at the origin on the $n$th step, defining the value $u_0=1$ for the trivial loop. We also introduce an indicator random variable $x_n$, which takes the value $1$, if the particle is at the origin on the $n$th step and zero otherwise.</span>
<span id="cb6-459"><a href="#cb6-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-460"><a href="#cb6-460" aria-hidden="true" tabindex="-1"></a>Then</span>
<span id="cb6-461"><a href="#cb6-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-462"><a href="#cb6-462" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-463"><a href="#cb6-463" aria-hidden="true" tabindex="-1"></a>T = \sum_{n=1}^{\infty}x_n</span>
<span id="cb6-464"><a href="#cb6-464" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-465"><a href="#cb6-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-466"><a href="#cb6-466" aria-hidden="true" tabindex="-1"></a>is the total number of times, the particle is at the origin, so $E$ is equal to the expectation of $T$, $\mathbb{E}(T)$, which is equal to:</span>
<span id="cb6-467"><a href="#cb6-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-468"><a href="#cb6-468" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-469"><a href="#cb6-469" aria-hidden="true" tabindex="-1"></a>\mathbb{E}<span class="co">[</span><span class="ot">T</span><span class="co">]</span> &amp;= \sum_{n=1}^{\infty}\mathbb{E}<span class="co">[</span><span class="ot">x_n</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb6-470"><a href="#cb6-470" aria-hidden="true" tabindex="-1"></a>&amp;= \sum_{n=1}^{\infty} u_n</span>
<span id="cb6-471"><a href="#cb6-471" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-472"><a href="#cb6-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-473"><a href="#cb6-473" aria-hidden="true" tabindex="-1"></a>But, we showed previously that if $E$ is finite, then the walk is transient and if $E = \infty$, then the walk is recurrent, so we have established that if:</span>
<span id="cb6-474"><a href="#cb6-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-475"><a href="#cb6-475" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-476"><a href="#cb6-476" aria-hidden="true" tabindex="-1"></a>\sum_{n=1}^{\infty}u_n</span>
<span id="cb6-477"><a href="#cb6-477" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-478"><a href="#cb6-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-479"><a href="#cb6-479" aria-hidden="true" tabindex="-1"></a>converges then the walk is transient and if the sum diverges, then the walk is recurrent.</span>
<span id="cb6-480"><a href="#cb6-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-481"><a href="#cb6-481" aria-hidden="true" tabindex="-1"></a><span class="fu">### $\mathbb{Z}^1$ case</span></span>
<span id="cb6-482"><a href="#cb6-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-483"><a href="#cb6-483" aria-hidden="true" tabindex="-1"></a>Now that we have built up the necessary tools, we will consider the cases. We start by considering a simple random walk on $\mathbb{Z}^1$. Since, as mentioned previously, a walk must have an even number of steps to be a loop, we only look at $u_{2n},n \in \mathbb{Z}^+$. A path of length $2n$ returning to the origin must have $n$ up-moves and $n$ down-moves. The number of such paths are ${2n \choose n}$. Each such path has a probability of occurrence $\frac{1}{2^{2n}}$. Thus,</span>
<span id="cb6-484"><a href="#cb6-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-485"><a href="#cb6-485" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-486"><a href="#cb6-486" aria-hidden="true" tabindex="-1"></a>u_{2n} = \frac{1}{2^{2n}}{2n \choose n}</span>
<span id="cb6-487"><a href="#cb6-487" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-488"><a href="#cb6-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-489"><a href="#cb6-489" aria-hidden="true" tabindex="-1"></a>Using Stirling's approximation $n! \sim \sqrt{2\pi n} e^{-n} n^{n}$, we obtain:</span>
<span id="cb6-490"><a href="#cb6-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-491"><a href="#cb6-491" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-492"><a href="#cb6-492" aria-hidden="true" tabindex="-1"></a>u_{2n} &amp;= \frac{1}{2^{2n}} \frac{(2n)!}{n! n!}<span class="sc">\\</span></span>
<span id="cb6-493"><a href="#cb6-493" aria-hidden="true" tabindex="-1"></a>&amp;\approx \frac{1}{2^{2n}} \cdot \frac{\sqrt{2\pi(2n)} e^{-2n}(2n)^{2n}}{\left(\sqrt{2\pi n} e^{-n} n^n\right)^2}<span class="sc">\\</span></span>
<span id="cb6-494"><a href="#cb6-494" aria-hidden="true" tabindex="-1"></a>&amp;=\frac{1}{\sqrt{\pi n}}</span>
<span id="cb6-495"><a href="#cb6-495" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-496"><a href="#cb6-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-497"><a href="#cb6-497" aria-hidden="true" tabindex="-1"></a>So, we see that:</span>
<span id="cb6-498"><a href="#cb6-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-499"><a href="#cb6-499" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-500"><a href="#cb6-500" aria-hidden="true" tabindex="-1"></a>\sum_{n=0}^{\infty} u_{2n} \approx \sum_{n=0}^{\infty} \frac{1}{\sqrt{n\pi}}</span>
<span id="cb6-501"><a href="#cb6-501" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-502"><a href="#cb6-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-503"><a href="#cb6-503" aria-hidden="true" tabindex="-1"></a>And the series on the right certainly diverges so, we see that a simple random walk in $\mathbb{Z}^1$ is recurrent since $E$ diverges.</span>
<span id="cb6-504"><a href="#cb6-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-505"><a href="#cb6-505" aria-hidden="true" tabindex="-1"></a><span class="fu">### $\mathbb{Z}^2$ case</span></span>
<span id="cb6-506"><a href="#cb6-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-507"><a href="#cb6-507" aria-hidden="true" tabindex="-1"></a>A particle has an equal probability $1/4$ of moving left, right, up or down randomly in the $d=2$ dimensional lattice. Each path of $2n$ steps has a probability $\frac{1}{4^{2n}}$ of occurring. We then consider the number of paths with equal steps left and right (say $L$ steps in each horizontal direction) and equal steps up and down (then $n-L$) is:</span>
<span id="cb6-508"><a href="#cb6-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-509"><a href="#cb6-509" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-510"><a href="#cb6-510" aria-hidden="true" tabindex="-1"></a>{2n \choose L}{2n - L \choose L}{2n - 2L \choose n - L}{n-L \choose n - L} = \frac{(2n)!}{L! L! (n-L)! (n-L)!}</span>
<span id="cb6-511"><a href="#cb6-511" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-512"><a href="#cb6-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-513"><a href="#cb6-513" aria-hidden="true" tabindex="-1"></a>So we get:</span>
<span id="cb6-514"><a href="#cb6-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-515"><a href="#cb6-515" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-516"><a href="#cb6-516" aria-hidden="true" tabindex="-1"></a>u_{2n} &amp;= \frac{1}{4^{2n}} \sum_{L=0}^n \frac{(2n)!}{L! L! (n-L)! (n-L)!} <span class="sc">\\</span></span>
<span id="cb6-517"><a href="#cb6-517" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{1}{4^{2n}} \sum_{L=0}^n \frac{(2n)!}{n! n!} \cdot \left(\frac{n!}{L! (n-L)!}\right)^2 <span class="sc">\\</span></span>
<span id="cb6-518"><a href="#cb6-518" aria-hidden="true" tabindex="-1"></a>&amp;=\frac{1}{4^{2n}} {2n \choose n}\sum_{L=0}^n {n \choose L}^2</span>
<span id="cb6-519"><a href="#cb6-519" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-520"><a href="#cb6-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-521"><a href="#cb6-521" aria-hidden="true" tabindex="-1"></a>Suppose, we are to form a team of $n$ players from a population of $2n$ participants. There ${2n \choose n}$ distinguishable teams of size $n$. Alternatively, we could divide the population into two halves of $n$ participants each, choose $L$ participants from the first sub-population, and the remaining $n-L$ participants from the second sub-population. So, the number of distinguishable teams is:</span>
<span id="cb6-522"><a href="#cb6-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-523"><a href="#cb6-523" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-524"><a href="#cb6-524" aria-hidden="true" tabindex="-1"></a>\sum_{L=0}^{n}{n \choose L}{n \choose n - L} = \sum_{L=0}^{n} {n \choose L}^2</span>
<span id="cb6-525"><a href="#cb6-525" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-526"><a href="#cb6-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-527"><a href="#cb6-527" aria-hidden="true" tabindex="-1"></a>So, we have the combinatorial identity:</span>
<span id="cb6-528"><a href="#cb6-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-529"><a href="#cb6-529" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-530"><a href="#cb6-530" aria-hidden="true" tabindex="-1"></a>\sum_{L=0}^{n} {n \choose L}^2 = {2n \choose n}</span>
<span id="cb6-531"><a href="#cb6-531" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-532"><a href="#cb6-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-533"><a href="#cb6-533" aria-hidden="true" tabindex="-1"></a>Thus,</span>
<span id="cb6-534"><a href="#cb6-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-535"><a href="#cb6-535" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-536"><a href="#cb6-536" aria-hidden="true" tabindex="-1"></a>u_{2n} &amp;=\frac{1}{4^{2n}} {2n \choose n}\sum_{L=0}^n {n \choose L}^2<span class="sc">\\</span></span>
<span id="cb6-537"><a href="#cb6-537" aria-hidden="true" tabindex="-1"></a>&amp;= \left(\frac{1}{2^{2n}} {2n \choose n}\right)^2</span>
<span id="cb6-538"><a href="#cb6-538" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-539"><a href="#cb6-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-540"><a href="#cb6-540" aria-hidden="true" tabindex="-1"></a>So, we have that, it is just the square of the result from $\mathbb{Z}^1$, so we see in this case that:</span>
<span id="cb6-541"><a href="#cb6-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-542"><a href="#cb6-542" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-543"><a href="#cb6-543" aria-hidden="true" tabindex="-1"></a>u_{2n} &amp;\approx \sum_{n=0}^{\infty} \frac{1}{\pi n}</span>
<span id="cb6-544"><a href="#cb6-544" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-545"><a href="#cb6-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-546"><a href="#cb6-546" aria-hidden="true" tabindex="-1"></a>And the series on the right certainly diverges, so we see that a simple random walk in $\mathbb{Z}^2$ is recurrent as $E$ diverges.</span>
<span id="cb6-547"><a href="#cb6-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-548"><a href="#cb6-548" aria-hidden="true" tabindex="-1"></a><span class="fu">### $\mathbb{Z}^3$ case</span></span>
<span id="cb6-549"><a href="#cb6-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-550"><a href="#cb6-550" aria-hidden="true" tabindex="-1"></a>As before, in order to have a walk return to the origin we must have equal steps in the positive and negative directions for each direction and each path of $2n$ has a probability of occurring of $\frac{1}{6^{2n}}$. Then, extending the idea from the previous subsection, the number of paths (of total length $2n$) with $L$ steps left and right, $U$ steps up and down and $n - L - U$ steps forward and backward is:</span>
<span id="cb6-551"><a href="#cb6-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-552"><a href="#cb6-552" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-553"><a href="#cb6-553" aria-hidden="true" tabindex="-1"></a>\frac{(2n)!}{L! L! U! U! (n - L - U)! (n - L - U)!}</span>
<span id="cb6-554"><a href="#cb6-554" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-555"><a href="#cb6-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-556"><a href="#cb6-556" aria-hidden="true" tabindex="-1"></a>So, we get:</span>
<span id="cb6-557"><a href="#cb6-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-558"><a href="#cb6-558" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-559"><a href="#cb6-559" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-560"><a href="#cb6-560" aria-hidden="true" tabindex="-1"></a>u_{2n} &amp;= \frac{1}{6^{2n}} \sum_{L,U,L+U \leq n} \frac{(2n)!}{L! L! U! U! (n - L - U)! (n - L - U)!} <span class="sc">\\</span></span>
<span id="cb6-561"><a href="#cb6-561" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{1}{2^{2n}} {2n \choose n} \sum_{L,U,L+U \leq n} \left(\frac{1}{3^n}\frac{n!}{L! U! (n - U - L)!}\right)^2</span>
<span id="cb6-562"><a href="#cb6-562" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-563"><a href="#cb6-563" aria-hidden="true" tabindex="-1"></a>$$ {#eq-probability-of-return-to-origin-at-nth-step-in-3d}</span>
<span id="cb6-564"><a href="#cb6-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-565"><a href="#cb6-565" aria-hidden="true" tabindex="-1"></a>Consider a $3$-sided fair coin, with $\mathbb{P}<span class="sc">\{</span>\text{Heads}<span class="sc">\}</span> = \mathbb{P}<span class="sc">\{</span>\text{Tails}<span class="sc">\}</span> = \mathbb{P}<span class="sc">\{</span>\text{Edge}<span class="sc">\}</span> = \frac{1}{3}$. Suppose that the coin is tossed $n=3^2 = 9$ times. The probability of landing $L$ heads, $U$ tails and $n - L - U$ edges is $\frac{n!}{L!U!(n-L-U)!} \frac{1}{3^n}$.  This is precisely the term seen in the above expression. The number of heads, tails and edges in $n$ coin tosses follows a multinomial distribution. It can be easily demonstrated, that in, $n/3 = 3$ heads, $n/3$ tails and $n/3$ edges are most likely to occur in $n$ coin tosses. So, we can find an upper bound on the summand in @eq-probability-of-return-to-origin-at-nth-step-in-3d as:</span>
<span id="cb6-566"><a href="#cb6-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-567"><a href="#cb6-567" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-568"><a href="#cb6-568" aria-hidden="true" tabindex="-1"></a>\frac{n!}{3^n L! U! (n- L - U)!} \leq \frac{n!}{3^n \lfloor\frac{n}{3}\rfloor! \lfloor\frac{n}{3}\rfloor! \lfloor\frac{n}{3}\rfloor!}</span>
<span id="cb6-569"><a href="#cb6-569" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-570"><a href="#cb6-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-571"><a href="#cb6-571" aria-hidden="true" tabindex="-1"></a>Also, from the multinomial expansion theorem:</span>
<span id="cb6-572"><a href="#cb6-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-573"><a href="#cb6-573" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-574"><a href="#cb6-574" aria-hidden="true" tabindex="-1"></a>(1 + a + b)^n = \sum_{L,U,L+U\leq n} \frac{n!}{L! U! (n-L-U)!} a^L b^U</span>
<span id="cb6-575"><a href="#cb6-575" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-576"><a href="#cb6-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-577"><a href="#cb6-577" aria-hidden="true" tabindex="-1"></a>Setting $a = b = 1$, we get:</span>
<span id="cb6-578"><a href="#cb6-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-579"><a href="#cb6-579" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-580"><a href="#cb6-580" aria-hidden="true" tabindex="-1"></a>\sum_{L,U,L+U\leq n} \frac{n!}{3^n L! U! (n-L-U)!} a^L b^U = 1</span>
<span id="cb6-581"><a href="#cb6-581" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-582"><a href="#cb6-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-583"><a href="#cb6-583" aria-hidden="true" tabindex="-1"></a>We then see that:</span>
<span id="cb6-584"><a href="#cb6-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-585"><a href="#cb6-585" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-586"><a href="#cb6-586" aria-hidden="true" tabindex="-1"></a>u_{2n} \leq \frac{1}{2^{2n}} {2n \choose n} \frac{n!}{3^n \lfloor\frac{n}{3}\rfloor! \lfloor\frac{n}{3}\rfloor! \lfloor\frac{n}{3}\rfloor!}</span>
<span id="cb6-587"><a href="#cb6-587" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-588"><a href="#cb6-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-589"><a href="#cb6-589" aria-hidden="true" tabindex="-1"></a>We can simplify this as:</span>
<span id="cb6-590"><a href="#cb6-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-591"><a href="#cb6-591" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-592"><a href="#cb6-592" aria-hidden="true" tabindex="-1"></a>u_{2n} &amp;= \frac{1}{2^{2n}}{2n \choose n} \frac{n!}{3^n \left(\lfloor\frac{n}{3}\rfloor!\right)^3} <span class="sc">\\</span></span>
<span id="cb6-593"><a href="#cb6-593" aria-hidden="true" tabindex="-1"></a>&amp;\approx \frac{1}{\sqrt{\pi n}} \times \frac{\sqrt{2\pi n} e^{-n} n^n}{3^n \left<span class="sc">\{</span>\sqrt{2\pi \frac{n}{3}}e^{-n/3} \left(\frac{n}{3}\right)^{n/3}\right<span class="sc">\}</span>^3}<span class="sc">\\</span></span>
<span id="cb6-594"><a href="#cb6-594" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{1}{\sqrt{\pi n}} \frac{\sqrt{2\pi n} e^{-n} n^n}{3^n \frac{(2\pi n)^{3/2}}{3^{3/2}} e^{-n} \frac{n^n}{3^n}}<span class="sc">\\</span></span>
<span id="cb6-595"><a href="#cb6-595" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{1}{\sqrt{\pi n}} \frac{\sqrt{2\pi n} \cancel{e^{-n}} \cancel{n^n}}{\cancel{3^n} \frac{(2\pi n)^{3/2}}{3^{3/2}} \cancel{e^{-n}} \frac{ \cancel{n^n}}{\cancel{3^n}}}<span class="sc">\\</span></span>
<span id="cb6-596"><a href="#cb6-596" aria-hidden="true" tabindex="-1"></a>&amp;\approx \frac{M}{(\pi n)^{3/2}}</span>
<span id="cb6-597"><a href="#cb6-597" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-598"><a href="#cb6-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-599"><a href="#cb6-599" aria-hidden="true" tabindex="-1"></a>where $M$ is a positive constant. We then see:</span>
<span id="cb6-600"><a href="#cb6-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-601"><a href="#cb6-601" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-602"><a href="#cb6-602" aria-hidden="true" tabindex="-1"></a>\sum_n u_{2n} &amp;= M \sum_n \frac{1}{n^{\frac{3}{2}}}</span>
<span id="cb6-603"><a href="#cb6-603" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-604"><a href="#cb6-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-605"><a href="#cb6-605" aria-hidden="true" tabindex="-1"></a>The sum on the right hand side converges, so we have that a simple random walk in three dimensions is transient. The proof of Polya's Random Walk Theorem is complete.</span>
<span id="cb6-606"><a href="#cb6-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-607"><a href="#cb6-607" aria-hidden="true" tabindex="-1"></a><span class="fu">## Recurrence and Transience of Brownian Motion</span></span>
<span id="cb6-608"><a href="#cb6-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-609"><a href="#cb6-609" aria-hidden="true" tabindex="-1"></a>In one dimension, we established that every path of a Brownian motion reaches any level $a \in \mathbf{R}$. More precisely, for $a &gt; 0$, if we define the stopping time :</span>
<span id="cb6-610"><a href="#cb6-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-611"><a href="#cb6-611" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-612"><a href="#cb6-612" aria-hidden="true" tabindex="-1"></a>\tau = \min <span class="sc">\{</span> t \geq 0 : B_t \geq a<span class="sc">\}</span></span>
<span id="cb6-613"><a href="#cb6-613" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-614"><a href="#cb6-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-615"><a href="#cb6-615" aria-hidden="true" tabindex="-1"></a>we have $\mathbb{P}<span class="sc">\{</span>\tau_a &lt; \infty <span class="sc">\}</span> = 1$. This implies in particular that every path will come back to $0$ and will do infinitely many times. This is because $B(t+\tau) - B(t)$ is a standard brownian motion. This property of Brownian motion is called *recurrence*. This is to be compared with Brownian motion with a drift. In our analysis, we found that, if the drift is negative, then there are paths that will not reach a given level $a &gt; 0$ with positive probability. Such paths go to infinity without ever going back to $0$. This property of the process is called *transience*. </span>
<span id="cb6-616"><a href="#cb6-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-617"><a href="#cb6-617" aria-hidden="true" tabindex="-1"></a>We can derive similar properties for the multidimensional Brownian motion. We will rely heavily on @cor-brownian-martingales and on some knowledge of harmonic functions. Harmonic functions play a very important role in mathematics, physics and in nature in general. As we mentioned earlier, if $d = 1$, the only harmonic functions are the linear functions, since the equation $f''(x) = 0$ has the solutions $f(x)=ax+b$. However, in higher dimensions, the collection of harmonic functions is very rich. This gives access to a plethora of Brownian martingales. For example, the following functions are harmonic in the whole space minus the origin, $\mathbf{R}^d \setminus <span class="sc">\{</span>0<span class="sc">\}</span>$.</span>
<span id="cb6-618"><a href="#cb6-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-619"><a href="#cb6-619" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-620"><a href="#cb6-620" aria-hidden="true" tabindex="-1"></a>h(x) = \begin{cases}</span>
<span id="cb6-621"><a href="#cb6-621" aria-hidden="true" tabindex="-1"></a>\log ||x||, &amp; d = 2 <span class="sc">\\</span></span>
<span id="cb6-622"><a href="#cb6-622" aria-hidden="true" tabindex="-1"></a>||x||^{2 - d}, &amp; d \geq 3</span>
<span id="cb6-623"><a href="#cb6-623" aria-hidden="true" tabindex="-1"></a>\end{cases}</span>
<span id="cb6-624"><a href="#cb6-624" aria-hidden="true" tabindex="-1"></a>$$ {#eq-example-of-harmonic-function}</span>
<span id="cb6-625"><a href="#cb6-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-626"><a href="#cb6-626" aria-hidden="true" tabindex="-1"></a>where $x\in\mathbf{R}^d$.</span>
<span id="cb6-627"><a href="#cb6-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-628"><a href="#cb6-628" aria-hidden="true" tabindex="-1"></a>::: {.proof}</span>
<span id="cb6-629"><a href="#cb6-629" aria-hidden="true" tabindex="-1"></a>Consider </span>
<span id="cb6-630"><a href="#cb6-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-631"><a href="#cb6-631" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-632"><a href="#cb6-632" aria-hidden="true" tabindex="-1"></a>f(x_1,x_2) = \log \sqrt {x_1^2 + x_2^2}</span>
<span id="cb6-633"><a href="#cb6-633" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-634"><a href="#cb6-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-635"><a href="#cb6-635" aria-hidden="true" tabindex="-1"></a>We have:</span>
<span id="cb6-636"><a href="#cb6-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-637"><a href="#cb6-637" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-638"><a href="#cb6-638" aria-hidden="true" tabindex="-1"></a>\frac{\partial f}{\partial x_1} &amp;= \frac{1}{\sqrt{x_1^2 + x_2^2}} \cdot \frac{\partial }{\partial x_1} (\sqrt{x_1^2 + x_2^2})<span class="sc">\\</span></span>
<span id="cb6-639"><a href="#cb6-639" aria-hidden="true" tabindex="-1"></a>&amp;=\frac{1}{\sqrt{x_1^2 + x_2^2}} \cdot \frac{x_1}{\sqrt{x_1^2 + x_2^2}}<span class="sc">\\</span></span>
<span id="cb6-640"><a href="#cb6-640" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{x_1}{x_1^2 + x_2^2}</span>
<span id="cb6-641"><a href="#cb6-641" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-642"><a href="#cb6-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-643"><a href="#cb6-643" aria-hidden="true" tabindex="-1"></a>Further,</span>
<span id="cb6-644"><a href="#cb6-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-645"><a href="#cb6-645" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-646"><a href="#cb6-646" aria-hidden="true" tabindex="-1"></a>\frac{\partial^2 f}{\partial x_1^2} &amp;= \frac{(x_1^2 + x_2^2)(1) - x_1(2x_1)}{(x_1^2 + x_2^2)^2} <span class="sc">\\</span></span>
<span id="cb6-647"><a href="#cb6-647" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{x_1^2 - x_2^2}{(x_1^2 + x_2^2)}</span>
<span id="cb6-648"><a href="#cb6-648" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-649"><a href="#cb6-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-650"><a href="#cb6-650" aria-hidden="true" tabindex="-1"></a>By symmetry,</span>
<span id="cb6-651"><a href="#cb6-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-652"><a href="#cb6-652" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-653"><a href="#cb6-653" aria-hidden="true" tabindex="-1"></a>\frac{\partial^2 f}{\partial x_2^2} </span>
<span id="cb6-654"><a href="#cb6-654" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{x_2^2 - x_1^2}{(x_1^2 + x_2^2)}</span>
<span id="cb6-655"><a href="#cb6-655" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-656"><a href="#cb6-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-657"><a href="#cb6-657" aria-hidden="true" tabindex="-1"></a>So, </span>
<span id="cb6-658"><a href="#cb6-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-659"><a href="#cb6-659" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-660"><a href="#cb6-660" aria-hidden="true" tabindex="-1"></a>\frac{\partial^2 f}{\partial x_1^2} &amp;= - \frac{\partial^2 f}{\partial x_2^2}<span class="sc">\\</span></span>
<span id="cb6-661"><a href="#cb6-661" aria-hidden="true" tabindex="-1"></a>\frac{\partial^2 f}{\partial x_1^2} + \frac{\partial^2 f}{\partial x_2^2}&amp;=0</span>
<span id="cb6-662"><a href="#cb6-662" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-663"><a href="#cb6-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-664"><a href="#cb6-664" aria-hidden="true" tabindex="-1"></a>We conclude that $f$ is harmonic.</span>
<span id="cb6-665"><a href="#cb6-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-666"><a href="#cb6-666" aria-hidden="true" tabindex="-1"></a>Next, consider </span>
<span id="cb6-667"><a href="#cb6-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-668"><a href="#cb6-668" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-669"><a href="#cb6-669" aria-hidden="true" tabindex="-1"></a>g(x_1,x_2,\ldots,x_d) = \frac{1}{\left(\sqrt{x_1^2 + x_2^2 + \ldots + x_d^2}\right)^{d-2}}</span>
<span id="cb6-670"><a href="#cb6-670" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-671"><a href="#cb6-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-672"><a href="#cb6-672" aria-hidden="true" tabindex="-1"></a>Now,</span>
<span id="cb6-673"><a href="#cb6-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-674"><a href="#cb6-674" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-675"><a href="#cb6-675" aria-hidden="true" tabindex="-1"></a>\frac{\partial g}{\partial x_i} &amp;= \frac{(2-d)}{\left(\sqrt{x_1^2 + x_2^2 + \ldots + x_d^2}\right)^{d-1}} \cdot \frac{\partial }{\partial x_i}\left(\sqrt{x_1^2 + x_2^2 + \ldots + x_d^2}\right)<span class="sc">\\</span></span>
<span id="cb6-676"><a href="#cb6-676" aria-hidden="true" tabindex="-1"></a> &amp;= \frac{(2-d)}{\left(\sqrt{x_1^2 + x_2^2 + \ldots + x_d^2}\right)^{d-1}}\cdot \frac{2x_i}{2\left(\sqrt{x_1^2 + x_2^2 + \ldots + x_d^2}\right)}<span class="sc">\\</span></span>
<span id="cb6-677"><a href="#cb6-677" aria-hidden="true" tabindex="-1"></a> &amp;= \frac{(2-d)x_i}{\left(\sqrt{x_1^2 + x_2^2 + \ldots + x_d^2}\right)^d}</span>
<span id="cb6-678"><a href="#cb6-678" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-679"><a href="#cb6-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-680"><a href="#cb6-680" aria-hidden="true" tabindex="-1"></a>Further, we have:</span>
<span id="cb6-681"><a href="#cb6-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-682"><a href="#cb6-682" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-683"><a href="#cb6-683" aria-hidden="true" tabindex="-1"></a>\frac{\partial^2 g}{\partial x_i^2} &amp;= (2-d)\frac{\left(\sqrt{x_1^2 + x_2^2 + \ldots + x_d^2}\right)^d (1) - (x_i)\cdot d \cdot\left(\sqrt{x_1^2 + x_2^2 + \ldots + x_d^2}\right)^{d-1}\cdot \frac{x_i}{\left(\sqrt{x_1^2 + x_2^2 + \ldots + x_d^2}\right)}}{\left(\sqrt{x_1^2 + x_2^2 + \ldots + x_d^2}\right)^{2d}}<span class="sc">\\</span></span>
<span id="cb6-684"><a href="#cb6-684" aria-hidden="true" tabindex="-1"></a>&amp;=(2-d)\left(\sqrt{x_1^2 + x_2^2 + \ldots + x_d^2}\right)^{d-2} \frac{\left(\sqrt{x_1^2 + x_2^2 + \ldots + x_d^2}\right)^2  - d x_i^2}{\left(\sqrt{x_1^2 + x_2^2 + \ldots + x_d^2}\right)^{2d}}<span class="sc">\\</span></span>
<span id="cb6-685"><a href="#cb6-685" aria-hidden="true" tabindex="-1"></a>&amp;=(2-d) \frac{\left(\sum_{i=1}^d x_i^2\right) - dx_i^2 }{||x||^{d+2}}</span>
<span id="cb6-686"><a href="#cb6-686" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-687"><a href="#cb6-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-688"><a href="#cb6-688" aria-hidden="true" tabindex="-1"></a>We conclude that:</span>
<span id="cb6-689"><a href="#cb6-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-690"><a href="#cb6-690" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-691"><a href="#cb6-691" aria-hidden="true" tabindex="-1"></a>\sum_{i=1}^{d} \frac{\partial^2 g}{\partial x_i^2} = 0</span>
<span id="cb6-692"><a href="#cb6-692" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-693"><a href="#cb6-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-694"><a href="#cb6-694" aria-hidden="true" tabindex="-1"></a>and hence $g$ is harmonic.</span>
<span id="cb6-695"><a href="#cb6-695" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb6-696"><a href="#cb6-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-697"><a href="#cb6-697" aria-hidden="true" tabindex="-1"></a>Interestingly enough, the answer to the recurrence versus transience puzzle depends on the dimension. We will show that Brownian motion is recurrent in dimension $d=2$ in the sense that every Brownian motion path starting from $x$ will eventually enter a disc around the origin, no matter how small the disc is. The Brownian path will then enter this disc infinitely many times, as $t \to \infty$. Note that, we did not say that the path actually hits $0$, but that *it enters a disc around the $0$*. This nuance is important, as we will in fact show that a Brownian path actually never hits a given point. In dimension $d=3$ or higher, it is proved that there are some paths starting from a given $x$ that will never enter a given ball around the origin with positive probability. This is the transience property. </span>
<span id="cb6-698"><a href="#cb6-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-699"><a href="#cb6-699" aria-hidden="true" tabindex="-1"></a>The strategy of the proof is similar to the approach for Brownian motion with a drift. We will find a good function $h : \mathbf{R}^d \to \mathbf{R}$ for which $h(B_t)$ is a martingale. In light of @cor-brownian-martingales, this function needs to be harmonic in a suitable region. The desired probability is then obtained by considering the right boundary values.</span>
<span id="cb6-700"><a href="#cb6-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-701"><a href="#cb6-701" aria-hidden="true" tabindex="-1"></a>::: {#thm-recurrence-and-transience-of-brownian-motion}</span>
<span id="cb6-702"><a href="#cb6-702" aria-hidden="true" tabindex="-1"></a><span class="fu">### Recurrence and transience of a brownian motion in $\mathbf{R}^d$</span></span>
<span id="cb6-703"><a href="#cb6-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-704"><a href="#cb6-704" aria-hidden="true" tabindex="-1"></a>Let $(B_t,t\geq 0)$ be a Brownian motion in $\mathbf{R}^d$ starting at $B_0 = x$. Consider for $r &lt; ||x||$, the stopping time </span>
<span id="cb6-705"><a href="#cb6-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-706"><a href="#cb6-706" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-707"><a href="#cb6-707" aria-hidden="true" tabindex="-1"></a>\tau_r = \min <span class="sc">\{</span>t \geq 0 : ||B_t|| &lt; r<span class="sc">\}</span></span>
<span id="cb6-708"><a href="#cb6-708" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-709"><a href="#cb6-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-710"><a href="#cb6-710" aria-hidden="true" tabindex="-1"></a>the first hitting time of the paths in a ball of radius $r$ around the origin. We have:</span>
<span id="cb6-711"><a href="#cb6-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-712"><a href="#cb6-712" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-713"><a href="#cb6-713" aria-hidden="true" tabindex="-1"></a>\mathbb{P}(\tau_r &lt; \infty) = </span>
<span id="cb6-714"><a href="#cb6-714" aria-hidden="true" tabindex="-1"></a>\begin{cases}</span>
<span id="cb6-715"><a href="#cb6-715" aria-hidden="true" tabindex="-1"></a>1 &amp; \text{ if }d \leq 2 <span class="sc">\\</span></span>
<span id="cb6-716"><a href="#cb6-716" aria-hidden="true" tabindex="-1"></a>\left(\frac{r}{||x||}\right)^{d-2} &amp; \text{ if }d \geq 3</span>
<span id="cb6-717"><a href="#cb6-717" aria-hidden="true" tabindex="-1"></a>\end{cases}</span>
<span id="cb6-718"><a href="#cb6-718" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-719"><a href="#cb6-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-720"><a href="#cb6-720" aria-hidden="true" tabindex="-1"></a>In particular, for $d \leq 2$, the paths are recurrent; that is, they come back infinitely many times in a neighbourhood of the origin. For $d \geq 3$, each path will eventually never come back to a neighbourhood of the origin.</span>
<span id="cb6-721"><a href="#cb6-721" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb6-722"><a href="#cb6-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-723"><a href="#cb6-723" aria-hidden="true" tabindex="-1"></a>Note that we made sure that the starting point of the Brownian motion $x$ is outside the ball of radius $r$.</span>
<span id="cb6-724"><a href="#cb6-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-725"><a href="#cb6-725" aria-hidden="true" tabindex="-1"></a>::: {.proof}</span>
<span id="cb6-726"><a href="#cb6-726" aria-hidden="true" tabindex="-1"></a>Consider another hitting time of a ball with a radius larger than $||x||$:</span>
<span id="cb6-727"><a href="#cb6-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-728"><a href="#cb6-728" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-729"><a href="#cb6-729" aria-hidden="true" tabindex="-1"></a>\tau_R' = \min <span class="sc">\{</span>t \geq 0 : ||B_t|| \geq R<span class="sc">\}</span>, \quad r &lt; ||x|| &lt; R</span>
<span id="cb6-730"><a href="#cb6-730" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-731"><a href="#cb6-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-732"><a href="#cb6-732" aria-hidden="true" tabindex="-1"></a>Note that $\tau_R'$ must increase with $R$ and that it must go to $+\infty$ as $R \to \infty$. Moreover, the sequence of events $<span class="sc">\{</span>\tau_r &lt; \tau_R'<span class="sc">\}</span>_{R &gt; ||x||}$ is increasing. In particular, by continuity of probability measure, we have:</span>
<span id="cb6-733"><a href="#cb6-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-734"><a href="#cb6-734" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-735"><a href="#cb6-735" aria-hidden="true" tabindex="-1"></a>\lim_{R \to \infty} \mathbb{P}(\tau_r &lt; \tau_R') &amp;= \mathbb{P}(\lim_{R \to \infty} \tau_r &lt; \tau_R')<span class="sc">\\</span></span>
<span id="cb6-736"><a href="#cb6-736" aria-hidden="true" tabindex="-1"></a>&amp;= \mathbb{P}(\tau_r &lt; \infty)</span>
<span id="cb6-737"><a href="#cb6-737" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-738"><a href="#cb6-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-739"><a href="#cb6-739" aria-hidden="true" tabindex="-1"></a>If we set $\tau = \tau_r \land \tau_R'$, then the event $<span class="sc">\{</span>\tau_r &lt; \tau_R'<span class="sc">\}</span>$ is the same as the event $<span class="sc">\{</span>||B_\tau||=r<span class="sc">\}</span>$. So, $\lim_{R \to \infty} \mathbb{P}(\tau_r &lt; \tau_R') = \lim_{R \to \infty} \mathbb{P}(||B_\tau||=r)$.</span>
<span id="cb6-740"><a href="#cb6-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-741"><a href="#cb6-741" aria-hidden="true" tabindex="-1"></a>Now, consider the event $<span class="sc">\{</span>\tau &lt; \infty<span class="sc">\}</span>$. Let $E_n$ be the event that the $n$th increment $||B_n - B_{n-1}||$ exceeds $R$. If $E_n$ occurs, then we must have the Brownian motion exits the spherical shell of thickness $R-r$. Moreover, we have $\mathbb{P}(E_1) = \ldots = \mathbb{P}(E_n)$, for all $n$. Call this probability $p$. Clearly, $0 &lt; p &lt; 1$. Since the events $E_n$ are independent, we have:</span>
<span id="cb6-742"><a href="#cb6-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-743"><a href="#cb6-743" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-744"><a href="#cb6-744" aria-hidden="true" tabindex="-1"></a>\mathbb{P}(E_1^C \cap \ldots \cap E_n^C) = (1 - p)^n</span>
<span id="cb6-745"><a href="#cb6-745" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-746"><a href="#cb6-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-747"><a href="#cb6-747" aria-hidden="true" tabindex="-1"></a>As $n \to \infty$, we have $\lim_{n \to \infty} \mathbb{P}(\bigcap_{k=1}^{n}E_k^C) = 0$. Now, let $F_k$ be the event that there are no excursions upto $k$. That is, $F_k = \bigcap_{i=1}^{k}E_i^C$. Now, the event $F_{k+1}$ implies $F_k$, or equivalently, $F_{k+1} \subseteq F_k$. So, $<span class="sc">\{</span>F_k<span class="sc">\}</span>_{k=1}^{\infty}$ is a decreasing sequence of events. Moreover, $\bigcap_{k=1}^n F_k = \bigcap_{k=1}^n E_k^C$. So, by continuity of probability measure,</span>
<span id="cb6-748"><a href="#cb6-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-749"><a href="#cb6-749" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-750"><a href="#cb6-750" aria-hidden="true" tabindex="-1"></a>\lim_{n \to \infty} \mathbb{P}(\bigcap_{k=1}^{n}E_k^C) </span>
<span id="cb6-751"><a href="#cb6-751" aria-hidden="true" tabindex="-1"></a>&amp;= \lim_{n \to \infty} \mathbb{P}(\bigcap_{k=1}^{n}F_k) <span class="sc">\\</span></span>
<span id="cb6-752"><a href="#cb6-752" aria-hidden="true" tabindex="-1"></a>&amp;= \mathbb{P}(\lim_{n \to \infty} \bigcap_{k=1}^{n}F_k) <span class="sc">\\</span></span>
<span id="cb6-753"><a href="#cb6-753" aria-hidden="true" tabindex="-1"></a>&amp;= \mathbb{P}(\bigcap_{k=1}^{\infty}F_k) <span class="sc">\\</span></span>
<span id="cb6-754"><a href="#cb6-754" aria-hidden="true" tabindex="-1"></a>&amp;= \mathbb{P}(\bigcap_{k=1}^{\infty}E_k^C) </span>
<span id="cb6-755"><a href="#cb6-755" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-756"><a href="#cb6-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-757"><a href="#cb6-757" aria-hidden="true" tabindex="-1"></a>So, $\mathbb{P}(\bigcup_{k=1}^{\infty}E_k) = 1$. There exists an $n_0 \in \mathbf{N}$, such that the event $E_{n_0}$, an excursion at $n_0$ occurs with probability $1$. So, the event $<span class="sc">\{</span>\tau &lt; \infty<span class="sc">\}</span>$ occurs almost surely.</span>
<span id="cb6-758"><a href="#cb6-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-759"><a href="#cb6-759" aria-hidden="true" tabindex="-1"></a>To compute $\mathbb{P}(||B_\tau||=r)$, the idea is to find a good function $h$ with the following properties:</span>
<span id="cb6-760"><a href="#cb6-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-761"><a href="#cb6-761" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Martingale**: $(h(B_t),t\leq \tau)$ is a bounded martingale, so that the optional stopping theorem implies:</span>
<span id="cb6-762"><a href="#cb6-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-763"><a href="#cb6-763" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-764"><a href="#cb6-764" aria-hidden="true" tabindex="-1"></a>\mathbb{E}<span class="co">[</span><span class="ot">h(B_\tau)</span><span class="co">]</span> = h(B_0) = h(x)</span>
<span id="cb6-765"><a href="#cb6-765" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-766"><a href="#cb6-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-767"><a href="#cb6-767" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Boundary values**: Since $B_\tau$ is a point at $||x||=r$ or at $||x||=R$, we pick boundary conditions for $h$, so that $\mathbb{E}[h(B_{\tau})]=\mathbb{P}(||B_\tau||=r)$. </span>
<span id="cb6-768"><a href="#cb6-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-769"><a href="#cb6-769" aria-hidden="true" tabindex="-1"></a>The second point is easy; it suffices to take the *boundary conditions* $h(x)=0$ at $||x||=R$ and $h(x)=1$ at $||x||=r$. For the first point, by Ito's formula, we pick $h$ to be harmonic in the annulus $<span class="sc">\{</span>x \in \mathbf{R}^d : r &lt; ||x||&lt;R \}$. Thus, we can use the function in @eq-example-of-harmonic-function. Of course, the functions $ah(x) + b$ remain harmonic. To satisfy the boundary conditions, we pick $a$ and $b$ suitably:</span>
<span id="cb6-770"><a href="#cb6-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-771"><a href="#cb6-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-772"><a href="#cb6-772" aria-hidden="true" tabindex="-1"></a>### $\mathbb{R}^1$ case</span>
<span id="cb6-773"><a href="#cb6-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-774"><a href="#cb6-774" aria-hidden="true" tabindex="-1"></a>Let $h(x) = ax + b$. Then, at $x=r$, we have:</span>
<span id="cb6-775"><a href="#cb6-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-776"><a href="#cb6-776" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-777"><a href="#cb6-777" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-778"><a href="#cb6-778" aria-hidden="true" tabindex="-1"></a>ar + b = 1</span>
<span id="cb6-779"><a href="#cb6-779" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-780"><a href="#cb6-780" aria-hidden="true" tabindex="-1"></a>$$ {#eq-boundary-condition-5}</span>
<span id="cb6-781"><a href="#cb6-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-782"><a href="#cb6-782" aria-hidden="true" tabindex="-1"></a>and at $x = R$, we have:</span>
<span id="cb6-783"><a href="#cb6-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-784"><a href="#cb6-784" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-785"><a href="#cb6-785" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-786"><a href="#cb6-786" aria-hidden="true" tabindex="-1"></a>aR + b = 0</span>
<span id="cb6-787"><a href="#cb6-787" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-788"><a href="#cb6-788" aria-hidden="true" tabindex="-1"></a>$$ {#eq-boundary-condition-6}</span>
<span id="cb6-789"><a href="#cb6-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-790"><a href="#cb6-790" aria-hidden="true" tabindex="-1"></a>So, $b = -aR$. Substituting in @eq-boundary-condition-5, we get:</span>
<span id="cb6-791"><a href="#cb6-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-792"><a href="#cb6-792" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-793"><a href="#cb6-793" aria-hidden="true" tabindex="-1"></a>a &amp;= \frac{1}{r - R}</span>
<span id="cb6-794"><a href="#cb6-794" aria-hidden="true" tabindex="-1"></a>b &amp;= -\frac{R}{r - R}</span>
<span id="cb6-795"><a href="#cb6-795" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-796"><a href="#cb6-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-797"><a href="#cb6-797" aria-hidden="true" tabindex="-1"></a>Consequently,</span>
<span id="cb6-798"><a href="#cb6-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-799"><a href="#cb6-799" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-800"><a href="#cb6-800" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-801"><a href="#cb6-801" aria-hidden="true" tabindex="-1"></a>h(x) &amp;= \frac{R - x}{R - r}</span>
<span id="cb6-802"><a href="#cb6-802" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-803"><a href="#cb6-803" aria-hidden="true" tabindex="-1"></a>$$  {#eq-h(x)-R1-case}</span>
<span id="cb6-804"><a href="#cb6-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-805"><a href="#cb6-805" aria-hidden="true" tabindex="-1"></a>### $\mathbb{R}^2$ case</span>
<span id="cb6-806"><a href="#cb6-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-807"><a href="#cb6-807" aria-hidden="true" tabindex="-1"></a>Let $h(x) = \log ||x||$. Then, at $||x||=r$, we have:</span>
<span id="cb6-808"><a href="#cb6-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-809"><a href="#cb6-809" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-810"><a href="#cb6-810" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-811"><a href="#cb6-811" aria-hidden="true" tabindex="-1"></a>a \log ||x|| + b &amp;= 1</span>
<span id="cb6-812"><a href="#cb6-812" aria-hidden="true" tabindex="-1"></a>a \log r + b &amp;= 1</span>
<span id="cb6-813"><a href="#cb6-813" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-814"><a href="#cb6-814" aria-hidden="true" tabindex="-1"></a>$$ {#eq-boundary-condition-1}</span>
<span id="cb6-815"><a href="#cb6-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-816"><a href="#cb6-816" aria-hidden="true" tabindex="-1"></a>At $||x||=R$, we have:</span>
<span id="cb6-817"><a href="#cb6-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-818"><a href="#cb6-818" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-819"><a href="#cb6-819" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-820"><a href="#cb6-820" aria-hidden="true" tabindex="-1"></a>a \log ||x|| + b &amp;= 0</span>
<span id="cb6-821"><a href="#cb6-821" aria-hidden="true" tabindex="-1"></a>a \log R + b &amp;= 0</span>
<span id="cb6-822"><a href="#cb6-822" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-823"><a href="#cb6-823" aria-hidden="true" tabindex="-1"></a>$$ {#eq-boundary-condition-2}</span>
<span id="cb6-824"><a href="#cb6-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-825"><a href="#cb6-825" aria-hidden="true" tabindex="-1"></a>Thus, from @eq-boundary-condition-2, $b = -a \log R$. Substituting the value for $b$ in @eq-boundary-condition-1, we have:</span>
<span id="cb6-826"><a href="#cb6-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-827"><a href="#cb6-827" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-828"><a href="#cb6-828" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-829"><a href="#cb6-829" aria-hidden="true" tabindex="-1"></a>a \log r - a \log R &amp;= 1\\</span>
<span id="cb6-830"><a href="#cb6-830" aria-hidden="true" tabindex="-1"></a>a &amp;= \frac{1}{\log r - \log R}</span>
<span id="cb6-831"><a href="#cb6-831" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-832"><a href="#cb6-832" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-833"><a href="#cb6-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-834"><a href="#cb6-834" aria-hidden="true" tabindex="-1"></a>Consequently, </span>
<span id="cb6-835"><a href="#cb6-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-836"><a href="#cb6-836" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-837"><a href="#cb6-837" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-838"><a href="#cb6-838" aria-hidden="true" tabindex="-1"></a>h(x) &amp;= \frac{\log ||x||}{\log r - \log R} -  \frac{1}{\log r - \log R} \log R\\</span>
<span id="cb6-839"><a href="#cb6-839" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{\log R - \log ||x||}{\log R - \log r}</span>
<span id="cb6-840"><a href="#cb6-840" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-841"><a href="#cb6-841" aria-hidden="true" tabindex="-1"></a>$$ {#eq-h(x)-R2-case}</span>
<span id="cb6-842"><a href="#cb6-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-843"><a href="#cb6-843" aria-hidden="true" tabindex="-1"></a>### $\mathbb{R}^d$, $d \geq 3$ case</span>
<span id="cb6-844"><a href="#cb6-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-845"><a href="#cb6-845" aria-hidden="true" tabindex="-1"></a>Let $h(x)=||x||^{2-d}$. At $||x||=r$, $a h(x) + b = 1$. So, we have:</span>
<span id="cb6-846"><a href="#cb6-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-847"><a href="#cb6-847" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-848"><a href="#cb6-848" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-849"><a href="#cb6-849" aria-hidden="true" tabindex="-1"></a>a r^{2-d} + b = 1</span>
<span id="cb6-850"><a href="#cb6-850" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-851"><a href="#cb6-851" aria-hidden="true" tabindex="-1"></a>$$ {#eq-boundary-condition-3}</span>
<span id="cb6-852"><a href="#cb6-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-853"><a href="#cb6-853" aria-hidden="true" tabindex="-1"></a>At $||x||=R$, $ah(x) + b = 0$. So, we have:</span>
<span id="cb6-854"><a href="#cb6-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-855"><a href="#cb6-855" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-856"><a href="#cb6-856" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-857"><a href="#cb6-857" aria-hidden="true" tabindex="-1"></a>a ||R||^{2-d} + b &amp;= 0</span>
<span id="cb6-858"><a href="#cb6-858" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-859"><a href="#cb6-859" aria-hidden="true" tabindex="-1"></a>$$  {#eq-boundary-condition-4}</span>
<span id="cb6-860"><a href="#cb6-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-861"><a href="#cb6-861" aria-hidden="true" tabindex="-1"></a>From @eq-boundary-condition-4, we get $b = -a R^{2-d}$. Substituting this value in @eq-boundary-condition-3, we get:</span>
<span id="cb6-862"><a href="#cb6-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-863"><a href="#cb6-863" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-864"><a href="#cb6-864" aria-hidden="true" tabindex="-1"></a>a r^{2-d} - aR^{2-d}  &amp;= 1\\</span>
<span id="cb6-865"><a href="#cb6-865" aria-hidden="true" tabindex="-1"></a>a &amp;= \frac{1}{r^{2-d} - R^{2-d}}</span>
<span id="cb6-866"><a href="#cb6-866" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-867"><a href="#cb6-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-868"><a href="#cb6-868" aria-hidden="true" tabindex="-1"></a>And </span>
<span id="cb6-869"><a href="#cb6-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-870"><a href="#cb6-870" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-871"><a href="#cb6-871" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-872"><a href="#cb6-872" aria-hidden="true" tabindex="-1"></a>b = - \frac{R^{2-d}}{r^{2-d} - R^{2-d}}</span>
<span id="cb6-873"><a href="#cb6-873" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-874"><a href="#cb6-874" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-875"><a href="#cb6-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-876"><a href="#cb6-876" aria-hidden="true" tabindex="-1"></a>Thus,</span>
<span id="cb6-877"><a href="#cb6-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-878"><a href="#cb6-878" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-879"><a href="#cb6-879" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-880"><a href="#cb6-880" aria-hidden="true" tabindex="-1"></a>h(x) &amp;= \frac{||x||^{2-d}}{r^{2-d} - R^{2-d}} - \frac{R^{2-d}}{r^{2-d} - R^{2-d}}\\</span>
<span id="cb6-881"><a href="#cb6-881" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{R^{2-d} - ||x||}{R^{2-d} - r^{2-d}}</span>
<span id="cb6-882"><a href="#cb6-882" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-883"><a href="#cb6-883" aria-hidden="true" tabindex="-1"></a>$$  {#eq-h(x)-R3-case}</span>
<span id="cb6-884"><a href="#cb6-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-885"><a href="#cb6-885" aria-hidden="true" tabindex="-1"></a>Collecting all the results together, we get:</span>
<span id="cb6-886"><a href="#cb6-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-887"><a href="#cb6-887" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-888"><a href="#cb6-888" aria-hidden="true" tabindex="-1"></a>h(x) = \begin{cases}</span>
<span id="cb6-889"><a href="#cb6-889" aria-hidden="true" tabindex="-1"></a>\frac{R - x}{R - r}, &amp; d=1 \\</span>
<span id="cb6-890"><a href="#cb6-890" aria-hidden="true" tabindex="-1"></a>\frac{\log R - \log ||x||}{\log R - \log r}, &amp; d=2 \\</span>
<span id="cb6-891"><a href="#cb6-891" aria-hidden="true" tabindex="-1"></a>\frac{R^{2-d} - ||x||^{2-d}}{R^{2-d} - r^{2-d}}, &amp; d \geq 3</span>
<span id="cb6-892"><a href="#cb6-892" aria-hidden="true" tabindex="-1"></a>\end{cases}</span>
<span id="cb6-893"><a href="#cb6-893" aria-hidden="true" tabindex="-1"></a>$$ {#eq-hx-in-Rd-case}</span>
<span id="cb6-894"><a href="#cb6-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-895"><a href="#cb6-895" aria-hidden="true" tabindex="-1"></a>Passing to the limit as $R \to \infty$, for $d=1$, we have:</span>
<span id="cb6-896"><a href="#cb6-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-897"><a href="#cb6-897" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-898"><a href="#cb6-898" aria-hidden="true" tabindex="-1"></a>\lim_{R \to \infty} h(x) &amp;= \lim_{R \to \infty} \frac{R - x}{R - r} \\</span>
<span id="cb6-899"><a href="#cb6-899" aria-hidden="true" tabindex="-1"></a>&amp;= \lim_{R \to \infty} \frac{1 - \frac{x}{R}}{1 - \frac{r}{R}}\\</span>
<span id="cb6-900"><a href="#cb6-900" aria-hidden="true" tabindex="-1"></a>&amp;= 1</span>
<span id="cb6-901"><a href="#cb6-901" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-902"><a href="#cb6-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-903"><a href="#cb6-903" aria-hidden="true" tabindex="-1"></a>For $d = 2$, we get:</span>
<span id="cb6-904"><a href="#cb6-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-905"><a href="#cb6-905" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-906"><a href="#cb6-906" aria-hidden="true" tabindex="-1"></a>\lim_{R \to \infty} h(x) &amp;= \lim_{R \to \infty} \frac{1 - \frac{\log x}{\log R}}{1 - \frac{\log r}{\log R}} \\</span>
<span id="cb6-907"><a href="#cb6-907" aria-hidden="true" tabindex="-1"></a>&amp;= 1</span>
<span id="cb6-908"><a href="#cb6-908" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-909"><a href="#cb6-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-910"><a href="#cb6-910" aria-hidden="true" tabindex="-1"></a>For $d = 3$, we get:</span>
<span id="cb6-911"><a href="#cb6-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-912"><a href="#cb6-912" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-913"><a href="#cb6-913" aria-hidden="true" tabindex="-1"></a>\lim_{R \to \infty}  h(x) &amp;= \lim_{R \to \infty} \frac{R^{2-d} - ||x||^{2-d}}{R^{2-d} - r^{2-d}}\\</span>
<span id="cb6-914"><a href="#cb6-914" aria-hidden="true" tabindex="-1"></a>&amp;= \left(\frac{||x||}{r}\right)^{2-d}</span>
<span id="cb6-915"><a href="#cb6-915" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-916"><a href="#cb6-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-917"><a href="#cb6-917" aria-hidden="true" tabindex="-1"></a>This concludes the proof. $\blacksquare$</span>
<span id="cb6-918"><a href="#cb6-918" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb6-919"><a href="#cb6-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-920"><a href="#cb6-920" aria-hidden="true" tabindex="-1"></a>::: {#exm-brownian-path-in-Rd-never-hits-a-given-point}</span>
<span id="cb6-921"><a href="#cb6-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-922"><a href="#cb6-922" aria-hidden="true" tabindex="-1"></a>We get more from the above proof. Indeed, in dimension $d \geq 2$, it implies that the probability that a Brownian motion starting at $B_0 = x$ eventually hits any other point $y$ is $0$. Indeed, if we take $y = 0$ and $x \neq 0$, we have:</span>
<span id="cb6-923"><a href="#cb6-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-924"><a href="#cb6-924" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-925"><a href="#cb6-925" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-926"><a href="#cb6-926" aria-hidden="true" tabindex="-1"></a>\mathbb{P}(\exists t &gt; 0: B_t = 0) &amp;= \lim_{R \to \infty} \lim_{r \to \infty} \mathbb{P}(\tau_r &lt; \tau_R')<span class="sc">\\</span></span>
<span id="cb6-927"><a href="#cb6-927" aria-hidden="true" tabindex="-1"></a>&amp;= \lim_{R \to \infty} \lim_{r \to \infty} \frac{R^{2-d} - ||x||^{2-d}}{R^{2-d} - r^{2-d}}<span class="sc">\\</span></span>
<span id="cb6-928"><a href="#cb6-928" aria-hidden="true" tabindex="-1"></a>&amp;=\lim_{R \to \infty}  \lim_{r \to \infty} \frac{(R/r)^{2-d} - (||x||/r)^{2-d}}{(R/r)^{2-d} - 1}<span class="sc">\\</span></span>
<span id="cb6-929"><a href="#cb6-929" aria-hidden="true" tabindex="-1"></a>&amp;= \lim_{R \to \infty} 0<span class="sc">\\</span></span>
<span id="cb6-930"><a href="#cb6-930" aria-hidden="true" tabindex="-1"></a>&amp;= 0</span>
<span id="cb6-931"><a href="#cb6-931" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-932"><a href="#cb6-932" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-933"><a href="#cb6-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-934"><a href="#cb6-934" aria-hidden="true" tabindex="-1"></a>Here, we shrink the inner radius to $0$ first and then we let the outer radius go to infinity after. It remains to take the limits of the expression obtained in equation @eq-hx-in-Rd-case. The first limit $r \to 0$ gives $0$ right away.</span>
<span id="cb6-935"><a href="#cb6-935" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb6-936"><a href="#cb6-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-937"><a href="#cb6-937" aria-hidden="true" tabindex="-1"></a><span class="fu">## Dynkin's Formula and the Dirichlet Problem</span></span>
<span id="cb6-938"><a href="#cb6-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-939"><a href="#cb6-939" aria-hidden="true" tabindex="-1"></a>In the last section, we translated the problem of recurrence and transience of Brownian motion in terms of a *boundary value problem*: we needed to find a particular function $h$ that solves a PDE (that is, $\nabla^2 h=0$) in a certain region of space(the annulus) and that satisfies given boundary conditions (the function is $1$ on the inner circle and $0$ on the outer circle). This is a particular case of the *Dirichlet problem* in PDE.</span>
<span id="cb6-940"><a href="#cb6-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-941"><a href="#cb6-941" aria-hidden="true" tabindex="-1"></a>Consider a region $\mathcal{O} \subset \mathbb{R}^d$. $\mathcal{O}$ is an open ball. That is, for all $x \in \mathcal{O}$, there exists $\epsilon&gt;0$, such that $V_\epsilon(x) = <span class="sc">\{</span>y : ||y - x|| &lt; \epsilon<span class="sc">\}</span>$ is contained in $\mathcal{O}$. $\mathcal{O}$ doesn't contain boundary points $\partial \mathcal{O}$. In the proof of @thm-recurrence-and-transience-of-brownian-motion, the region was the annulus $<span class="sc">\{</span>x: r &lt; ||x|| &lt; R<span class="sc">\}</span>$ and the boundary was given by the spheres $<span class="sc">\{</span>x :||x|| = r<span class="sc">\}</span>$ and $<span class="sc">\{</span>x: ||x||=R<span class="sc">\}</span>$. The Dirichlet problem in $\mathcal{O}$ can be stated as follows:</span>
<span id="cb6-942"><a href="#cb6-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-943"><a href="#cb6-943" aria-hidden="true" tabindex="-1"></a>Let $f:\partial\mathcal{O} \to \mathbb{R}$ be a function on the boundary of $\mathcal{O}$. Can we extend the function $f$ to $O$ in such a way that the extension is harmonic on $\mathcal{O}$ and coincides with $f$ on the boundary?</span>
<span id="cb6-944"><a href="#cb6-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-945"><a href="#cb6-945" aria-hidden="true" tabindex="-1"></a>In the instance of the proof of the @thm-recurrence-and-transience-of-brownian-motion, we knew the solution of the problem, thanks to @eq-example-of-harmonic-function. The only job left to do was to adjust some parameters to fit the boundary conditions. It turns out that the formalism of stochastic calculus allows us to express the solution of the Dirichlet problem as an average over Brownian paths for general regions of space and boundary conditions. To do so, we look at a twist on the Ito's formula called the *Dynkin's formula*.</span>
<span id="cb6-946"><a href="#cb6-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-947"><a href="#cb6-947" aria-hidden="true" tabindex="-1"></a>Let $x$ be a point in $\mathcal{O}$. Consider a Brownian motion $(B_t,t\geq 0)$ starting at $x$, $B_0 = x$. To emphasize the dependence on $x$, we write $\mathbb{P}_x$ and $\mathbb{E}_x$ for the probability and the expectation for the Brownian motion. Dykin's formula is obtained by merging @cor-brownian-martingales for the Brownian martingales together with the optional stopping theorem. More precisely, consider $f \in C^2(\mathbb{R}^d)$ that satisfies the assumption of the @cor-brownian-martingales. We then have that the process:</span>
<span id="cb6-948"><a href="#cb6-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-949"><a href="#cb6-949" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-950"><a href="#cb6-950" aria-hidden="true" tabindex="-1"></a>M_t &amp;= f(B_t) - \frac{1}{2}\int_{0}^t \nabla^2 f(B_s) ds, \quad t \geq 0</span>
<span id="cb6-951"><a href="#cb6-951" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-952"><a href="#cb6-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-953"><a href="#cb6-953" aria-hidden="true" tabindex="-1"></a>is a Brownian martingale. </span>
<span id="cb6-954"><a href="#cb6-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-955"><a href="#cb6-955" aria-hidden="true" tabindex="-1"></a>Consider also the stopping time $\tau = \min <span class="sc">\{</span>t \geq 0 : B_t \in \mathcal{O}^C<span class="sc">\}</span>$. This is the first exit time of $\mathcal{O}$ of the Brownian motion path. Then, if the assumptions of the optional stopping theorem are fulfilled, we get *Dynkin's formula*:</span>
<span id="cb6-956"><a href="#cb6-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-957"><a href="#cb6-957" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-958"><a href="#cb6-958" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-959"><a href="#cb6-959" aria-hidden="true" tabindex="-1"></a>\mathbb{E}<span class="co">[</span><span class="ot">M_\tau</span><span class="co">]</span> = \mathbb{E}<span class="co">[</span><span class="ot">f(B_\tau)</span><span class="co">]</span> - \frac{1}{2} \mathbb{E}\left<span class="co">[</span><span class="ot">\int_0^\tau \nabla^2 f(B_s)ds\right</span><span class="co">]</span> = f(B_0) = M_0</span>
<span id="cb6-960"><a href="#cb6-960" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-961"><a href="#cb6-961" aria-hidden="true" tabindex="-1"></a>$$ {#eq-dynkins-formula}</span>
<span id="cb6-962"><a href="#cb6-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-963"><a href="#cb6-963" aria-hidden="true" tabindex="-1"></a>As an application of Dynkin's formula, let's express the solution of the Dirichlet problem as an average over Brownian motion. If $f$ is harmonic in $\mathcal{O}$, then $\nabla^2 f = 0$ in $\mathcal{O}$, so the process $(f(B_t),t\leq \tau)$ is itself a martingale. Note that since $\mathcal{O}$ is bounded, this is a bounded martingale! Moreover, the integrands $\partial_i f(B_s)$, $1 \leq i \leq d$, are bounded. We conclude that the solution to the Dirichlet problem can be represented as follows:</span>
<span id="cb6-964"><a href="#cb6-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-965"><a href="#cb6-965" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-966"><a href="#cb6-966" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-967"><a href="#cb6-967" aria-hidden="true" tabindex="-1"></a>f(x) = \mathbb{E}_x[f(B_\tau)], \quad x \in \mathcal{O}</span>
<span id="cb6-968"><a href="#cb6-968" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-969"><a href="#cb6-969" aria-hidden="true" tabindex="-1"></a>$$ {#eq-dynkins-formula-applied-to-dirichlet-problem}</span>
<span id="cb6-970"><a href="#cb6-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-971"><a href="#cb6-971" aria-hidden="true" tabindex="-1"></a>In other words, the value of the harmonic function of $f$ at $x$ is given by the average over the Brownian paths of the value of the function at the exit point of the path on the boundary of $\mathcal{O}$. Equation @eq-dynkins-formula-applied-to-dirichlet-problem does not prove the existence of the solution to the Dirichlet problem, as we assume that such a function exists. Existence of the solution to the Dirichlet problem can be shown this way, assuming the region $\mathcal{O}$ and the function on the boundary are nice enough. However, note that the averaging on the right-hand side of the formula makes sense even in the case where $f$ is simply defined on the boundary $\partial \mathcal{O}$. We then define a posteriori the *harmonic extension* of $f$ inside $\mathcal{O}$ by defining its value at $x$ as $\mathbb{E}_x[f(B_\tau)]$. </span>
<span id="cb6-972"><a href="#cb6-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-973"><a href="#cb6-973" aria-hidden="true" tabindex="-1"></a><span class="fu">## Numerical Projects</span></span>
<span id="cb6-974"><a href="#cb6-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-975"><a href="#cb6-975" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises</span></span>
<span id="cb6-976"><a href="#cb6-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-977"><a href="#cb6-977" aria-hidden="true" tabindex="-1"></a>::: {#exr-gaussian-integration-by-parts}</span>
<span id="cb6-978"><a href="#cb6-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-979"><a href="#cb6-979" aria-hidden="true" tabindex="-1"></a>**Gaussian Integration by parts.**</span>
<span id="cb6-980"><a href="#cb6-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-981"><a href="#cb6-981" aria-hidden="true" tabindex="-1"></a>(a) Let $Z$ be a standard Gaussian random variable. Show using integration by parts that for a differentiable function $g$:</span>
<span id="cb6-982"><a href="#cb6-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-983"><a href="#cb6-983" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-984"><a href="#cb6-984" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-985"><a href="#cb6-985" aria-hidden="true" tabindex="-1"></a>\mathbb{E}<span class="co">[</span><span class="ot">Z g(Z)</span><span class="co">]</span> = \mathbb{E}<span class="co">[</span><span class="ot">g'(Z)</span><span class="co">]</span></span>
<span id="cb6-986"><a href="#cb6-986" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-987"><a href="#cb6-987" aria-hidden="true" tabindex="-1"></a>$$ {#eq-gaussian-integration-by-parts}</span>
<span id="cb6-988"><a href="#cb6-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-989"><a href="#cb6-989" aria-hidden="true" tabindex="-1"></a>where we assume that both expectations are well-defined.</span>
<span id="cb6-990"><a href="#cb6-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-991"><a href="#cb6-991" aria-hidden="true" tabindex="-1"></a>(b) Use this to recover the expression for the moments for $\mathbb{E}<span class="co">[</span><span class="ot">Z^{2j}</span><span class="co">]</span>,j \in \mathbb{N}$.</span>
<span id="cb6-992"><a href="#cb6-992" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb6-993"><a href="#cb6-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-994"><a href="#cb6-994" aria-hidden="true" tabindex="-1"></a>*Solution*.</span>
<span id="cb6-995"><a href="#cb6-995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-996"><a href="#cb6-996" aria-hidden="true" tabindex="-1"></a>We have:</span>
<span id="cb6-997"><a href="#cb6-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-998"><a href="#cb6-998" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-999"><a href="#cb6-999" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-1000"><a href="#cb6-1000" aria-hidden="true" tabindex="-1"></a>\mathbb{E}<span class="co">[</span><span class="ot">g'(Z)</span><span class="co">]</span> &amp;= \int_{-\infty}^{\infty}\phi(z) \cdot g'(z) dz <span class="sc">\\</span></span>
<span id="cb6-1001"><a href="#cb6-1001" aria-hidden="true" tabindex="-1"></a>&amp;= \left<span class="co">[</span><span class="ot">\frac{e^{-z^2/2}}{\sqrt{2\pi}}\cdot g(z)\right</span><span class="co">]</span>_{-\infty}^{\infty} - \int_{-\infty}^{\infty} g(z) \frac{-ze^{-z^2/2}}{\sqrt{2\pi}}dz <span class="sc">\\</span></span>
<span id="cb6-1002"><a href="#cb6-1002" aria-hidden="true" tabindex="-1"></a>&amp;= 0 + \int_{-\infty}^{\infty} z g(z) \phi(z)dz<span class="sc">\\</span></span>
<span id="cb6-1003"><a href="#cb6-1003" aria-hidden="true" tabindex="-1"></a>&amp;= \mathbb{E}<span class="co">[</span><span class="ot">Zg(Z)</span><span class="co">]</span></span>
<span id="cb6-1004"><a href="#cb6-1004" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-1005"><a href="#cb6-1005" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-1006"><a href="#cb6-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1007"><a href="#cb6-1007" aria-hidden="true" tabindex="-1"></a>Moreover, we can write:</span>
<span id="cb6-1008"><a href="#cb6-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1009"><a href="#cb6-1009" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-1010"><a href="#cb6-1010" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb6-1011"><a href="#cb6-1011" aria-hidden="true" tabindex="-1"></a>\mathbb{E}<span class="co">[</span><span class="ot">Z^{2n}</span><span class="co">]</span> &amp;= \mathbb{E}<span class="co">[</span><span class="ot">Z \cdot Z^{2n-1}</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb6-1012"><a href="#cb6-1012" aria-hidden="true" tabindex="-1"></a>&amp;= \mathbb{E}<span class="co">[</span><span class="ot">Z \cdot g(Z)</span><span class="co">]</span>, \quad <span class="sc">\{</span> \text{ where }g(x)=x^{2n - 1}<span class="sc">\}</span> <span class="sc">\\</span></span>
<span id="cb6-1013"><a href="#cb6-1013" aria-hidden="true" tabindex="-1"></a>&amp;= \mathbb{E}<span class="co">[</span><span class="ot">g'(Z)</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb6-1014"><a href="#cb6-1014" aria-hidden="true" tabindex="-1"></a>&amp;= (2n - 1) \mathbb{E}<span class="co">[</span><span class="ot">Z^{(2n - 2)}</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb6-1015"><a href="#cb6-1015" aria-hidden="true" tabindex="-1"></a>&amp; \vdots <span class="sc">\\</span></span>
<span id="cb6-1016"><a href="#cb6-1016" aria-hidden="true" tabindex="-1"></a>&amp;= (2n - 1)\cdots 5 \cdot 3 \cdot \mathbb{E}<span class="co">[</span><span class="ot">Z^2</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb6-1017"><a href="#cb6-1017" aria-hidden="true" tabindex="-1"></a>&amp;= (2n - 1)\cdots 5 \cdot 3 \cdot 1</span>
<span id="cb6-1018"><a href="#cb6-1018" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb6-1019"><a href="#cb6-1019" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-1020"><a href="#cb6-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1021"><a href="#cb6-1021" aria-hidden="true" tabindex="-1"></a>::: {#exr-the-heat-equation}</span>
<span id="cb6-1022"><a href="#cb6-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1023"><a href="#cb6-1023" aria-hidden="true" tabindex="-1"></a>**The Heat Equation**. </span>
<span id="cb6-1024"><a href="#cb6-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1025"><a href="#cb6-1025" aria-hidden="true" tabindex="-1"></a>Use the Gaussian integration by parts identity to check that the solution $f(t,x)$ to the *heat equation* </span>
<span id="cb6-1026"><a href="#cb6-1026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1027"><a href="#cb6-1027" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-1028"><a href="#cb6-1028" aria-hidden="true" tabindex="-1"></a>\frac{\partial f}{\partial t} = \frac{1}{2}\nabla^2 f \quad \text{f(0,x) = g(x)}</span>
<span id="cb6-1029"><a href="#cb6-1029" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-1030"><a href="#cb6-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1031"><a href="#cb6-1031" aria-hidden="true" tabindex="-1"></a>for some function $g:\mathbb{R}^d \to \mathbb{R}$ is given by:</span>
<span id="cb6-1032"><a href="#cb6-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1033"><a href="#cb6-1033" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-1034"><a href="#cb6-1034" aria-hidden="true" tabindex="-1"></a>f(t,x) = \mathbb{E}_{x}<span class="co">[</span><span class="ot">g(B_t)</span><span class="co">]</span></span>
<span id="cb6-1035"><a href="#cb6-1035" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb6-1036"><a href="#cb6-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1037"><a href="#cb6-1037" aria-hidden="true" tabindex="-1"></a>where $(B_t,t\geq 0)$ is a brownian motion in $\mathbb{R}^d$ starting at $B_0 = x$.</span>
<span id="cb6-1038"><a href="#cb6-1038" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb6-1039"><a href="#cb6-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1040"><a href="#cb6-1040" aria-hidden="true" tabindex="-1"></a>*Solution*.</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>