<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Quasar">
<meta name="dcterms.date" content="2025-12-12">

<title>quantdev.blog - The C++ casts</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;800&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap')
</style>
<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9993009899870547" crossorigin="anonymous"></script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../.././symbol.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">quantdev.blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../sell_side_quant_critical_path.html" rel="" target="">
 <span class="menu-text">Sell-side Quant</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../roadmap.html" rel="" target="">
 <span class="menu-text">C++ Roadmap</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://patreon.com/u59411143?utm_medium=unknown&amp;utm_source=join_link&amp;utm_campaign=creatorshare_creator&amp;utm_content=copyLink" rel="" target=""><i class="bi bi-patreon" role="img">
</i> 
 <span class="menu-text">Become a patreon</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/quasar-chunawala" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="http://linkedin.com/in/quasar-chunawala" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml" rel="" target=""><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">The C++ casts</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">C++</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Quasar </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 12, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-c-casts" id="toc-the-c-casts" class="nav-link active" data-scroll-target="#the-c-casts">The C++ casts</a>
  <ul class="collapse">
  <li><a href="#your-best-friend-most-of-the-time---static_cast" id="toc-your-best-friend-most-of-the-time---static_cast" class="nav-link" data-scroll-target="#your-best-friend-most-of-the-time---static_cast">Your best friend (most of the time) - <code>static_cast</code></a></li>
  <li><a href="#a-sign-somethings-wrong---dynamic_cast" id="toc-a-sign-somethings-wrong---dynamic_cast" class="nav-link" data-scroll-target="#a-sign-somethings-wrong---dynamic_cast">A sign something’s wrong - <code>dynamic_cast</code></a></li>
  <li><a href="#playing-tricks-with-safety---const_cast" id="toc-playing-tricks-with-safety---const_cast" class="nav-link" data-scroll-target="#playing-tricks-with-safety---const_cast">Playing tricks with safety - <code>const_cast</code></a></li>
  <li><a href="#believe-me-compiler---reinterprete_cast" id="toc-believe-me-compiler---reinterprete_cast" class="nav-link" data-scroll-target="#believe-me-compiler---reinterprete_cast"><em>Believe me compiler</em> - <code>reinterprete_cast</code></a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="the-c-casts" class="level1">
<h1>The C++ casts</h1>
<p>Traditionally, C++ has supported four ways to perform those explicit type conversions we call casts - <code>static_cast</code>, <code>dynamic_cast</code>, <code>const_cast</code> and <code>reinterprete_cast</code>. C++11 added a fifth one <code>duration_cast</code>. Finally, C++20 introduced a sixth case <code>bit_cast</code>.</p>
<section id="your-best-friend-most-of-the-time---static_cast" class="level2">
<h2 class="anchored" data-anchor-id="your-best-friend-most-of-the-time---static_cast">Your best friend (most of the time) - <code>static_cast</code></h2>
<p>The best, most efficient tool in our type-casting toolset is <code>static_cast</code>. <code>static_cast</code> performs compile-time conversion between related types. It is mostly safe, costs essentially nothing in most cases, and can be used in a <code>constexpr</code> context.</p>
<p>You can also use <code>static_cast</code> in situations involving potential risks, such as converting an <code>int</code> to a <code>float</code> or vice versa. In the latter case, it explicitly acknowledges the loss of the decimal part.</p>
<p>You can can use <code>static_cast</code> to cast a pointer or a reference from a derived class to one of its direct or indirect base classes (as long as there is no ambiguity), which is totally safe.</p>
<p>Casting from a base class to a derived class is extremely risky if the cast is incorrect, as it does not perform runtime checks.</p>
<p>Here are some examples:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1"></a><span class="pp">#include </span><span class="im">&lt;print&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">struct</span> B<span class="op">{</span> </span>
<span id="cb1-4"><a href="#cb1-4"></a>    <span class="kw">virtual</span> <span class="op">~</span>B<span class="op">()</span> <span class="op">=</span> <span class="cf">default</span><span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="op">};</span></span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="kw">struct</span> D0<span class="op">:</span> B <span class="op">{</span> <span class="co">/*...*/</span> <span class="op">};</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="kw">struct</span> D1<span class="op">:</span> B <span class="op">{</span> <span class="co">/*...*/</span> <span class="op">};</span></span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="kw">class</span> X<span class="op">{</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>    X<span class="op">(</span><span class="dt">int</span><span class="op">,</span> <span class="dt">double</span><span class="op">){}</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="op">};</span></span>
<span id="cb1-14"><a href="#cb1-14"></a></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="dt">void</span> f<span class="op">(</span>D0<span class="op">*){}</span></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="dt">void</span> f<span class="op">(</span>D1<span class="op">*){}</span></span>
<span id="cb1-17"><a href="#cb1-17"></a></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="dt">int</span> main<span class="op">()</span></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="op">{</span></span>
<span id="cb1-20"><a href="#cb1-20"></a>    <span class="at">const</span> <span class="dt">float</span> x <span class="op">=</span> <span class="fl">3.14159</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb1-21"><a href="#cb1-21"></a>    <span class="dt">int</span> n <span class="op">=</span> <span class="kw">static_cast</span><span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;(</span>x<span class="op">);</span>    <span class="co">// ok, no warning</span></span>
<span id="cb1-22"><a href="#cb1-22"></a></span>
<span id="cb1-23"><a href="#cb1-23"></a>    X x0<span class="op">{</span> <span class="dv">3</span><span class="op">,</span> <span class="fl">3.5</span> <span class="op">};</span> <span class="co">// ok</span></span>
<span id="cb1-24"><a href="#cb1-24"></a></span>
<span id="cb1-25"><a href="#cb1-25"></a>    X x1<span class="op">(</span><span class="fl">3.5</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span>   <span class="co">// compiles, </span></span>
<span id="cb1-26"><a href="#cb1-26"></a>    <span class="co">// probably warns (narrowing conversion)</span></span>
<span id="cb1-27"><a href="#cb1-27"></a></span>
<span id="cb1-28"><a href="#cb1-28"></a>    <span class="co">//X x2{3.5, 0}; // does not compile</span></span>
<span id="cb1-29"><a href="#cb1-29"></a>                    <span class="co">// narrowing is not allowed within braces</span></span>
<span id="cb1-30"><a href="#cb1-30"></a></span>
<span id="cb1-31"><a href="#cb1-31"></a>    X x3<span class="op">{</span> <span class="kw">static_cast</span><span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;(</span>x<span class="op">),</span> <span class="dv">3</span> <span class="op">};</span> <span class="co">// ok</span></span>
<span id="cb1-32"><a href="#cb1-32"></a></span>
<span id="cb1-33"><a href="#cb1-33"></a>    D0 d0<span class="op">;</span></span>
<span id="cb1-34"><a href="#cb1-34"></a>    <span class="co">// illegal, no base-derived relatonship between D0 and D1</span></span>
<span id="cb1-35"><a href="#cb1-35"></a>    <span class="co">//D1* d1 = static_cast&lt;D1*&gt;(&amp;d0);</span></span>
<span id="cb1-36"><a href="#cb1-36"></a></span>
<span id="cb1-37"><a href="#cb1-37"></a>    B<span class="op">*</span> b <span class="op">=</span> <span class="kw">static_cast</span><span class="op">&lt;</span>B<span class="op">*&gt;(&amp;</span>d0<span class="op">);</span>     <span class="co">// ok</span></span>
<span id="cb1-38"><a href="#cb1-38"></a>    <span class="co">// f(*b)                         // illegal</span></span>
<span id="cb1-39"><a href="#cb1-39"></a>    f<span class="op">(</span><span class="kw">static_cast</span><span class="op">&lt;</span>D0<span class="op">*&gt;(</span>b<span class="op">));</span>         <span class="co">// ok</span></span>
<span id="cb1-40"><a href="#cb1-40"></a>    f<span class="op">(</span><span class="kw">static_cast</span><span class="op">&lt;</span>D1<span class="op">*&gt;(</span>b<span class="op">));</span>         <span class="co">// compiles, but very dangerous</span></span>
<span id="cb1-41"><a href="#cb1-41"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-42"><a href="#cb1-42"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><a href="https://compiler-explorer.com/z/Y7684n73e">Compiler Explorer</a> Pay special attention to the last use of <code>static_cast</code> of the preceding example - converting from a base class to one of its derived classes is appropriately done with <code>static_cast</code>. However, you must ensure that the conversion leads to an object of the chosen type, as there is no run-time verification made of the validity of that conversion. Only compile-time checks are done.</p>
</section>
<section id="a-sign-somethings-wrong---dynamic_cast" class="level2">
<h2 class="anchored" data-anchor-id="a-sign-somethings-wrong---dynamic_cast">A sign something’s wrong - <code>dynamic_cast</code></h2>
<p>There will be cases where you have a pointer or a reference to an object of some class type and that happens to be different (but related to) the type needed. This often happens - for example, in game engines where most classes derive from some <code>Component</code> base and functions tend to take <code>Component*</code> arguments but need to access members from an object of the derived class they expect.</p>
<p>The main problem here is, typically that the function’s interface is wrong - it accepts arguments of types that are insufficiently precise. Still, we all have software to deliver, and sometimes we need to make things work even though we made some choices along the way, that we will revisit later on.</p>
<p>The safe way to do such casts is <code>dynamic_cast</code>. This cast lets you convert a pointer or reference from one type to another, related type in a way that lets you test whether the conversion worked or not; with pointers, an incorrect conversion yields <code>nullptr</code>, whereas with references, an incorrect conversion throws <code>std::bad_cast</code>. The relatedness of types with <code>dynamic_cast</code> is not limited to base-derived relationships and includes casting from one base to another base in a multiple inheritance design. However, note that in most cases, <code>dynamic_cast</code> requires that the expression that is cast to another type is of the polymorphic type, in the sense that it must have atleast one <code>virtual</code> member function.</p>
<p>Here are some examples:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="kw">struct</span> B0<span class="op">{</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>    <span class="kw">virtual</span> <span class="dt">int</span> f<span class="op">()</span> <span class="at">const</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>    <span class="kw">virtual</span> <span class="op">~</span>B0<span class="op">()</span> <span class="op">=</span> <span class="cf">default</span><span class="op">;</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="op">};</span></span>
<span id="cb2-7"><a href="#cb2-7"></a></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="kw">struct</span> B1<span class="op">{</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>    <span class="kw">virtual</span> <span class="dt">int</span> g<span class="op">()</span> <span class="at">const</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-10"><a href="#cb2-10"></a>    <span class="kw">virtual</span> <span class="op">~</span>B1<span class="op">()</span> <span class="op">=</span> <span class="cf">default</span><span class="op">;</span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="op">};</span></span>
<span id="cb2-12"><a href="#cb2-12"></a></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="kw">class</span> D0 <span class="op">:</span> <span class="kw">public</span> B0<span class="op">{</span></span>
<span id="cb2-14"><a href="#cb2-14"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb2-15"><a href="#cb2-15"></a>    <span class="dt">int</span> f<span class="op">()</span> <span class="at">const</span> <span class="kw">override</span><span class="op">{</span></span>
<span id="cb2-16"><a href="#cb2-16"></a>        <span class="cf">return</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb2-17"><a href="#cb2-17"></a>    <span class="op">}</span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="op">};</span></span>
<span id="cb2-19"><a href="#cb2-19"></a></span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="kw">class</span> D1 <span class="op">:</span> <span class="kw">public</span> B1<span class="op">{</span></span>
<span id="cb2-21"><a href="#cb2-21"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb2-22"><a href="#cb2-22"></a>    <span class="dt">int</span> g<span class="op">()</span> <span class="at">const</span> <span class="kw">override</span><span class="op">{</span></span>
<span id="cb2-23"><a href="#cb2-23"></a>        <span class="cf">return</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb2-24"><a href="#cb2-24"></a>    <span class="op">}</span></span>
<span id="cb2-25"><a href="#cb2-25"></a><span class="op">};</span></span>
<span id="cb2-26"><a href="#cb2-26"></a></span>
<span id="cb2-27"><a href="#cb2-27"></a><span class="kw">class</span> D <span class="op">:</span> <span class="kw">public</span> D0<span class="op">,</span> <span class="kw">public</span> D1<span class="op">{};</span></span>
<span id="cb2-28"><a href="#cb2-28"></a></span>
<span id="cb2-29"><a href="#cb2-29"></a><span class="dt">int</span> f<span class="op">(</span>D<span class="op">*</span> p<span class="op">){</span></span>
<span id="cb2-30"><a href="#cb2-30"></a>    <span class="cf">return</span> p <span class="op">?</span> p <span class="op">-&gt;</span> f<span class="op">()</span> <span class="op">+</span> p<span class="op">-&gt;</span>g<span class="op">()</span> <span class="op">:</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-31"><a href="#cb2-31"></a><span class="op">}</span></span>
<span id="cb2-32"><a href="#cb2-32"></a></span>
<span id="cb2-33"><a href="#cb2-33"></a><span class="co">// g has the wrong interfacce: it accepts a D0&amp; but </span></span>
<span id="cb2-34"><a href="#cb2-34"></a><span class="co">// tries to use it as a D1&amp;, which makes sense if the </span></span>
<span id="cb2-35"><a href="#cb2-35"></a><span class="co">// referred object is publiclly D0 and D1 (for example)</span></span>
<span id="cb2-36"><a href="#cb2-36"></a><span class="co">// class D</span></span>
<span id="cb2-37"><a href="#cb2-37"></a><span class="dt">int</span> g<span class="op">(</span>D0<span class="op">&amp;</span> d0<span class="op">){</span></span>
<span id="cb2-38"><a href="#cb2-38"></a>    D1<span class="op">&amp;</span> d1 <span class="op">=</span> <span class="kw">dynamic_cast</span><span class="op">&lt;</span>D1<span class="op">&amp;&gt;(</span>d0<span class="op">);</span> <span class="co">//throws if wrong</span></span>
<span id="cb2-39"><a href="#cb2-39"></a>    <span class="cf">return</span> d1<span class="op">.</span>g<span class="op">();</span></span>
<span id="cb2-40"><a href="#cb2-40"></a><span class="op">}</span></span>
<span id="cb2-41"><a href="#cb2-41"></a></span>
<span id="cb2-42"><a href="#cb2-42"></a><span class="dt">int</span> main<span class="op">()</span></span>
<span id="cb2-43"><a href="#cb2-43"></a><span class="op">{</span></span>
<span id="cb2-44"><a href="#cb2-44"></a>    D d<span class="op">;</span></span>
<span id="cb2-45"><a href="#cb2-45"></a>    f<span class="op">(&amp;</span>d<span class="op">);</span>      <span class="co">// ok</span></span>
<span id="cb2-46"><a href="#cb2-46"></a>    g<span class="op">(</span>d<span class="op">);</span>       <span class="co">// ok, D is a D0</span></span>
<span id="cb2-47"><a href="#cb2-47"></a>    D0 d0<span class="op">;</span></span>
<span id="cb2-48"><a href="#cb2-48"></a>    <span class="co">// calls f(nullptr) as &amp;d0 does not point to a D</span></span>
<span id="cb2-49"><a href="#cb2-49"></a>    <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> f<span class="op">(</span><span class="kw">dynamic_cast</span><span class="op">&lt;</span>D<span class="op">*&gt;(&amp;</span>d0<span class="op">))</span> <span class="op">&lt;&lt;</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="cb2-50"><a href="#cb2-50"></a></span>
<span id="cb2-51"><a href="#cb2-51"></a>    <span class="cf">try</span><span class="op">{</span></span>
<span id="cb2-52"><a href="#cb2-52"></a>        g<span class="op">(</span>d0<span class="op">);</span>  <span class="co">// compile, but will throw std::bad_cast</span></span>
<span id="cb2-53"><a href="#cb2-53"></a>    <span class="op">}</span><span class="cf">catch</span><span class="op">(</span><span class="bu">std::</span>bad_cast<span class="op">&amp;</span> ex<span class="op">){</span></span>
<span id="cb2-54"><a href="#cb2-54"></a>        <span class="bu">std::</span>cerr<span class="op"> &lt;&lt;</span> <span class="st">"Nice try!"</span> <span class="op">&lt;&lt;</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">;</span></span>
<span id="cb2-55"><a href="#cb2-55"></a>    <span class="op">}</span></span>
<span id="cb2-56"><a href="#cb2-56"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-57"><a href="#cb2-57"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><a href="https://compiler-explorer.com/z/fdq4qYaKE">Compiler Explorer</a></p>
<p>Note that, even though this example displays a message when <code>std::bad_cast</code> ism thrown, this is in no way what we could call exception handling; we did not solve the problem, and code execution continues in a potentially corrupt state, which could make things worse in more serious code. In a toy example such as this, just letting the code fail and stop executing would also have been a more reasonable choice.</p>
<p>Note that, the use of <code>dynamic_cast</code> requires binaries to be compiled with <strong>runtime type information(RTTI)</strong> included, leading to larger binaries. Unsurprisingly; due to these costs, some application domains will tend to avoid this cost.</p>
</section>
<section id="playing-tricks-with-safety---const_cast" class="level2">
<h2 class="anchored" data-anchor-id="playing-tricks-with-safety---const_cast">Playing tricks with safety - <code>const_cast</code></h2>
<p>Neither <code>static_cast</code> nor <code>dynamic_cast</code>, can change <em>cv</em>-qualifiers of an expression. To do this, you need <code>const_cast</code>. With <code>const_cast</code>, you can add or remove the <code>const</code> or <code>volatile</code> qualifiers from an expression. As you might guess, this only makes sense on a pointer or a reference.</p>
</section>
<section id="believe-me-compiler---reinterprete_cast" class="level2">
<h2 class="anchored" data-anchor-id="believe-me-compiler---reinterprete_cast"><em>Believe me compiler</em> - <code>reinterprete_cast</code></h2>
<p>Sometimes, you just have to make the compiler believe you. For example, knowing <code>sizeof(int) == 4</code> on your platform, you might want to treat <code>int</code> as <code>char[4]</code> to interoperate with an existing API that expects that type. Note that, you should ensure that this property holds (maybe through <code>static_assert</code>), rather than relying on the belief that the property holds on all platforms (it does not).</p>
<p>That’s what <code>reinterpret_cast</code> gives you - the ability to cast a pointer of some type to a pointer of an unrelated type. This can be used in situations where you seek to benefit from pointer-interconvertibility, just as this this can be used to lie to the type system in several rather dangerous and non-portable ways.</p>
<p>Also note that, <code>reinterpret_cast</code> only changes the type associated with an expression - for example, it does not perform the slight address adjustments, that <code>static_cast</code> would make when converting from a derived class to a base class in multiple inheritance situations.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">struct</span> B0<span class="op">{}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ul>
<li><a href="https://amzn.eu/d/7bRAPXQ">C++ Memory Management</a> by <em>Patrice Roy</em>, Packt Publishers</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="quasar-chunawala/quantdev" data-repo-id="R_kgDOL2t5-A" data-category="General" data-category-id="DIC_kwDOL2t5-M4ClndQ" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->



</body></html>